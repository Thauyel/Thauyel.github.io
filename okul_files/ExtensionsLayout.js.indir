function ExtensionsLayout(e){window[e]=this;var n,t,o,s=this,a=!1,i="";s.initialize=function(){n=s.settings,t=s.controls.sortDropdown,searchBox=s.controls.searchBox,o=n.extensionType,t.change(function(){!function(){var e=window[s.pagerInstanceName];e&&(e.pageNumber=1);CCL.CommonFunctions.safeAjax({type:"PUT",url:n.webMethods.updateSortingPreference,data:{sorting:t.val()},error:g}),l(d)}()}),searchBox.bind(s.settings.clientEvents.textSearch,function(e,n){c(n)}),u()},s.beforeOpenDialog=function(){s.customScripts.beforeDialogOpened&&s.customScripts.beforeDialogOpened()},s.afterOpenDialog=function(){t.focus(),CCL.CommonFunctions.safeAjaxPost({url:n.webMethods.registerDialogOpened,data:{placement:s.settings.placement}})},s.beforeCloseDialog=function(){a&&s.customScripts.afterMultipleExtensionsRemoveAndClose&&s.customScripts.afterMultipleExtensionsRemoveAndClose(),s.customScripts.beforeDialogClosed&&s.customScripts.beforeDialogClosed()};var r=function(e,n){if(s.customScripts.afterExtensionInclude){s.controls.changedExtensionsHidden.val(e);var t={extensionId:e,extensionTitle:n};s.customScripts.afterExtensionInclude(t)}};function c(e){i=e,function(e){e.length?(s.controls.searchResultLabel.find("span:first").text("'"+e+"'"),s.controls.searchResultLabel.show()):s.controls.searchResultLabel.hide()}(e),CCL.CommonFunctions.safeAjaxPost({url:n.webMethods.measureSearch,data:{searchText:e},error:g});var t=window[s.pagerInstanceName];t&&(t.pageNumber=1),l(d)}function l(a,r){var c=window[s.pagerInstanceName];CCL.CommonFunctions.safeAjaxPost({url:n.webMethods.renderExtensionsMatrixMarkup,data:{extensionsLayoutClientInstanceName:e,extensionType:o,isLibraryMode:n.isLibraryMode,placement:s.settings.placement,sorting:t.val(),filtering:i,pageNumber:c?c.pageNumber:1,organisationId:n.organisationId,ignoreExtensionPreselection:n.ignoreExtensionPreselection,isDeepLinkingSupported:n.isDeepLinkingSupported},dataType:"JSON",success:function(e,n){c.totalCount=e.VirtualCount,s.controls.matrixContainer.html(e.HtmlMarkup),u(),null!=a&&a(r)},error:g})}function u(){s.controls.matrixContainer.toggleClass(n.cssClasses.noApps,s.controls.matrixContainer.find("."+n.cssClasses.notFoundInner).length>0)}function d(){var e=window[s.pagerInstanceName];e&&(0==e.totalCount?e.hide():e.render())}function g(e,t,o){e.status>=CCL.CommonConstants.httpStatusCodes.badRequest&&alert(e.responseText?$("<div/>").html(e.responseText).text():n.terms.generalErrorMessageText)}return s.toggleExtension=function(e,t,i){CCL.CommonFunctions.safeAjax({type:"PUT",url:n.webMethods.toggleExtension,async:!1,data:{extensionType:o,extensionId:e,include:t},success:function(o,c){t?(n.expandFramesWhenInclude&&window[s.settings.dialogClientInstanceName].toggleContentAreaFrame(!1),r(e,i),a=!1,window[s.settings.dialogClientInstanceName].close()):a=!0,l()},error:g})},s.registerExtensionUse=function(e,t){CCL.CommonFunctions.safeAjaxPost({url:n.webMethods.registerExtensionUse,async:!1,data:{extensionType:o,extensionId:e},success:function(){r(e,t),window[s.settings.dialogClientInstanceName].close()},error:g})},s.onPageChange=function(e){var n=window[s.pagerInstanceName];n.pageNumber=e.pageNumber,l(n.render)},s.clearSearch=function(){window[s.searchBoxInstanceName].clearSearch(),c("")},s}