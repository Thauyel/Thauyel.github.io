function PersonalMessagesComposer(t){window[t]=this;var e,n,a,s,o,i,r,c=this,l=!1,u=window.PersonalMessagesComposerSavedInput;function m(){window.PersonalMessagesComposerSavedInput=u={participants:[]}}function p(){u.subject=n.val(),u.text=a.val(),u.participants=d().getLabelsMetadata()}function d(){return window[c.settings.participantsInstanceName]}c.initialize=function(){var t,i;u||m(),e=$(c.settings.subjectContainerSelector),n=$(c.settings.subjectInputSelector),a=$(c.settings.replyTextAreaSelector),s=$(c.settings.newButtonSelector),o=$(c.settings.sendButtonSelector),r=c.settings.cssClasses,t=100,i=3,e.on(c.settings.clickOrTouch,function(t){t.preventDefault(),n.focus()}),n.on("keyup",function(){n.width(t+n.val().length*i)}),n.on("change",p),a.on("keyup",c.toggleSendButton),a.on("change",p),s.on(c.settings.clickOrTouch,function(){c.toggleSendButton(),l||(l=!0,d().addLabelsChangedHandler(p),n.val(u.subject),a.val(u.text),$.each(u.participants,function(t,e){d().pushLabel(e.Name,e)}))})},c.toggleSendButton=function(){o.prop("disabled",!(d().getLabelsMetadata().length>0&&""!==a.val().trim()))},c.renderItem=function(t,e){return $("<li>").append(e.metadata?String.format("<a><img alt='' class='{0}' src='{1}'/><span class='{2}'><span>{3}</span>{4}{5}</span></a>",r.image,e.metadata.ImageUrl,r.info,CCL.CommonFunctions.htmlEncode(e.label),e.metadata.ExtraInfo?String.format(" <span class='{0}'>({1})</span>",r.extraInfo,CCL.CommonFunctions.htmlEncode(e.metadata.ExtraInfo)):"",e.metadata.WithDetailedInformation?String.format("<span class='{0}'>{1}</span>",r.organization,CCL.CommonFunctions.htmlEncode(e.metadata.Organization)):""):String.format("<span class='{0}'>{1}</span>",r.noMatches,CCL.CommonFunctions.htmlEncode(c.settings.terms.noMatches))).addClass(r.item).appendTo(t)},c.participantsAutocomplete=function(t,e){var n=d();i&&i.abort&&i.abort(),i=$.ajax({url:c.settings.participantsSearchServiceUrl,dataType:"json",data:{search:t.term,useOtherCalendarsPreferences:!1,limitByAbilityToCommunicate:!0},success:function(t){var a=t.filter(function(t){return 0===n.mapLabelsField("UserName").filter(function(e){return e===t.UserName}).length});if(a.length)e($.map(a,function(t){return{label:t.Name,value:t.Name,metadata:t}}));else{var s=[{value:e.term}];e(s)}},complete:function(t,e){i=void 0}})},c.clear=function(){m()}}