var AddEditFoldersWidget={userInputChanged:!1,data:void 0,onReady:function(){var e=AddEditFoldersWidget.data;parent[e.dashboardLayoutClientInstanceName].toggleModalDialogControls(!0,!1),e.uploadButton.on("click",function(t){parent[e.dashboardLayoutClientInstanceName].toggleModalDialogControls(!1,!1),setTimeout(function(){$(e.uploadButton).prop("disabled",!0)})})},saveBlock:function(){var e=AddEditFoldersWidget.data;e.uploadControl.val()?parent.CCL.CommonFunctions.jAjaxConfirm(e.terms.forgotToUploadWarningMessage,"",e.terms.ok,e.terms.cancel,function(t){parent[e.dashboardLayoutClientInstanceName].toggleModalDialogControls(!t,!1),t&&e.saveBlockFunctionWrapper()}):(parent[e.dashboardLayoutClientInstanceName].toggleModalDialogControls(!1,!1),e.saveBlockFunctionWrapper())},initialize:function(){AddEditFoldersWidget.data.titleInput.change(AddEditFoldersWidget.setUserInputChanged),window.parent.BlockHelper.wrapAddEditBlockCancelFunction(function(){return AddEditFoldersWidget.userInputChanged||AddEditFoldersWidget.data.uploadControl.val()},AddEditFoldersWidget.data.contentBlockType)},setUserInputChanged:function(){AddEditFoldersWidget.userInputChanged=!0}};function RichContentBlock(e){window[e]=this;var t=this;function n(){parent[t.settings.dashboardLayoutClientInstanceName].adjustWindowSizeOfEditDialog()}return t.initialize=function(){t.controls.blockTitle.change(t.setUserInputChanged),$("#"+t.controls.editorId).change(t.setUserInputChanged),window.parent.BlockHelper.wrapAddEditBlockCancelFunction(function(){var e=!1;try{e=isTextEditorDirty(t.controls.editorId)}catch(e){}return t.userInputChanged||e},t.contentBlockType),window.CKEDITOR&&CKEDITOR.on("instanceReady",function(e){e.editor.name===t.controls.editorId&&(e.editor.on("dialogShow",n),e.editor.on("dialogHide",n),e.editor.on("resize",n),n())})},t.setUserInputChanged=function(){t.userInputChanged=!0},t}var BlockHelper={getPageInstance:function(){return window.DashboardLayoutInstance},getClientInstance:function(e){return window["BlockClientInstance"+e]?window["BlockClientInstance"+e]:null},getContentWindow:function(){return $("#"+BlockHelper.getPageInstance().settings.dialogIframeName).find("iframe").get(0).contentWindow},adjustImageWidth:function(e,t){e.width>t&&(e.width=t),e.style.visibility="visible"},addEditBlock:function(e,t){var n=BlockHelper.getClientInstance(t),o=BlockHelper.getPageInstance();if(n.settings.useIframe){o.toggleModalDialogControls(!0,!0);var i=window[o.settings.dialogIframeName];o.setNewAfterOkClickFunction(function(){BlockHelper.getClientInstance(t).okFunctionWrapper()}),(n.settings.dialogWidth>0||n.settings.dialogHeight>0)&&i.setPreferredSize(n.settings.dialogWidth,n.settings.dialogHeight),i.setIframeUrl(n.settings.addEditFrameUrl.replace("ContentBlockId=0","ContentBlockId="+e),!0),i.setTitle(e?n.settings.editDialogTitle:n.settings.addDialogTitle)}else if(n.customClientFunction){var a={contentBlockId:e};n.customClientFunction(a)}},wrapAddEditBlockCancelFunction:function(e,t){if(e&&$.isFunction(e)){var n=function(){return!e()||BlockHelper.getClientInstance(t).cancelFunctionWrapper()};window[BlockHelper.getPageInstance().settings.dialogIframeName].setCloseConfirmation(n),BlockHelper.getPageInstance().setCancelConfirmation(n)}}};function BlockClientInstance(e){window["BlockClientInstance"+e]=this}function DashboardLayout(e){window[e]=this;var t,n,o,i,a,s,r=this;function d(e,t,n){r.webMethods.deleteContentBlock&&CCL.CommonFunctions.safeAjax({type:"DELETE",url:r.webMethods.deleteContentBlock.replace("{dashboardId}",r.settings.dashboardId).replace("{contentBlockId}",e),data:{isPermanent:t}}).done(n).fail(CommonScripts.jQueryWebServiceErrorHelper)}function l(){return t||(t=window[r.settings.dialogIframeName]),t}function c(){return o||(o=l().getFooter().find("input:submit")),o}function u(e,t){var n=$(".ilw-reactivate-feedback",r.controls.reactivatePanel);n.empty(),n.append($("<div></div>").addClass("ccl-feedback").addClass(t).append($("<span/>").text(e)))}function g(e){u(e,"warning")}return r.name=e,r.firstLoad=function(){r.controls.widgetsPickerSubmitOrCancel.hide(),r.controls.browseExtensionsLink.click(function(){return r.onBrowseExtensionsLinkClickClientScriptFunction(),!1}),n=new CCL.CallbackDebouncer(function(){l().adjustWindowSize()}),$(function(){$(function(){c().click(function(e){a&&a(),e.preventDefault()}),(i||(i=l().getFooter().find("a")),i).click(function(){return i.getIfHyperLinkEnabled()&&(!s||s())})})})},r.setNewAfterOkClickFunction=function(e){a=e},r.setCancelConfirmation=function(e){s=e},r.updateLayoutScheme=function(e,t,n){r.webMethods.updateLayoutScheme&&CCL.CommonFunctions.safeAjax({type:"PUT",url:r.webMethods.updateLayoutScheme.replace("{dashboardId}",r.settings.dashboardId),data:{scheme:e}}).done(t).fail(n)},r.updateLayout=function(e,t,n){r.webMethods.reorderContentBlocks&&CCL.CommonFunctions.safeAjax({type:"PUT",url:r.webMethods.reorderContentBlocks.replace("{dashboardId}",r.settings.dashboardId),data:{data:e}}).done(t).fail(n)},r.notifyAboutChanges=function(e,t,n,o){r.webMethods.notifyAboutChanges&&CCL.CommonFunctions.safeAjaxPost({url:r.webMethods.notifyAboutChanges,data:{learningObjectId:e,learningObjectInstanceId:t}}).done(n).fail(o)},r.deleteContentBlock=function(e,t){d(e,t,function(t,n){r.onDeleteBlockSuccess(t,n,e)})},r.onDeleteBlockClick=function(e,t){CCL.CommonFunctions.jAjaxConfirm(r.terms.deleteContentBlockConfirmationMessage,"",r.terms.ok,r.terms.cancel,function(e){e&&r.deleteContentBlock(t,!1)})},r.onDeletePlaceholderClick=function(e,t){CCL.CommonFunctions.jAjaxConfirm(r.terms.deletePlaceholderConfirmationMessage,"",r.terms.ok,r.terms.cancel,function(e){e&&r.deleteContentBlock(t,!0)})},r.onDeleteAggregatedBlockClick=function(e,t,n){CCL.CommonFunctions.jAjaxConfirm(r.terms.deleteAggregatedContentBlockConfirmationMessage,"",r.terms.ok,r.terms.cancel,function(e){e&&(r.deleteContentBlock(t,!1),toggle_contentblockAddable(n))})},r.onDeleteBlockSuccess=function(e,t,n){var o=$("li.il-widget").length;WidgetLayout.getWidgetElementsJQuery(n).remove(),0==$("li.il-widget").length||o==r.settings.maxNumberOfContentBlocksOnPage?WidgetLayout._reloadWindow():r.controls.pasteItemPanel.filter(function(e,t){return $(t).find("input[value='"+n+"']:hidden").length>0}).hide()},r.addContentBlockItsl=function(e){r.webMethods.addContentBlockItsl&&CCL.CommonFunctions.safeAjaxPost({url:r.webMethods.addContentBlockItsl.replace("{dashboardId}",r.settings.dashboardId),data:{blockType:e}}).done(r.onAddContentBlockItslSuccess).fail(CommonScripts.jQueryWebServiceErrorHelper)},r.onAddContentBlockItslSuccess=function(e,t){r.closeDialog(!1),window.location.reload()},r.onAddContentBlockSuccess=function(){r.toggleModalDialogControls(!1,!0),WidgetLayout._reloadWindow()},r.closeDialog=function(e){e?$(window).unload(function(){CssModal.closeDialog()}):CssModal.closeDialog()},r.toggleModalDialogControls=function(e,t){window[c().parent("div").attr("id")].toggleInProgressState(!e,t),t&&l().toggleDialogCloseButton(e)},r.onCutBlockClick=function(e,t,n){CCL.CommonFunctions.safeAjax({type:"PUT",url:r.webMethods.toggleCutContentBlock.replace("{contentBlockId}",t)}).done(function(){if(t==r.settings.cutContentBlockId)r.settings.cutContentBlockId=0,r.controls.pasteItemPanel.hide();else if(r.settings.cutContentBlockId=t,r.settings.allowPaste){var e=n||"#";r.controls.pasteItemPanel.empty().addClass("ilw-addblock-link-panel").show().append($('<input type="hidden" />').val(t)).append($("<a></a>").attr("href","javascript:void(0);").addClass("ccl-iconlink").addClass(r.settings.pasteImageCssClass).append($("<img />").attr("src",r.settings.onePixelTransparentImageUrl).attr("alt","")).append($("<span></span>").text(r.terms.paste.replace("{0}",e))).on("click",function(e){r.onPasteBlockClick(e)}))}r.updateCutWidgetState()}).fail(CommonScripts.jQueryWebServiceErrorHelper)},r.updateCutWidgetState=function(){WidgetLayout.getWidgetElementsJQuery(r.settings.cutContentBlockId).addClass("il-widget-cut").find("a.il-widget-cutlink").attr("title",r.terms.undo).find("img").attr("alt",r.terms.undo).prop("className",r.settings.undoImageCssClass),WidgetLayout.getAllWidgetsExceptOne(r.settings.cutContentBlockId).removeClass("il-widget-cut").find("a.il-widget-cutlink").attr("title",r.terms.cut).find("img").attr("alt",r.terms.cut).prop("className",r.settings.cutImageCssClass)},r.onPasteBlockClick=function(e){CCL.CommonFunctions.safeAjaxPost({url:r.webMethods.pasteContentBlock.replace("{targetDashboardId}",r.settings.dashboardId)}).done(WidgetLayout._reloadWindow).fail(CommonScripts.jQueryWebServiceErrorHelper)},r.beforeOpenWidgetsPicker=function(){var e=WidgetLayout.getCurrentNumberOfWidgets(),t=r.getNumberOfDeletedContentBlocks(),n=window[r.settings.addBlockDialogName];e>=r.settings.maxNumberOfContentBlocksOnPage?(n.setNewTitle(r.terms.dashboardIsFullHeader),r.controls.widgetsPickerSubmitOrCancel.hide(),r.controls.addItemsPanel.hide(),r.controls.reactivatePanel.hide(),r.controls.bottomPanel.hide(),r.controls.dashboardFullPanel.show(),r.controls.dashboardFullPanel.html(r.terms.dashboardIsFullDescription.replace("{0}",r.settings.maxNumberOfContentBlocksOnPage)).append($("<br />")),t&&r.controls.dashboardFullPanel.append($("<a href='javascript:void(0);'></a>").text(r.terms.reactivateLink).click(r.reactivateLinkClick))):(n.setNewTitle(r.terms.contentBlocksHeader),r.controls.widgetsPickerSubmitOrCancel.hide(),r.controls.addItemsPanel.show(),r.controls.reactivatePanel.hide(),r.controls.dashboardFullPanel.hide(),r.controls.reactivateLinkPanel.toggle(t>0),r.controls.browseExtensionsLinkPanel.toggle(r.settings.allowBrowseExtensions),r.controls.bottomPanel.toggleClass("ilw-border-top",t>0||r.settings.allowBrowseExtensions),r.controls.bottomPanel.show()),CommonFunctions.hideEmbeddedObjectsOnDialogOpening()},r.beforeCloseWidgetsPicker=function(){CommonFunctions.showEmbeddedObjectsOnDialogClosing()},r.widgetsPickerFocus=function(){r.controls.dashboardFullPanel.is(":visible")?window[r.settings.addBlockDialogName].focusOnCloseLink():r.controls.widgetsPicker.find("li:first a:first").focus()},r.getNumberOfDeletedContentBlocks=function(){var e=0;return $.ajax({type:"GET",url:r.webMethods.getNumberOfDeletedContentBlocks.replace("{dashboardId}",r.settings.dashboardId),async:!1,data:{enableEspresso:r.settings.enableEspressoForLocation}}).done(function(t){e=t}).fail(CommonScripts.jQueryWebServiceErrorHelper),e},r.reactivateLinkClick=function(){window[r.settings.addBlockDialogName].setNewTitle(r.terms.reactivateContentBlockHeader),r.controls.bottomPanel.hide(),r.controls.widgetsPickerSubmitOrCancel.hide(),r.controls.addItemsPanel.hide(),r.controls.reactivatePanel.hide(),r.controls.dashboardFullPanel.hide(),$.ajax({type:"GET",url:r.webMethods.getDeletedContentBlocks.replace("{dashboardId}",r.settings.dashboardId),data:{enableEspresso:r.settings.enableEspressoForLocation,useHigherEducationLanguage:r.settings.useHigherEducationLanguage},dataType:"json"}).done(r.onDeletedBlocksDataReady).fail(CommonScripts.jQueryWebServiceErrorHelper)},r.onDeletedBlocksDataReady=function(e,t){var n=WidgetLayout.getCurrentNumberOfWidgets(),o=r.settings.maxNumberOfContentBlocksOnPage>n;if(r.settings.isFromPage)$(".ilw-reactivate-description").text(r.terms.reactivateDescriptionForPage);else if(o){var i=r.terms.reactivateDescriptionForDashboard.replace("{0}",r.settings.maxNumberOfContentBlocksOnPage-n);$(".ilw-reactivate-description").text(i)}else $(".ilw-reactivate-description").empty();$(".ilw-reactivate-feedback",r.controls.reactivatePanel).empty();var a=$(".ilw-reactivate-container",r.controls.reactivatePanel);$(".ilw-reactivate-container",r.controls.reactivatePanel).empty();var s=e;if(s){var l=$("<ul></ul>").addClass("h-vlist ccl-actionitemlist");if($.each(s,function(e,t){var n=function(e,t){var n,o,i;"#"!=e.title?(n=r.terms.deleteTooltip.replace("{0}",e.title),o=r.terms.deletePermanentlyConfirmation.replace("{0}",e.title),i=r.terms.deletedPermanentlyMessage.replace("{0}",e.title)):(n=r.terms.deleteTooltipNoTitle.replace("{0}",e.type).replace("{1}",e.deletedDate),o=r.terms.deletePermanentlyConfirmationNoTitle.replace("{0}",e.type).replace("{1}",e.deletedDate),i=r.terms.deletedPermanentlyMessageNoTitle.replace("{0}",e.type).replace("{1}",e.deletedDate));var a="reactivate-chk-"+e.contentBlockId,s=$("<a href='javascript:void(0);'>&times;</a>").attr("title",n).addClass("ilw-removelink h-td-none h-no-print"),l=$("<input type='checkbox' />").attr("value",e.contentBlockId).attr("id",a),c=e.title+(e.type?" - "+e.type:"")+" - "+e.deleted,g=$("<label></label>").text(c).attr("for",a);s.click(function(){var t=$(this);CCL.CommonFunctions.jAjaxConfirm(o,"",r.terms.ok,r.terms.cancel,function(n){n&&d(e.contentBlockId,!0,function(){u(i,"information"),t.parent().remove()})})});var p=$("<li></li>").addClass("ccl-actionitemlist-separator"),m=$("<div></div>");return p.append(s).append(m),t?(m.append(l),r.settings.isFromPage?setTimeout(function(){CCL.ModernCheckbox.BuildCheckbox(l,c).css("margin-left",0)}):m.append(g)):m.append(g),p}(t,o);l.append(n)}),a.append(l),r.controls.reactivatePanel.show(),o&&r.controls.widgetsPickerSubmitOrCancel.show(),o){var c=$($(".ilw-reactivate-container input",r.controls.reactivatePanel));c.length&&c[0].focus()}else{var g=$($(".ilw-reactivate-container a",r.controls.reactivatePanel));g.length&&g[0].focus()}}},r.undeleteElementClick=function(){var e="",t=$(".ilw-reactivate-container ul :checked",r.controls.reactivatePanel);if(t.each(function(t){t&&(e+=","),e+=$(this).val()}),!t.length)return g(r.terms.atLeastOneItemHasToSelected),!1;var n=WidgetLayout.getCurrentNumberOfWidgets();if(n+t.length>r.settings.maxNumberOfContentBlocksOnPage){var o=r.settings.maxNumberOfContentBlocksOnPage-n;return g(r.terms.reactivateBlocksLimitException.replace("{0}",o)),!1}return r.controls.widgetsPickerSubmitOrCancel.hide(),CCL.CommonFunctions.safeAjaxPost({url:r.webMethods.unDeleteContentBlocks.replace("{dashboardId}",r.settings.dashboardId),data:{contentBlocksIds:e}}).done(WidgetLayout._reloadWindow),!1},r.applyWidgetColor=function(e,t){CCL.CommonFunctions.safeAjax({type:"PUT",url:r.webMethods.setColorScheme.replace("{contentBlockId}",e),data:{colorScheme:parseInt(t)}})},r.repaintWidgetColor=function(e,t){WidgetLayout.getWidgetElementsJQuery(e).find("div.il-widget-header").removeClass().addClass("il-widget-header").addClass(t)},r.adjustWindowSizeOfEditDialog=function(){n.invokeCallback(void 0,100)},r}var EspressoWidget={addInstance:function(e){CCL.CommonFunctions.safeAjaxPost({url:e.settings.webMethodUrl.replace("{dashboardId}",e.settings.dashboardId),data:{blockType:e.settings.blockType}}).done(function(){WidgetLayout._reloadWindow()}).fail(CommonScripts.jQueryWebServiceErrorHelper)}};function FileStructureList(e){window[e]=this;var t=this;function n(e){return 0!==e.length||(parent.CCL.CommonFunctions.jAjaxAlert(t.folderNameEmptyErrorMessage,"",t.settings.terms.ok),!1)}return t.name=e,t.sessionKey=null,t.renameTemporaryFolderItemWebMethodUrl=null,t.deleteTemporaryFolderItemWebMethodUrl=null,t.tbody=null,t.deleteConfirmationMessage=null,t.deleteNonEmptyFolderConfirmationMessage=null,t.folderDialogName=null,t.createTemporaryFolderFunction=null,t.currentFolderIdHidden=null,t.createFolderHeader=null,t.renameFolderHeader=null,t.defaultFolderName=null,t.folderTitleClientId=null,t.folderNameEmptyErrorMessage=null,t.renameFolderFunction=null,t.eventsSender=null,t.renameFileEventName=null,t.deleteFolderItemEventName=null,t.renameTemporaryFolderItem=function(e,o,i,a){var s=$.trim(i);o&&!n(s)||CCL.CommonFunctions.safeAjax({type:"PUT",url:t.renameTemporaryFolderItemWebMethodUrl.replace("{uniqueIdentifier}",e),data:{sessionKey:t.sessionKey,isFolder:o,title:s}}).done(a).fail(CommonScripts.jQueryWebServiceErrorHelper)},t.tryDeleteTemporaryFolderItem=function(e,n,o){var i=o?t.deleteNonEmptyFolderConfirmationMessage:t.deleteConfirmationMessage;parent.CCL.CommonFunctions.jAjaxConfirm(i,"",t.settings.terms.ok,t.settings.terms.cancel,function(o){o&&t.deleteTemporaryFolderItem(e,n)})},t.deleteTemporaryFolderItem=function(e,n){CCL.CommonFunctions.safeAjax({type:"DELETE",url:t.deleteTemporaryFolderItemWebMethodUrl.replace("{uniqueIdentifier}",e),data:{sessionKey:t.sessionKey,isFolder:n}}).done(function(o,i){t.onDeleteTemporaryFolderItemSuccess(o,i,e,n)}).fail(CommonScripts.jQueryWebServiceErrorHelper)},t.onDeleteTemporaryFolderItemSuccess=function(e,n,o,i){t.getRowJQuery(o,i).remove(),t.eventsSender.trigger(t.deleteFolderItemEventName)},t.createFolder=function(){var e=window[t.folderDialogName];e.setNewAfterOkClickFunction(function(){return t.createFolderOkClick()}),e.setNewAfterCancelClickFunction(function(){return t.createFolderCancelClick()}),e.setNewTitle(t.createFolderHeader),$("#"+t.folderTitleClientId).val(t.defaultFolderName),e.open()},t.createFolderOkClick=function(){return!!n($.trim($("#"+t.folderTitleClientId).val()))&&(t.createTemporaryFolderFunction(),!0)},t.createFolderCancelClick=function(){return!0},t.renameFolder=function(e,n){var o=window[t.folderDialogName];o.setNewAfterOkClickFunction(function(){return t.renameFolderOkClick()}),o.setNewAfterCancelClickFunction(function(){return t.renameFolderCancelClick()}),o.setNewTitle(t.renameFolderHeader),$("#"+t.folderTitleClientId).val(n),o.open(),t.renamedFolderId=e},t.renameFolderOkClick=function(){var e=t.renamedFolderId;return t.renameTemporaryFolderItem(e,!0,$("#"+t.folderTitleClientId).val(),t.renameFolderSuccess),!1},t.renameFileSuccess=function(){t.eventsSender.trigger(t.renameFileEventName)},t.renameFolderSuccess=function(){t.renameFolderFunction()},t.renameFolderCancelClick=function(){return t.renamedFolderId=null,!0},t.changeCurrentFolder=function(e){t.currentFolderIdHidden.value=e,setTimeout(function(){document.forms[0].submit()})},t.getRowJQuery=function(e,n){return $("tr[id$='"+(n?"fo":"fi")+e+"Row']",t.tbody)},t.focusFolderTitle=function(){$("#"+t.folderTitleClientId).focus()},t}var FoldersWidget={settings:{webMethodUrl:null},getFolderContent:function(e,t){FoldersWidget.settings.webMethodUrl&&$.ajax({type:"GET",url:FoldersWidget.settings.webMethodUrl.replace("{widgetId}",e).replace("{folderId}",t),dataType:"html"}).done(function(t){WidgetLayout.getWidgetElementsJQuery(e).find("ul.ilw-filesblock-ul").html(t)})}},ItslWidgetManager={widgets:[],createServerGeneratedWidget:function(e){var t=new ItslWidget(e);this.widgets[e.widgetId]=t},getWidget:function(e){return this.widgets[e]},getPageInstance:function(){return window.DashboardLayoutInstance},getClientInstance:function(e){return this.widgets[""+e]?this.widgets[""+e]:null},getContentWindow:function(){return $("#"+ItslWidgetManager.getPageInstance().settings.dialogIframeName).find("iframe").get(0).contentWindow},setWidgetEditSettings:function(e,t){var n=this.getWidget(e);n||(n=new ItslWidget(null),this.widgets[e]=n),n.setEditSettings(t)},addEditBlock:function(e,t,n){var o=this.widgets[""+t].editSettings;if(o&&"undefined"!=o.addEditPath&&""!=o.addEditPath){var i=o.addEditPath.replace("ContentBlockId=0","ContentBlockId="+t),a=window[o.dialogIframeName];ItslWidgetManager.getPageInstance().setNewAfterOkClickFunction(function(){$(this).prop("disabled",!1),ItslWidgetManager.getClientInstance(t).onOkAddEditBlockWrapper()}),a.setTitle(t?o.editDialogTitle:o.addDialogTitle),a.setIframeUrl(i.replace("DashboardId=0","DashboardId="+e),!0)}},wrapAddEditBlockCancelFunction:function(e,t){if(e&&$.isFunction(e)){var n=function(){return!e()||ItslWidgetManager.getClientInstance(t).onCancelAddEditBlockWrapper()};window[ItslWidgetManager.getPageInstance().settings.dialogIframeName].setCloseConfirmation(n),ItslWidgetManager.getPageInstance().setCancelConfirmation(n)}}};function ItslWidget(e){this.settings=e}ItslWidget.prototype.init=function(e){this.load(e)},ItslWidget.prototype.setEditSettings=function(e){this.editSettings=e},ItslWidget.prototype.load=function(e){this.getProgressContainer().show();var t=this;CCL.CommonFunctions.safeAjaxPost({url:this.settings.path,data:this.getRequestParams(e)}).done(function(e){t.getContentContainer().html(e),t.onLoad()})},ItslWidget.prototype.getRequestParams=function(e){return{widgetSettings:this.settings,widgetCommand:JSON.stringify(e)}},ItslWidget.prototype.onLoad=function(e,t,n){this.getProgressContainer().hide(),this.getContentContainer().show(),this.updateMenu(),this.updateTitle(),WidgetLayout.dynamicContentChanged()},ItslWidget.prototype.updateTitle=function(){var e=this._readNewTitle();null!=e&&WidgetLayout.setWidgetTitle(this.settings.widgetId,e)},ItslWidget.prototype.updateMenu=function(){var e=this._readNewMenu();null!=e&&WidgetLayout.setWidgetMenu(this.settings.widgetId,e)},ItslWidget.prototype.getContainer=function(){return $("#"+this.settings.clientId)},ItslWidget.prototype.getContentContainer=function(){return this.getContainer().find("."+this.settings.cssContentContainer)},ItslWidget.prototype.getProgressContainer=function(){return this.getContainer().find("."+this.settings.cssProgressContainer)},ItslWidget.prototype._readNewTitle=function(){var e=this.getContainer().find("."+this.settings.cssTitleContainer).html();return this.getContainer().find("."+this.settings.cssTitleContainer).remove(),e},ItslWidget.prototype._readNewMenu=function(){var e=this.getContainer().find("."+this.settings.cssFunctionsContainer).html();return this.getContainer().find("."+this.settings.cssFunctionsContainer).remove(),e},ItslWidget.prototype.onOkAddEditBlockWrapper=function(){return ItslWidgetManager.getContentWindow()[this.editSettings.addEditDialogClientInstance].addOrEditBlock(),!1},ItslWidget.prototype.onCancelAddEditBlockWrapper=function(){var e=confirm(this.editSettings.cancelConfirmation);return e&&window[this.editSettings.dialogIframeName].setIframeUrl("javascript:false;",!0),e};var PluginWidget={editInstance:function(contentBlockId){var blockSettings=eval("PluginWidgetSettings"+contentBlockId);window.open(blockSettings.editPluginUrl,"_blank","resizable=yes,scrollbars=yes,status=yes")}};function RssWidget(e){window["RssWidget"+e]=this,this.name="RssWidget"+e,this.getFeed=function(){var e=this;$.ajax({type:"GET",url:e.settings.webMethodUrl.replace("{contentBlockId}",e.settings.contentBlockId),dataType:"xml"}).done(function(t){e.createFeed(t)}).fail(function(){e.createErrorReadingFeed()})},this.createFeed=function(e){var t=RssHelper.feedToJson(e,this.settings.feedsCount,this.settings.showSummary);this.appendFeedXhtml(t),WidgetLayout.dynamicContentChanged()},this.createErrorReadingFeed=function(){var e=this;this.container.empty().append(e.settings.errorReadingFeedMessage+"<br /><br />").append($("<a></a>").text(e.settings.feedsUrl).attr("href",e.settings.feedsUrl).on("click",function(e){return window.open($(this).attr("href")),!1})),WidgetLayout.dynamicContentChanged()},this.appendFeedXhtml=function(e){var t=this,n=$("<ul></ul>").addClass("ilw-rssblock-list");this.container.empty().append(n),$.each(e,function(){var e=this.title;e||(e="#");var o=$("<li></li>").addClass("ilw-rssblock-list-item").append($("<a></a>").attr("href",this.link).addClass("ilw-rssblock-link").addClass("ccl-iconlink").append($("<img />").attr("src",t.settings.onePixelTransparentImageUrl).attr("alt","").addClass(t.settings.cssClasses.rssblockLinkImage)).append($("<span></span>").text(e)).on("click",function(e){return window.open($(this).attr("href")),!1}));if(t.settings.showSummary){var i=$("<div></div>").addClass("ilw-rssblock-list-item-content").html(this.description);i.find("a").on("click",function(e){return window.open($(this).attr("href")),!1}),i.find("object embed").attr("wmode","transparent"),o.append(i).append($("<div></div>").addClass("h-fl-c"))}n.append(o)})}}var RssHelper={userInputChanged:!1,feedToJson:function(e,t,n){var o=[];return $("channel",e).length?$("item:lt("+t+")",e).each(function(){var e={link:$(this).find("> link").text(),title:$(this).find("> title").text()};n&&(e.description=$(this).find("> description").text()),o.push(e)}):$("feed > entry:lt("+t+")",e).each(function(){var e={link:$(this).find("> link").attr("href"),title:$(this).find("> title").text()};n&&($(this).find("> summary").length?e.description=$(this).find("> summary").text():e.description=$(this).find("> content").text()),o.push(e)}),o},setUserInputChanged:function(){RssHelper.userInputChanged=!0}},StickyTextbox=function(){var e,t,n,o,i,a,s,r,d,l,c;function u(){setTimeout(function(){r.val().trim().length>0&&!n.isEditorContentEmpty()?a.attr("disabled")&&a.removeAttr("disabled"):a.attr("disabled","disabled")},1)}function g(e,t,n,a){var s={};s[o.antiForgery.headerName]=o.antiForgery.headerValue,CCL.CommonFunctions.safeAjax({type:e,url:o.webServiceUrl,data:t,headers:s}).fail(function(){window.CommonScripts.showAlert(i.errorMessage),a&&a()}).done(function(e){n&&(n(e),CCL.CommonFunctions.applyIframely())})}function p(){var e;(o.textContent&&0!==o.textContent.length||!n.isEditorContentEmpty())&&(null==o.textContent&&(o.textContent=""),n.setEditorContent((e=o.textContent,o.replaceNewLines?e.replace(/<br\s?\/>/gi,"\n"):e),o.editorId,!0))}function m(){r.val(o.titleContent),function(){if(c)p();else if("undefined"!=typeof CKEDITOR){var e=function(){c.on("blur",u),c.on("change",u);var e,t=c.editable();t.attachListener(t,"keydown",u),p(),(e=c.config.oembed||{}).DialogSrc&&(e.DialogSrc=e.DialogSrc+o.oEmbedQueryParam)};(c=n.getEditorControl()).instanceReady?e():c.on("instanceReady",function(){e()})}else(c=$(n.getEditorControl())).on("blur",u),c.on("keydown",u),c.addClass("ccl-modern-input"),p()}(),u();var t=window[e.modalClientId];t.setCustomScripts({afterOpenDialog:function(){r.focus()}}),t.openDialog()}function C(){CssModal.closeDialog()}function f(){var e,a={title:r.val().trim(),text:(e=n.getEditorContent(),o.replaceNewLines?e.replace(/\n/g,"<br/>"):e)};(function(e){return!(e.text.length>o.maxContentLength&&(window.CommonScripts.showAlert(i.contentTooLongMessage.replace("{0}",o.maxContentLength)),1))})(a)&&g("PUT",a,function(e){var n;o.titleContent=e.Title,o.textContent=e.Text,n=e.ViewModeText,window.WidgetLayout.setWidgetTitle(o.widgetId,o.titleContent),d.html(n),l.removeClass(t.classPlaceholderMode),l.addClass(t.classViewMode),CssModal.closeDialog()},function(){CssModal.closeDialog()})}function h(){window[e.deleteDialogClientId].show().then(function(e){e===CCL.ConfirmDialogResult.Confirm&&g("DELETE",{},function(){o.titleContent="",o.textContent="",window.WidgetLayout.setWidgetTitle(o.widgetId,""),d.html(""),l.removeClass(t.classViewMode),l.addClass(t.classPlaceholderMode)})}),$("#"+e.deleteDialogClientId).find(":focusable").first().focus()}return function(c){e=c.properties.clientIds,t=c.properties.classes,n=c.editorFunctions,o=c.properties.stickySettings,i=c.properties.terms,a=$("#"+e.saveButtonClientId),s=$("#"+e.cancelButtonClientId),r=$("#"+e.titleClientId),d=$("#"+e.viewTextClientId),l=$("."+t.classContainer),a.click(f),s.click(C),r.keydown(u),r.on("keyup keypress",function(e){13===e.which&&e.preventDefault()}),this.openEditModal=m,this.deleteStickyTextbox=h}}(),ViewImage={showImageDialog:function(e,t,n){return setTimeout(function(){if(window[e]){var o=window[e];o.setNewTitle(n);var i=o.getContainerJQueryElement().find("img.ilw-viewimage-image").prop("alt",n);t===i.attr("src")?ViewImage.onImageReady(o):i.attr("src",t).on("load",function(){ViewImage.onImageReady(o),i.off("load")})}}),!1},onImageReady:function(e){e.open(),e.focusOnCloseLink()}};function VoteAlternativesEditor(e){window[e]=this,this.name=e,this.deleteItem=function(e){e.remove(),this.updateAddLink(),this.updateAlternateListItems(),this.updateHidden(),this.events.eventsSender.trigger(this.events.deleteAlternativeEventName)},this.createAlternativeRow=function(){var e=this,t=e.controls.list.find("li").length%2!=0,n=$("<li></li>").addClass(e.cssClasses.listItem+(t?" "+e.cssClasses.listItemAlternate:"")).appendTo(e.controls.list).append($("<input />").attr("type","hidden").val("")),o=$("<input />").attr("type","text").val("").addClass(e.cssClasses.textbox).appendTo(n).on("blur",function(t){e.updateHidden()});e.settings.canAddOrRemove&&n.append($("<a></a>").attr("href","javascript:void(0);").attr("title",e.settings.deleteTerm).addClass(e.cssClasses.deleteLink).on("click",function(t){e.deleteItem(n)}).append($("<img />").attr("src",e.settings.onePixelTransparentImageUrl).attr("alt",e.settings.deleteTerm).addClass(e.cssClasses.deleteIcon).addClass(e.cssClasses.verticalAlignMiddle))),e.updateAddLink(),o.focus(),e.events.eventsSender.trigger(e.events.addAlternativeEventName)},this.updateHidden=function(){var e=this,t=[];e.controls.list.find("li").each(function(){var n={VoteAlternativeId:$(this).find("input:hidden").val()||null,Text:$.trim($(this).find("input:text").val())};!n.Text&&e.settings.canAddOrRemove||t.push(n)}),e.controls.hiddenField.val(JSON.stringify(t))},this.updateAlternateListItems=function(){var e=this;e.controls.list.find("li:even").removeClass(e.cssClasses.listItemAlternate),e.controls.list.find("li:odd").addClass(e.cssClasses.listItemAlternate)},this.updateAddLink=function(){var e=this;e.controls.list.find("li").length<e.settings.maxNumberOfAlternatives?e.controls.addLink.show():e.controls.addLink.hide()}}function VoteWidget(e){window["VoteWidget"+e]=this;var t=this;t.name="VoteWidget"+e,t.createContent=function(){t.data.hasVoted?t.data.showResult?t.renderStatisticsScreen():t.renderOwnVoteResultScreen():t.renderRadioButtonsScreen()},t.renderRadioButtonsScreen=function(){var e=t.controls.contentContainer;t.controls.thankYouContainer.hide(),e.empty();var n=e.prop("id")+"opt",o=$("<ul></ul>").addClass("ilw-votewidget-list").appendTo(e);$.each(t.data.alternatives,function(){var t=this.VoteAlternativeId,i=n+t,a=$("<input name='"+n+"' type='radio' />").attr("id",i).val(t.toString()).on("click",function(){e.find("input:submit").prop("disabled",!1)});o.append($("<li></li>").addClass("ilw-votewidget-list-item").append(a).append($("<label></label>").attr("for",i).text(this.Text))),this.IsSelected&&a.prop("checked",!0)}),$("<input />").attr("type","submit").addClass(t.settings.cssClasses.buttonStyle).addClass(t.settings.cssClasses.noPrint).prop("disabled",!0).on("click",function(){return t.vote(),!1}).val(t.terms.vote).appendTo(e),t.renderViewResultLink(),WidgetLayout.dynamicContentChanged()},t.renderOwnVoteResultScreen=function(){var e=t.controls.contentContainer;t.controls.thankYouContainer.show(),e.empty();var n=$("<ul></ul>").addClass("ilw-votewidget-ownvote-list").appendTo(e);$.each(t.data.alternatives,function(){var e=this.Text,o=$("<li></li>").addClass("ilw-votewidget-ownvote-list-item").appendTo(n);this.IsSelected?o.append($("<span></span>").addClass("ilw-votewidget-ownvote-list-item-chosenalternativetext").text(e)).append(document.createTextNode(" ("+t.terms.yourVote+")")):o.text(e)}),t.renderChangeYourVoteLink($("<div></div>").addClass(t.settings.cssClasses.marginTop10).appendTo(e)),WidgetLayout.dynamicContentChanged()},t.renderStatisticsScreen=function(){var e=t.controls.contentContainer;t.controls.thankYouContainer.hide(),e.empty();var n=$("<div></div>").appendTo(e);if(t.data.hasAnyoneVoted){var o=$("<div></div>").addClass("ilw-votewidget-stat-imagecontainer").appendTo(n);setTimeout(function(){t.renderChart(o)}),t.renderLegend(n)}else n.text(t.terms.noOneHasVoted);t.data.displayNumberOfVotes&&e.append($("<div></div>").addClass("h-fl-r").text(t.terms.totalOfVotes.replace("{0}",t.data.numberOfVotes)).appendTo(e)).append($("<div></div>").addClass("h-fl-c"));var i=$("<div></div>").addClass(t.settings.cssClasses.marginTop10).appendTo(e);t.data.hasVoted&&i.append($("<span></span>").addClass(t.settings.cssClasses.verticalAlignMiddle).html(t.terms.youVoted+": "+t.getSelectedAlternativeText()+". ")),t.renderChangeYourVoteLink(i),WidgetLayout.dynamicContentChanged()},t.renderChart=function(n){var o=VoteChartUrl+"?ContentBlockId="+e+"&ViewAsPersonId="+t.data.voteAsPersonId+"&stamp="+(new Date).getTime();n.append($("<img />").attr("alt","").attr("src",o).load(function(){WidgetLayout.dynamicContentChanged()}))},t.renderLegend=function(e){var n=$("<ul></ul>").addClass("ilw-votewidget-stat-list").appendTo(e),o=t.settings.chartColors,i=o.length;$.each(t.data.alternatives,function(e,a){n.append($("<li></li>").addClass("ilw-votewidget-stat-list-item").append($("<span></span>").addClass("ilw-votewidget-stat-list-item-bullet").css("background-color",o[e%i]).html("&nbsp;")).append($("<span></span>").addClass("ilw-votewidget-stat-list-item-description").text(a.Text).append($("<span></span>").addClass("ilw-votewidget-stat-list-item-percentage").text(" ("+a.PercentOfVotes.toString().replace(".",t.settings.decimalSeparator)+"%)"))))})},t.renderViewResultLink=function(){t.data.showResult&&$("<div></div>").addClass(t.settings.cssClasses.marginTop10).append($("<a></a>").addClass(t.settings.cssClasses.iconLink).addClass(t.settings.cssClasses.noPrint).attr("href","javascript:void(0);").on("click",function(){t.updateWidgetData(!0)}).append($("<span></span>").text(t.terms.viewResult))).appendTo(t.controls.contentContainer)},t.renderChangeYourVoteLink=function(e){!t.data.canChangeTheVote&&t.data.hasVoted||e.append($("<a></a>").addClass(t.settings.cssClasses.iconLink).addClass(t.settings.cssClasses.noPrint).attr("href","javascript:void(0);").on("click",function(){t.renderRadioButtonsScreen()}).append($("<span></span>").text(t.data.hasVoted?t.terms.changeYourVote:t.terms.clickHereToVote)))},t.getSelectedAlternativeText=function(){var e="";return $.each(t.data.alternatives,function(){this.IsSelected&&(e=CCL.CommonFunctions.htmlEncode(this.Text))}),e},t.vote=function(){var e=t.controls.contentContainer,n=e.find("input:radio:checked").val();n&&(e.find("input:submit").prop("disabled",!0),CCL.CommonFunctions.safeAjaxPost({url:t.webMethods.vote.replace("{widgetId}",t.data.widgetId).replace("{alternativeId}",n),dataType:"json",data:t.data.voteAsPersonId}).done(function(e){t.data=e,t.createContent()}).fail(function(e){CommonScripts.jQueryWebServiceErrorHelper(e),t.controls.contentContainer.find("input:submit").prop("disabled",!1)}))},t.updateWidgetData=function(e){$.ajax({type:"GET",url:t.webMethods.getVoteWidgetData.replace("{widgetId}",t.data.widgetId)+"?ViewAsPersonId="+t.data.voteAsPersonId,dataType:"json"}).done(function(n){t.data=n,e&&t.data.showResult?t.renderStatisticsScreen():t.createContent()}).fail(CommonScripts.jQueryWebServiceErrorHelper)}}var VoteWidgetHelper={userInputChanged:!1,setUserInputChanged:function(){VoteWidgetHelper.userInputChanged=!0}};