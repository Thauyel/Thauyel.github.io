var __extends=this&&this.__extends||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);function i(){this.constructor=e}e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)},ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,UploadStatus,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,Helpers,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb;!function(e){!function(e){var t=function(t){this.context=t,this.selectedItemsCount=function(){var t=$("td [id^='"+e.courseManagerInstance.context.Controls.SelectedItemsClientId+"']:not([id='"+e.courseManagerInstance.context.Controls.SelectAllItemsCheckboxClientId+"'])");if(!t||0===t.length)return 0;if(e.courseManagerInstance.context.Controls.PerformAllCheckbox.is(":checked"))return e.courseManagerInstance.context.Settings.CoursesVirtualCount;for(var n=0,i=0,s=t.get();i<s.length;i++)s[i].checked&&n++;return n},this.hideArchiveFilter=function(t){var n=$("."+e.courseManagerInstance.context.Settings.ArchiveDateCssClass).parent();$("#"+e.courseManagerInstance.context.Controls.StatusClientId+" input[type = 'radio']").first().attr("id")===t.target.id?n.hide():n.show()},this.clickOnAction=function(t){if($(t.currentTarget).parent().hasClass(e.courseManagerInstance.context.Settings.ToolbarItemDisabledCssClass))return!1;var n=e.courseManagerInstance.selectedItemsCount();return 0!==n&&confirm(CCL.CommonFunctions.formatString(t.data.text,n))},this.context=t,e.courseManagerInstance=this,$("#"+e.courseManagerInstance.context.Controls.StatusClientId+" input[type = 'radio']").first().is(":checked")&&$("."+e.courseManagerInstance.context.Settings.ArchiveDateCssClass).parent().hide(),$("#"+e.courseManagerInstance.context.Controls.StatusClientId+" input[type = 'radio']").click(this.hideArchiveFilter),e.courseManagerInstance.context.Controls.DeleteAction.on("click",null,{text:e.courseManagerInstance.context.LanguageTerms.DeleteConfirmText},this.clickOnAction),e.courseManagerInstance.context.Controls.ArchiveAction.on("click",null,{text:e.courseManagerInstance.context.LanguageTerms.ArchiveConfirmText},this.clickOnAction),e.courseManagerInstance.context.Controls.UnarchiveAction.on("click",null,{text:e.courseManagerInstance.context.LanguageTerms.UnarchiveConfirmText},this.clickOnAction),e.courseManagerInstance.context.Controls.EnrolAction.length&&e.courseManagerInstance.context.Controls.EnrolAction.on("click",null,{text:e.courseManagerInstance.context.LanguageTerms.EnrolConfirmText},this.clickOnAction),e.courseManagerInstance.context.Controls.WithdrawAction.length&&e.courseManagerInstance.context.Controls.WithdrawAction.on("click",null,{text:e.courseManagerInstance.context.LanguageTerms.WithdrawConfirmText},this.clickOnAction)};e.CourseManager=t}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e){var t=this;this.settings=e,this.settings=e,$(function(){var e=$("#"+t.settings.PlannerCheckboxClientId),n=document.getElementById(t.settings.PlannerCheckboxClientId),i=$("#"+t.settings.TopicsInPlannerCheckboxClientId),s=$("#"+t.settings.DifferentiatedPlansCheckboxClientId);function o(){e.is(":checked")?(n.removeAttribute("readonly"),n.removeEventListener("click",a)):(n.setAttribute("readonly","true"),n.addEventListener("click",a))}function r(){e.is(":checked")?(i.removeProp("readonly"),i.off("click",l),s.removeProp("readonly"),s.off("click",c)):(i.prop("readonly","readonly"),i.on("click",l),s.prop("readonly","readonly"),s.on("click",c))}function a(){return!1}function l(){return!1}function c(){return!1}o(),r(),e.on("change",function(){o(),r()})})};e.EditDefaultCourseSettings=t}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t){var n=this;this.context=t,e.editPolicyInstance=this,t.Settings.IsBroadcastMassMessageEnabled&&t.Settings.CanChangeOrganization&&t.Settings.CanSitePermissionBeSelectedForMassMessaging&&$("#"+t.Controls.OrganizationsDropdownClientId).change(function(e){n.onOrganizationChanged(e)})}return t.prototype.checkEsafetyChanged=function(){if(e.editPolicyInstance.context.Settings.IsInstantMessageSystemEnabled&&e.editPolicyInstance.context.Settings.IsEditMode){var t=[];CCL.CommonFunctions.checkAndAddRole(e.editPolicyInstance.context.Settings.EsafetyStaffChecked,e.editPolicyInstance.context.Controls.StaffCheckboxClientId,e.editPolicyInstance.context.LanguageTerms.Staff,t),CCL.CommonFunctions.checkAndAddRole(e.editPolicyInstance.context.Settings.EsafetyStudentChecked,e.editPolicyInstance.context.Controls.StudentCheckboxClientId,e.editPolicyInstance.context.LanguageTerms.Student,t),CCL.CommonFunctions.checkAndAddRole(e.editPolicyInstance.context.Settings.EsafetyGuestChecked,e.editPolicyInstance.context.Controls.GuestCheckboxClientId,e.editPolicyInstance.context.LanguageTerms.Guest,t);var n="";switch($("#"+e.editPolicyInstance.context.Controls.InitiateCommunicationCheckBoxClientId).is(":checked")&&(n="\n"+e.editPolicyInstance.context.LanguageTerms.AdditionEsafetyText),t.length){case 1:alert(CCL.CommonFunctions.formatString(e.editPolicyInstance.context.LanguageTerms.UncheckedOneEsafetyRoleText,t[0])+n);break;case 2:alert(CCL.CommonFunctions.formatString(e.editPolicyInstance.context.LanguageTerms.UncheckedTwoEsafetyRolesText,t[0],t[1])+n);break;case 3:alert(CCL.CommonFunctions.formatString(e.editPolicyInstance.context.LanguageTerms.UncheckedThreeEsafetyRolesText)+n)}}},t.prototype.toogleEsafetyDropDown=function(e,t){document.getElementById(e).style.visibility=document.getElementById(t).checked?"visible":"hidden"},t.prototype.onOrganizationChanged=function(e){var t=e.target;if(t){var n=t.options[t.selectedIndex].value;this.toggleSiteOptionInBroadcastMassMessagingDropdown(n===this.context.Settings.SiteOrganizationId.toString())}},t.prototype.toggleSiteOptionInBroadcastMassMessagingDropdown=function(e){var t=$("#"+this.context.Controls.BroadcastMassMessageDropdownClientId+" option[value='"+this.context.Settings.BroadcastMassMessageSchoolPermission+"']");if(e){var n=$("<option value='"+this.context.Settings.BroadcastMassMessageSitePermission+"'>"+this.context.LanguageTerms.Site+"</option>");t.before(n)}else{var i=$("#"+this.context.Controls.BroadcastMassMessageDropdownClientId+" option:selected").val();$("#"+this.context.Controls.BroadcastMassMessageDropdownClientId+" option[value='"+this.context.Settings.BroadcastMassMessageSitePermission+"']").remove(),i===this.context.Settings.BroadcastMassMessageSitePermission.toString()&&t.attr("selected","selected")}},t}();e.EditPolicy=t}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(e){var t=this;this.controls={checkbox:null,newActionButton:null,radioButtons:null,textArea:null,confirmButton:null},this.sections={recentActions:null,newAction:null,reason:null,confirmation:null},this.initialize=function(e){t.initializeSections(e),t.initializeControls(e),setTimeout(t.revealElements,0)},this.initializeSections=function(e){t.sections.recentActions=$("#"+e.RecentActionsSectionId),t.sections.newAction=$("#"+e.NewActionSectionId),t.sections.reason=$("#"+e.ReasonSectionId),t.sections.confirmation=$("#"+e.ConfirmationSectionId)},this.initializeControls=function(e){t.controls.checkbox=$("#"+e.CheckboxId),t.controls.newActionButton=$("#"+e.NewActionButtonId),t.controls.radioButtons=$("#"+e.NewActionSectionId+" input"),t.controls.textArea=$("#"+e.TextAreaId),t.controls.confirmButton=$("#"+e.ConfirmButtonId),t.controls.checkbox.change(t.onCheckboxClick),t.controls.newActionButton.on("click",t.onNewActionButtonClick),t.controls.radioButtons.on("change",t.onRadioButtonClick),CCL.TextAreaExtensions.setMaxLength(t.controls.textArea,e.ReasonMaxLength),t.controls.textArea.on("input change",t.onTextAreaUpdate)},this.onCheckboxClick=function(e){e.target.checked||(t.hasNewActionButtonBeenPressed=!1),t.revealElements()},this.onNewActionButtonClick=function(){t.hasNewActionButtonBeenPressed=!0,t.revealElements()},this.onRadioButtonClick=function(){t.revealElements()},this.onTextAreaUpdate=function(){t.revealElements()},this.revealElements=function(){var e=!1,n=!0,i=!1,s=!1,o=!1,r=!1;t.isUserConfirmed()&&(e=!0,t.hasNewActionButtonBeenPressed&&(n=!1,i=!0,t.isActionSelected()&&(s=!0,o=!0,t.isReasonProvided()&&(r=!0)))),t.showOrHideElement(t.sections.recentActions,e),t.showOrHideElement(t.controls.newActionButton,n),t.showOrHideElement(t.sections.newAction,i,function(){t.controls.radioButtons.each(function(){$(this).prop("checked",!1)})}),t.showOrHideElement(t.sections.reason,s,function(){t.controls.textArea.val("")}),t.showOrHideElement(t.sections.confirmation,o),t.controls.confirmButton.prop("disabled",!r)},this.showOrHideElement=function(e,t,n){void 0===n&&(n=function(){}),t?e.show():(e.hide(),n())},this.isUserConfirmed=function(){return t.controls.checkbox.is(":checked")},this.isActionSelected=function(){return t.controls.radioButtons.is(":checked")},this.isReasonProvided=function(){return""!=t.controls.textArea.val().trim()},$(function(){return t.initialize(e)})};e.Default=t}(e.Gdpr||(e.Gdpr={}))}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(t){var n=function(){function t(t){var n=this;this.context=t,this.onDialogAddButtonClick=function(t){var i=new Array;t.forEach(function(t,n){t!==e.CheckboxStateMachine.State.Saved&&t!==e.CheckboxStateMachine.State.AttachedByUser||i.push(n)}),n.selectedHierarchyIds.val(i.join()),n.isHierarchySelectionChanged=!0},this.onDialogClosed=function(){n.isHierarchySelectionChanged&&n.context.Scripts.SelectHierarchyScript()},this.setupHierarchyLinkClickHandler()}return Object.defineProperty(t.prototype,"selectedHierarchyIds",{get:function(){return $("#"+this.context.Controls.SelectedHierarchyIds)},enumerable:!0,configurable:!0}),t.prototype.setupHierarchyLinkClickHandler=function(){var t=this,n=e.Controls.HierarchyDialog.hierarchyDialogManagerInstance,i=this.selectedHierarchyIds.val()?this.selectedHierarchyIds.val().split(","):[];n&&$("#"+this.context.Controls.AddHierarchyLinkId).on(CCL.CommonFunctions.isMobileDevice()?"touchstart":"click",function(){t.isHierarchySelectionChanged=!1;var s=new Map;i.forEach(function(t){s.set(parseInt(t),e.CheckboxStateMachine.State.Saved)}),n.openDialog({itemStates:s,disabledItemIds:[],header:t.context.Resources.HierarchyDialogHeader,afterOkClickCallback:t.onDialogAddButtonClick,afterCloseDialogCallback:t.onDialogClosed,allowFolderSelection:!0},{})})},t}();t.AddEditModuleApps=n}(t.ManageApps||(t.ManageApps={}))}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(n){var i=function(){function n(e,t,n,i){this.utility=e,this.editorCallbacks=t,this.cssClasses=n,this.terms=i}return n.prototype.buildCommonMarkup=function(e,t,n,i,s,o,r,a,l,c,d,u){void 0===a&&(a=null),void 0===l&&(l=!1),void 0===c&&(c=!1),void 0===d&&(d=!0),n&&this.buildSectionTitle(e,i,s),a&&a(),this.buildContentMarkup(e,t.editable&&r,!c&&l,o,c,d,u)},n.prototype.buildSectionTitle=function(e,t,n){$("<div>").addClass(t).text(n).appendTo(e)},n.prototype.getEditorBinding=function(e,t){var n=this;return{element:t,event:e,watermarkText:this.getTextContainerWatermark(e),cachedText:this.getCachedText(e),cachedPlainText:this.getCachedPlainText(e),isPlainText:this.isPlainText(e),sendTextAjax:function(i){return n.sendTextAjax(e,t,i)}}},n.prototype.checkEventHasAttachedResources=function(e,t){return e.bookedResources&&e.bookedResources.length>0||e.PlanIds&&e.PlanIds.length>0||this.utility.getAddedElementsCount(t)>0},n.prototype.buildContentMarkup=function(n,i,s,o,r,a,l){var c=this,d=$("<div>");l&&d.addClass(this.utility.settings.cssClasses.ModernInputTextEditor).addClass(this.utility.settings.cssClasses.ModernInputTextIsValid).appendTo(n);var u=$("<div>").addClass(this.cssClasses.inlineEditContainer).appendTo(l?d:n),h=$("<div>");r?h.text(o.cachedText):(h.html(o.cachedText),s&&CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(h)),h.addClass(this.utility.settings.cssClasses.UserInput).appendTo(u),i&&(o.isPlainText?(u.addClass(this.utility.settings.cssClasses.TextContainerEditable),h.css("cursor","pointer"),h.css("outline","none"),h.prop("tabindex",0),o.cachedText.trim()||h.addClass(this.utility.settings.cssClasses.TextContainerWatermark).text(o.watermarkText),h.one("click keyup",function(){if(void 0===u.find("textarea")[0]&&0===u.find("div[data-created-marker=true]").length&&(h.attr("data-created-marker","true"),new t.InlineEdit.InlineEditContent(u,c.utility,c.editorCallbacks,o,r,a,l?l.inputValidationFunction:null).makeTextContentInlineEditable(),l)){var n=new e.InputValidator(c.utility,d,l);n.createValidationMessageContainer(),c.editorCallbacks.onEditFinished=function(){n.resetValidation()}}})):h.prop("title",this.terms.isNotEditableTooltip)),r||CCL.CommonFunctions.executeScripts(o.cachedText)},n}();n.MarkupBuilderBase=i}(t.EventTextContent||(t.EventTextContent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function e(e){this.utility=e}return e.prototype.buildMarkup=function(e,t){(t.editable||t.PreviousEvent.ExtraDescription&&t.PreviousEvent.ExtraDescription.length)&&$("<div>").addClass(this.utility.settings.cssClasses.DescriptionApiLabel).text(this.utility.settings.terms.ApiDescriptionLabel).appendTo(e),$("<div>").addClass(this.utility.settings.cssClasses.UserInput).addClass(this.utility.settings.cssClasses.DescriptionApi).html(t.apiDescription).appendTo($(e))},e}();e.ApiDescriptionMarkupBuilder=t}(e.EventTextContent||(e.EventTextContent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e){this.utility=e,this.defaultTitleHeight=20,this.defaultDescriptionHeight=86,this.cssClasses=this.utility.settings.cssClasses,this.controls=this.utility.controls}return e.prototype.getFilterItemIds=function(e,t){for(var n=[],i=0,s=this.getFilterItemsList(e);i<s.length;i++){var o=s[i];!t==!this.filterItemChecked(o)&&n.push(+o.dataset.itemid)}return n},e.prototype.getFilterItemIdsWithColors=function(e,t){for(var n=[],i=[],s=0,o=this.getFilterItemsList(e);s<o.length;s++){var r=o[s];!t==!this.filterItemChecked(r)&&(n.push(+r.dataset.itemid),i.push(+r.dataset.itemcolor))}return{persons:n.join(),colors:i.join()}},e.prototype.toggleDescriptionInlineEditorModes=function(e,t){(t&&!e.isPlainTextInDescription?(this.controls.AddEventReadOnlyDescriptionContainer.innerHTML=e.description,this.controls.AddEventReadOnlyDescriptionContainer.style.display="block",this.controls.AddEventEditableDescriptionContainer.style.display="none",CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick($(this.controls.AddEventReadOnlyDescriptionContainer))):(this.controls.AddEventReadOnlyDescriptionContainer&&(this.controls.AddEventReadOnlyDescriptionContainer.innerHTML="",this.controls.AddEventReadOnlyDescriptionContainer.style.display="none"),this.controls.AddEventEditableDescriptionContainer.style.display="block",this.controls.addEventDescriptionBox[0].value=t&&e.descriptionPlainText||""),this.utility.settings.customerSettings.enableFrenchCalendarLayout)&&(t&&!e.isPlainTextInExtraDescription?(this.controls.AddEventReadOnlyExtraDescriptionContainer.innerHTML=e.extraDescription,this.controls.AddEventReadOnlyExtraDescriptionContainer.style.display="block",this.controls.AddEventEditableExtraDescriptionContainer.style.display="none",CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick($(this.controls.AddEventEditableExtraDescriptionContainer))):(this.controls.AddEventReadOnlyExtraDescriptionContainer&&(this.controls.AddEventReadOnlyExtraDescriptionContainer.innerHTML="",this.controls.AddEventReadOnlyExtraDescriptionContainer.style.display="none"),this.controls.AddEventEditableExtraDescriptionContainer.style.display="block",this.controls.addEventExtraDescriptionBox[0].value=t&&e.extraDescriptionPlainText||""))},e.prototype.resetInputFieldsToDefault=function(e){this.controls.addEventChooseCategoryErrorMessageLabel[0].style.display="none",this.controls.addEventResponseErrorMessageLabel[0].style.display="none",this.controls.AddEventTitleTextBox[0].value=e,this.controls.addEventDescriptionBox[0].value="",this.controls.addEventExtraDescriptionBox[0]&&(this.controls.addEventExtraDescriptionBox[0].value=""),this.controls.AddEventTitleTextBox[0].style.height=this.defaultTitleHeight+"px",this.controls.addEventDescriptionBox[0].style.height=this.defaultDescriptionHeight+"px",this.controls.addEventExtraDescriptionBox[0]&&(this.controls.addEventExtraDescriptionBox[0].style.height=this.defaultDescriptionHeight+"px")},e.prototype.adjustHeights=function(){this.controls.AddEventTitleTextBox[0].style.height=this.controls.AddEventTitleTextBox[0].scrollHeight+"px",this.controls.addEventDescriptionBox[0].style.height=this.controls.addEventDescriptionBox[0].scrollHeight+"px",this.controls.addEventExtraDescriptionBox[0]&&(this.controls.addEventExtraDescriptionBox[0].style.height=this.controls.addEventExtraDescriptionBox[0].scrollHeight+"px")},e.prototype.setUserInputsIfNeeded=function(e){if(e){if(!e.IsEventTitleReadOnly){var t=this.controls.eventDetailsMainContainer.querySelector("."+this.cssClasses.Title+" > ."+this.cssClasses.UserInput);t&&(e.EventTitle=!t.classList.contains(this.cssClasses.TextContainerWatermark)&&t.innerText||"")}if(e.isPlainTextInDescription){var n=this.controls.eventDetailsMainContainer.querySelector("."+this.cssClasses.Description+" > ."+this.cssClasses.UserInput);n&&(e.description=!n.classList.contains(this.cssClasses.TextContainerWatermark)&&n.innerHTML||"")}if(this.utility.settings.customerSettings.enableFrenchCalendarLayout&&e.showExtraDescription&&e.isPlainTextInExtraDescription){var i=this.controls.eventDetailsMainContainer.querySelector("."+this.cssClasses.DescriptionExtra+" > ."+this.cssClasses.UserInput);i&&(e.extraDescription=!i.classList.contains(this.cssClasses.TextContainerWatermark)&&i.innerHTML||"")}}},e.prototype.getFilterItemsList=function(e){return e&&Object.assign([],e.getElementsByClassName(this.cssClasses.FilterItem))||[]},e.prototype.filterItemChecked=function(e){return e.querySelector("input").checked},e}();e.Schedule=t}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){!function(e){e[e.None=0]="None",e[e.NotSet=1]="NotSet",e[e.Success=2]="Success",e[e.RegistrationClosed=3]="RegistrationClosed",e[e.AttendanceChangedByTeacher=4]="AttendanceChangedByTeacher"}(e.SelfRegisteredPersonAttendanceStatus||(e.SelfRegisteredPersonAttendanceStatus={}));e.SelfRegisteredPersonAttendanceStatus}(e.SelfRegistrationAttendance||(e.SelfRegistrationAttendance={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function t(e){this.utility=e,this.terms=this.utility.settings.terms,this.cssClasses=this.utility.settings.cssClasses}return t.prototype.buildMarkup=function(t,n,i){if(n.showSelfRegistrationOfAttendanceSection&&!n.editable&&n.selfRegisteredAttendanceStatus!==e.SelfRegisteredPersonAttendanceStatus.None){var s=document.createElement("div");s.classList.add(this.utility.settings.cssClasses.SelfRegistrationLabel),s.innerText=this.utility.settings.terms.SelfRegistration;var o=document.createElement("div");o.appendChild(s),n.selfRegisteredAttendanceStatus===e.SelfRegisteredPersonAttendanceStatus.NotSet?this.buildSelfRegistrationButton(o,i):this.buildSelfRegisteredAttendanceStatus(o,n.selfRegisteredAttendanceStatus),t[0].appendChild(o)}},t.prototype.buildSelfRegistrationButton=function(e,t){var n=document.createElement("button");n.type="button",n.setAttribute("aria-label",this.terms.RegisterPresence),n.addEventListener("click",t),n.classList.add(this.cssClasses.Button),n.classList.add(this.cssClasses.SelfRegistrationButton);var i=document.createTextNode(this.terms.RegisterPresence);n.appendChild(i);var s=document.createElement("div");s.classList.add(this.utility.settings.cssClasses.MarginBottom20),s.classList.add(this.utility.settings.cssClasses.MarginTop10),s.appendChild(n),$(s).appendTo($(e))},t.prototype.buildSelfRegisteredAttendanceStatus=function(t,n){var i="",s="";switch(n){case e.SelfRegisteredPersonAttendanceStatus.Success:i=this.terms.PresenceRegistered,s=this.cssClasses.SelfRegistrationStatusSuccess;break;case e.SelfRegisteredPersonAttendanceStatus.RegistrationClosed:i=this.terms.SelfRegistrationClosed,s=this.cssClasses.SelfRegistrationStatusClosed;break;case e.SelfRegisteredPersonAttendanceStatus.AttendanceChangedByTeacher:i=this.terms.PresenceChangedToAbsence,s=this.cssClasses.SelfRegistrationStatusChanged}if(""!==i){var o=document.createElement("div");o.classList.add(this.cssClasses.SelfRegistrationStatusLabel),o.classList.add(s);var r=document.createTextNode(i);o.appendChild(r),$(o).appendTo($(t))}},t}();e.SelfRegistrationSectionMarkupBuilder=t}(e.SelfRegistrationAttendance||(e.SelfRegistrationAttendance={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function t(t,n){var i=this;this.controls=t,this.settings=n,e.multipleCourseSearchSelectorDialogClientInstance=this,this.modalDialog=window[this.dialogId],this.controls.CourseSearchButton&&(this.controls.CourseSearchButton.onclick=function(){i.inputSelectize.isOpen?i.inputSelectize.close():i.inputSelectize.open()}),this.controls.AddButton.onclick=function(e){i.preventDefaultOnSave&&e.preventDefault(),i.updateSelectedCourses(),i.settings.OnSaveCallback&&i.settings.OnSaveCallback(e)},this.modalDialog.setCustomScripts({afterCloseDialog:function(){i.modalDialog.clearLastActiveElement(),i.inputSelectize.blur()},afterOpenDialog:function(){i.inputSelectize.close(),i.inputSelectize.focus(),setTimeout(function(){i.refreshSelectedCourses()},10)}}),this.initSelectize(),this.inputSelectize.hideInput=function(){var e=this;e.setTextboxValue(""),e.$control_input.css({opacity:0}),e.isInputHidden=!0};var s=this.inputSelectize.$dropdown,o=this.inputSelectize.$control;this.inputSelectize.positionDropdown=function(){s.position({my:"left top",at:"left bottom",of:o,collision:"none"}),s.css("width",o.outerWidth())}}return Object.defineProperty(t.prototype,"dialogId",{get:function(){return this.controls.Container.id},enumerable:!0,configurable:!0}),t.prototype.setCoursesToSelectFrom=function(e){this.settings.CoursesAvailableToSelect=e,this.inputSelectize.clearOptions(),this.updateSearchInput()},t.prototype.setMaxItems=function(e){this.inputSelectize.settings.maxItems=e},t.prototype.openDialog=function(e,t,n){void 0===n&&(n=!0),this.settings.OnSaveCallback=t,this.preventDefaultOnSave=n,this.modalDialog.openDialog(!1),this.selectedCourses=e},Object.defineProperty(t.prototype,"selectedCourses",{get:function(){return this.selectedCoursesArray},set:function(e){this.selectedCoursesArray=e},enumerable:!0,configurable:!0}),t.prototype.updateSelectedCourses=function(){var e=this;this.selectedCourses=this.inputSelectize.items?this.inputSelectize.items.map(function(t){return e.settings.CoursesAvailableToSelect.filter(function(e){return e.CourseId===parseInt(t,10)})[0]}):[]},t.prototype.getAvailableCoursesCount=function(){return this.settings.CoursesAvailableToSelect.length},t.prototype.clear=function(){this.inputSelectize.clear(!0)},t.prototype.toggleError=function(e){var t=this.controls.Container.querySelector("."+this.settings.CssClasses.SelectizeInput);e?t.classList.add(this.settings.CssClasses.ModernInputInvalid):t.classList.remove(this.settings.CssClasses.ModernInputInvalid)},t.prototype.initSelectize=function(){var e=this,t=$(this.controls.CourseSearchInput);t.selectize({valueField:"Value",plugins:{"selectize-plugin-a11y":{},remove_button:{title:this.settings.Terms.Remove},no_results:{message:this.settings.Terms.NoMatches}},searchField:["Label"],highlight:!1,openOnFocus:!0,closeAfterSelect:!0,preload:"focus",addPrecedence:!0,persist:!1,loadThrottle:null,maxOptions:this.settings.MaxNumberOfCoursesToShow>0?this.settings.MaxNumberOfCoursesToShow:void 0,placeholder:this.settings.Terms.FindCourses,diacritics:!1,render:{item:function(t,n){return'<div class="itsl-selectize-item"><span class="'+e.settings.CssClasses.CourseIconClass+" "+t.ColorCssClass+'"></span><span class="itsl-selectize-item-label">'+n(t.Label)+"</span></div>"},option:function(t,n){return'<div class="itsl-selectize-option"><span class="'+e.settings.CssClasses.CourseIconClass+" "+t.ColorCssClass+'"></span><span class="itsl-selectize-option-label">'+n(t.Label)+"</span></div>"}},load:function(){e.settings.CoursesAvailableToSelect.forEach(function(t){e.inputSelectize.addOption({Label:t.Title,Value:t.CourseId,ColorCssClass:t.ColorCssClass})}),e.inputSelectize.refreshOptions()},onItemAdd:function(){e.updateSearchInput(),e.inputSelectize.$control[0].scrollTop=e.inputSelectize.$control[0].scrollHeight,e.settings.OnItemAddCallback&&e.settings.OnItemAddCallback()},onItemRemove:function(){e.updateSearchInput(),e.settings.OnItemRemoveCallback&&e.settings.OnItemRemoveCallback()},onFocus:function(){e.updateSearchInput()}}),this.inputSelectize=t[0].selectize,this.inputSelectize.$control.click(function(){return e.inputSelectize.open()}),this.inputSelectize.$control_input.keypress(function(e){e.which===CCL.CommonConstants.keyCodes.enter&&e.preventDefault()}).keyup(function(t){t.which===CCL.CommonConstants.keyCodes.escape&&e.inputSelectize.isFocused&&t.stopPropagation()})},t.prototype.refreshSelectedCourses=function(){var e=this.selectedCourses?this.selectedCourses.map(function(e){return e.CourseId.toString()}):[];this.inputSelectize.setValue(e,!0)},t.prototype.updateSearchInput=function(){this.inputSelectize.loadedSearches={},this.inputSelectize.lastQuery=null,this.inputSelectize.refreshOptions()},t}();e.MultipleCourseSearchSelector=t}(e.MultipleCourseSearchSelector||(e.MultipleCourseSearchSelector={}))}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(t){this.settings=t,window[e.instanceName]=this}return e.prototype.countDown=function(e,t){var n=this,i=document.querySelector("[id$='"+this.settings.TimerPrefix+e+"']"),s=document.querySelector("[id$='"+this.settings.EditLinkPrefix+e+"']");s&&i&&(t>0?(i.innerHTML=this.settings.EditMessagePart1+" "+t+" "+this.settings.EditMessagePart2,t-=1,setTimeout(function(){n.countDown(e,t)},6e4)):(i.style.display="none",s.style.display="none"))},e.getInstance=function(){return window[e.instanceName]},e.instanceName="ThreadViewTableClientInstance",e}();e.ThreadViewTable=t}(e.Discussion||(e.Discussion={}))}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){var n=this;this.controls=e,this.settings=t,this.modalDialog=window[this.getDialogId()],this.setupOkButtonClickHandler(),this.modalDialog.setCustomScripts({afterOpenDialogAjaxDynamicallySuccess:function(){var e=window[n.settings.TreeViewSelectorContainerId];e.init({allowFolderSelection:!0,itemStates:n.currentParams.itemStates,disabledItemIds:n.currentParams.disabledItemIds});var t=e.countCheckedItems()>0;n.controls.OkButton.prop("disabled",!t),n.controls.Container.on(e.settings.StateChangedEventName,function(e,t){n.controls.OkButton.prop("disabled",0===t)}),e.onFolderContentLoaded();var i=n.controls.Container.find(CCL.CommonFunctions.getDataSelector(e.settings.DataAttributes.ItemId)).first();e.expandFolder(i)},afterCloseDialog:function(){void 0!==n.currentParams.afterCloseDialogCallback&&n.currentParams.afterCloseDialogCallback()}})}return e.prototype.openDialog=function(e,t){this.currentParams=e,$.extend(t,{treeViewContainerId:this.settings.TreeViewSelectorContainerId}),this.ajaxParams=t,this.modalDialog.setAjaxUrl(this.settings.DialogContentUrl,t,!1),this.modalDialog.setTitle(this.currentParams.header),this.modalDialog.openDialog(!1)},e.prototype.closeDialog=function(){CssModal.closeDialog()},e.prototype.getDialogId=function(){return this.controls.Container.prop("id")},e.prototype.setupOkButtonClickHandler=function(){var e=this;this.controls.OkButton.on("click",function(t){e.currentParams.afterOkClickCallback(e.currentParams.itemStates),e.closeDialog(),t.preventDefault()})},e}();e.HierarchyDialogManager=t}(e.HierarchyDialog||(e.HierarchyDialog={}))}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;this.options=new Map,this.optionsGroup=e,this.options=new Map,t.forEach(function(e){return n.options.set(e[0],e[1])}),this.optionsGroup.on("keydown","label",function(e){if(e.keyCode===CCL.CommonConstants.keyCodes.enter||e.keyCode===CCL.CommonConstants.keyCodes.space)return $(e.target).click(),e.preventDefault(),!1})}return e.prototype.isSelected=function(e){return this.isOptionSelected(this.options.get(e))},e.prototype.addOnChangeHandler=function(e){this.optionsGroup.on("change","input:radio",e)},e.prototype.isOptionSelected=function(e){return e.is(":checked")},e}();e.OptionRadioButtonManagerBase=t}(e.OptionRadioButton||(e.OptionRadioButton={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(t){var n=function(){function n(n,i){var s=this;this.controls=n,this.settings=i,this.optionRadioManager=new e.OptionRadioButton.OptionRadioButtonManagerBase(this.controls.RadioButtonGroup,[[t.PrivacyChangedDialogActionType.MakeReadOnly,this.controls.RadioButtonReadOnly],[t.PrivacyChangedDialogActionType.LeaveOpen,this.controls.RadioButtonLeaveOpen]]),this.optionRadioManager.addOnChangeHandler(function(){s.switchState()}),t.privacyChangedDialogManagerInstance.toggleOkButton(0===this.getSelectedProfilesIds().length),this.controls.ProfileCheckboxesByCss.off("change").on("change",function(e){t.privacyChangedDialogManagerInstance.toggleOkButton(0===s.getSelectedProfilesIds().length)})}return n.prototype.getCurrentProfileId=function(){return this.settings.CurrentProfileId},n.prototype.selectedActionType=function(){return this.optionRadioManager.isSelected(t.PrivacyChangedDialogActionType.MakeReadOnly)?t.PrivacyChangedDialogActionType.MakeReadOnly:t.PrivacyChangedDialogActionType.LeaveOpen},n.prototype.getSelectedProfilesIds=function(){for(var e=this,t=new Array,n=function(n){if(n.is(":checked")){var s=i.settings.PersonProfiles.find(function(t){return t.PersonProfileId.toString()===n.attr("id").replace(e.settings.ProfileCheckboxPrefix,"")});t.push(s.PersonProfileId)}},i=this,s=0,o=this.controls.ProfileCheckboxes;s<o.length;s++){n(o[s])}return t},n.prototype.getSelectedProfileNames=function(){for(var e=this,t=new Array,n=function(n){if(n.is(":checked")){var s=i.settings.PersonProfiles.find(function(t){return t.PersonProfileId.toString()===n.attr("id").replace(e.settings.ProfileCheckboxPrefix,"")});t.push(s.PersonProfileName)}},i=this,s=0,o=this.controls.ProfileCheckboxes;s<o.length;s++){n(o[s])}return t},n.prototype.areGroupConversationsIncludedChecked=function(){return this.controls.IncludeGroupConversationsCheckbox.is(":checked")},n.prototype.switchState=function(){this.optionRadioManager.isSelected(t.PrivacyChangedDialogActionType.MakeReadOnly)?(this.controls.ReadOnlySection.show(),t.privacyChangedDialogManagerInstance.toggleOkButton(0===this.getSelectedProfilesIds().length)):(this.controls.ReadOnlySection.hide(),t.privacyChangedDialogManagerInstance.toggleOkButton(!1))},n}();t.PrivacyChangedDialogContentManager=n}(t.PersonProfile||(t.PersonProfile={}))}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(t){var n=function(){function n(e,t){this.controls=e,this.settings=t,this.modalDialog=window[this.getDialogId()]}return n.prototype.toggleOkButton=function(e){this.controls.OkButton.prop("disabled",e)},n.prototype.openDialog=function(e,t){this.params=e,this.modalDialog.setAjaxUrl(this.settings.DialogContentUrl,t,!1),this.modalDialog.setTitle(this.settings.HeaderText),this.setupOkButtonClickHandler(),this.modalDialog.openDialog(!1)},n.prototype.closeDialog=function(){CssModal.closeDialog()},n.prototype.getDialogId=function(){return this.controls.Container.prop("id")},n.prototype.setupOkButtonClickHandler=function(){var n=this;this.controls.OkButton.off("click").on("click",function(i){e.WebComponents.personProfileSiteInstance.showConfirmEsafetyChanges(t.privacyChangedDialogContentManagerInstance.getSelectedProfileNames(),t.privacyChangedDialogContentManagerInstance.areGroupConversationsIncludedChecked(),t.privacyChangedDialogContentManagerInstance.selectedActionType())?(n.startJob(),n.closeDialog(),i.preventDefault(),new Function(n.params.submitFormMethod)()):i.preventDefault()})},n.prototype.startJob=function(){var e={selectedAction:t.privacyChangedDialogContentManagerInstance.selectedActionType(),selectedProfileIds:t.privacyChangedDialogContentManagerInstance.getSelectedProfilesIds(),currentProfileId:t.privacyChangedDialogContentManagerInstance.getCurrentProfileId(),areGroupConversationsIncluded:t.privacyChangedDialogContentManagerInstance.areGroupConversationsIncludedChecked()};CCL.CommonFunctions.safeAjaxPost({url:this.settings.StartPrivacyChangedJob,data:e,dataType:"html"})},n}();t.PrivacyChangedDialogManager=n}(t.PersonProfile||(t.PersonProfile={}))}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(t){this.context=t,this.selectedItemsCount=function(){return e.projectManagerInstance.context.Controls.PerformOnAllCheckbox.is(":checked")?e.projectManagerInstance.context.Settings.ProjectsVirtualCount:e.projectManagerInstance.context.Controls.TableItem.find("tr.selected").length},this.hideArchiveFilter=function(t){var n=$("."+e.projectManagerInstance.context.Settings.ArchiveDateCssClass).parent();$("#"+e.projectManagerInstance.context.Controls.StatusClientId+" input[type = 'radio']").first().attr("id")===t.target.id?n.hide():n.show()},this.clickOnAction=function(t){if($(t.currentTarget).is("[disabled=disabled]"))return!1;var n=e.projectManagerInstance.selectedItemsCount();return 0!==n&&confirm(CCL.CommonFunctions.formatString(t.data.text,n))},this.context=t,e.projectManagerInstance=this,$("."+e.projectManagerInstance.context.Settings.ArchiveDateCssClass).children().addClass(e.projectManagerInstance.context.Settings.InlineCssClass),$("#"+e.projectManagerInstance.context.Controls.StatusClientId+" input[type = 'radio']").first().is(":checked")&&$("."+e.projectManagerInstance.context.Settings.ArchiveDateCssClass).parent().hide(),$("#"+e.projectManagerInstance.context.Controls.StatusClientId+" input[type = 'radio']").click(this.hideArchiveFilter),e.projectManagerInstance.context.Controls.DeleteAction.on("click",null,{text:e.projectManagerInstance.context.LanguageTerms.DeleteConfirmText},this.clickOnAction);for(var n=0,i=e.projectManagerInstance.context.Controls.HeaderClientIds;n<i.length;n++){var s=i[n],o=document.getElementById(s);o&&1===o.childNodes.length&&(o.className="")}};e.ProjectManager=t}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t){this.context=t,e.finalAssessmentInstance=this}return t.prototype.toggleView=function(e,t){$(e).closest(this.context.Controls.ItemRootCssSelector).find("li[data-id='"+t+"']").toggle()},t.prototype.alertAjaxError=function(e){CCL.CommonFunctions.alertAjaxError(e,null,null)},t.prototype.updateViewScore=function(e,t){var n=e.val();n===this.context.Settings.NotAssessmentStringPattern&&(n=this.context.Settings.NotAssessmentReplaceValue),e.closest(this.context.Controls.ItemRootCssSelector).find("li[data-id='"+t+"'] "+this.context.Controls.ScoreCssSelector).text(n)},t.prototype.assessPerson=function(e,t,n,i,s){var o={personId:e,assessmentId:n,assessmentItemId:t.getValue(),courseId:i,gradeBookItemId:s};CCL.CommonFunctions.safeAjaxPost({url:this.context.WebMethods.AssessWithScaleUrl,data:o}).fail(this.alertAjaxError).done(this.updateViewScore(t,s))},t}();e.FinalAssessment=t}(e.AssessmentRecord||(e.AssessmentRecord={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function t(t){e.termAssessmentOverviewInstance=this,this.context=t}return t.prototype.init=function(){var e=this;$("#"+this.context.Controls.CompleteCourseButtonId).click(function(){return e.completeSelectedCourses()}),$("#"+this.context.Controls.RevertCourseButtonId).click(function(){return e.revertSelectedCourses()})},t.prototype.getSelectedCourses=function(){for(var e=$("#"+this.context.Controls.GridId).find("tbody > tr.selected"),t=new Array,n=0,i=e.toArray();n<i.length;n++){var s=i[n],o=$("span["+this.context.Settings.DataSerializedInfoAttribute+"]",s).first(),r=$.parseJSON(o.attr(this.context.Settings.DataSerializedInfoAttribute));t.push(r)}return t},t.prototype.getRevertConfirmationMessage=function(e){var t="";switch(e.length){case 0:break;case 1:t=this.context.Settings.RevertConfirmOneCourseMessagePattern.replace(this.context.Settings.CourseAPattern,e[0].Title);break;case 2:t=this.context.Settings.RevertConfirmTwoCoursesMessagePattern.replace(this.context.Settings.CourseAPattern,e[0].Title).replace(this.context.Settings.CourseBPattern,e[1].Title);break;case 3:t=this.context.Settings.RevertConfirmThreeCoursesMessagePattern.replace(this.context.Settings.CourseAPattern,e[0].Title).replace(this.context.Settings.CourseBPattern,e[1].Title).replace(this.context.Settings.CourseCPattern,e[2].Title);break;default:t=this.context.Settings.RevertConfirmFourOrMoreCoursesMessagesPattern.replace(this.context.Settings.CourseAPattern,e[0].Title).replace(this.context.Settings.CourseBPattern,e[1].Title).replace(this.context.Settings.NumberOfCoursesPattern,(e.length-2).toString())}return t},t.prototype.checkSelectionExists=function(e){return 0!=e.length||(jAlert(this.context.Settings.PleaseMakeSelectionMessage),!1)},t.prototype.completeSelectedCourses=function(){var e=this,t=this.getSelectedCourses();if(this.checkSelectionExists(t)){var n=this.context.Settings.CompleteConfirmMessage;jConfirm(n,this.context.Settings.ConfirmDialogTitle,function(t){t&&e.context.Scripts.PostbackComplete()})}},t.prototype.revertSelectedCourses=function(){var e=this,t=this.getSelectedCourses();if(this.checkSelectionExists(t)){var n=this.getRevertConfirmationMessage(t);jConfirm(n,this.context.Settings.ConfirmDialogTitle,function(t){t&&e.context.Scripts.PostbackRevert()})}},t}();e.TermAssessmentOverview=t}(e.Headteacher||(e.Headteacher={}))}(e.Assessment||(e.Assessment={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t){this.settings=t,this.crumbs=window.parent.document.getElementById("crumbs"),this.textItemBuilder=new e.BreadcrumbTextItemBuilder(t.CssClasses),this.linkItemBuilder=new e.BreadcrumbLinkItemBuilder(t.CssClasses,t.KpiSettings)}return t.prototype.buildBreadcrumbs=function(e){var t=this;window.parent!==window&&this.crumbs&&(Array.prototype.slice.call(this.crumbs.querySelectorAll("li:not(:first-child)")).forEach(function(e){e.parentNode.removeChild(e)}),e.forEach(function(n,i){var s=i===e.length-1?t.textItemBuilder:t.linkItemBuilder;t.crumbs.appendChild(s.buildItem(n))}))},t}();e.BreadcrumbBuilder=t}(e.Breadcrumbs||(e.Breadcrumbs={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){this.cssClasses=e}return e.prototype.buildListItem=function(e){var t=document.createElement("li");return t.appendChild(this.getSeparator()),t.appendChild(e),t},e.prototype.getSeparator=function(){var e=document.createElement("span");return e.innerText="/",e.className=this.cssClasses.Separator,e},e}();e.BreadcrumbItemBuilderBase=t}(e.Breadcrumbs||(e.Breadcrumbs={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e){function t(t,n){e.call(this,t),this.kpiSettings=n}return __extends(t,e),t.prototype.buildItem=function(e){var t=this,n=document.createElement("a");n.innerText=e.Text,n.setAttribute("title",e.Title&&e.Title.length?e.Title:e.Text),n.setAttribute("href",e.Href),n.setAttribute("target",e.Target),n.onclick=function(){return t.measureKpi()};var i=document.createElement("span");return i.appendChild(n),this.buildListItem(i)},t.prototype.measureKpi=function(){fetch(this.kpiSettings.Url,{credentials:"same-origin",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({measureSection:this.kpiSettings.Section,measurement:this.kpiSettings.Measurement,measureContext:this.kpiSettings.Context})})},t}(e.BreadcrumbItemBuilderBase);e.BreadcrumbLinkItemBuilder=t}(e.Breadcrumbs||(e.Breadcrumbs={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e){function t(t){e.call(this,t)}return __extends(t,e),t.prototype.buildItem=function(e){var t=document.createElement("span");return t.className=this.cssClasses.SelectedCrumb,t.innerText=e.Text,this.buildListItem(t)},t}(e.BreadcrumbItemBuilderBase);e.BreadcrumbTextItemBuilder=t}(e.Breadcrumbs||(e.Breadcrumbs={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.Library=0]="Library",e[e.Course=1]="Course",e[e.CreateNew=2]="CreateNew",e[e.Computer=3]="Computer"}(e.ElementExternalSourceType||(e.ElementExternalSourceType={}));e.ElementExternalSourceType}(e.AddResourceMenu||(e.AddResourceMenu={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){e[e.MakeReadOnly=0]="MakeReadOnly",e[e.LeaveOpen=1]="LeaveOpen"}(e.PrivacyChangedDialogActionType||(e.PrivacyChangedDialogActionType={}));e.PrivacyChangedDialogActionType}(e.PersonProfile||(e.PersonProfile={}))}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){e[e.Other=0]="Other",e[e.Resource=1]="Resource",e[e.Child=2]="Child"}(e.CalendarTypes||(e.CalendarTypes={}));e.CalendarTypes;!function(e){e[e.Month=0]="Month",e[e.Week=1]="Week",e[e.Day=2]="Day",e[e.List=3]="List"}(e.CalendarView||(e.CalendarView={}));e.CalendarView;!function(e){e[e.ReportError=0]="ReportError",e[e.PerformUpdate=1]="PerformUpdate",e[e.AskConfirmation=2]="AskConfirmation"}(e.EventCheckDecision||(e.EventCheckDecision={}));e.EventCheckDecision;!function(e){e[e.Month=0]="Month"}(e.EventCopyPeriodType||(e.EventCopyPeriodType={}));e.EventCopyPeriodType;!function(e){e[e.Unspecified=0]="Unspecified",e[e.RecurringEventInSingleMode=1]="RecurringEventInSingleMode",e[e.RecurringEventInUpcomingMode=2]="RecurringEventInUpcomingMode"}(e.EventScopeMode||(e.EventScopeMode={}));e.EventScopeMode;!function(e){e[e.CheckOnly=0]="CheckOnly",e[e.CheckOrUpdate=1]="CheckOrUpdate",e[e.UpdateOnly=2]="UpdateOnly"}(e.EventScopeOperation||(e.EventScopeOperation={}));e.EventScopeOperation;!function(e){e[e.Course=1]="Course",e[e.Person=2]="Person",e[e.Project=3]="Project",e[e.All=4]="All"}(e.EventType||(e.EventType={}));e.EventType;!function(e){e[e.None=0]="None",e[e.Default=1]="Default",e[e.CourseApproval=2]="CourseApproval",e[e.BookingsAvailability=4]="BookingsAvailability"}(e.EventValidationScope||(e.EventValidationScope={}));e.EventValidationScope}(e.CalendarControllerModels||(e.CalendarControllerModels={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){e[e.Available=1]="Available",e[e.PartlyBooked=2]="PartlyBooked",e[e.Booked=3]="Booked"}(e.BookableResourceStatuses||(e.BookableResourceStatuses={}));e.BookableResourceStatuses;!function(e){e[e.Monday=1]="Monday",e[e.Tuesday=2]="Tuesday",e[e.Wednesday=4]="Wednesday",e[e.Thursday=8]="Thursday",e[e.Friday=16]="Friday",e[e.Saturday=32]="Saturday",e[e.Sunday=64]="Sunday"}(e.WeekDays||(e.WeekDays={}));e.WeekDays}(e.EditEvent||(e.EditEvent={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.Empty=0]="Empty",e[e.Saved=1]="Saved",e[e.AttachedByUser=2]="AttachedByUser",e[e.DetachedByUser=3]="DetachedByUser"}(e.State||(e.State={}));e.State}(e.CheckboxStateMachine||(e.CheckboxStateMachine={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.Day=0]="Day",e[e.Week=1]="Week"}(e.DatePeriod||(e.DatePeriod={}));e.DatePeriod}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.Copy=0]="Copy",e[e.Move=1]="Move"}(e.CopyMoveElementDialogMode||(e.CopyMoveElementDialogMode={}));e.CopyMoveElementDialogMode}(e.CopyMoveElementDialog||(e.CopyMoveElementDialog={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.All=0]="All",e[e.Resources=1]="Resources",e[e.Activities=2]="Activities",e[e.LearningObjectives=3]="LearningObjectives",e[e.Homework=4]="Homework",e[e.Files=5]="Files"}(e.ContentElementType||(e.ContentElementType={}));e.ContentElementType}(e.ElementLinkDialog||(e.ElementLinkDialog={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.Participant=0]="Participant",e[e.Group=1]="Group"}(e.ItemType||(e.ItemType={}));e.ItemType}(e.ElementParticipantPicker||(e.ElementParticipantPicker={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){e[e.NextStep=0]="NextStep",e[e.NoNewSteps=-1]="NoNewSteps",e[e.Finish=-2]="Finish"}(e.TriggerResult||(e.TriggerResult={}));e.TriggerResult;!function(e){e[e.Score=1]="Score",e[e.StatusViewed=2]="StatusViewed",e[e.StatusSubmitted=3]="StatusSubmitted",e[e.StatusCompleted=4]="StatusCompleted"}(e.TriggerCondition||(e.TriggerCondition={}));e.TriggerCondition;!function(e){e[e.LinearTransitionWithSingleElement=0]="LinearTransitionWithSingleElement",e[e.LinearTransitionWithMultipleElements=1]="LinearTransitionWithMultipleElements",e[e.BranchingWithSingleElement=2]="BranchingWithSingleElement"}(e.StepType||(e.StepType={}));e.StepType;!function(e){e[e.StudentView=0]="StudentView",e[e.TeacherView=1]="TeacherView",e[e.TeacherEdit=2]="TeacherEdit"}(e.LearningPathStepViewMode||(e.LearningPathStepViewMode={}));e.LearningPathStepViewMode}(e.Builder||(e.Builder={}))}(e.LearningPath||(e.LearningPath={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){e[e.First="First"]="First",e[e.Last="Last"]="Last",e[e.Best="Best"]="Best"}(e.WhichAttemptCounts||(e.WhichAttemptCounts={}));e.WhichAttemptCounts;!function(e){e[e.Never="Never"]="Never",e[e.AfterEachAttempt="AfterEachAttempt"]="AfterEachAttempt",e[e.AfterDeadline="AfterDeadline"]="AfterDeadline",e[e.AfterAllAttempts="AfterAllAttempts"]="AfterAllAttempts",e[e.WhenTeacherDecides="WhenTeacherDecides"]="WhenTeacherDecides"}(e.WhenToShowResult||(e.WhenToShowResult={}));e.WhenToShowResult;!function(e){e[e.Never="Never"]="Never",e[e.AfterEachAttempt="AfterEachAttempt"]="AfterEachAttempt",e[e.AfterAllAttempts="AfterAllAttempts"]="AfterAllAttempts",e[e.WithResults="WithResults"]="WithResults",e[e.AfterDeadline="AfterDeadline"]="AfterDeadline"}(e.WhenToShowQuestionListAndAnswer||(e.WhenToShowQuestionListAndAnswer={}));e.WhenToShowQuestionListAndAnswer}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){e[e.ActivationControl=1]="ActivationControl",e[e.Results=2]="Results",e[e.SubmissionStatusForStudent=3]="SubmissionStatusForStudent",e[e.CollaborationSelector=4]="CollaborationSelector",e[e.Deadline=5]="Deadline",e[e.Homework=6]="Homework",e[e.LearningObjectiveList=7]="LearningObjectiveList",e[e.AssessmentScale=8]="AssessmentScale",e[e.Attempts=9]="Attempts",e[e.ResultsAndFeedback=10]="ResultsAndFeedback",e[e.SubmissionStatusForTeacher=11]="SubmissionStatusForTeacher",e[e.GroupSubmission=12]="GroupSubmission",e[e.AnonymousSubmission=13]="AnonymousSubmission",e[e.PlagiarismControl=14]="PlagiarismControl",e[e.Mandatory=15]="Mandatory",e[e.PeerAssessment=16]="PeerAssessment",e[e.TestMode=17]="TestMode",e[e.WorkloadSetting=18]="WorkloadSetting",e[e.Description=19]="Description",e[e.AssignTo=20]="AssignTo"}(e.SettingType||(e.SettingType={}));e.SettingType}(e.Settings||(e.Settings={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.ShowCurrent=0]="ShowCurrent",e[e.ShowScheduled=1]="ShowScheduled",e[e.ShowExpired=2]="ShowExpired"}(e.BulletinsDisplayMode||(e.BulletinsDisplayMode={}));e.BulletinsDisplayMode;!function(e){e[e.Success=0]="Success",e[e.LightBulletinNotFound=1]="LightBulletinNotFound",e[e.AnnouncementTextValidationError=2]="AnnouncementTextValidationError"}(e.GenericResponseCode||(e.GenericResponseCode={}));e.GenericResponseCode;!function(e){e[e.Edit=0]="Edit",e[e.SetCommentsAvailability=1]="SetCommentsAvailability",e[e.ScheduleBulletin=2]="ScheduleBulletin",e[e.Delete=3]="Delete",e[e.ToggleSubscription=4]="ToggleSubscription",e[e.ImmersiveReader=5]="ImmersiveReader"}(e.LightBulletinDropDownMenuActionType||(e.LightBulletinDropDownMenuActionType={}));e.LightBulletinDropDownMenuActionType;!function(e){e[e.UnsubscribedManually=0]="UnsubscribedManually",e[e.Subscribed=1]="Subscribed",e[e.WasNotSubscribed=2]="WasNotSubscribed"}(e.PersonSubscriptionStatus||(e.PersonSubscriptionStatus={}));e.PersonSubscriptionStatus}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.RichText=0]="RichText",e[e.TopicTitle=1]="TopicTitle",e[e.TopicDescription=2]="TopicDescription",e[e.PlanDescription=3]="PlanDescription",e[e.PlanTitle=4]="PlanTitle",e[e.ClassHours=5]="ClassHours"}(e.ClientColumnType||(e.ClientColumnType={}));e.ClientColumnType}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){e[e.Show=0]="Show",e[e.Hide=1]="Hide",e[e.Disable=2]="Disable"}(e.CopyDialogOverwriteAssessmentCriteriaState||(e.CopyDialogOverwriteAssessmentCriteriaState={}));e.CopyDialogOverwriteAssessmentCriteriaState}(e.Dialogs||(e.Dialogs={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=e.CalendarControllerModels.EventValidationScope,i=function(){function e(e){var t=this;this.utility=e,this.currentChangesScope=n.None,this.changesDebouncer=new CCL.CallbackDebouncer(function(){return t.callChangesHandler()}),this.setupStartEndDateTimeHandlers(),this.setupRecurringHandlers()}return e.prototype.setChangesHandler=function(e){this.changesHandler=e},e.prototype.callChangesHandler=function(){var e=this.currentChangesScope;this.currentChangesScope=n.None,this.changesHandler(e)},e.prototype.setupStartEndDateTimeHandlers=function(){var e=this;this.utility.controls.startDateInput.add(this.utility.controls.startTimeInput).change(function(){e.onChanged(n.Default|e.getCourseApprovalScopeIfNeeded()|e.getBookingsAvailabilityScopeIfNeeded())}),this.utility.controls.endDateInput.add(this.utility.controls.endTimeInput).change(function(){e.onChanged(n.Default|e.getBookingsAvailabilityScopeIfNeeded())})},e.prototype.setupRecurringHandlers=function(){var e=this;this.utility.controls.recurringCheckbox.add(this.utility.controls.recurrenceEndDateInput).change(function(){e.onChanged(n.Default|e.getBookingsAvailabilityScopeIfNeeded())}),this.utility.controls.repeatWeekCountSelect.add(this.utility.controls.repeatWeekDaysList).change(function(){return e.onChanged(e.getBookingsAvailabilityScopeIfNeeded())})},e.prototype.onChanged=function(e){this.changesHandler&&(this.currentChangesScope|=e,this.currentChangesScope!==n.None&&this.changesDebouncer.invokeCallback(void 0,t.Utility.timeoutForValidationAfterDateShiftedMilliseconds))},e.prototype.getCourseApprovalScopeIfNeeded=function(){return this.utility.settings.AvailableFeatures.IsCalendarApprovalEnabled?n.CourseApproval:0},e.prototype.getBookingsAvailabilityScopeIfNeeded=function(){return this.utility.hasAnyBookingsSelected()?n.BookingsAvailability:0},e}();t.ChangesAdapter=i}(e.EditEvent||(e.EditEvent={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t;!function(e){e[e.Empty=0]="Empty",e[e.Single=1]="Single",e[e.Multiple=2]="Multiple"}(t||(t={}));var n=function(){function e(e){this.container=e.controls.FeedbackContainer,this.cssClasses=e.settings.CssClasses}return e.prototype.addErrorMessage=function(e){switch(this.detectFeedbackType()){case t.Empty:this.createSingleError(e);break;case t.Single:var n=this.findSingleError(),i=n.text();i!==e&&n.replaceWith(this.createMultiErrorList([i,e]));break;case t.Multiple:0===this.filterMultiErrors(e,this.findMultiErrors()).length&&this.findFeedbackError().find("ol").append($("<li>").text(e));break;default:throw Error("Unknown feedback type")}},e.prototype.removeErrorMessages=function(){this.findFeedbackError().remove()},e.prototype.createSingleError=function(e){this.createFeedbackError().append($("<div>").addClass(this.cssClasses.FeedbackText).text(e))},e.prototype.createMultiErrorList=function(e){for(var t=$("<ol>").addClass(this.cssClasses.NoBullet+" "+this.cssClasses.Margin0+" "+this.cssClasses.Padding0),n=0;n<e.length;n++)t.append($("<li>").text(e[n]));return t},e.prototype.createFeedbackError=function(){return $("<div>").addClass(this.cssClasses.Feedback+" "+this.cssClasses.FeedbackError+" "+this.cssClasses.ClearFloat).append($("<i>").addClass(this.cssClasses.ImageContainer+" "+this.cssClasses.ExclamationCircle)).prependTo(this.container)},e.prototype.detectFeedbackType=function(){var e=this.findFeedbackError(),n=t.Empty;return e.length>0&&(e.find("."+this.cssClasses.FeedbackText).length>0?n=t.Single:e.find("ol").length>0&&(n=t.Multiple)),n},e.prototype.findFeedbackError=function(){return this.container.find("."+this.cssClasses.Feedback+"."+this.cssClasses.FeedbackError)},e.prototype.findSingleError=function(){return this.findFeedbackError().find("."+this.cssClasses.FeedbackText)},e.prototype.findMultiErrors=function(){return this.findFeedbackError().find("ol > li")},e.prototype.filterMultiErrors=function(e,t){return t.filter(function(t,n){return $(n).text()===e})},e}();e.FeedbackBuilder=n}(e.EditEvent||(e.EditEvent={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){var n=this;this.fullCalendarWrapper=e,this.timeFormats=t,this.getIsoDateTime=function(e){return n.formatDate(e,n.timeFormats.LocalIsoFormat)},this.getFormattedDate=function(e,t){return n.formatDate(e,t)}}return e.prototype.getEventFormattedDates=function(e,t){var n=e.getDate()!==t.getDate()||e.getMonth()!==t.getMonth()?this.timeFormats.twoDaysFormat:this.timeFormats.timeRangeFormat;return this.formatDates(e,t,n)},e.prototype.getEventFormattedDateAndTime=function(e,t,n){void 0===n&&(n=!0);var i=e.getDate()!==t.getDate()||e.getMonth()!==t.getMonth()?this.timeFormats.twoDaysFormat:n?this.timeFormats.DateAndTimeRangeFormat:this.timeFormats.DateAndTimeRangeFormatWithoutSeparator;return this.formatDates(e,t,i)},e.prototype.getShortDateTime=function(e){return this.formatDate(e,this.timeFormats.ShortDateAndTimeFormat)},e.prototype.getShortDate=function(e){return this.formatDate(e,this.timeFormats.shortDatePattern)},e.prototype.formatDate=function(e,t){return this.fullCalendarWrapper.formatDate(e,t)},e.prototype.formatDates=function(e,t,n){return this.fullCalendarWrapper.formatDates(e,t,n)},e}();e.DateFormatter=t}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t,n,i){var s=this;this.utilityBase=e,this.ajaxClientBase=t,this.datePickerClientInstanceName=n,this.timeSlotPickerClientInstanceName=i,$(function(){return s.getNextEventDatePicker().onDateSelectedFunction=function(e){return s.getNextEventTimeSlotPicker().updateFilteredTimeForDate(e.dateText,e.dateFilterId)}})}return Object.defineProperty(e.prototype,"hasNextEvent",{get:function(){return this.getNextEventId()>0},enumerable:!0,configurable:!0}),e.prototype.getNextEventId=function(){return parseInt(this.getNextEventTimeSlotPicker().getSelectedTimeSlotId(),10)||0},e.prototype.getNextEventDatePicker=function(){return window[this.datePickerClientInstanceName]},e.prototype.getNextEventTimeSlotPicker=function(){return window[this.timeSlotPickerClientInstanceName]},e}();e.NextEventDateWorkerBase=t}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(e){function t(t,n){var i=this;e.call(this,t,n,t.settings.ClientInstanceNames.NextEventPicker,t.settings.ClientInstanceNames.NextEventTimeSlotPicker),this.utility=t,this.ajaxClient=n,$(function(){i.getNextEventDatePicker().getAvailableDatesFunction=function(e){return i.getAvailableDates(e)},i.getNextEventTimeSlotPicker().getAvailableTimeSlotsForDateFunction=function(e){return i.getAvailableTimeSlotsForDate(e)}})}return __extends(t,e),t.prototype.setDefaultDate=function(e){this.getNextEventDatePicker().setDefaultDate(e)},t.prototype.getAvailableDates=function(e){this.ajaxClient.getDatesOfEventsToBePickedAsNextEventForEditEventPage({courseId:this.utility.settings.LocationId,eventId:this.utility.settings.SingleActivityId,startDate:e.startDate,endDate:e.endDate,eventStopDateAsUserInputString:this.utility.controls.endDateInput.val(),eventStopTimeAsUserInputString:this.utility.controls.endTimeInput.val()}).done(function(t){return e.allowedDates=t})},t.prototype.getAvailableTimeSlotsForDate=function(e){this.ajaxClient.getTimeSlotsOfEventsToBePickedAsNextEventForEditEventPage({courseId:this.utility.settings.LocationId,eventId:this.utility.settings.SingleActivityId,date:e.date,eventStopDateAsUserInputString:this.utility.controls.endDateInput.val(),eventStopTimeAsUserInputString:this.utility.controls.endTimeInput.val()}).done(function(t){return e.availableTimeSlots=t})},t}(e.NextEventDateWorkerBase);t.NextEventDateWorker=n}(e.EditEvent||(e.EditEvent={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function t(t,n,i,s,o,r){this.utility=t,this.addEventElementLinkManager=new e.AddEventElementLinkManager(t,n,i,s,{onUploadFromComputer:r.onUploadFromComputer}),this.editEventElementLinkManager=new e.EditEventElementLinkManager(t,n,i,o,r),this.initEventHandlers()}return t.prototype.initEventHandlers=function(){$(document).on("click","."+this.utility.settings.cssClasses.AddResourceMenuLink,function(t){e.ElementLinkManagerDialogBase.currentManager.onAddResourceMenuItemLinkClick(t)})},t}();e.ElementLinkManagerFactory=t}(e.ElementLink||(e.ElementLink={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,i){e.call(this,t,n,{inlineEditContainer:t.settings.cssClasses.Title},{isNotEditableTooltip:""}),this.ajaxClient=i}return __extends(t,e),t.prototype.buildMarkup=function(t,n,i,s){n.editable&&i&&n.IsEventTitleReadOnly?this.buildReadOnlyTitleMarkup(t,n):e.prototype.buildCommonMarkup.call(this,t,n,n.editable&&(i||n.EventTitle.length>0),this.utility.settings.cssClasses.TitleLabel,this.utility.settings.terms.Title,this.getEditorBinding(n,t),i,null,!1,!0,!1,s)},t.prototype.getTextContainerWatermark=function(e){return this.utility.settings.terms.Title},t.prototype.getCachedText=function(e){return e.EventTitle},t.prototype.getCachedPlainText=function(e){return e.EventTitle},t.prototype.isPlainText=function(e){return!0},t.prototype.sendTextAjax=function(e,t,n){return this.ajaxClient.editEventTitle({EventId:e.activityId,Text:n,HasResources:this.checkEventHasAttachedResources(e,t)})},t.prototype.buildReadOnlyTitleMarkup=function(e,t){if(t.editable&&""!==t.EventTitle){var n=document.createElement("div");n.classList.add(this.utility.settings.cssClasses.TitleLabel),n.innerText=this.utility.settings.terms.Title,e[0].appendChild(n)}var i=document.createElement("div");i.classList.add(this.utility.settings.cssClasses.UserInput),i.classList.add(this.utility.settings.cssClasses.DescriptionApi),i.innerText=t.EventTitle,e[0].appendChild(i)},t}(e.MarkupBuilderBase);e.TitleMarkupBuilder=t}(e.EventTextContent||(e.EventTextContent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t,n){var i=this;this.getFullCalendar=e,this.getCalendar=t,this.eventSourceNames=n,this.handleChildrenCalendarsChange=function(){i.refetchSourceByName(i.eventSourceNames.childrenCalendars)},this.handleOtherCalendarsChange=function(){i.refetchSourceByName(i.eventSourceNames.otherCalendars)},this.handleResourcesCalendarsChange=function(){i.refetchSourceByName(i.eventSourceNames.resourceCalendars)}}return e.prototype.addEventForSource=function(e,t){this.getFullCalendar().fullCalendar("renderEventForSource",e,t)},e.prototype.addEventForSourceByName=function(e,t){if(t in this.getCalendar().eventSources){var n=this.getCalendar().eventSources[t];this.addEventForSource(e,n)}this.refetchSourceByName(this.eventSourceNames.otherCalendars),this.refetchSourceByName(this.eventSourceNames.childrenCalendars)},e.prototype.changeView=function(e){this.getFullCalendar().fullCalendar("changeView",e)},e.prototype.getDate=function(){return this.getFullCalendar().fullCalendar("getDate")},e.prototype.getFirstDay=function(){return this.getFullCalendar().fullCalendar("option","firstDay")},e.prototype.getView=function(){return this.getFullCalendar().fullCalendar("getView")},e.prototype.getViewName=function(){return this.getView().name},e.prototype.refetchAll=function(){this.getFullCalendar().fullCalendar("refetchEvents")},e.prototype.refetchEvents=function(e,t){this.handleOtherCalendarsChange(),this.handleChildrenCalendarsChange();var n=this.getFullCalendar().fullCalendar("clientEvents",e);n.length>0&&this.getCalendar().refetchEvents(n,t)},e.prototype.refetchSourceByName=function(e){if(e in this.getCalendar().eventSources){var t=this.getCalendar().eventSources[e];this.getFullCalendar().fullCalendar("refetchSource",t)}},e.prototype.refetchTaskSourceByName=function(e){if(e in this.getCalendar().taskSources){var t=this.getCalendar().taskSources[e];this.getFullCalendar().fullCalendar("refetchTaskSource",t)}},e.prototype.removeEvent=function(e){this.getFullCalendar().fullCalendar("removeEvents",e)},e.prototype.removeEvents=function(e){this.getFullCalendar().fullCalendar("removeEvents",e)},e.prototype.render=function(){this.getFullCalendar().fullCalendar("render")},e.prototype.select=function(e,t,n){this.getFullCalendar().fullCalendar("select",e,t,n)},e.prototype.unselect=function(){this.getFullCalendar().fullCalendar("unselect")},e.prototype.formatDate=function(e,t){return this.getFullCalendar().fullCalendar("formatDate",e,t)},e.prototype.formatDates=function(e,t,n){return this.getFullCalendar().fullCalendar("formatDates",e,t,n)},e}();e.FullCalendarWrapper=t}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e){this.utility=e}return e.prototype.buildBookingsIcon=function(e){var t=document.createElement("span");t.classList.add(this.utility.settings.cssClasses.FcEventInlineIcon),t.innerHTML=this.utility.settings.InlineIcons.Bookings,e.appendChild(t)},e.prototype.buildAttendanceIcon=function(e){var t=document.createElement("span");t.innerHTML=this.utility.settings.InlineIcons.RegisterAttendance,e.appendChild(t)},e.prototype.buildAttendanceEventButton=function(e,t,n,i,s,o){void 0===s&&(s=""),void 0===o&&(o=!1);var r=document.createElement("button");if(r.type="button",r.disabled=t,r.classList.add(this.utility.settings.cssClasses.EventInlineButton),r.title=n,r.setAttribute("aria-label",n),r.innerHTML=this.utility.settings.InlineIcons.RegisterAttendance,s&&s.length>0){var a=document.createElement("span");a.classList.add(this.utility.settings.cssClasses.EventAttendanceButtonText),a.appendChild(document.createTextNode(s)),r.insertBefore(a,r.firstChild)}if(!t&&i&&r.addEventListener("click",i),o){var l=document.createElement("span");l.classList.add(this.utility.settings.cssClasses.FcEventInlineButton),l.appendChild(r),e.appendChild(l)}else e.appendChild(r)},e.prototype.buildColorIcon=function(e){void 0===e&&(e="");var t=document.createElement("span");return e&&t.classList.add(e),t.classList.add(this.utility.settings.cssClasses.EventItemColor),t},e.prototype.replaceColorIcon=function(e,t){e.className=this.utility.settings.cssClasses.EventItemColor+" "+t},e.prototype.buildDeleteEventButton=function(e){var t=document.createElement("button");return t.type="button",t.classList.add(e?this.utility.settings.cssClasses.MarginRight10:this.utility.settings.cssClasses.MarginRight15),t.title=this.utility.settings.terms.deleteEventTooltip,t.setAttribute("aria-label",this.utility.settings.terms.deleteEventTooltip),t.innerHTML=this.utility.settings.InlineIcons.Trashcan,e&&t.setAttribute("data-eventdetails-delete",""),t},e.prototype.buildCopyIcon=function(e){return e.innerHTML=this.utility.settings.InlineIcons.Copy,e.title=this.utility.settings.terms.CopyEvent,e.setAttribute("aria-label",this.utility.settings.terms.CopyEvent),e},e.prototype.buildEditEventIcon=function(e,t,n,i){var s=document.createElement("a");s.innerHTML=this.utility.settings.InlineIcons.Edit,s.classList.add(t),s.setAttribute("href",n),s.title=this.utility.settings.terms.editEventTooltip,s.setAttribute("aria-label",this.utility.settings.terms.editEventTooltip),e.appendChild(s),i&&s.addEventListener("click",i)},e.prototype.buildGroupIcon=function(e,t,n){var i=document.createElement("span");if(i.classList.add(this.utility.settings.cssClasses.FcEventInlineIcon),i.innerHTML=this.utility.settings.InlineIcons.Users,i.setAttribute("alt",this.utility.settings.terms.group),i.title=t?this.utility.settings.terms.group:this.utility.settings.terms.group+": ("+n+")",e.appendChild(i),t){var s=document.createElement("span");s.classList.add(this.utility.settings.cssClasses.ColorGrey),s.classList.add(this.utility.settings.cssClasses.EventItemIconText),s.textContent=n,e.appendChild(s)}},e.prototype.buildHomeworkIcon=function(e){var t=document.createElement("span");t.classList.add(this.utility.settings.cssClasses.FcEventInlineIcon),t.title=this.utility.settings.terms.homeworkIconToolTip,t.innerHTML=this.utility.settings.InlineIcons.Homework,e.appendChild(t)},e.prototype.buildLockIcon=function(e,t,n){var i=document.createElement("span");if(i.classList.add(this.utility.settings.cssClasses.LockIcon),i.innerHTML=this.utility.settings.InlineIcons.Lock,t){var s=document.createElement("span");s.textContent=n;var o=document.createElement("div");o.classList.add(this.utility.settings.cssClasses.LockInformationContainer),o.appendChild(i),o.appendChild(s),e.insertBefore(o,e.firstChild)}else e.insertBefore(i,e.firstChild)},e.prototype.buildPlanIcon=function(e){var t=document.createElement("span");t.classList.add(this.utility.settings.cssClasses.MarginRight5),t.innerHTML=this.utility.settings.InlineIcons.Plans,e.appendChild(t)},e.prototype.buildPlannerButtonIcon=function(e,t,n){var i=document.createElement("button");i.type="button",i.title=t,i.classList.add(this.utility.settings.cssClasses.EventInlineButton),i.addEventListener("click",n),i.innerHTML=this.utility.settings.InlineIcons.Plans;var s=document.createElement("span");s.classList.add(this.utility.settings.cssClasses.FcEventInlineButton),s.appendChild(i),e.appendChild(s)},e.prototype.buildRecurringIcon=function(e){var t=this.createImageNode(this.utility.settings.urls.recurringImageUrl,this.utility.settings.constants.IconSize,this.utility.settings.terms.recurringTooltip);t.classList.add(this.utility.settings.cssClasses.VerticalAlignMiddle),t.classList.add(this.utility.settings.cssClasses.MarginLeft5),e.appendChild(t)},e.prototype.createImageNode=function(e,t,n){var i=document.createElement("img");return i.src=e,i.width=t,i.height=t,i.alt="",i.title=n,i},e}();e.IconBuilder=t}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function t(t,n,i,s,o,r,a,l,c){this.utility=t,this.dateFormatter=n,this.toggleEventSettings=i,this.extraDescriptionMarkupBuilder=s,this.nextEventMarkupBuilder=new e.NextEventMarkupBuilder(this.utility,this.dateFormatter),this.addEventDialogNextEventDateWorker=new e.AddEventDialogNextEventDateWorker(this.utility,o,r,l),this.editEventDialogNextEventDateWorker=new e.EditEventDialogNextEventDateWorker(this.utility,o,c)}return t.prototype.initNextEventForAddDialog=function(){var e=this;this.setOnChangeDatePickerEvent(this.utility.controls.NextEvent.AddEventDatePickerContainer,this.addEventDialogNextEventDateWorker),this.utility.controls.NextEvent.AddEventDatePickerButton.one("click",function(){$(e.addEventDialogNextEventDateWorker.getNextEventDatePicker()).on(e.utility.settings.constants.NextEventDateSetEventName,function(){e.utility.controls.addEventCalendarsDropdown.is(":disabled")||e.toggleEventSettings(!0)}),$(e.addEventDialogNextEventDateWorker.getNextEventDatePicker()).on(e.utility.settings.constants.NextEventDateClearedEventName,function(){e.utility.controls.addEventCalendarsDropdown.is(":disabled")&&e.toggleEventSettings(!1)})})},t.prototype.buildContainerForEditEvent=function(e,t,n){var i=this,s=e.editable&&!n,o=e.showExtraDescription&&(e.extraDescription||s),r=e.showExtraDescription&&(e.NextEventId>0||s);if(o||r){this.extraDescriptionMarkupBuilder.buildMarkup(t,e,!n,function(){r&&(i.nextEventMarkupBuilder.buildMarkup(t,s,e),s&&i.initializeNextEventHandlers(e))})}},t.prototype.isEditDialogEditMode=function(){return this.editEventDialogNextEventDateWorker.isInEditMode()},t.prototype.initializeNextEventHandlers=function(e){this.editEventDialogNextEventDateWorker.nextEventQueryArgs={nextEvent:{eventId:e.NextEventId,eventStart:e.NextEventStart},courseId:e.courseId,eventId:e.activityId,eventStopDateTimeAsIsoString:JSON.stringify(this.dateFormatter.getIsoDateTime(e.end))};var t=this.utility.controls.NextEvent.EditEventDatePickerContainer.find("."+this.utility.settings.cssClasses.DatePickerInput),n=this.editEventDialogNextEventDateWorker.getNextEventDatePicker();this.utility.controls.NextEvent.EditEventDatePickerContainer.find(".ui-datepicker-trigger").remove(),t.removeClass("hasDatepicker"),n.initialize(),this.editEventDialogNextEventDateWorker.getNextEventTimeSlotPicker().initialize(),e.NextEventId>0&&this.editEventDialogNextEventDateWorker.setDateTimePickerValues(),this.setOnChangeDatePickerEvent(this.utility.controls.NextEvent.EditEventDatePickerContainer,this.editEventDialogNextEventDateWorker)},t.prototype.setOnChangeDatePickerEvent=function(e,t){var n=this;e.on("change","input, select",function(){return n.updateDateTimeLabel(t)})},t.prototype.updateDateTimeLabel=function(e){var t=e.getNextEventTimeSlotPicker().getSelectedTimeSlot();e.getDatePickerButton().find("."+this.utility.settings.cssClasses.NextEventButtonText).text(t?this.dateFormatter.getEventFormattedDateAndTime(CCL.SerializableDateTimeConverter.toDateWithSeconds(t.EventStartLocal),CCL.SerializableDateTimeConverter.toDateWithSeconds(t.EventStopLocal)):this.utility.settings.terms.PickDate)},t}();e.NextEventManager=t}(e.NextEvent||(e.NextEvent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(t,n,i){var s=this;this.utility=t,this.container=n,this.inputValidatorParameters=i,this.modernInput=new CCL.ModernInput({EditorTextarea:this.utility.cssClassesBase.ModernInputTextEditor,TextIsValid:this.utility.cssClassesBase.ModernInputTextIsValid},{TextValidationErrorMessage:this.utility.dataAttributeNames.InputValidationMessage});var o=n.find("textarea, input").first();if(o.length){var r=new CCL.CallbackDebouncer(function(){return o.val(e.cleanUpLineBreaks(o.val()))});o.on("input",function(){return s.validateOnInput(o)}).on("paste",function(){return r.invokeCallback(void 0,50)})}}return e.cleanUpInputValue=function(t){return t?e.cleanUpLineBreaks(t).replace(/\s{2,}/g," ").trim():""},e.prototype.createValidationMessageContainer=function(){$("<span>").addClass(this.inputValidatorParameters.errorMessageClass).attr("data-"+this.utility.dataAttributeNames.InputValidationMessage,"").appendTo(this.container)},e.prototype.resetValidation=function(){this.validate(!0)},e.cleanUpLineBreaks=function(e){return e.replace(/\r?\n/g,"")},e.prototype.validateOnInput=function(t){var n=this.inputValidatorParameters.inputValidationFunction(e.cleanUpInputValue(t.val()));this.validate(n)},e.prototype.validate=function(e){this.modernInput.toggleTextError(this.container.parent(),this.inputValidatorParameters.errorMessageText,!e),this.inputValidatorParameters.onValidateFunction&&this.inputValidatorParameters.onValidateFunction(e)},e}();e.InputValidator=t}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){e[e.Awaiting=0]="Awaiting",e[e.InProgress=1]="InProgress",e[e.Succeeded=2]="Succeeded",e[e.SucceededWithErrors=3]="SucceededWithErrors",e[e.Failed=4]="Failed"}(UploadStatus||(UploadStatus={})),function(e){!function(e){var t=function(){function e(e){var t=this;this.settings=e,this.handleSubmitButtonBehaviour=function(e){t.lockSubmitButton(e===UploadStatus.InProgress)},this.isUploaderDirty=function(){var e=window[t.settings.ClientIds.UploaderControl];return!!e&&e.uploadedItems.uploadMetadataArray.length+e.uploadedItems.fileInCloudMetadataArray.length>0},window[e.ClientInstanceName]=this,this.$form=$("#"+this.settings.ClientIds.PageForm),this.$submitButton=$("#"+this.settings.ClientIds.SubmitButton),this.$cancelButton=$("#"+this.settings.ClientIds.CancelButton),this.formCheckBeforeUnload=new CCL.FormCheckBeforeUnload(this.$form,this.settings.Terms.BeforeUnloadWarningMessage,{cancelButtonId:this.settings.ClientIds.CancelButton,callback:this.isUploaderDirty}),this.lockSubmitButton(!1)}return e.prototype.lockSubmitButton=function(e){this.$submitButton.toggleHyperlink(!e)},e}();e.EditPortfolioItemControl=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){this.input=e,this.serialize=t}return Object.defineProperty(e.prototype,"dateValue",{get:function(){return this.date},set:function(e){this.date=e,this.input.val(this.serialize(e))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stringValue",{get:function(){return this.input.val()},enumerable:!0,configurable:!0}),e}();e.DateInputWrapper=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,i){e.call(this,t,n,{inlineEditContainer:t.settings.cssClasses.Description},{isNotEditableTooltip:t.settings.terms.eventDescriptionNotEditableTooltip}),this.ajaxClient=i}return __extends(t,e),t.prototype.buildMarkup=function(t,n,i,s){void 0===s&&(s=null);var o=n.editable||!!s||n.PreviousEvent.ExtraDescription&&n.PreviousEvent.ExtraDescription.length>0&&n.description.length>0;e.prototype.buildCommonMarkup.call(this,t,n,o,this.utility.settings.cssClasses.DescriptionLabel,this.utility.settings.terms.DescriptionLabel,this.getEditorBinding(n,t),i,s,!0)},t.prototype.getTextContainerWatermark=function(e){return 0===e.courseId?this.utility.settings.terms.otherEventDescriptionWatermark:this.utility.settings.customerSettings.enableFrenchCalendarLayout?this.utility.settings.terms.courseEventPastDescriptionWatermark:this.utility.settings.terms.courseEventDescriptionWatermark},t.prototype.getCachedText=function(e){return e.description},t.prototype.getCachedPlainText=function(e){return e.descriptionPlainText},t.prototype.isPlainText=function(e){return e.isPlainTextInDescription},t.prototype.sendTextAjax=function(e,t,n){return this.ajaxClient.editEventDescription({EventId:e.activityId,Text:n,HasResources:this.checkEventHasAttachedResources(e,t)})},t}(e.MarkupBuilderBase);e.DescriptionMarkupBuilder=t}(e.EventTextContent||(e.EventTextContent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,i){e.call(this,t,n,{inlineEditContainer:t.settings.cssClasses.DescriptionExtra},{isNotEditableTooltip:t.settings.terms.eventExtraDescriptionNotEditableTooltip}),this.ajaxClient=i}return __extends(t,e),t.prototype.buildMarkup=function(t,n,i,s){e.prototype.buildCommonMarkup.call(this,t,n,n.editable||n.NextEventId>0||n.extraDescription.length>0,this.utility.settings.cssClasses.DescriptionExtraHeader,this.utility.settings.terms.extraDescriptionLabel,this.getEditorBinding(n,t),i,s,!0)},t.prototype.buildPreviousExtraDescriptionMarkup=function(e,t,n,i){var s=document.createElement("div");if(s.classList.add(this.utility.settings.cssClasses.PreviousEventContainer),s.classList.add(this.utility.settings.cssClasses.UserInput),t){this.buildSectionTitle(e,this.utility.settings.cssClasses.PreviousEventExtraDescriptionLabel,this.utility.settings.terms.PreviousEventExtraDescriptionLabel);var o=document.createElement("div");o.classList.add(this.utility.settings.cssClasses.PreviousEventExtraDescription),o.innerHTML=t,s.appendChild(o)}var r=document.createElement("div");if(r.classList.add(this.utility.settings.cssClasses.PreviousEventDateLabel),i){var a=document.createElement("p");a.innerText=n;var l=document.createElement("p");l.innerText=this.utility.settings.terms.CannotPreviewOrEditPreviousEvent,r.appendChild(a),r.appendChild(l)}else r.innerText=n;s.appendChild(r),e[0].appendChild(s)},t.prototype.buildOpenPreviousEventButton=function(e,t,n){var i=document.createElement("button");i.type="button",i.classList.add(this.utility.settings.cssClasses.Button),i.classList.add(this.utility.settings.cssClasses.PreviousEventEditButton),i.innerText=t,i.addEventListener("click",n),e.appendChild(i)},t.prototype.getTextContainerWatermark=function(e){return this.utility.settings.terms.courseEventFutureDescriptionWatermark},t.prototype.getCachedText=function(e){return e.extraDescription},t.prototype.getCachedPlainText=function(e){return e.extraDescriptionPlainText},t.prototype.isPlainText=function(e){return e.isPlainTextInExtraDescription},t.prototype.sendTextAjax=function(e,t,n){return this.ajaxClient.editEventExtraDescription({EventId:e.activityId,Text:n,HasResources:this.checkEventHasAttachedResources(e,t)})},t}(e.MarkupBuilderBase);e.ExtraDescriptionMarkupBuilder=t}(e.EventTextContent||(e.EventTextContent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){e[e.ListView=1]="ListView",e[e.ContextDialog=2]="ContextDialog"}(e.EventDetailsType||(e.EventDetailsType={}));e.EventDetailsType}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e){this.utility=e,this.combinedClasses={expandableSection:this.utility.settings.cssClasses.ExpandableContainer+" "+this.utility.settings.cssClasses.ExpandableSection,expandableHeaderArrowCollapsed:this.utility.settings.cssClasses.Icon+" "+this.utility.settings.cssClasses.IconArrowForward+" "+this.utility.settings.cssClasses.IconColorDefault,expandableHeaderArrowExpanded:this.utility.settings.cssClasses.Icon+" "+this.utility.settings.cssClasses.IconArrowDown+" "+this.utility.settings.cssClasses.IconColorDefault}}return e.prototype.buildExpandableContainer=function(e,t,n,i,s){var o=this,r=(void 0===i?{}:i).isExpanded,a=void 0!==r&&r,l=$("<section>").addClass(this.combinedClasses.expandableSection).append($("<div tabindex='0'>").addClass(this.utility.settings.cssClasses.ExpandableContainerHeader).append($("<i>").addClass(a?this.combinedClasses.expandableHeaderArrowExpanded:this.combinedClasses.expandableHeaderArrowCollapsed)).append($("<span>").append(t))).append($("<div>").addClass(this.utility.settings.cssClasses.ExpandableContainerContent).append(n));return e.append(l),new ExpandableContainer(l,{isExpanded:a,onToggleCallback:function(e,t){t.find(o.utility.selectors.expandableContainerHeaderIcon).toggleClass(o.utility.settings.cssClasses.IconArrowForward,!e).toggleClass(o.utility.settings.cssClasses.IconArrowDown,e),s&&s()}})},e}();e.ExpanderBuilder=t}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function n(e,t,n,i,s,o,r){this.dataAttributeNames=e,this.cssClassesBase=t,this.terms=n,this.clientInstanceNamesBase=i,this.postMessageNames=s,this.controlsBase=o,this.constants=r,this.dataAttributes=this.initDataAttributesCommon(),this.selectors=this.initSelectorsCommon()}return n.prototype.initSelectorsCommon=function(){return{addElementButton:"."+this.cssClassesBase.AddElementButton,elementExternalSourceComputer:CCL.CommonFunctions.getDataSelector(this.dataAttributeNames.ElementExternalSource,e.AddResourceMenu.ElementExternalSourceType.Computer),elementListContainer:CCL.CommonFunctions.getDataSelector(this.dataAttributeNames.ElementListContainer),elementListContainerHomework:CCL.CommonFunctions.getDataSelector(this.dataAttributeNames.ElementListContainerHomework),elementListCount:CCL.CommonFunctions.getDataSelector(this.dataAttributeNames.ElementListCount),elementListItem:CCL.CommonFunctions.getDataSelector(this.dataAttributeNames.ElementListItem)}},n.prototype.initDataAttributesCommon=function(){return{elementListContainer:"data-"+this.dataAttributeNames.ElementListContainer,elementListContainerHomework:"data-"+this.dataAttributeNames.ElementListContainerHomework,elementListCount:"data-"+this.dataAttributeNames.ElementListCount,elementListItem:"data-"+this.dataAttributeNames.ElementListItem}},n.prototype.getElementForEventData=function(e){return e.data(this.dataAttributeNames.ElementListItem)},n.prototype.getElementExternalSourceType=function(e){return e.data(this.dataAttributeNames.ElementExternalSource)},n.prototype.getContentElementType=function(e){return e.data(this.dataAttributeNames.ContentElementType)},n.prototype.getAddResourceMenuParameters=function(e){return e.data(t.CalendarClientConstants.dataAttributeNames.addResourceMenuParameters)},n.prototype.getElementId=function(e){return this.getElementForEventData(e).ElementId},n.prototype.getElementByElementId=function(e){return $("["+this.dataAttributes.elementListItem+'*=\'"ElementId":'+e+",']")},n.prototype.getAddedElementsCount=function(e){return e.find(this.selectors.elementListItem).length},n.prototype.toggleElementActivation=function(e){this.getElementByElementId(e).find("."+this.cssClassesBase.ElementListTitle).toggleClass(this.cssClassesBase.ElementItemInactive)},n.prototype.toggleCalendarDropdown=function(e){var t=e.enabled?"":this.terms.CannotChangeCalendarBecauseOfNextEventTooltip;e.calendarDropdown.prop("disabled",!e.enabled),e.calendarDropdown.prop("title",t)},n}();t.CalendarUtilityBase=n}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=e.CalendarControllerModels.EventValidationScope,i=function(e){function t(t,n){e.call(this,t.DataAttributes,t.CssClasses,t.Terms,t.ClientInstanceNames,t.PostMessageNames,n,t.CalendarClientConstants),this.settings=t,this.controls=n}return __extends(t,e),t.prototype.getEventDateValidationInputModel=function(e){var t=this,i=this.getEventSettingsRecurring(),s=this.parseJsonIntList(this.controls.EventBookingsBookedIdsHidden.val()),o=this.parseJsonIntList(this.controls.EventBookingsReservedIdsHidden.val()),r=this.settings.SingleActivityId,a=0;this.getWeekDayCheckboxes().each(function(e,n){var i=$(n);if(i.is(":checked")){var s=CCL.CommonFunctions.getDataSelector(t.settings.DataAttributes.WeekDayEnumValue),o=i.closest(s);a+=parseInt(o.data(t.settings.DataAttributes.WeekDayEnumValue),10)}});var l=(e&n.BookingsAvailability)===n.BookingsAvailability;return{ValidationScope:e,StartDate:this.controls.startDateInput.val(),StartTime:this.controls.startTimeInput.val(),StopDate:this.controls.endDateInput.val(),StopTime:this.controls.endTimeInput.val(),CourseId:this.settings.LocationId,RecurrenceEndDate:i.RecurrenceEndDate,IsRecurring:i.IsRecurring,IsSingle:!i.IsRecurring,WasIsSingle:this.settings.WasIsSingle,RepeatWeekCount:this.controls.repeatWeekCountSelect.val()||"0",WeekDaysEnumValue:a,SelectedBookingIds:""+$.merge(s,o),HidePartlyBookedBookingsForRecurringEvent:l&&0!==r,EventId:r}},t.prototype.getEventSettingsRecurring=function(){return{StartDate:this.controls.startDateInput.val(),RecurrenceEndDate:this.controls.recurrenceEndDateInput.length>0?this.controls.recurrenceEndDateInput.val():"",IsRecurring:this.controls.recurringCheckbox.is(":checked")}},t.prototype.getWeekDayCheckboxes=function(){return this.weekDayCheckboxes||(this.weekDayCheckboxes=this.controls.repeatWeekDaysList.find("input:checkbox")),this.weekDayCheckboxes},t.prototype.hasAnyBookingsSelected=function(){return this.parseJsonIntList(this.controls.EventBookingsBookedIdsHidden.val()).length>0||this.parseJsonIntList(this.controls.EventBookingsReservedIdsHidden.val()).length>0},t.prototype.openConfirmSubmitDialog=function(e,t){CCL.CommonFunctions.jAjaxConfirm(e,this.settings.Terms.ConfirmationDialogTitle,this.settings.Terms.Ok,this.settings.Terms.CancelButton,t)},t.prototype.parseJsonIntList=function(e){return JSON.parse(e||"[]")},t.timeoutForDatesIntervalShiftingMilliseconds=200,t.timeoutForValidationAfterDateShiftedMilliseconds=t.timeoutForDatesIntervalShiftingMilliseconds+100,t}(e.CalendarUtilityBase);t.Utility=i}(e.EditEvent||(e.EditEvent={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e){var t=this;this.utilityBase=e,this.toggleSectionByItemCount=function(e){var n=e.getElementsByClassName(t.utilityBase.cssClassesBase.ElementList).item(0);e.style.display=n&&n.hasChildNodes()?"":"none"}}return t.prototype.getFakeElement=function(){return $("#"+this.utilityBase.constants.FakeElementItemId)},t.prototype.getCurrentFakeElementTitle=function(){return this.getFakeElement().find("."+this.utilityBase.cssClassesBase.ElementListTitle).text()},t.prototype.hasFakeElement=function(){return this.getFakeElement().is(":visible")},t.prototype.removeElement=function(t,n){var i=this;void 0===n&&(n=void 0);var s=t.closest(this.elementListSelector);t.slideUp(e.CalendarClientConstants.animationSpeedMilliseconds,function(){t.remove(),i.afterRemoveElement(s,n)})},t.prototype.buildFakeElementMarkup=function(e){var t=document.createElement("li");t.id=this.utilityBase.constants.FakeElementItemId,t.setAttribute(this.utilityBase.dataAttributes.elementListItem,"");var n=this.utilityBase.controlsBase.LoadingWheel;n.style.display="";var i=document.createElement("div");i.classList.add(this.utilityBase.cssClassesBase.ElementListItemContainer);var s=document.createElement("span");return s.classList.add(this.utilityBase.cssClassesBase.ElementListTitle),s.classList.add(this.utilityBase.cssClassesBase.FontItalic),s.textContent=CCL.CommonFunctions.htmlEncode(e),i.appendChild(n),i.appendChild(s),t.appendChild(i),t},t.prototype.buildElementListSectionMarkup=function(){return'<ul class="'+this.utilityBase.cssClassesBase.ElementList+" "+this.utilityBase.cssClassesBase.GenericList+'" />'},t.prototype.afterRemoveElement=function(e,t){0===this.utilityBase.getAddedElementsCount(e)&&e.slideUp(),t&&t()},t}();e.ElementListMarkupBuilderBase=t}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(e){function t(t){e.call(this,t),this.utility=t,this.elementListSelector=this.utility.selectors.elementListContainer}return __extends(t,e),t.prototype.buildElementListMarkup=function(e){e.ResourceCount>0&&this.utility.controls.ElementListSection.get(0).insertAdjacentHTML("beforeEnd",e.Resources),this.utility.settings.IsAddingHomeworkElementsEnabled&&e.HomeworkCount>0&&this.utility.controls.HomeworkElementListSection.get(0).insertAdjacentHTML("beforeEnd",e.Homework)},t.prototype.addFakeItemIntoElementSection=function(e){var t=this.buildFakeElementMarkup(e),n=this.utility.controls.ElementListSection.get(0),i=n.getElementsByClassName(this.utility.cssClassesBase.ElementList);i.length||(n.insertAdjacentHTML("beforeEnd",this.buildElementListSectionMarkup()),i=n.getElementsByClassName(this.utility.cssClassesBase.ElementList)),i[0].insertAdjacentHTML("beforeEnd",t.outerHTML),"none"===n.style.display&&(n.style.display="")},t.prototype.removeFakeItemFromElementSection=function(){this.getFakeElement().remove(),this.toggleSectionByItemCount(this.utility.controls.ElementListSection.get(0))},t.prototype.toggleAddResourceButtonAndSections=function(e){this.toggleAddButton(e),this.toggleSectionByItemCount(this.utility.controls.ElementListSection.get(0)),this.utility.settings.IsAddingHomeworkElementsEnabled&&this.toggleSectionByItemCount(this.utility.controls.HomeworkElementListSection.get(0))},t.prototype.afterRemoveElement=function(t,n){var i=this;e.prototype.afterRemoveElement.call(this,t,function(){i.toggleAddButton(),n&&n()})},t.prototype.toggleAddButton=function(e){void 0===e&&(e=void 0);var t=e||this.utility.getAddedElementsCount($(document));$(this.utility.selectors.addElementButton).toggle(t<this.utility.constants.MaxCountOfAddedElements)},t}(e.ElementListMarkupBuilderBase);t.ElementListMarkupBuilder=n}(e.EditEvent||(e.EditEvent={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t,n,i){void 0===i&&(i=3),this.targetContainer=e,this.dotContainerCssClass=t,this.dotsCssClass=n,this.dotsCount=i;for(var s=$("<div>").addClass(this.dotContainerCssClass),o=0;o<i;o++)s.append($("<div>").addClass(this.dotsCssClass));e.append(s)}return e.prototype.removeDotContainer=function(){this.targetContainer.find("."+this.dotContainerCssClass).remove()},e}();e.CalendarBouncingDots=t}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e.animationSpeedMilliseconds=500,e.dataAttributeNames={addResourceMenuParameters:"add-resource-menu-parameters"},e.alternativeChoiceDialogOffsetY=-7,e.uploadingFileTimeoutMilliseconds=400}(e.CalendarClientConstants||(e.CalendarClientConstants={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(n){var i=function(n){function i(e,t,i){n.call(this,e),this.utility=e,this.expanderBuilder=t,this.callbackOnSectionToggle=i,this.enableElementLinkManagement=!0,this.elementListSelector=this.utility.selectors.expandableContainer}return __extends(i,n),i.prototype.renderAddButtonWithElementSections=function(e,n,i){this.enableElementLinkManagement=n.enableElementLinkManagement&&i!==t.EventDetailsType.ListView;var s=e.find("."+this.utility.settings.cssClasses.SelectedElementListAppendTarget);0===s.length&&(s=this.generateElementListAppendTarget(),e.append(s)),this.enableElementLinkManagement&&!e.find("#calendar-add-menu").length&&s.before($('<div id="calendar-add-menu" data-course-id="'+n.courseId+'">').addClass(this.utility.settings.cssClasses.MarginTop10).addClass(this.utility.settings.cssClasses.AddElementButton)),this.renderElementList(s,n.elementListMarkups)},i.prototype.generateElementListAppendTarget=function(){return $("<div>").addClass(this.utility.settings.cssClasses.SelectedElementListAppendTarget)},i.prototype.generateAttachedElementsHidden=function(){return $("<input>").attr(this.utility.selectors.addEventDialogAttachedElementsHidden,"").prop("type","hidden").prop("value","[]")},i.prototype.addFakeItemIntoElementSection=function(e,t){var n=this.buildFakeElementMarkup(e),i=this.utility.getElementListAppendTarget(t),s=i.find(this.utility.selectors.elementListContainer),o=s.find("."+this.utility.cssClassesBase.ElementList);if(o.length){o.append(n);var r=this.utility.getExpandableContainer(s);r.is(":visible")||r.show(),this.updateHeaderCounter(r)}else{var a=document.createElement("ul");a.classList.add(this.utility.settings.cssClasses.ElementList),a.classList.add(this.utility.settings.cssClasses.GenericList),a.innerHTML=n.outerHTML,this.buildResourceListMarkup(i,{Homework:"",HomeworkCount:0,Resources:a.outerHTML,ResourceCount:1,BookableResourceCount:0,BookableResources:""})}},i.prototype.removeFakeItemFromElementSection=function(){var t=this,n=this.getFakeElement(),i=n.closest("."+this.utility.cssClassesBase.ElementList);if(n.remove(),i.length){var s=this.utility.getExpandableContainer(i);setTimeout(function(){t.updateHeaderCounter(s),t.toggleSectionByItemCount(s.get(0))},e.CalendarClientConstants.uploadingFileTimeoutMilliseconds)}},i.prototype.renderElementList=function(e,t){t&&(this.utility.settings.customerSettings.enableHomework&&this.buildHomeworkListMarkup(e,t),this.buildResourceListMarkup(e,t),this.toggleAddElementButton(e.closest("."+this.utility.settings.cssClasses.ContextDialogContent)))},i.prototype.rebuildElementListMarkup=function(e,t){var n=e.find("."+this.utility.settings.cssClasses.SelectedElementListAppendTarget);n.find(this.utility.selectors.expandableContainer).remove(),this.renderElementList(n,t),this.updateHeaderCounter(this.utility.getExpandableContainer(n.find(this.utility.selectors.elementListContainer)))},i.prototype.buildHeader=function(e,t){return $("<span>").text(e).append(" (").append($("<span>").attr(this.utility.dataAttributes.elementListCount,"").text(t)).append(")")},i.prototype.afterRemoveElement=function(e,t){var i=this;n.prototype.afterRemoveElement.call(this,e,function(){i.toggleAddElementButton(e.closest("."+i.utility.settings.cssClasses.ContextDialogContent)),i.updateHeaderCounter(e),t&&t()})},i.prototype.buildHomeworkListMarkup=function(e,t){this.buildElementListMarkup(e,this.utility.settings.terms.HomeworkResourcesSectionTitle,this.utility.dataAttributes.elementListContainerHomework,t.Homework,t.HomeworkCount)},i.prototype.buildResourceListMarkup=function(e,t){this.buildElementListMarkup(e,this.utility.settings.terms.ResourcesSectionTitle,this.utility.dataAttributes.elementListContainer,t.Resources,t.ResourceCount)},i.prototype.buildElementListMarkup=function(e,t,n,i,s){if(null!=i&&i.length>0){var o=$("<div>").attr(n,"").append(i);this.enableElementLinkManagement||o.find("."+this.utility.settings.cssClasses.ElementListItemRemove).remove(),this.expanderBuilder.buildExpandableContainer(e,this.buildHeader(t,s),o,{isExpanded:!0},this.callbackOnSectionToggle)}},i.prototype.updateHeaderCounter=function(e){e.find(this.utility.selectors.elementListCount).text(this.utility.getAddedElementsCount(e))},i.prototype.toggleAddElementButton=function(e){var t=this.utility.getManuallyAddedElementsCount(e);e.find(this.utility.selectors.addElementButton).toggle(t<this.utility.constants.MaxCountOfAddedElements)},i}(e.ElementListMarkupBuilderBase);n.ElementListMarkupBuilder=i}(t.ElementLink||(t.ElementLink={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,n,i,s,o,r){var a=this;this.container=e,this.utility=t,this.callbacks=n,this.binding=i,this.isAlwaysPlainText=s,this.isMultiline=o,this.inputValidationFunction=r,this.onEditFunction=function(e,t){if(e.actualText=e.actualText.replace(/[^\S\n]{2,}/g," ").trim(),a.inputValidationFunction&&!a.inputValidationFunction(e.actualText))e.stopOnEdit=!0,e.isUpdateSuccess=!1,t(e);else{var n=a.isMultiline?CCL.CommonFunctions.replaceLineBreaksWithPTags(CCL.CommonFunctions.htmlEncode(e.actualText)):e.actualText;a.callbacks.onTextSaved(),a.binding.sendTextAjax(n).fail(function(){return e.isUpdateSuccess=!1}).always(function(){return t(e)})}},this.onChangeModeFunction=function(e){[a.cssClasses.ScheduleDialogSubheader,a.cssClasses.ShowMoreOptionsLink,a.cssClasses.ExpandableContainerHeader,a.cssClasses.ExpandableContainerContent].forEach(function(t){var n=$("."+t);(CCL.CommonFunctions.isIe()||CCL.CommonFunctions.isEdge())&&(n=n.parent()),n.css("pointer-events",e.isEditMode||a.callbacks.checkIfAnythingElseIsInEditMode()?"none":"")}),e.isEditMode?a.initEditMode():(a.container.removeClass(a.cssClasses.TextContainerFocused),a.callbacks.onEditFinished&&a.callbacks.onEditFinished(),e.actualText?a.initViewModeWithChangedText():e.isNewTextSaved||a.textContainer.hasClass(a.cssClasses.TextContainerWatermark)?a.initViewModeWithWatermark():a.initViewModeWithInitialText())},this.cssClasses=this.utility.settings.cssClasses,this.editorOptions={autoResize:!0,autoResizeAdditionalHeight:0,multiline:!0,editFieldCssClass:this.cssClasses.Width100Percent+" "+this.cssClasses.ResizeNone+" "+this.cssClasses.UserInput,watermark:this.binding.watermarkText,watermarkCssClass:this.cssClasses.TextContainerWatermark,preventLineBreaksInMultilineMode:!o}}return e.prototype.makeTextContentInlineEditable=function(){this.textContainer=this.container.find("."+this.cssClasses.UserInput),this.editorInstance=new ClientInlineEditor(this.textContainer,void 0,this.createHidden(),this.editorOptions,this.onEditFunction,this.onChangeModeFunction,void 0),this.textContainer.click()},e.prototype.createHidden=function(){return $("<input type='hidden'>").val(this.binding.cachedPlainText).appendTo(this.container)},e.prototype.initEditMode=function(){this.editorInstance.hideWatermark(),this.container.addClass(this.cssClasses.TextContainerFocused)},e.prototype.initViewModeWithChangedText=function(){var e;this.textContainer.removeClass(this.cssClasses.TextContainerWatermark),e=this.isMultiline?CCL.CommonFunctions.replaceBrTagsWithPTags(this.textContainer.html()):this.isAlwaysPlainText?this.textContainer.text():this.textContainer.html(),this.setText(e),this.binding.cachedText=e},e.prototype.initViewModeWithWatermark=function(){this.textContainer.hasClass(this.cssClasses.TextContainerWatermark)||this.textContainer.addClass(this.cssClasses.TextContainerWatermark),this.textContainer.text(this.binding.watermarkText)},e.prototype.initViewModeWithInitialText=function(){this.setText(this.binding.cachedText)},e.prototype.setText=function(e){this.isAlwaysPlainText?this.textContainer.text(e):this.textContainer.html(e)},e}();e.InlineEditContent=t}(e.InlineEdit||(e.InlineEdit={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(e){function t(t,n,i,s){var o=this;e.call(this,t,n,i,s),this.utility=t,this.ajaxClient=n,this.setFocusOutEvent=function(){var e=o.getDatePickerContainer();e.on("focusout",function(){return setTimeout(function(){o.getNextEventDatePicker().isPickerVisible()&&!o.getNextEventDatePicker().isPickerClosing()||0!==$(document.activeElement).closest(e).length||o.onFocusOut()})})}}return __extends(t,e),t.prototype.setDatePickerButtonClick=function(){var e=this;this.getDatePickerButton().one("click",this.setFocusOutEvent).click(function(){e.getNextEventDatePicker().setDefaultDate(e.getDefaultDate()),e.toggleDatePicker(!0),e.getNextEventDatePicker().focus()})},t.prototype.getAvailableDates=function(e,t,n,i){this.ajaxClient.getDatesOfEventsToBePickedAsNextEventForSchedulePage({courseId:t,eventId:n,startDate:e.startDate,endDate:e.endDate,eventStopDateTimeAsIsoString:i}).done(function(t){return e.allowedDates=t})},t.prototype.getAvailableTimeSlotsForDate=function(e,t,n,i){this.ajaxClient.getTimeSlotsOfEventsToBePickedAsNextEventForSchedulePage({courseId:t,eventId:n,date:e.date,eventStopDateTimeAsIsoString:i}).done(function(t){return e.availableTimeSlots=t})},t.prototype.resetDatePicker=function(){this.toggleDatePicker(!1);var e=this.getNextEventDatePicker();e.clearDateAndTime(!1),e.setDefaultDate(null)},t.prototype.isInEditMode=function(){return this.isEditMode},t.prototype.toggleDatePicker=function(e){this.getDatePickerContainer()[0].style.display=e?"inline-flex":"none",this.getDatePickerButton()[0].style.display=e?"none":"inline-flex",this.isEditMode=e},t.prototype.onFocusOut=function(){this.toggleDatePicker(!1)},t}(e.NextEventDateWorkerBase);t.AddEditEventDialogNextEventDateWorker=n}(t.NextEvent||(t.NextEvent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,i,s){var o=this;e.call(this,t,n,t.settings.ClientInstanceNames.AddEventNextEventPicker,t.settings.ClientInstanceNames.AddEventNextEventTimeSlotPicker),this.utility=t,this.locationParser=i,this.addEventEndDateHiddenFieldWrapper=s,this.setDatePickerButtonClick(),$(function(){o.getNextEventDatePicker().getAvailableDatesFunction=function(e){return o.getAvailableDates(e,o.getCourseId(),0,o.getEventStopDateTimeAsIsoString())},o.getNextEventTimeSlotPicker().getAvailableTimeSlotsForDateFunction=function(e){return o.getAvailableTimeSlotsForDate(e,o.getCourseId(),0,o.getEventStopDateTimeAsIsoString())}})}return __extends(t,e),t.prototype.resetDatePicker=function(){e.prototype.resetDatePicker.call(this),this.getDatePickerButton().find("span").text(this.utility.settings.terms.PickDate)},t.prototype.getDatePickerButton=function(){return this.utility.controls.NextEvent.AddEventDatePickerButton},t.prototype.getDatePickerContainer=function(){return this.utility.controls.NextEvent.AddEventDatePickerContainer},t.prototype.getDefaultDate=function(){return new Date(this.utility.controls.addEventEndDateHiddenField.val())},t.prototype.getCourseId=function(){return this.locationParser.parseCourseId(this.utility.controls.addEventCalendarsDropdown.val())},t.prototype.getEventStopDateTimeAsIsoString=function(){return JSON.stringify(this.addEventEndDateHiddenFieldWrapper.stringValue)},t}(e.AddEditEventDialogNextEventDateWorker);e.AddEventDialogNextEventDateWorker=t}(e.NextEvent||(e.NextEvent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(e){function t(t,n,i){var s=this;e.call(this,t,n,t.settings.ClientInstanceNames.EditEventNextEventPicker,t.settings.ClientInstanceNames.EditEventNextEventTimeSlotPicker),this.onNextEventSaved=i,$(function(){s.getNextEventDatePicker().getAvailableDatesFunction=function(e){return s.getAvailableDates(e,s.queryArgs.courseId,s.queryArgs.eventId,s.queryArgs.eventStopDateTimeAsIsoString)},s.getNextEventTimeSlotPicker().getAvailableTimeSlotsForDateFunction=function(e){return s.getAvailableTimeSlotsForDate(e,s.queryArgs.courseId,s.queryArgs.eventId,s.queryArgs.eventStopDateTimeAsIsoString)}})}return __extends(t,e),Object.defineProperty(t.prototype,"nextEventQueryArgs",{set:function(e){this.resetDatePicker(),this.setDatePickerButtonClick(),this.queryArgs=e,e.nextEvent.eventId>0&&this.setDateTimePickerValues()},enumerable:!0,configurable:!0}),t.prototype.setDateTimePickerValues=function(){var e=this.getNextEventDatePicker();e.setDate(CCL.SerializableDateTimeConverter.toDateWithSeconds(this.queryArgs.nextEvent.eventStart));var t=this.getNextEventTimeSlotPicker();t.updateFilteredTimeForDate(e.getDateAsString(),e.selectedFilterId),t.setSelectedTimeSlot(this.queryArgs.nextEvent.eventId),t.toggle(!0)},t.prototype.getDatePickerButton=function(){return this.utility.controls.NextEvent.EditEventDatePickerButton},t.prototype.getDatePickerContainer=function(){return this.utility.controls.NextEvent.EditEventDatePickerContainer},t.prototype.getDefaultDate=function(){return new Date(JSON.parse(this.queryArgs.eventStopDateTimeAsIsoString))},t.prototype.onFocusOut=function(){e.prototype.onFocusOut.call(this),this.getNextEventId()!==this.queryArgs.nextEvent.eventId&&this.saveNextEvent()},t.prototype.saveNextEvent=function(){var e=this,t=this.getNextEventId();this.ajaxClient.editNextEventId({EventId:this.queryArgs.eventId,NextEventId:t}).done(function(){e.queryArgs.nextEvent.eventId=t,e.onNextEventSaved&&e.onNextEventSaved(t)})},t}(e.AddEditEventDialogNextEventDateWorker);e.EditEventDialogNextEventDateWorker=t}(e.NextEvent||(e.NextEvent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t){this.utility=e,this.dateFormatter=t}return e.prototype.buildMarkup=function(e,t,n){var i=n.NextEventId>0?this.dateFormatter.getEventFormattedDateAndTime(CCL.SerializableDateTimeConverter.toDateWithSeconds(n.NextEventStart),CCL.SerializableDateTimeConverter.toDateWithSeconds(n.NextEventStop)):void 0;t?(this.utility.controls.NextEvent.EditEventDatePickerButton.find("span").text(i||this.utility.settings.terms.PickDate),this.utility.controls.NextEvent.EditEventDatePickerButton.appendTo(e),this.utility.controls.NextEvent.EditEventDatePickerContainer.appendTo(e)):i&&$("<div>").addClass(this.utility.settings.cssClasses.NextEventDateLabel).text(i).appendTo(e)},e}();e.NextEventMarkupBuilder=t}(e.NextEvent||(e.NextEvent={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){var t=function(e,t){var n=this;void 0===t&&(t=function(){}),this.commonSettings=e,this.onBeforeRedirect=t,this.handleAjaxError=function(e){var t=function(){n.onBeforeRedirect(),(window.itslTop||window.top).location.href=n.commonSettings.LogoutPageUrl},i=function(){e.status>=CCL.CommonConstants.httpStatusCodes.badRequest&&alert(CCL.CommonFunctions.htmlDecode(n.commonSettings.AnErrorOccurredTerm))};e.status===CCL.CommonConstants.httpStatusCodes.badRequest||e.status===CCL.CommonConstants.httpStatusCodes.unauthorized||e.status===CCL.CommonConstants.httpStatusCodes.methodNotAllowed?$.ajax({type:"GET",url:n.commonSettings.CheckSessionUrl}).done(function(e){return(e?t:i)()}).fail(t):i()}};e.CommonAjaxClient=t}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e,t){this.clientInstanceName=e,this.settings=t,window[e]=this,this.modalDialogClientInstanceName=t.ModalDialogClientInstanceName,this.modalDialog=window[t.ModalDialogClientInstanceName]}return t.prototype.openDialog=function(t,n,i,s){void 0===i&&(i=!1),void 0===s&&(s=!0);var o=this.createIFrameUrl(t,n,i,s);this.modalDialog.setIframeUrl(o,!1),this.modalDialog.setTitle(t===e.CopyMoveElementDialogMode.Copy?this.settings.Terms.CopyTo:this.settings.Terms.MoveTo),this.modalDialog.openDialog(!1)},t.prototype.closeDialog=function(){CssModal.closeDialog()},t.prototype.getContentMaxHeight=function(){return this.modalDialog.getInnerContentMaxHeight()},t.prototype.resizeDialog=function(){this.modalDialog.adjustWindowSize()},t.prototype.copyMoveOperationInProgress=function(e){var t=this;this.modalDialog.toggleDialogCloseButton(!e),this.modalDialog.getIframe().load(function(){t.modalDialog.toggleDialogCloseButton(!0)})},t.prototype.copyMoveOperationCompleted=function(e){window.dispatchEvent(new CustomEvent(this.settings.CopyMoveOperationCompletedEventName,{detail:e}))},t.prototype.createIFrameUrl=function(e,t,n,i){var s=this.settings.IframePageUrl+"?"+this.settings.RequestItems.Mode+"="+e+"&"+this.settings.RequestItems.ElementIds+"="+(Array.isArray(t)?encodeURIComponent(t.join(",")):t);return n&&(s=s+"&"+this.settings.RequestItems.HideLocationDropdown+"="+n),i||(s=s+"&"+this.settings.RequestItems.ShowFeedback+"="+i),s},t}();e.CopyMoveElementDialog=t}(e.CopyMoveElementDialog||(e.CopyMoveElementDialog={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e,t){var n=this;this.clientInstanceName=e,this.settings=t,window[e]=this,$(function(){n.$copyMoveButton=$("#"+n.settings.ClientIds.CopyMoveButton),n.$copyWithTreeLinksButton=$("#"+n.settings.ClientIds.CopyWithTreeLinksButton),n.$cancelButton=$("#"+n.settings.ClientIds.CancelButton),n.$courseAndProjectsDropDownList=$("#"+n.settings.ClientIds.CourseAndProjectDropDownList),n.$includeAnswersCheckBox=$("#"+n.settings.ClientIds.IncludeAnswersCheckBox),n.$includeAnswersCheckBoxHidden=$("#"+n.settings.ClientIds.IncludeAnswersCheckBoxHiddenField),n.$overwriteAssessmentCriteriaCheckBox=$("#"+n.settings.ClientIds.OverwriteAssessmentCriteriaCheckBox),n.$overwriteAssessmentCriteriaCheckBoxHidden=$("#"+n.settings.ClientIds.OverwriteAssessmentCriteriaCheckBoxHiddenField),n.$treeMenu=$("#"+n.settings.ClientIds.TreeMenu),n.$viewPort=$("#"+n.settings.ClientIds.ViewPort),n.$lastSelected=$("."+n.settings.CssClasses.NodeClicked),n.treeLinksFeedback=window[n.settings.TreeLinksWarning.TreeLinksFeedbackName],n.treeLinksWarning=n.settings.TreeLinksWarning,n.genericFeedback=window[n.settings.FeedbackMessage.FeedbackClientInstanceName],n.feedbackMessage=n.settings.FeedbackMessage,n.terms=n.settings.Terms,n.mode=n.settings.Mode,n.contentContainer=document.getElementById(n.settings.ClientIds.ContentContainer),n.windowParent=window.parent,n.$viewPort[0]&&(n.contentHeightWithoutTreeMenu=n.contentContainer.scrollHeight-n.$viewPort[0].clientHeight),n.copyMovePostbackClientFunction=new Function(n.settings.ClientFunctions.CopyMovePostback),n.copyWithTreeLinksPostbackClientFunction=new Function(n.settings.ClientFunctions.CopyWithTreeLinksPostback),n.currentlyInProgress=!1,n.$copyMoveButton.prop("disabled",!0).removeAttr("onclick").click(function(){n.inProgress(),n.copyMovePostbackClientFunction()}),n.$copyWithTreeLinksButton.prop("disabled",!0).removeAttr("onclick").click(function(){n.inProgress(),n.copyWithTreeLinksPostbackClientFunction()}),n.feedbackMessage.ShowMessage?(n.currentlyInProgress=!0,n.genericFeedback.showMessage(CCL.FeedbackType.Warning,n.feedbackMessage.Message),n.$copyMoveButton.prop("disabled",!0),n.$copyWithTreeLinksButton.prop("disabled",!0),n.$copyMoveButton.hide(),n.$copyWithTreeLinksButton.hide()):n.treeLinksWarning.ShowTreeLinksWarning&&(n.updateTreeLinksFeedbackAndButtons(n.treeLinksWarning.TreeLinksWarningMessage),n.$includeAnswersCheckBox.length&&n.$includeAnswersCheckBox.removeAttr("onclick").click(function(){n.updateTreeLinksWarningClientFunction()})),n.settings.ReloadFolder&&("function"==typeof window.itslTop.reloadFolder&&window.itslTop.reloadFolder(),n.notifyAboutProgress(!1)),n.attachTreeMenuListeners()})}return t.prototype.updateTreeLinksFeedbackAndButtons=function(t){t&&t.HasTreeLinks?(this.treeLinksFeedback.showMessage(CCL.FeedbackType.Warning,t.TreeLinksWarningMessage),this.$copyWithTreeLinksButton.show(),this.$copyMoveButton.prop("value",this.mode===e.CopyMoveElementDialogMode.Copy?this.terms.CopySelectedResourceOnly:this.terms.Move)):(this.treeLinksFeedback.hide(),this.$copyWithTreeLinksButton.hide(),this.$copyMoveButton.prop("value",this.mode===e.CopyMoveElementDialogMode.Copy?this.terms.Copy:this.terms.Move))},t.prototype.updateTreeLinksWarningClientFunction=function(){var e=this;$.ajax({url:this.treeLinksWarning.GetTreeLinksWarningMessageUrl.replace(new RegExp("includeAnswers=((true)|(false))","ig"),"includeAnswers="+this.$includeAnswersCheckBox.is(":checked")),dataType:"json"}).done(function(t){e.updateTreeLinksFeedbackAndButtons(t)})},t.prototype.closeDialog=function(){this.windowParent.closeCopyOrMoveElementsDialog?this.windowParent.closeCopyOrMoveElementsDialog():window.parent[this.settings.DialogClientInstanceName]&&window.parent[this.settings.DialogClientInstanceName].closeDialog()},t.prototype.attachTreeMenuListeners=function(){var e=this;this.$treeMenu.on("loaded.jstree",function(){$("."+e.settings.CssClasses.Tree).show(),e.notifyAboutResizeRequired()});var t=this;this.$treeMenu.on("select_node.jstree",function(n,i){var s=$("#"+e.settings.ClientIds.SelectedTreeNode),o=$(i.rslt.obj);return o.hasClass(t.settings.CssClasses.TreeMenuTogglableNode)?(s.val(""),e.$copyMoveButton.prop("disabled",!0),e.$copyWithTreeLinksButton.prop("disabled",!0),!1):(!1===e.currentlyInProgress&&(e.$copyMoveButton.prop("disabled",!1),e.$copyWithTreeLinksButton.prop("disabled",!1)),s.val($(o).prop("id")),t.isScrolledIntoView(o)||$("html, body, div").scrollTop(o.offset().top+t.$viewPort.scrollTop()-$(o).height()),o.focus(),e.$lastSelected&&e.$lastSelected.removeClass(t.settings.CssClasses.NodeSelected),e.$lastSelected=o,e.$lastSelected&&t.$lastSelected.addClass(t.settings.CssClasses.NodeSelected),!0)}),this.$treeMenu.on("open_node.jstree",function(n,i){e.notifyAboutResizeRequired();var s=$(i.rslt.obj);if(!s.hasClass(t.settings.CssClasses.TreeMenuTogglableNode))return!0;t.$treeMenu.jstree("deselect_node",s),t.$treeMenu.jstree("open_node",s),t.$lastSelected&&t.$lastSelected.addClass(t.settings.CssClasses.NodeClicked)}),this.$treeMenu.on("close_node.jstree",function(n,i){e.notifyAboutResizeRequired();var s=$(i.rslt.obj);if(!s.hasClass(t.settings.CssClasses.TreeMenuTogglableNode)&&!t.settings.CssClasses.Folder)return!0;t.$treeMenu.jstree("deselect_node",s),t.$treeMenu.jstree("close_node",s),t.$lastSelected&&e.$lastSelected.addClass(t.settings.CssClasses.NodeClicked)})},t.prototype.isScrolledIntoView=function(e){var t=this.$viewPort.scrollTop(),n=t+this.$viewPort.height(),i=e.offset().top+t,s=i+e.height();return s>=t&&i<=n&&s<=n&&i>=t},t.prototype.inProgress=function(){this.currentlyInProgress=!0,this.$copyMoveButton.prop("disabled",!0).prop("value","").addClass(this.settings.CssClasses.InProgress),this.$copyWithTreeLinksButton.prop("disabled",!0).prop("value","").addClass(this.settings.CssClasses.InProgress),this.$cancelButton.prop("disabled",!0),this.$courseAndProjectsDropDownList.prop("disabled",!0),this.$includeAnswersCheckBox.length&&(this.$includeAnswersCheckBoxHidden.val(this.$includeAnswersCheckBox.is(":checked").toString()),this.$includeAnswersCheckBox.prop("disabled",!0)),this.$overwriteAssessmentCriteriaCheckBox.length&&(this.$overwriteAssessmentCriteriaCheckBoxHidden.val(this.$overwriteAssessmentCriteriaCheckBox.is(":checked").toString()),this.$overwriteAssessmentCriteriaCheckBox.prop("disabled",!0)),this.notifyAboutProgress(!0)},t.prototype.notifyAboutProgress=function(e){this.windowParent.copyMoveOperationInProgress?this.windowParent.copyMoveOperationInProgress(e):window.parent[this.settings.DialogClientInstanceName]&&window.parent[this.settings.DialogClientInstanceName].copyMoveOperationInProgress&&window.parent[this.settings.DialogClientInstanceName].copyMoveOperationInProgress(e)},t.prototype.notifyAboutResizeRequired=function(){var e;this.windowParent.getContentMaxHeight?(e=this.windowParent.getContentMaxHeight(),this.$viewPort.css("max-height",e-this.contentHeightWithoutTreeMenu)):window.parent[this.settings.DialogClientInstanceName]&&window.parent[this.settings.DialogClientInstanceName].getContentMaxHeight&&(e=window.parent[this.settings.DialogClientInstanceName].getContentMaxHeight(),this.$viewPort.css("max-height",e-this.contentHeightWithoutTreeMenu)),this.windowParent.resizeDialog?this.windowParent.resizeDialog():window.parent[this.settings.DialogClientInstanceName]&&window.parent[this.settings.DialogClientInstanceName].resizeDialog&&window.parent[this.settings.DialogClientInstanceName].resizeDialog()},t}();e.CopyMoveElementDialogPage=t}(e.CopyMoveElementDialog||(e.CopyMoveElementDialog={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;this.settings=e,GroupsTableGetSelectedValues=t,$("table button[id*='_Delete_']").click(function(e){return n.onDeleteGroup(e)});var i=$("#"+e.DeleteButtonClientId);this.deletePostBackReference=i.attr("href").replace("javascript:",""),i.click(function(e){return n.onDeleteSelectedGroups(e)})}return e.prototype.isAnyGroupSelected=function(){var e=$("[id^='"+this.settings.TableClientId+"_Select']:checked");return e.length>0&&!(1===e.length&&e[0].id.toLowerCase().indexOf("selectall")>-1)},e.prototype.onDeleteGroup=function(e){var t=this,n=$(e.currentTarget),i=[];i.push(this.getGroupId(n)),this.checkBeforeDelete(i,function(){return t.deleteGroup(n)})},e.prototype.onDeleteSelectedGroups=function(e){var t=this;return this.isAnyGroupSelected()?(this.checkBeforeDelete(GroupsTableGetSelectedValues(),function(){new Function(t.deletePostBackReference)()}),!1):(alert(this.settings.Terms.SelectGroups),!1)},e.prototype.checkBeforeDelete=function(e,t){var n=this,i=1===e.length?this.settings.Terms.DeleteGroupQuestion:this.settings.Terms.DeleteGroupsQuestion;this.checkRelatedCalendarEvents(e).done(function(e){if(e){var s="Delete",o=new CCL.ConfirmButtonMetaData(n.settings.Terms.Delete,CCL.CommonCssClasses.Buttons.Red,s),r=new CCL.ConfirmButtonMetaData(n.settings.Terms.Cancel,"","Cancel");CCL.CommonFunctions.jAjaxMultiButtonConfirm("",n.settings.Terms.GroupHasConnectedEventsWarning,[o,r],function(e){e.customId===s&&t()})}else confirm(i)&&t()})},e.prototype.deleteGroup=function(e){__doPostBack(e.data("event-target"),"")},e.prototype.getGroupId=function(e){var t=e.attr("id");return Number(t.substr(t.lastIndexOf("_")+1))},e.prototype.checkRelatedCalendarEvents=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.settings.ApiRoutes.CheckRelatedCalendarEvents,data:e})},e}();e.Groups=t}(e.Courses||(e.Courses={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function e(e,t,n,i,s,o,r,a,l){var c=this;this.controlsModel=t,this.url=n,this.deleteUrl=i,this.widgetSettings=s,this.terms=o,this.antiForgeryToken=r,this.loadPlanCardsEventName=a,this.plansContainerCssClass=l,this.courseIconKey="Course",this.eventDialog=window[e],this.initializeButtons(),document.addEventListener(CCL.FullScreenDialog.onCloseCancelableEvent,function(){c.currentEventId&&c.loadEvent(c.createGetEventAjaxRequest(c.currentEventId))})}return e.prototype.resetDialog=function(){this.resetNav(),this.resetHeaderIcons(),this.controlsModel.Content.empty(),this.controlsModel.Footer.AttendanceSection.show(),this.controlsModel.Footer.AttendanceSection.empty(),this.controlsModel.AjaxLoading.hide(),this.controlsModel.Footer.ButtonsContainer.hide(),this.controlsModel.Header.DeleteEventButton.hide(),this.controlsModel.Header.EditEventLink.hide(),this.controlsModel.Footer.ShowMore.show(),this.currentEventId=void 0},e.prototype.showConfirmation=function(e,t){this.resetHeaderIcons();var n=$("<span>").addClass(this.controlsModel.ContentHeaderTitleCssClass).text(e),i=$("<div>").addClass(this.controlsModel.ContentHeaderCssClass).append(n),s=$("<div>").text(t);this.controlsModel.Content.empty().append(i,s),this.controlsModel.Header.DeleteEventButton.hide(),this.controlsModel.Header.EditEventLink.hide(),this.controlsModel.Header.HeaderTitle.text(e),this.controlsModel.Header.HeaderColorSchema.hide(),this.controlsModel.Footer.AttendanceSection.hide(),this.controlsModel.Footer.ShowMore.hide(),this.controlsModel.Footer.ButtonsContainer.show(),this.controlsModel.AjaxLoading.hide(),this.eventDialog.adjustWindowSize()},e.prototype.resetHeaderIcons=function(){var e=this,t=this.controlsModel.Header.HeaderColorSchema.data("schema");t&&this.controlsModel.Header.HeaderColorSchema.removeClass(t),Object.keys(this.controlsModel.Header.Icons).forEach(function(t){e.controlsModel.Header.Icons[t].Instance.hide(),t!==e.courseIconKey&&e.controlsModel.Header.Icons[t].Instance.parent().hide()})},e.prototype.resetNav=function(){this.setNav("#")},e.prototype.setNav=function(e,t){void 0===t&&(t="_top"),this.controlsModel.Footer.ShowMore.prop("href",e),this.controlsModel.Footer.ShowMore.prop("target",t)},e.prototype.setEditLink=function(e,t){this.controlsModel.Header.EditEventLink.prop("href",e)},e.prototype.SetTitle=function(e,t,n){if(t in this.controlsModel.Header.Icons){var i=n.replace("itsl-dot","");this.controlsModel.Header.HeaderColorSchema.addClass(i).data("schema",i),this.controlsModel.Header.Icons[t].Instance.show(),t!==this.courseIconKey&&this.controlsModel.Header.Icons[t].Instance.parent().show()}this.controlsModel.Header.HeaderTitle.text(e)},e.prototype.open=function(e,t,n,i,s,o,r,a){this.resetDialog(),this.SetTitle(t,n,s),this.setNav(i,o),this.eventDialog.openDialog(!1),this.loadEvent(this.createGetEventAjaxRequest(e)),this.setEditLink(r,a),this.currentEventId=e},e.prototype.loadEvent=function(e){var t=this;this.currentLoadingSession&&this.currentLoadingSession.abort&&this.currentLoadingSession.abort(),this.controlsModel.Content.empty(),this.controlsModel.Content.click(function(e){$(e.target).is("a")&&CssModal.closeDialog()}),this.controlsModel.AjaxLoading.show(),this.currentLoadingSession=e(),this.currentLoadingSession.done(function(e){t.controlsModel.Content.html(e.Content),t.controlsModel.Footer.AttendanceSection.html(e.AttendanceOverview),t.eventDialog.adjustWindowSize(),t.controlsModel.Header.DeleteEventButton.toggle(e.IsDeletable),t.controlsModel.Header.EditEventLink.toggle(e.IsEditable),t.initializeOpenSelfRegistrationDialogEventHandler(),CCL.CommonFunctions.applyIframely(),t.loadPlanCards()}).always(function(){t.controlsModel.AjaxLoading.hide(),t.currentLoadingSession=void 0})},e.prototype.loadPlanCards=function(){var e=this.controlsModel.Content.get(0).getElementsByClassName(this.plansContainerCssClass);if(1===e.length){var t=e[0].getElementsByTagName("input");1===t.length&&e[0].getElementsByTagName("div")[0].dispatchEvent(new CustomEvent(this.loadPlanCardsEventName,{bubbles:!0,detail:JSON.parse(t[0].value)}))}},e.prototype.createGetEventAjaxRequest=function(e){var t=this;return function(){return CCL.CommonFunctions.safeAjaxPost({url:t.url.replace("{eventId}",e),data:{widgetSettings:t.widgetSettings}})}},e.prototype.initializeButtons=function(){var e=this;this.controlsModel.Header.EditEventLink.click(function(e){CssModal.closeDialog()}),this.controlsModel.Header.DeleteEventButton.click(function(t){var n=e.controlsModel.Content.find("."+e.controlsModel.EventTitleCssClass).text();e.showConfirmation(CCL.CommonFunctions.formatString(e.terms.DeleteEventConfirmationHeader,n),e.terms.DeleteEventConfirmationText)}),this.controlsModel.Footer.DeleteEventButton.click(function(){var t;$.ajax({type:"DELETE",url:e.deleteUrl.replace("{eventId}",e.currentEventId.toString())+"?deleteRecurringSeries=false",contentType:"application/json",headers:(t={},t[e.antiForgeryToken.name]=e.antiForgeryToken.value,t)}).done(function(){CssModal.closeDialog(),window.location.reload()})}),this.controlsModel.Footer.CancelButton.click(function(){CssModal.closeDialog()})},e.prototype.initializeOpenSelfRegistrationDialogEventHandler=function(){var e=this;$("."+this.controlsModel.ContentSelfRegisterPresenceButtonCssClass).click(function(t){t.stopPropagation(),CssModal.closeDialog(),e.openSelfRegistrationAttendanceDialog(e.currentEventId)})},e.prototype.openSelfRegistrationAttendanceDialog=function(e){var t=this;CCL.CommonFunctions.makePostMessageCall(window.top,{messageName:CCL.CommonWindowMessages.MessageNames.maskNavigationBar});var n=new CustomEvent(this.controlsModel.OpenSelfRegistrationDialogEventName,{detail:{eventId:e}});document.dispatchEvent(n);var i=function(e){document.removeEventListener(t.controlsModel.CloseSelfRegistrationDialogEventName,i),CCL.CommonFunctions.makePostMessageCall(window.top,{messageName:CCL.CommonWindowMessages.MessageNames.unmaskNavigationBar})};document.addEventListener(this.controlsModel.CloseSelfRegistrationDialogEventName,i)},e}();e.EventPreview=t}(e.Events||(e.Events={}))}(e.Widgets||(e.Widgets={}))}(e.Dashboard||(e.Dashboard={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function e(e){this.attributesModel=e}return e.prototype.getEventColorSchema=function(e){return e.data(this.attributesModel.EventColorSchema)},e.prototype.getEventUrl=function(e){return e.data(this.attributesModel.EventUrl)},e.prototype.getEditEventUrl=function(e){return e.data(this.attributesModel.EditEventUrl)},e.prototype.getEditRecurringEventUrl=function(e){return e.data(this.attributesModel.EditRecurringEventUrl)},e.prototype.getEventUrlTarget=function(e){return e.data(this.attributesModel.EventUrlTarget)},e.prototype.getEventId=function(e){return e.data(this.attributesModel.EventId)},e.prototype.getEventTitle=function(e){return e.data(this.attributesModel.EventTitle)},e.prototype.getEventCategory=function(e){return e.data(this.attributesModel.EventCategory)},e}();e.EventUtility=t}(e.Events||(e.Events={}))}(e.Widgets||(e.Widgets={}))}(e.Dashboard||(e.Dashboard={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){var n=this;window[e]=this,this.settings=t,$(function(){n.$pickerResults=$("#"+n.settings.Controls.PickerResultsHidden)})}return e.prototype.getPickerResult=function(){return this.$pickerResults.val()},e}();e.AssignTo=t}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){this.utility=e}return Object.defineProperty(e.prototype,"newBulletinTextArea",{get:function(){return this._newBulletinTextArea},enumerable:!0,configurable:!0}),e.prototype.setNewBulletinSvelteControls=function(){this._newBulletinTextArea=$(this.utility.selectors.newBulletinTextArea)},e}();e.LightBulletinSvelteControls=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e){var t=this;this.settings=e,$("#"+this.settings.Controls.EmailDeactivate).on("click",function(){confirm(t.settings.Terms.AreYouSureDeactivateEmail)&&t.updateServiceStatus(n.email,!1,function(){$("."+t.settings.CssClasses.Services+" [data-service='"+n.email+"']").attr("data-is-active","false"),t.showInformationFeedback(t.settings.Terms.EmailSuccessfullyDeactivated),t.updateCheckboxesStates(n.email)})}),$("#"+this.settings.Controls.EmailActivate).on("click",function(){confirm(t.settings.Terms.AreYouSureActivateEmail)&&t.updateServiceStatus(n.email,!0,function(){$("."+t.settings.CssClasses.Services+" [data-service='"+n.email+"']").attr("data-is-active","true"),t.showInformationFeedback(t.settings.Terms.EmailSuccessfullyActivated),t.updateCheckboxesStates(n.email)})}),$("#"+this.settings.Controls.SubscriptionsSave).on("click",function(){var e=[];$("."+t.settings.CssClasses.SubscriptionsCheckbox).each(function(t,n){e.push({Service:$(n).attr("data-service"),Subscription:$(n).attr("data-subscription"),IsChecked:$(n).find("input").prop("checked")})});var n={};n[t.settings.AntiForgeryHeaderName]=t.settings.AntiForgeryHeaderValue,CCL.CommonFunctions.safeAjaxPost({url:t.settings.SubscriptionsUrl,data:{model:e},headers:n}).done(function(){t.showInformationFeedback(t.settings.Terms.InformationSaved)}).fail(function(){return t.showInformationFeedback(t.settings.Terms.ErrorFeedback)})})}return e.prototype.updateServiceStatus=function(e,t,n){var i=this,s={};s[this.settings.AntiForgeryHeaderName]=this.settings.AntiForgeryHeaderValue,CCL.CommonFunctions.safeAjaxPost({url:this.settings.ServiceStatusUrl,data:{service:e,isActive:t},headers:s}).done(n).fail(function(){return i.showInformationFeedback(i.settings.Terms.ErrorFeedback)})},e.prototype.updateCheckboxesStates=function(e){var t=$("."+this.settings.CssClasses.Services+" [data-service='"+e+"']").attr("data-is-active"),n=$("."+this.settings.CssClasses.SubscriptionsCheckbox+"[data-service='"+e+"'] input");"false"===t&&n.attr("disabled","disabled"),"true"===t&&n.removeAttr("disabled")},e.prototype.showInformationFeedback=function(e){CCL.InformationFeedback.showFeedback($("#"+this.settings.Controls.MainContainer),e)},e}();e.Alerts=t;var n=function(){function e(){}return e.email="email",e}()}(e.Settings||(e.Settings={}))}(e.Person||(e.Person={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;this.lastTreeLinkIdToNavigate=void 0,this.settings=e,$(function(){n.$informationFeedbackContainer=$("#"+t),CCL.CustomTreeLinkNavigationManager.registerCustomHandler(function(e){n.handleTreeLinkNavigationEvent(e)}),CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.askIfCustomTreeLinkNavigationRequired,function(){n.hideInformationFeedback(!1)})})}return e.prototype.handleTreeLinkNavigationEvent=function(e){var t=this;if(this.lastTreeLinkIdToNavigate=e.linkId,!e.linkId||e.sourceId<=0){var n=e.context===CCL.TreeLinkContext.library;this.showInformationFeedback(n?this.settings.Terms.TreeLinkIsInLibrary:this.settings.Terms.ErrorOccurred)}else{var i=this.settings.TreeLinksGetInfoForCustomNavigation.replace("{id}",e.linkId).replace("{sourceElementId}",e.sourceId.toString());$.get(i).done(function(n){if(t.lastTreeLinkIdToNavigate===e.linkId)if(n.HasError)t.showInformationFeedback(n.ErrorDescription);else{var i=t.settings.KpiSettings;CCL.CommonFunctions.measureKpi(i.url,i.section,i.clickOnTreeLinkMeasurement,i.context).always(function(){"_blank"!==e.target?window.itslTop.location.assign(n.TargetElementUrl):window.open(n.TargetElementContentUrl,"_blank")})}}).fail(function(){t.lastTreeLinkIdToNavigate===e.linkId&&t.showInformationFeedback(t.settings.Terms.ErrorOccurred)})}},e.prototype.showInformationFeedback=function(e){CCL.InformationFeedback.showFeedback(this.$informationFeedbackContainer,e)},e.prototype.hideInformationFeedback=function(e){void 0===e&&(e=!0),CCL.InformationFeedback.hideFeedback(this.$informationFeedbackContainer,e)},e}();e.GenericTreeLinkNavigationHandler=t}(e.TreeLink||(e.TreeLink={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){var n=this;this.onWorkloadEnableChanged=function(e){$("#"+n.settings.Controls.WorkloadEnableCheckbox).is(":checked")?n.$workloadEstimationSection.show():(n.$workloadEstimationHoursTextBox.val("0"),n.$workloadEstimationMinutesDropDown.val("00"),n.$workloadEstimationSection.hide())},window[e]=this,this.settings=t,$(function(){n.$workloadEstimationSection=$("#"+n.settings.Controls.WorkloadEstimationSection),n.$workloadEstimationHoursTextBox=$("#"+n.settings.Controls.WorkloadEstimationHoursTextBox),n.$workloadEstimationHoursInputError=$("#"+n.settings.Controls.WorkloadEstimationHoursInputError),n.$workloadEstimationMinutesDropDown=$("#"+n.settings.Controls.WorkloadEstimationMinutesDropdown),n.$workloadEnableCheckbox=$("#"+n.settings.Controls.WorkloadEnableCheckbox),n.$workloadEnableCheckbox.on("click",function(e){return n.onWorkloadEnableChanged(e)}),$("#"+n.settings.Controls.WorkloadEnableCheckbox).is(":checked")||n.$workloadEstimationSection.hide(),n.$workloadEstimationSection.on("change keyup",function(){$(document).trigger(n.settings.Events.WorkloadChangedClient)})})}return e.prototype.onChange=function(e){this.onChangeHandler=e},e.prototype.isValid=function(){var e=$.isNumeric(this.$workloadEstimationHoursTextBox.val()),t=60*this.$workloadEstimationHoursTextBox.val()+1*this.$workloadEstimationMinutesDropDown.val();return!e||t<0||t>599940?(this.$workloadEstimationHoursInputError.show(),this.$workloadEstimationHoursTextBox.addClass("itsl-workload-estimationhourseditbox-error"),!1):(this.$workloadEstimationHoursInputError.hide(),this.$workloadEstimationHoursTextBox.removeClass("itsl-workload-estimationhourseditbox-error"),!0)},e.prototype.getWorkloadEnabled=function(){return!!$("#"+this.settings.Controls.WorkloadEnableCheckbox).is(":checked")||(this.$workloadEstimationHoursTextBox.val("0"),this.$workloadEstimationMinutesDropDown.val("00"),!1)},e.prototype.getWorkloadEstimation=function(){var e=60*this.$workloadEstimationHoursTextBox.val()+1*this.$workloadEstimationMinutesDropDown.val();return e<0||e>599940?-1:e},e}();e.WorkloadSetting=t}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function t(t,n){this.controls=t,this.settings=n,this.eventPreview=new e.EventPreview(n.ClientInstanceNames.EventDialog,t.EventDialog,n.WebMethods.GetEventDetails,n.WebMethods.DeleteEvent,n.WidgetSettings,n.Terms,{name:n.AntiForgeryTokenName,value:n.AntiForgeryTokenValue},n.EventNames.LoadPlanCards,n.CssClasses.PlansContainer),this.utility=new e.EventUtility(n.DataAttributes),this.setupEventItemClick(),this.setupOpenStartUpEvent()}return t.prototype.openEventItem=function(e,t,n,i,s,o,r,a){this.eventPreview.open(e,t,n,i,s,o,r,a)},t.prototype.setupOpenStartUpEvent=function(){var e=this;if(null!=this.settings.StartupEvent&&($(window).load(function(){e.eventPreview.open(e.settings.StartupEvent.Id,e.settings.StartupEvent.Title,e.settings.StartupEvent.Category,e.settings.StartupEvent.Url,e.settings.StartupEvent.ColorSchema,e.settings.StartupEvent.UrlTarget,e.settings.StartupEvent.EditUrl,e.settings.StartupEvent.EditRecurringUrl)}),window.parent&&window.parent.document&&window.parent.history)){var t=CCL.CommonFunctions.setQueryStringParameter(window.parent.location.href,this.settings.StartupEvent.EventParameterName,"");window.parent.history.replaceState({},window.parent.document.title,t)}},t.prototype.setupEventItemClick=function(){var e=this;this.controls.Container.on("click",CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.EventTimeRangeLink),function(t){var n=$(t.currentTarget);n.getIfHyperLinkEnabled()&&e.openEventItem(e.utility.getEventId(n),e.utility.getEventTitle(n),e.utility.getEventCategory(n),e.utility.getEventUrl(n),e.utility.getEventColorSchema(n),e.utility.getEventUrlTarget(n),e.utility.getEditEventUrl(n),e.utility.getEditRecurringEventUrl(n))}),this.controls.Container.on("click","."+this.settings.CssClasses.KeepAttendanceButton,function(t){if(!$(t.currentTarget).prop("disabled")){var n=$(t.currentTarget).closest(CCL.CommonFunctions.getDataSelector(e.settings.DataAttributes.EventId)).data(e.settings.DataAttributes.EventId);e.openKeepAttendanceDialog(n)}return!1})},t.prototype.clearEventDialogContent=function(){this.eventPreview.resetDialog()},t.prototype.openKeepAttendanceDialog=function(e){var t=this,n=new CustomEvent(this.settings.EventNames.OpenKeepAttendanceDialog,{detail:{eventId:e}});document.dispatchEvent(n);var i=function(e){if(document.removeEventListener(t.settings.EventNames.CloseKeepAttendanceDialog,i),e.detail&&e.detail.eventId&&(e.detail.saved||e.detail.attendanceChanged)){if(e.detail.saved){var n=t.settings.Terms.FeedbackMessage.replace("{0}",e.detail.eventDate+" "+e.detail.eventTime).replace("{1}",CCL.CommonFunctions.htmlEncode(e.detail.courseName));CCL.InformationFeedback.showFeedback(t.controls.Container,n)}var s=e.detail.presentCount>0||e.detail.absentCount>0,o=s?CCL.CommonFunctions.formatString(t.settings.Terms.AttendanceHasBeenKeptWithStatistics,e.detail.presentCount,e.detail.absentCount)+" "+t.settings.Terms.EditAttendance:t.settings.Terms.RegisterAttendance;t.getKeepAttendanceButton(e.detail.eventId).prop("title",o).prop("aria-label",o),t.getAttendanceStatisticsLabel(e.detail.eventId).toggle(s).text(s?e.detail.presentCount+"/"+e.detail.absentCount:"")}};document.addEventListener(this.settings.EventNames.CloseKeepAttendanceDialog,i)},t.prototype.getKeepAttendanceButton=function(e){return this.getEventContainer(e).find("."+this.settings.CssClasses.KeepAttendanceButton)},t.prototype.getAttendanceStatisticsLabel=function(e){return this.getEventContainer(e).find("."+this.settings.CssClasses.AttendanceStatisticsLabel)},t.prototype.getEventContainer=function(e){return this.controls.Container.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.EventId,e))},t}();e.EventsContentBlock=t}(e.Events||(e.Events={}))}(e.Widgets||(e.Widgets={}))}(e.Dashboard||(e.Dashboard={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){this.clientInstanceName=e,this.settings=t,window[e]=this,this.modalDialogClientInstanceName=t.ModalDialogClientInstanceName,this.modalDialog=window[t.ModalDialogClientInstanceName],this.modalDialog.setCustomScripts({afterOpenDialog:this.fixSidePanelExpansion.bind(this)})}return e.prototype.openDialog=function(e){this.deferred=jQuery.Deferred(),document.querySelector("#"+this.settings.DialogContentId).innerHTML=e;for(var t=document.querySelector("#"+this.settings.ModalDialogClientInstanceName).querySelectorAll("button"),n=0;n<t.length;n++)t[n].addEventListener("click",this.closeDialog.bind(this));return this.modalDialog.openDialog(!1),this.deferred.promise()},e.prototype.closeDialog=function(e){CssModal.closeDialog(),"ok"===e.target.value?this.deferred.resolve(!0):this.deferred.resolve(!1)},e.prototype.fixSidePanelExpansion=function(){setTimeout(function(){return CCL.CommonFunctions.makePostMessageCall(window,{messageName:CCL.CommonWindowMessages.MessageNames.collapseExtensionIframe})},500)},e}();e.LearningObjectiveRemovalDialog=t}(e.LearningObjectiveRemovalDialog||(e.LearningObjectiveRemovalDialog={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(){}return t.handle=function(t,n,i,s){var o=(void 0===s?{shouldAlertErrorMessage:function(e){return!0}}:s).shouldAlertErrorMessage;if(t.Code===e.GenericResponseCode.Success)n(t.ResponseData);else t.ErrorMessage&&o(t)&&alert(t.ErrorMessage),i&&i(t)},t}();e.GenericResponseHandler=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.InProgress=0]="InProgress",e[e.Failed=1]="Failed",e[e.Aborted=2]="Aborted"}(e.PendingProcessStatus||(e.PendingProcessStatus={}));e.PendingProcessStatus}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(){this.processes=new Map,this.lastProcessId=0}return t.prototype.createProcess=function(t){var n=this.lastProcessId+1,i={processId:n,pendingStatus:e.PendingProcessStatus.InProgress,ajaxRequest:t};return this.lastProcessId=n,this.processes.set(n,i),i},t.prototype.getProcessById=function(e){return this.processes.get(e)},t.prototype.setProcessFailed=function(t){t.pendingStatus=e.PendingProcessStatus.Failed,this.clearProcessAjaxRequest(t)},t.prototype.clearProcessAjaxRequest=function(e){e.ajaxRequest=void 0},t.prototype.cancelProcess=function(t){var n=this.processes.get(t);n.pendingStatus===e.PendingProcessStatus.InProgress&&(n.pendingStatus=e.PendingProcessStatus.Aborted,n.ajaxRequest&&(n.ajaxRequest.abort(),this.clearProcessAjaxRequest(n)))},t.prototype.removeProcessById=function(e){this.processes.delete(e)},t}();e.PendingEmbedProcessManager=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t){this.settings=t,e.supervisorOverviewInstance=this}return t.prototype.findSupervisor=function(t,n){return CCL.CommonFunctions.safeAjax({type:"GET",url:e.supervisorOverviewInstance.settings.FindSupervisorsServiceUrl+"?search="+t.term+"&supervisorType="+e.supervisorOverviewInstance.settings.SupervisorType+"&organisationId="+e.supervisorOverviewInstance.settings.OrganizationId,dataType:"json",success:function(e){n($.map(e,function(e){return{label:e.Name,value:e.Name,id:e.PersonId,organization:e.Organization}}))}})},t.prototype.personSearchRenderItem=function(t,n){return $("<li>").append($("<button>").attr("type","button").text(n.label).addClass(e.supervisorOverviewInstance.settings.CssClasses.ButtonPerson).append($("<div>").addClass(e.supervisorOverviewInstance.settings.CssClasses.ButtonPersonHierarchy).text(n.organization))).appendTo(t)},t.prototype.selectedSupervisorChanged=function(t,n){var i={SearchText:n.item.value,SearchValue:n.item.id};location.href=e.supervisorOverviewInstance.settings.FilterUrl+"&"+$.param(i)},t}();e.SupervisorOverview=t}(e.Supervisor||(e.Supervisor={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function n(e){this.context=e,t.personProfileSiteInstance=this,this.enableTwoFactorCheckboxOnlyForAdmins()}return n.prototype.checkEsafetyChanged=function(){if(t.personProfileSiteInstance.context.Settings.IsInstantMessageSystemEnabled&&t.personProfileSiteInstance.context.Settings.IsEditMode){this.rolesUnchecked=[],CCL.CommonFunctions.checkAndAddRole(t.personProfileSiteInstance.context.Settings.EsafetyStaffChecked,t.personProfileSiteInstance.context.Controls.StaffCheckboxClientId,t.personProfileSiteInstance.context.LanguageTerms.Staff,this.rolesUnchecked),CCL.CommonFunctions.checkAndAddRole(t.personProfileSiteInstance.context.Settings.EsafetyStudentChecked,t.personProfileSiteInstance.context.Controls.StudentCheckboxClientId,t.personProfileSiteInstance.context.LanguageTerms.Student,this.rolesUnchecked),CCL.CommonFunctions.checkAndAddRole(t.personProfileSiteInstance.context.Settings.EsafetyGuestChecked,t.personProfileSiteInstance.context.Controls.GuestCheckboxClientId,t.personProfileSiteInstance.context.LanguageTerms.Guest,this.rolesUnchecked);var n=e.Administration.PersonProfile.privacyChangedDialogManagerInstance;return!(n&&this.rolesUnchecked.length>0)||(n.openDialog({submitFormMethod:this.context.Settings.SumbitFormMethodString},{personProfileId:t.personProfileSiteInstance.context.Settings.ProfileId,rolesUnchecked:this.rolesUnchecked}),!1)}},n.prototype.showConfirmEsafetyChanges=function(n,i,s){var o=t.personProfileSiteInstance.context.Settings.ProfileName,r="";$("#"+t.personProfileSiteInstance.context.Controls.InitiateCommunicationCheckBoxClientId).is(":checked")&&(r="\n"+t.personProfileSiteInstance.context.LanguageTerms.AdditionEsafetyText);var a="";switch(this.rolesUnchecked.length){case 1:a=CCL.CommonFunctions.formatString(t.personProfileSiteInstance.context.LanguageTerms.UncheckedOneEsafetyRoleText,o,this.rolesUnchecked[0]);break;case 2:a=CCL.CommonFunctions.formatString(t.personProfileSiteInstance.context.LanguageTerms.UncheckedTwoEsafetyRolesText,o,this.rolesUnchecked[0],this.rolesUnchecked[1]);break;case 3:a=CCL.CommonFunctions.formatString(t.personProfileSiteInstance.context.LanguageTerms.UncheckedThreeEsafetyRolesText,o)}var l="";return s===e.Administration.PersonProfile.PrivacyChangedDialogActionType.MakeReadOnly&&(l=(l=i?CCL.CommonFunctions.formatString(t.personProfileSiteInstance.context.LanguageTerms.MarkCurrentConversationsIncludingGroupAsReadOnlyText,o,n.join(", ")):CCL.CommonFunctions.formatString(t.personProfileSiteInstance.context.LanguageTerms.MarkCurrentConversationsAsReadOnlyText,o,n.join(", ")))+"\n"+t.personProfileSiteInstance.context.LanguageTerms.ClosingCouldTakeSomeTime),confirm(a+" "+l+" "+r)},n.prototype.onHierarchyRoleChange=function(){this.enableTwoFactorCheckboxOnlyForAdmins()},n.prototype.enableTwoFactorCheckboxOnlyForAdmins=function(){var e=document.getElementById(this.context.Controls.TwoFactorCheckboxClientId),t=document.getElementById(this.context.Controls.HierarchyRoleDropDownClientId);e&&t&&(!this.context.Settings.IsProfileOfSystemAdmin&&t.value===this.context.Settings.HierarchyRoleAdministratorValue?e.disabled=!1:(this.context.Settings.IsProfileOfSystemAdmin||(e.checked=!1),e.disabled=!0))},n}();t.PersonProfileSite=n}(e.WebComponents||(e.WebComponents={}))}(ItslearningWeb||(ItslearningWeb={})),function(ItslearningWeb){var Controls;(function(Controls){var AssessmentScaleControl=function(){function AssessmentScaleControl(e,t){var n=this;this.onAssessmentChanged=function(e){var t=n.$assessmentItemDropDown.find("option:selected").val(),i=t===n.settings.Constants.UseScoreItemValue;n.settings.EventNames.ToggleCriteriaWeightVisibility&&$(document).trigger(n.settings.EventNames.ToggleCriteriaWeightVisibility,{show:t!==n.settings.Constants.DoNotUseAssessmentItemValue}),0===n.$assessmentItemDropDown.length&&(i=n.settings.Permissions.IsScoreUsed),n.$maxScoreFloatingSection.toggle(i),n.onMaxScoreStateChanged(),n.settings.Permissions.UseGradeBook&&n.toggleTermAndCategoryPanel(),void 0!==n.onChangeHandler&&void 0!==e&&n.onChangeHandler(e)},window[e]=this,this.settings=t,$(function(){n.$addToGradeBookCheck=$("#"+n.settings.Controls.AddToGradeBookCheckbox),n.$assessmentItemDropDown=$("#"+n.settings.Controls.AssessmentItemDropDown),n.$maxScoreFloatingSection=$("#"+n.settings.Controls.MaxScoreFloatingSection),n.$assessmentSection=$("#"+n.settings.Controls.AssessmentSection),n.$maxScoreTextBox=$("#"+n.settings.Controls.MaxScoreTextBox),n.$addToGradeBookCheckWithLabel=n.$addToGradeBookCheck.add(n.$addToGradeBookCheck.next()),n.$categoryDropDown=$("#"+n.settings.Controls.CategoryDropDown),n.$termDropDown=$("#"+n.settings.Controls.TermDropDown),n.onAssessmentChanged(void 0),n.$assessmentItemDropDown.change(n.onAssessmentChanged),n.$maxScoreTextBox&&(n.$maxScoreTextBox.on("blur input",function(){return n.onMaxScoreStateChanged()}),n.$maxScoreTextBox.keydown(function(e){var t=[CCL.CommonConstants.keyCodes.del,CCL.CommonConstants.keyCodes.backspace,CCL.CommonConstants.keyCodes.tab,CCL.CommonConstants.keyCodes.escape,CCL.CommonConstants.keyCodes.enter,CCL.CommonConstants.keyCodes.decimalPoint,CCL.CommonConstants.keyCodes.comma,CCL.CommonConstants.keyCodes.period];-1!==$.inArray(e.which,t)||e.which===CCL.CommonConstants.keyCodes.keyA&&(e.ctrlKey||e.metaKey)||e.which>=CCL.CommonConstants.keyCodes.end&&e.which<=CCL.CommonConstants.keyCodes.arrowDown||(e.shiftKey||e.which<CCL.CommonConstants.keyCodes.key0||e.which>CCL.CommonConstants.keyCodes.key9)&&(e.which<CCL.CommonConstants.keyCodes.numpad0||e.which>CCL.CommonConstants.keyCodes.numpad9)&&e.preventDefault()})),n.settings.Permissions.UseGradeBook&&n.toggleTermAndCategoryPanel()})}return AssessmentScaleControl.prototype.canUseAutoMaxScore=function(){return this.settings.Permissions.CanUseAutoMaxScore},AssessmentScaleControl.prototype.useAssessment=function(){return this.$assessmentItemDropDown.find("option:selected").val()!==this.settings.Constants.DoNotUseAssessmentItemValue},AssessmentScaleControl.prototype.isValid=function(){return!(this.$assessmentItemDropDown.find("option:selected").val()===this.settings.Constants.UseScoreItemValue)||!this.$maxScoreTextBox||this.validateScore(this.$maxScoreTextBox.val())},AssessmentScaleControl.prototype.validateScore=function(e){if(""===e)return!1;var t=parseFloat(e.replace(this.settings.NumberDecimalSeparator,"."));return!(isNaN(t)||t<this.settings.MaxScoreMinValue||t>this.settings.MaxScoreMaxValue)},AssessmentScaleControl.prototype.onChange=function(e){this.onChangeHandler=e},AssessmentScaleControl.prototype.onMaxScoreStateChanged=function(){this.settings.EventNames.MandatoryFieldsStateChangedClient&&$(document).trigger(this.settings.EventNames.MandatoryFieldsStateChangedClient)},AssessmentScaleControl.prototype.getState=function(){var e={};return e.AssessmentScaleId=parseInt(this.$assessmentItemDropDown.find("option:selected").val()),e.IsScore=e.AssessmentScaleId===parseInt(this.settings.Constants.UseScoreItemValue,10),e.MaxScore=parseInt(this.$maxScoreTextBox.val()),e.AddToGradeBook=this.$addToGradeBookCheck.is(":checked"),this.$categoryDropDown&&(e.CategoryId=parseInt(this.$categoryDropDown.val())),this.$termDropDown&&(e.TermId=parseInt(this.$termDropDown.val())),e},AssessmentScaleControl.prototype.toggleTermAndCategoryPanel=function(){var dropDownValue=this.$assessmentItemDropDown.find("option:selected").val(),checkboxEnabled=dropDownValue!==this.settings.Constants.DoNotUseAssessmentItemValue;checkboxEnabled&&this.$addToGradeBookCheck.is(":visible")||(this.$addToGradeBookCheckWithLabel.toggle(checkboxEnabled),this.$addToGradeBookCheck.prop("checked",checkboxEnabled),eval(this.settings.ToggleTermAndCategoryPanelClientFunctionName+"("+checkboxEnabled+")"))},AssessmentScaleControl}();Controls.AssessmentScaleControl=AssessmentScaleControl})(Controls=ItslearningWeb.Controls||(ItslearningWeb.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t,n){this.utility=e,this.inputSelector=t,this.errorSelector=n,this.input=this.utility.controls.Dialog.find(t),this.error=this.utility.controls.Dialog.find(n),this.instance=this.utility.getClientInstance(this.input.prop("id"))}return Object.defineProperty(e.prototype,"date",{get:function(){return this.instance.getDate()},set:function(e){this.instance.setDate(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateAsQueryStringParameter",{get:function(){return this.instance.getDateAsQueryStringParameter()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDateValid",{get:function(){return this.instance.isDateValid()},enumerable:!0,configurable:!0}),e.prototype.showError=function(e){void 0===e&&(e=void 0),this.input.addClass(this.utility.settings.CssClasses.DatePickerErrorState),e&&this.error.show().text(e)},e.prototype.hideError=function(){this.input.removeClass(this.utility.settings.CssClasses.DatePickerErrorState),this.error.hide()},e}();e.DatePickerWrapper=t}(e.PrintSettingsDialog||(e.PrintSettingsDialog={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function t(e,t){this.controls=e,this.settings=t,this.dataSelectors={courseTitleContainer:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.CourseTitleContainer),courseDropdown:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.CourseDropdown),dateFrom:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.DateFrom),dateTo:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.DateTo),dateFromError:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.DateFromError),dateToError:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.DateToError),dateRangeError:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.DateRangeError),okButton:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.OkButton)}}return Object.defineProperty(t.prototype,"dialog",{get:function(){return this.getClientInstance(this.controls.Dialog.prop("id"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"datePickerFrom",{get:function(){return new e.DatePickerWrapper(this,this.dataSelectors.dateFrom,this.dataSelectors.dateFromError)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"datePickerTo",{get:function(){return new e.DatePickerWrapper(this,this.dataSelectors.dateTo,this.dataSelectors.dateToError)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dateRangeError",{get:function(){return this.controls.Dialog.find(this.dataSelectors.dateRangeError)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"okButton",{get:function(){return this.controls.Dialog.find(this.dataSelectors.okButton)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"courseTitleContainer",{get:function(){return this.controls.Dialog.find(this.dataSelectors.courseTitleContainer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"courseDropdown",{get:function(){return this.controls.Dialog.find(this.dataSelectors.courseDropdown)},enumerable:!0,configurable:!0}),t.prototype.getClientInstance=function(e){return window[e]},t}();e.CalendarPrintUtility=t}(e.PrintSettingsDialog||(e.PrintSettingsDialog={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(t){var n=e.Controls.MultipleCourseSearchSelector.MultipleCourseSearchSelector,i=function(){function e(e,i){var s=this;this.controls=e,this.maxUrlLengthChars=2e3,this.okButtonClickHandler=function(e){if(!s.isInputValid())return e.preventDefault(),!1;s.updatePrintUrl(),CssModal.closeDialog()},this.updatePrintUrl=function(){s.utility.settings.IsPossibleToChooseCourse&&(s.currentCourseId=Number(s.utility.courseDropdown.val())),s.utility.settings.EnableMultipleCourseSelection&&s.multipleCourseSelector.updateSelectedCourses();var e=s.utility.settings.EnableMultipleCourseSelection?s.multipleCourseSelector.selectedCourses.map(function(e){return e.CourseId}):[s.currentCourseId],t=s.makeCalendarPrintUrl({CourseIds:e.join(","),EventId:0,StartDate:s.utility.datePickerFrom.dateAsQueryStringParameter,EndDate:s.utility.datePickerTo.dateAsQueryStringParameter,IsPrintFromAdminPage:!s.utility.settings.IsPossibleToChooseCourse});s.isUrlValid(t,e.length)?s.utility.okButton.prop("href",t):s.utility.settings.EnableMultipleCourseSelection&&s.multipleCourseSelector.setMaxItems(e.length-1)},this.utility=new t.CalendarPrintUtility(e,i),t.manager=this,i.EnableMultipleCourseSelection?(i.MultipleCourseSelectorSettings.OnItemAddCallback=this.updatePrintUrl,i.MultipleCourseSelectorSettings.OnItemRemoveCallback=this.updatePrintUrl,this.multipleCourseSelector=new n(e.MultipleCourseSelectorControls,i.MultipleCourseSelectorSettings)):this.utility.okButton.click(this.okButtonClickHandler)}return e.prototype.openPrintSettingsDialog=function(e,t,n){this.hideErrors(),this.currentCourseId=e,this.utility.datePickerFrom.date=CCL.SerializableDateTimeConverter.toDate(this.utility.settings.DefaultDateFrom),this.utility.datePickerTo.date=CCL.SerializableDateTimeConverter.toDate(this.utility.settings.DefaultDateTo),this.utility.courseTitleContainer.html(t),n&&this.utility.settings.EnableMultipleCourseSelection?(this.multipleCourseSelector.setCoursesToSelectFrom(n),this.multipleCourseSelector.openDialog([n.filter(function(t){return t.CourseId===e})[0]],this.okButtonClickHandler,!1)):this.utility.dialog.openDialog(!1)},e.prototype.makeCalendarPrintUrl=function(e){return this.utility.settings.Urls.GetCalendarPrintoutMarkup+"?"+$.param(e)},e.prototype.isInputValid=function(){this.hideErrors();var e=!0;return this.utility.datePickerFrom.isDateValid||(this.utility.datePickerFrom.showError(this.utility.settings.Terms.InvalidDateFrom),e=!1),this.utility.datePickerTo.isDateValid||(this.utility.datePickerTo.showError(this.utility.settings.Terms.InvalidDateTo),e=!1),e&&this.utility.datePickerFrom.date>this.utility.datePickerTo.date&&(this.utility.datePickerFrom.showError(),this.utility.datePickerTo.showError(),this.utility.dateRangeError.show().text(this.utility.settings.Terms.InvalidDateRange),e=!1),this.utility.settings.EnableMultipleCourseSelection&&!this.multipleCourseSelector.selectedCourses.length&&(this.multipleCourseSelector.toggleError(!0),this.controls.MultipleCourseSelectorControls.ErrorLabel.style.display="",this.controls.MultipleCourseSelectorControls.ErrorLabel.textContent=this.utility.settings.Terms.SelectAtLeastOneCourse,e=!1),e},e.prototype.isUrlValid=function(e,t){return!this.utility.settings.EnableMultipleCourseSelection||(e.length>this.maxUrlLengthChars?(this.controls.MultipleCourseSelectorControls.ErrorLabel.style.display="",this.controls.MultipleCourseSelectorControls.ErrorLabel.textContent=CCL.CommonFunctions.formatString(this.utility.settings.Terms.YouCanSelectOnlyXCourses,t-1),!1):(this.multipleCourseSelector.toggleError(!1),this.controls.MultipleCourseSelectorControls.ErrorLabel.style.display="none",!0))},e.prototype.hideErrors=function(){this.utility.datePickerFrom.hideError(),this.utility.datePickerTo.hideError(),this.utility.dateRangeError.hide(),this.utility.settings.EnableMultipleCourseSelection&&(this.multipleCourseSelector.toggleError(!1),this.controls.MultipleCourseSelectorControls.ErrorLabel.style.display="none")},e}();t.DialogManager=i}(t.PrintSettingsDialog||(t.PrintSettingsDialog={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(e){function t(t,n){e.call(this,n),this.urls=t}return __extends(t,e),t.prototype.getElementListMarkupByIds=function(e){return $.ajax({type:"POST",url:this.urls.GetElementListByIds,data:JSON.stringify(e),dataType:"html",contentType:"application/json; charset=utf-8"})},t}(e.CommonAjaxClient);t.ElementPickerAjaxClient=n}(e.CustomActivityElementPicker||(e.CustomActivityElementPicker={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e){var t=this;this.cssClasses=e,$("."+this.cssClasses.SelectedElementList).on("mouseenter","li",function(e){var n=$(e.currentTarget).find("."+t.cssClasses.ElementTitle).get(0),i=$(n).closest("a"),s=n.offsetWidth;CCL.CommonFunctions.isChrome()&&!CCL.CommonFunctions.isEdge()||s++,i.prop("title",s<n.scrollWidth?n.textContent.trim():"")})};e.CustomActivityOverview=t}(e.CustomActivityOverview||(e.CustomActivityOverview={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){this.settings=t,window[e]=this,this.$allowEveryoneCheckbox=$("."+t.AllowEveryoneCheckboxCss).find("input:checkbox"),this.$disableCommentsCheckbox=$("."+t.DisableCommentsCheckboxCss).find("input:checkbox"),this.editBulletinSettingsDialog=window[this.settings.EditBulletinsSettingsDialogClientId]}return e.prototype.showEditBulletinSettings=function(){var e=this;this.editBulletinSettingsDialog.show().then(function(t){if(t===CCL.ConfirmDialogResult.Confirm){var n={AllowEveryoneSetting:e.$allowEveryoneCheckbox.is(":checked")};e.$disableCommentsCheckbox&&e.$disableCommentsCheckbox.length&&(n.DisableCommentsSetting=e.$disableCommentsCheckbox.is(":checked")),$.ajax({type:"POST",url:e.settings.UpdateCourseBulletinSettingsUrl,contentType:"application/json; charset=utf-8",data:JSON.stringify({courseId:e.settings.CourseId,settings:n})}).fail(function(){jAlert(e.settings.ErrorMessage)}).done(function(){window.location.reload()})}else e.$allowEveryoneCheckbox.prop("checked",e.settings.AllowAllUsersPostBulletinsCourseSetting),e.$disableCommentsCheckbox&&e.$disableCommentsCheckbox.length&&e.$disableCommentsCheckbox.prop("checked",e.settings.DisableLightBulletinCommentsCourseSetting)}),$("#"+this.settings.EditBulletinsSettingsDialogClientId).find(":focusable").first().focus()},e}();e.Bulletins=t}(e.Widgets||(e.Widgets={}))}(e.Dashboard||(e.Dashboard={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t,n,i,s,o){var r=this;this.$itemSelector=e,this.$filterMenu=t,this.idDataAttribute=n,this.selectAllItemId=i,this.optionCheckboxPrefix=s,this.languageTerms=o,this.handleItemSelection=function(e){var t=e.closest("[data-"+r.idDataAttribute+"]").data(r.idDataAttribute),n=e.is(":checked"),i=t===r.selectAllItemId,s=r.$filterMenu.find("[data-"+r.idDataAttribute+"]");if(i)s.each(function(e,t){var i=$(t).data(r.idDataAttribute);r.getOptionCheckBox(i).prop("checked",n)});else{r.getOptionCheckBox(t).prop("checked",n);var o=null,a=!0;s.each(function(e,t){var n=$(t).data(r.idDataAttribute);if(n!==r.selectAllItemId){var i=r.getOptionCheckBox(n).is(":checked");if(null==o&&(o=i),i!==o)return a=!1,!1}return!0}),r.toggleAllOptionCheckBox(a,!1,o)}r.setDefaultItemText()},this.hasItems=function(){return r.$filterMenu.find("[data-"+r.idDataAttribute+"]").length>0},this.getSelectedItems=function(){var e=r.$filterMenu.find("[data-"+r.idDataAttribute+"]"),t=new Array;return e.each(function(e,n){var i=$(n).data(r.idDataAttribute);r.getOptionCheckBox(i).is(":checked")&&i!==r.selectAllItemId&&t.push(i)}),t},this.areAllItemsSelected=function(){return null!=r.allOptionCheckBox&&r.allOptionCheckBox.is(":checked")},this.areNoneItemsSelected=function(){return 0===r.getSelectedItems().length},this.setDefaultItemText=function(){var e;if(r.areAllItemsSelected())e=r.languageTerms.All+" "+r.languageTerms.Items.toLowerCase();else if(r.areNoneItemsSelected())e=r.languageTerms.SelectItem;else{var t=r.getSelectedItems();if(t.length>1)e=r.getSelectedItems().length+" "+r.languageTerms.Items.toLowerCase();else e=r.$filterMenu.find("[data-"+r.idDataAttribute+'="'+t[0]+'"]').find("label").text()}r.$itemSelector.text(CCL.CommonFunctions.htmlEncode(e))},this.getOptionCheckBox=function(e){return $("#"+r.optionCheckboxPrefix+e)},this.toggleAllOptionCheckBox=function(e,t,n){e?t||r.allOptionCheckBox.prop("checked",n):r.allOptionCheckBox.prop("checked",!1)},this.setDefaultItemText()}return Object.defineProperty(e.prototype,"allOptionCheckBox",{get:function(){return this.getOptionCheckBox(this.selectAllItemId)},enumerable:!0,configurable:!0}),e}(),n=function(){function e(n,i,s){var o=this;this.settings=i,this.controls=s,this.selectedItemIds=[],this.onItemClickHandler=function(t){o.itemMultiSelectorManager.handleItemSelection($(t.target)),o.selectedItemIds=o.itemMultiSelectorManager.areAllItemsSelected()||o.itemMultiSelectorManager.areNoneItemsSelected()?[]:o.itemMultiSelectorManager.getSelectedItems(),o.controls.ItemMultiSelector.trigger(e.itemMultiSelectorOnChangeEventName,o)},this.initPerfectScrollbar=function(){o.controls.MenuContainer.perfectScrollbar({suppressScrollX:!0});var e=new CCL.CallbackDebouncer(function(){o.controls.MenuContainer.perfectScrollbar("update")});$(window).on("resize",function(){e.invokeCallback(null,100)})},window[n]=this,this.itemMultiSelectorManager=new t(this.controls.ItemMultiSelector,this.controls.MenuContainer,this.settings.DataAttributes.ItemId,this.settings.SelectAllItemId,this.settings.OptionCheckboxPrefix,this.settings.LanguageTerms),this.initPerfectScrollbar(),this.controls.ItemMultiSelector.parent().on("focusin",function(){o.controls.ItemMultiSelector.addClass(o.settings.CssClasses.MenuIsActive)}),this.controls.ItemMultiSelector.parent().on("focusout",function(){o.controls.ItemMultiSelector.removeClass(o.settings.CssClasses.MenuIsActive)}),this.controls.ItemMultiSelector.on("keyup",function(e){e.which===CCL.CommonConstants.keyCodes.enter&&o.controls.ItemMultiSelector.trigger("click")}),this.controls.MenuContainer.on("change",this.onItemClickHandler)}return Object.defineProperty(e.prototype,"hasItems",{get:function(){return this.itemMultiSelectorManager.hasItems()},enumerable:!0,configurable:!0}),e.itemMultiSelectorOnChangeEventName="itemMultiSelector:onchange",e}();e.ItemMultiSelector=n}(e.ItemMultiSelector||(e.ItemMultiSelector={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e){var t=this;this.settings=e,this.onItemClickHandler=function(e){t.$checkbox.prop("checked",!t.$checkbox.is(":checked")).change(),e.stopPropagation()},this.$checkbox=$("#"+this.settings.OptionCheckboxClientId);var n=$("#"+e.ClientId);n.on(CCL.CommonFunctions.isMobileDevice()?"touchstart":"click",this.onItemClickHandler),n.on("keyup",function(e){e.which===CCL.CommonConstants.keyCodes.enter&&t.onItemClickHandler(e)})};e.Item=t}(e.ItemMultiSelector||(e.ItemMultiSelector={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){var t=function(){this.registerSafeImgBinding=function(){ko.bindingHandlers.safeImg={init:function(e,t){var n=ko.utils.unwrapObservable(t()),i=ko.utils.unwrapObservable(n.src),s=ko.utils.unwrapObservable(n.fallback);$(e).prop("src",i||s)},update:function(e,t){var n=ko.utils.unwrapObservable(t()),i=ko.utils.unwrapObservable(n.src),s=ko.utils.unwrapObservable(n.fallback);$(e).prop("src",i||s)}}},this.registerPerfectScrollBarBinding=function(){ko.bindingHandlers.perfectlyScrollable={init:function(e,t,n,i,s){var o=ko.unwrap(t())||{minScrollbarLength:10},r=$(e);r.perfectScrollbar(o);var a=new CCL.CallbackDebouncer(function(){r.perfectScrollbar("update")}),l=function(){a.invokeCallback(null,100)};$(window).on("resize",l),ko.utils.domNodeDisposal.addDisposeCallback(e,function(){r.perfectScrollbar("destroy"),$(window).off("resize",l)})}}}};e.KnockoutCustomBindingsManager=t}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){this.clientFunctions={},window[e]=this,this.settings=t,this.terms=t.Terms,this.cssClasses=t.CssClasses,this.clientFunctions.DeleteCurrentPostback=new Function(t.ClientFunctions.DeleteCurrentPostback),this.clientFunctions.DeleteSelectedPostback=new Function(t.ClientFunctions.DeleteSelectedPostback),this.clientFunctions.PublishAllPostback=new Function(t.ClientFunctions.PublishAllPostback),this.clientFunctions.UnpublishAllPostback=new Function(t.ClientFunctions.UnpublishAllPostback),this.clientFunctions.UnpublishCurrentPostback=new Function(t.ClientFunctions.UnpublishCurrentPostback),this.clientFunctions.UnpublishSelectedPostback=new Function(t.ClientFunctions.UnpublishSelectedPostback),this.grid=window[t.Controls.GridClientInstanceName]}return e.prototype.publishAll=function(){var e=this;CCL.CommonFunctions.jAjaxConfirm(this.terms.PublishAllConfirmation,this.terms.PleaseConfirm,this.terms.Yes,this.terms.No,function(t){t&&e.clientFunctions.PublishAllPostback()})},e.prototype.unpublishAll=function(){var e=this;CCL.CommonFunctions.jAjaxConfirm(this.terms.UnpublishAllConfirmation,this.terms.PleaseConfirm,this.terms.Yes,this.terms.No,function(t){t&&e.clientFunctions.UnpublishAllPostback()})},e.prototype.deleteCurrentLearningObjective=function(){this.deleteConfirmation(this.settings.IsCurrentSubjectPublished,this.clientFunctions.DeleteCurrentPostback,this.clientFunctions.UnpublishCurrentPostback)},e.prototype.deleteSelectedLearningObjectives=function(){var e=this.grid.getSelectedValues();if(0!==e.length){for(var t=!1,n=0;n<e.length;n++)if(this.grid.getRow(e[n]).find("."+this.cssClasses.Published).length>0){t=!0;break}this.deleteConfirmation(t,this.clientFunctions.DeleteSelectedPostback,this.clientFunctions.UnpublishSelectedPostback)}else CCL.CommonFunctions.jAlertAjaxError(this.terms.PleaseMakeSelection,this.terms.Alert,this.terms.Ok,!1)},e.prototype.deleteConfirmation=function(e,t,n){var i=this;CCL.CommonFunctions.jAjaxConfirm(this.terms.FirstDeleteConfirmation,this.terms.PleaseConfirm,this.terms.Ok,this.terms.Cancel,function(s){s&&(e?i.deleteConfirmationFromPublishedSubject(t,n):t())})},e.prototype.deleteConfirmationFromPublishedSubject=function(e,t){var n="confirm_unpublish",i="confirm_delete",s="confirm_cancel",o=new Array;o.push(new CCL.ConfirmButtonMetaData(this.terms.Unpublish,"",n)),o.push(new CCL.ConfirmButtonMetaData(this.terms.Delete,this.cssClasses.DeleteButton,i)),o.push(new CCL.ConfirmButtonMetaData(this.terms.Cancel,"",s));var r="<p>"+this.terms.DeleteConfirmationFromPublishedSubjectBody+"</p><p>"+this.terms.DeleteConfirmationFromPublishedSubjectFooter+"</p>";CCL.CommonFunctions.jAjaxMultiButtonConfirm(r,this.terms.AreYouSure,o,function(o){o&&o.customId&&o.customId!==s&&(o.customId===i?e():o.customId===n&&t())})},e}();e.LearningObjectiveOverview=t}(e.LearningObjectiveRepository||(e.LearningObjectiveRepository={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(){}return e.convertElementIdsToElementStateMapping=function(e,t){var n=new Map;return e.forEach(function(e){n.set(e,t)}),n},e}();e.LearningObjectiveRepositoryHelper=t}(e.LearningObjectiveRepository||(e.LearningObjectiveRepository={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(n){var i=this;this.settings=n,this.openDialog=function(){var n=JSON.parse(i.$subjectHiddenField.val()),s=[];n.forEach(function(e){s.push(e.Id)});var o={elementStates:t.LearningObjectiveRepositoryHelper.convertElementIdsToElementStateMapping(s,e.CheckboxStateMachine.State.AttachedByUser),disabledElementIds:[],showAll:!0,header:i.settings.HeaderText,elementType:e.ElementLinkDialog.ContentElementType.LearningObjectives,allowFolderSelection:!0,openerPage:e.ElementLinkDialog.ElementsPopupOpener.None,allowEmptySubmit:!0,afterOkClickCallback:function(t){var n=[];t.forEach(function(t,i){t!==e.CheckboxStateMachine.State.Empty&&n.push(i)}),i.updateUiWithNewElements(n)}},r={countryCode:i.settings.CountryCode};i.elementLinkDialogManagerInstance.openDialog(o,r)},this.createTagItInput=function(){var e=i.$aliasesContainer;CCL.TagItInput.createTagItInput(e,{isReadonly:!1,placeholderText:i.settings.AliasesPlaceholderText,tagitLimit:255})},this.updateSubjectsInUi=function(){var e=JSON.parse(i.$subjectHiddenField.val());i.$subjectContainer.html(""),e.forEach(function(e){var t=$("<div/>").addClass(i.settings.CssClasses.LearningObjectiveContainerCssClass),n=$("<img/>").addClass(i.settings.CssClasses.LearningObjectiveIconCssClass),s=$("<span/>").addClass(i.settings.CssClasses.LearningObjectiveTitleCssClass).text(e.Title),o=$("<span> &times; </span>").addClass(i.settings.CssClasses.LearningObjectiveDeleteCssClass).on("click",function(){i.removeSubject(e.Id)});t.append(n).append(" ").append(s).append(" ").append(o),i.$subjectContainer.append(t).append($("<br/>"))})},this.removeSubject=function(e){var t=-1,n=JSON.parse(i.$subjectHiddenField.val());n.forEach(function(n,i){n.Id===e&&(t=i)}),-1!==t&&(n.splice(t,1),i.$subjectHiddenField.val(JSON.stringify(n)),i.updateSubjectsInUi())},this.updateUiWithNewElements=function(e){$.ajax({type:"GET",url:i.settings.GetLearningObjectiveNamesUrl,data:{learningObjectiveIds:e.join(",")},dataType:"json",xhrFields:{withCredentials:!0}}).done(function(e){i.$subjectHiddenField.val(JSON.stringify(e)),i.updateSubjectsInUi()}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})},this.elementLinkDialogManagerInstance=e.ElementLinkDialog.elementLinkDialogManagerInstance,this.$subjectContainer=$("#"+n.ClientIds.SubjectLabelContainerClientId),this.$subjectHiddenField=$("#"+n.ClientIds.SubjectLabelHiddenFieldClientId),this.$aliasesContainer=$("#"+n.ClientIds.AliasesContainerClientId),this.createTagItInput(),CCL.CommonFunctions.preventSubmitOnEnter($("#"+n.ClientIds.LabelTextboxClientId)),$("#"+n.ClientIds.AddSubjectsButtonClientId).on("click",function(){return i.openDialog(),!1})};t.LearningObjectiveSubjectLabelsManager=n}(e.LearningObjectiveRepository||(e.LearningObjectiveRepository={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(){}return e.getStudentProgressChangedEventChannelName=function(t){return e.studentProgressChangedEvent+t},e.studentProgressChangedEvent="LearningPathSignalRListener:studentProgressChanged",e}();e.LearningPathSignalRListener=t,function(e){e[e.NoProgress=0]="NoProgress",e[e.ResourceViewed=1]="ResourceViewed",e[e.ActivityCompleted=2]="ActivityCompleted",e[e.TeachersActionNeeded=3]="TeachersActionNeeded",e[e.FinishIsReached=4]="FinishIsReached",e[e.AnotherTryNeeded=5]="AnotherTryNeeded"}(e.StudentProgressType||(e.StudentProgressType={}));e.StudentProgressType;var n=function(e,t,n){this.studentProgressType=e,this.learningPathId=t,this.unlockedElementId=n};e.StudentProgressEventData=n}(e.LearningPath||(e.LearningPath={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e){var n=this;this.settings=e,window[t.clientInstanceName]=this,$(function(){n.$elementListContainer=$("#"+n.settings.Controls.ElementListContainerId),n.$frame=$("#"+n.settings.Controls.Frame),n.$loadingIndicator=$("#"+n.settings.Controls.LoadingIndicator),n.$feedback=$("#"+n.settings.Controls.Feedback),n.$elementListContainer.on("click","."+n.settings.Css.ElementTitle,function(e){var t=$(e.currentTarget).closest("."+n.settings.Css.ElementContainer),i=parseInt(t.data(n.settings.DataAttributes.ElementId),10);return n.setCurrentElement(i),!1}),n.setCurrentElement(n.settings.ElementIdToSelect),IframeResizer.reportSetIframeDefaultHeight()})}return t.getInstance=function(){return window[t.clientInstanceName]},t.reloadElementList=function(e){t.getInstance().reloadElementList(e)},t.prototype.setCurrentElement=function(e){if(!e||e!==this.currentElementId){var t,n=!1;e>0?0===(t=this.$elementListContainer.find("."+this.settings.Css.ElementContainer+"[data-element-id="+e+"]")).length&&(t=this.$elementListContainer.find("."+this.settings.Css.ElementContainer).first(),n=!0):(t=this.$elementListContainer.find("."+this.settings.Css.ElementContainer).first(),n=!0);var i=t.find("."+this.settings.Css.ElementTitle).prop("href");$("."+this.settings.Css.ElementContainer).removeClass(this.settings.Css.SelectedElement),t.addClass(this.settings.Css.SelectedElement),this.$elementListContainer.scrollTop(t.offset().top-this.$elementListContainer.offset().top+this.$elementListContainer.scrollTop()),this.setFrameUrl(i),this.currentElementId=n?0:e}},t.prototype.setFrameUrl=function(e){e?(this.$frame.prop("src",e),this.$loadingIndicator.hide()):(this.$frame.contents().find("html").html(""),this.$loadingIndicator.show())},t.prototype.getElementLinkTitle=function(e){return this.$elementListContainer.find(""+CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.ElementId,e)).find("."+this.settings.Css.ElementTitle)},t.prototype.reloadElementList=function(e){var t=this;$.get(this.settings.Urls.StudentViewElementList+"&selectedElementId="+this.currentElementId).done(function(n){t.$elementListContainer.html(n),CCL.InformationFeedback.showFeedbackWithextraButton(t.$feedback,t.getFeedbackMessage(e.studentProgressType),e.unlockedElementId>0?t.settings.Terms.Continue:t.settings.Terms.Ok,function(){e.unlockedElementId>0&&t.setCurrentElement(e.unlockedElementId),CCL.InformationFeedback.hideFeedback(t.$feedback)})})},t.prototype.getFeedbackMessage=function(t){switch(t){case e.StudentProgressType.ActivityCompleted:return this.settings.Terms.NewStepAvailable;case e.StudentProgressType.ResourceViewed:return this.settings.Terms.TakeGoodLookAtThisResource;case e.StudentProgressType.FinishIsReached:return this.settings.Terms.ThatWasIt;case e.StudentProgressType.TeachersActionNeeded:return this.settings.Terms.YouCanContinueAfterTeacherReviewed;case e.StudentProgressType.AnotherTryNeeded:return this.settings.Terms.PleaseGiveItAnotherTry;default:return""}},t.clientInstanceName="StudentViewLearningPathInstance",t}();e.TakeLearningPathDialogContent=t}(e.LearningPath||(e.LearningPath={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(t){var n=this;this.convertId="confirm_convert_to_folder",this.deleteId="confirm_delete",this.cancelId="confirm_cancel",window[e.clientInstanceName]=this,this.settings=t,$(function(){$("."+n.settings.Css.DeleteLink).click(function(){$.ajax({url:n.settings.Urls.GetConfirmationModelForElementsDeleting,data:{elementIds:n.settings.LearningPathId},dataType:"json"}).done(function(e){var t=new Array,i=0===$("."+n.settings.Css.StepElementTitle).length,s=i?n.settings.Terms.EmptyLearningPathDeleteConfirmation:n.settings.Terms.LearningPathDeleteConfirmation;t.push(new CCL.ConfirmButtonMetaData(n.settings.Terms.Delete,n.settings.Css.RedButton,n.deleteId)),i||t.push(new CCL.ConfirmButtonMetaData(n.settings.Terms.MakeNormalFolder,n.settings.Css.ConfirmConvertButton,n.convertId)),t.push(new CCL.ConfirmButtonMetaData(n.settings.Terms.Cancel,"",n.cancelId)),e&&e.HasTreeLinks&&(s=e.TreeLinksDeleteConfirmationMessage+" "+s),n.showDeleteConvertConfirmDialog(s,t)})}),$("."+n.settings.Css.ConvertToFolderLink).click(function(){var e=new Array;e.push(new CCL.ConfirmButtonMetaData(n.settings.Terms.Ok,n.settings.Css.BlueButton,n.convertId)),e.push(new CCL.ConfirmButtonMetaData(n.settings.Terms.Cancel,"",n.cancelId)),n.showDeleteConvertConfirmDialog(n.settings.Terms.AreYouSure,e)})})}return e.prototype.showDeleteConvertConfirmDialog=function(e,t){var n=this;CCL.CommonFunctions.jAjaxMultiButtonConfirm("",e,t,function(e){if(e&&e.customId)switch(e.customId){case n.deleteId:n.deleteLearningPath();break;case n.convertId:n.convertLearningPathToFolder();case n.cancelId:}})},e.prototype.showError=function(e,t){void 0===t&&(t=!1),CCL.CommonFunctions.jAlertAjaxError(e,this.settings.Terms.ErrorOccured,this.settings.Terms.Ok,t)},e.prototype.convertLearningPathToFolder=function(){var e=this,t={LearningPathId:this.settings.LearningPathId};$.ajax({url:this.settings.Urls.ConvertToFolder.Action,type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(t)}).done(function(t){t.Success?e.settings.UseSimpleMenu?itslTop.location.href=e.settings.Urls.ConvertToFolder.RedirectAfterSucceed:window.location.href=e.settings.Urls.ConvertToFolder.RedirectAfterSucceed:e.showError(t.ErrorMessage)}).fail(function(){return e.showError(e.settings.Terms.LearningPathGeneralErrorMessage)})},e.prototype.deleteLearningPath=function(){var e=this,t={LearningPathId:this.settings.LearningPathId};$.ajax({url:this.settings.Urls.Delete.Action,type:"DELETE",dataType:"json",contentType:"application/json",data:JSON.stringify(t)}).done(function(t){t.Success?e.settings.IsNewResourceNavigationEnabled?itslTop.location.href=e.settings.Urls.Delete.RedirectAfterSucceed:window.location.href=e.settings.Urls.Delete.RedirectAfterSucceed:e.showError(t.ErrorMessage)}).fail(function(){return e.showError(e.settings.Terms.LearningPathGeneralErrorMessage)})},e.prototype.executeScript=function(e){new Function(e)()},e.clientInstanceName="LearningPathCommonEditActionsInstance",e}();e.LearningPathCommonEditActions=t}(e.LearningPath||(e.LearningPath={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){var t=function(){function e(){}return e.prototype.parseParams=function(e){var t,n={},i=/([^&=]+)=([^&]*)/g;for(e=e.replace(/\+/g,"%20");t=i.exec(e);)n[decodeURIComponent(t[1]).toLowerCase()]=decodeURIComponent(t[2]);return n},e.prototype.parseUrlQueryString=function(){return this.parseParams(window.location.search.substring(1))},e.prototype.parseUrlFragmentString=function(){return this.parseParams(window.location.hash.substring(1))},e}();e.UrlParamParser=t}(Helpers||(Helpers={})),function(e){!function(e){var t=function(){function t(n){var i=this;window[t.clientInstanceName]=this,this.settings=n,$(function(){if(i.settings.IsPlanner2||CCL.CommonFunctions.isSafari()){var t=(new Helpers.UrlParamParser).parseUrlQueryString();if(t.launch_url){i.dialog=CCL.FullScreenDialog.getInstance();var n=decodeURIComponent(t.launch_url);i.dialog.openDialog(n)}$("#"+i.settings.Controls.OpenDialogLink).click(function(e){var n=$(e.currentTarget).prop("href");if(t.launch_url||"None"===t.openerpage)i.dialog.openDialog(n);else{var s=encodeURIComponent(n);window.open(window.location.href+"&launch_url="+s+(i.settings.IsPlanner2?"&"+i.settings.IsPlanner2RequestItem+"=true":""),"_blank")}return!1})}else $("#"+i.settings.Controls.OpenDialogLink).click(function(e){var t=$(e.currentTarget).prop("href");return i.dialog.openDialog(t),!1});i.dialog=CCL.FullScreenDialog.getInstance(),$(i.dialog).on(CCL.FullScreenDialog.onCloseEvent,function(){clearTimeout(i.timer),window.location.href=i.settings.Urls.ViewLearningPath}),window.addEventListener(e.LearningPathSignalRListener.studentProgressChangedEvent,function(e){var t=e.detail;i.settings.LearningPathId===t.learningPathId&&(i.timer=setTimeout(function(){return i.reloadElementList(t)},i.getTimeout(t)))}),new BroadcastChannel(e.LearningPathSignalRListener.getStudentProgressChangedEventChannelName(i.settings.LearningPathId)).onmessage=function(e){var t=e.data;i.settings.LearningPathId===t.learningPathId&&(i.timer=setTimeout(function(){return i.reloadElementList(t)},i.getTimeout(t)))}})}return t.prototype.reloadElementList=function(t){var n=new BroadcastChannel(this.settings.ElementStatusChangedBroadcastChannelName);n.postMessage({elementId:this.settings.LearningPathId,completed:t.studentProgressType===e.StudentProgressType.FinishIsReached}),n.close(),this.dialog.isOpened()?e.TakeLearningPathDialogContent.reloadElementList(t):window.location.href=this.settings.Urls.ViewLearningPath},t.prototype.getTimeout=function(t){return t.studentProgressType===e.StudentProgressType.ResourceViewed?this.settings.Timeouts.ResourceCompletedInMs:t.studentProgressType===e.StudentProgressType.FinishIsReached?this.settings.Timeouts.FinishIsReachedInMs:this.settings.Timeouts.ActivityCompletedInMs},t.clientInstanceName="TakeLearningPathDialogLauncherInstance",t}();e.TakeLearningPathDialogLauncher=t}(e.LearningPath||(e.LearningPath={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function e(t,n){var i=this;this.dataUrl=t,this.model=n,this.page=0,this.run=function(t){t&&(i.page=t),i.model.lettersLoading(!0);var n={supervisorType:i.model.settings.SupervisorType,termId:i.model.termId(),hierarchyIds:i.model.hierarchyIds(),paging:{pageIndex:i.page,pageSize:e.pageSize},sorting:{sort:i.model.sorting.term,sortDescending:i.model.sorting.descending},search:i.model.lettersSearch()},s=CCL.CommonFunctions.safeAjaxPost({url:i.dataUrl,data:n,dataType:"json"});return s.done(function(e){i.model.addLetters(e),i.page++,i.model.lettersLoading(!1)}),s}}return e.pageSize=50,e}(),i=function(){this.term="FullName",this.descending=!1},s=function(){function t(t,s){var o=this;this.settings=t,this.controls=s,this.addLetters=function(e){[].push.apply(o.allLetters(),e),o.allLetters.valueHasMutated(),o.lettersLoading(!1),o.lettersCount(o.allLetters().length),o.areAllLettersRetreived(!e||0===e.length||e.length<n.pageSize)},this.showCard=function(e){return o.showStudentProfile(e)},this.showLetters=function(e){return o.showStudentProfile(e,"letters")},this.setSorting=function(e,t){var n=$(t.currentTarget).data(o.settings.DataAttributes.SortValue);o.allLetters([]),o.lettersLoading(!0),o.lettersCount(0),n===o.sorting.term?o.sorting.descending=!o.sorting.descending:(o.sorting.term=n,o.sorting.descending=!0),o.fetcher.page=0,o.fetcher.run()},this.showMoreLetters=function(e){$(e.currentTarget).blur(),o.fetchNextLettersPage()},this.getParentLettersOverview=function(e){return e.parentLettersTotalNumber>0?e.lettersOpenedByParentsTotalNumber+"/"+e.parentLettersTotalNumber:"-"},this.getStudentLettersOverview=function(e){return e.studentLettersTotalNumber>0?e.lettersOpenedByStudentTotalNumber+"/"+e.studentLettersTotalNumber:"-"},this.fetchData=function(){o.allLetters([]),o.lettersCount(o.allLetters().length),o.lettersLoading(!0),o.fetcher.page=0,null!=o.fetchDataPromise&&o.fetchDataPromise.readyState!==o.fetchDataPromise.DONE&&o.fetchDataPromise.abort(),o.fetchDataCallbackDebouncer.invokeCallback({},200)},this.onSearchChangeHandler=function(e){var t=$(e.currentTarget).val(),n=(e.which===CCL.CommonConstants.keyCodes.del||e.which===CCL.CommonConstants.keyCodes.backspace)&&t&&""===$.trim(t);(e.which===CCL.CommonConstants.keyCodes.enter||n)&&(o.lettersSearch($(e.currentTarget).val()),o.fetchData(),o.$searchFilter.val(o.lettersSearch()),e.stopPropagation()),CCL.CommonFunctions.isMobileDevice()&&e.which===CCL.CommonConstants.keyCodes.enter&&$(e.currentTarget).blur(),0===$(e.currentTarget).val().length?o.$searchFilterClear.hide():o.$searchFilterClear.show()},this.onSearchClearHandler=function(){o.lettersSearch(""),o.$searchFilter.val(o.lettersSearch()),o.$searchFilterClear.hide(),o.fetchData()},this.fetchNextLettersPage=function(){o.areAllLettersRetreived()||(null!=o.lettersScrollingPromise&&o.lettersScrollingPromise.readyState!==o.lettersScrollingPromise.DONE&&o.lettersScrollingPromise.abort(),o.lettersScrollingTimeout&&clearTimeout(o.lettersScrollingTimeout),o.lettersScrollingTimeout=setTimeout(function(){o.allLetters.valueHasMutated(),o.lettersScrollingPromise=o.fetcher.run()},50))},this.onFetchLettersHandler=function(e){var t=$(e.target).scrollTop();if(t>o.lettersLastScrollTop){var i=$("."+o.settings.CssClasses.StudentsList).children("li"),s=i.eq(i.length-n.pageSize/2);CCL.CommonFunctions.isOnScreen(s,.5,.5)&&o.fetchNextLettersPage()}o.lettersLastScrollTop=t},this.showStudentProfile=function(e,t){document.showProfileCard?t?document.showProfileCard(e.personId,t):document.showProfileCard(e.personId):window.raw_popup(e.fallbackProfileUrl,"","resizable,scrollbars,height=500,width=750")},this.configTermFilter=function(){o.controls.TermFilter.on(e.ItemSelector.ItemSelector.itemSelectorOnChangeEventName,o.onTermFilterItemClickHandler)},this.onTermFilterItemClickHandler=function(e,t){o.measureLettersOverviewPageFilterUsageKpi(),o.termId(t.selectedItemId),o.fetchData()},this.configHierarchyFilter=function(){o.controls.HierarchyFilter.on(e.ItemMultiSelector.ItemMultiSelector.itemMultiSelectorOnChangeEventName,o.onHierarchyFilterItemClickHandler)},this.onHierarchyFilterItemClickHandler=function(e,t){o.measureLettersOverviewPageFilterUsageKpi(),o.hierarchyIds(t.selectedItemIds),o.fetchData()},this.measureLettersOverviewPageFilterUsageKpi=function(){CCL.CommonFunctions.measureKpi(o.settings.WebMethods.MeasureKpi,o.settings.SupervisorKpiSection,o.settings.LettersOverviewPageFilterUsageKpiMeasurement,o.settings.RegularKpiContext)},this.fetchDataCallbackDebouncer=new CCL.CallbackDebouncer(function(){o.fetchDataPromise=o.fetcher.run()}),this.allLetters=ko.observableArray([]),this.lettersInitiated=ko.observable(!1),this.lettersLoading=ko.observable(!0),this.letters=ko.pureComputed(function(){return o.allLetters()}),this.lettersCount=ko.observable(0),this.areAllLettersRetreived=ko.observable(!1),this.lettersSearch=ko.observable(""),this.$searchFilter.keyup(this.onSearchChangeHandler),this.$searchFilterClear.on(CCL.CommonFunctions.isMobileDevice()?"touchstart":"click",this.onSearchClearHandler),this.sorting=new i,this.lettersLastScrollTop=$(window).scrollTop(),$(window).on("scroll touchmove",this.onFetchLettersHandler),this.configTermFilter(),this.configHierarchyFilter(),this.termId=ko.observable(null),this.hierarchyIds=ko.observableArray([]),this.isSearchOrFilteringApplied=ko.pureComputed(function(){return o.lettersSearch().length>0||null!=o.termId()||o.hierarchyIds().length>0});var r=null!=t.AdditionalInformationFieldName&&t.AdditionalInformationFieldName.length>0;this.displayAdditionalInformationColumn=ko.observable(r),this.additionInformationColumnName=ko.observable(r?t.AdditionalInformationFieldName:"");var a=r?5:4;this.columnCssClass=ko.observable("u-1/"+a+"-tiny-up"),this.doubleColumnCssClass=ko.observable("u-2/"+a+"-tiny-up")}return Object.defineProperty(t.prototype,"$searchFilter",{get:function(){return $("."+this.settings.CssClasses.SearchFilter)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$searchFilterClear",{get:function(){return $("."+this.settings.CssClasses.SearchFilterClear)},enumerable:!0,configurable:!0}),t}();t.LettersOverviewViewModel=s;var o=function(){function t(t,i){var o=this;this.settings=t,this.controls=i,this.preventFromDropDownMenuFromClosing=function(e){$(e.target).hasClass("c-supervisor-letters__inner")&&e.stopPropagation()},(new e.KnockoutCustomBindingsManager).registerSafeImgBinding(),this.model=new s(t,i),ko.applyBindings(this.model,$("."+this.settings.CssClasses.Container)[0]),this.$container.on("click",this.preventFromDropDownMenuFromClosing),ko.utils.domNodeDisposal.addDisposeCallback(this.$container[0],function(){o.$container.off("click",o.preventFromDropDownMenuFromClosing)}),this.model.fetcher=new n(this.settings.WebMethods.GetSupervisorLettersOverviews,this.model),this.model.fetcher.run().done(function(){o.model.lettersInitiated(!0)})}return Object.defineProperty(t.prototype,"$container",{get:function(){return $("."+this.settings.CssClasses.Container)},enumerable:!0,configurable:!0}),t}();t.SupervisorLetters=o}(e.Letter||(e.Letter={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(){function t(t,n){var i=this;this.settings=n,window[t]=this,this.settings=n,this.$mainContainer=$("#"+this.settings.Controls.MainContainer),this.$courseGroupSelectorLink=$("#"+this.settings.Controls.GroupSelectorLink),this.$submitIndividuallyLink=$("#"+this.settings.Controls.SubmitIndividuallyLink),this.settingManager=e.Settings.Manager.getInstance(),$(function(){$("#"+i.settings.Controls.DropDownMenuContainer).find("."+i.settings.MenuItemCssClass).click(function(e){var t=$(e.currentTarget).data("groupid");CCL.CommonFunctions.safeAjaxPost({url:i.settings.WebMethods.CreateCollaborationBasedOnCourseGroup.replace("{elementId}",i.settings.ElementId.toString()),data:{groupId:t}}).done(function(e){return i.processResponse(e)}).fail(function(){return i.settingManager.alertError()})}),i.$submitIndividuallyLink.on("click",function(){CCL.CommonFunctions.safeAjaxPost({url:i.settings.WebMethods.UseIndividualSubmission.replace("{elementId}",i.settings.ElementId.toString())}).done(function(e){return i.processResponse(e)}).fail(function(){return i.settingManager.alertError()})})})}return t.prototype.processResponse=function(e){e.Success?window.location.href=window.location.href.split("#")[0]:this.settingManager.alertError(e.Message)},t}();t.CourseGroups=n}(t.Collaboration||(t.Collaboration={}))}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(e){function t(t,n){e.call(this,n),this.actionUrlsBase=t}return __extends(t,e),t.prototype.getElementListMarkupForEventIds=function(e,t,n,i,s,o){return void 0===s&&(s=""),void 0===o&&(o=!1),CCL.CommonFunctions.safeAjaxPost({url:this.actionUrlsBase.GetElementListMarkupForEventIds,data:{eventId:e,startDateTime:t,courseId:n,elementIds:i,fakeElementTitle:s,showConnectedDate:o},dataType:"json"})},t.prototype.createNewFileElementForEvent=function(e,t,n,i){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrlsBase.CreateNewFileElementForEvent,data:{CourseId:e,EventId:t,FileName:n.name,FileId:n.id,SignedFileId:n.signature,ShouldFileBeAttachedToEventImmediately:i}})},t}(e.CommonAjaxClient);t.AjaxClientBase=n}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(e){function t(t,n){e.call(this,t,n),this.actionUrls=t}return __extends(t,e),t.prototype.validateDateRelatedContent=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.ValidateDateRelatedContent,data:e})},t.prototype.checkRecurringEventPeriodDuration=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.CheckRecurringEventPeriodDuration,async:!1,data:e})},t.prototype.getDatesOfEventsToBePickedAsNextEventForEditEventPage=function(e){return $.ajax({type:"GET",url:this.actionUrls.GetDatesOfEventsToBePickedAsNextEventForEditEventPage,async:!1,data:e,dataType:"json"})},t.prototype.getTimeSlotsOfEventsToBePickedAsNextEventForEditEventPage=function(e){return $.ajax({type:"GET",url:this.actionUrls.GetTimeSlotsOfEventsToBePickedAsNextEventForEditEventPage,async:!1,data:e,dataType:"json"})},t.prototype.getBookingMarkups=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.GetBookingMarkups,data:e,dataType:"json"})},t}(e.AjaxClientBase);t.AjaxClient=n}(e.EditEvent||(e.EditEvent={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(e){function t(t){e.call(this,t.settings.services,t.settings.CommonAjaxClientSettings),this.utility=t,this.actionUrls=t.settings.services}return __extends(t,e),t.prototype.getAddResourceMenu=function(e){return $.ajax({type:"GET",url:this.actionUrls.getAddResourceMenu,data:e})},t.prototype.updateEventElements=function(e){return $.ajax({type:"PUT",url:this.actionUrls.updateEventElements,data:JSON.stringify(e),contentType:"application/json"})},t.prototype.removeElement=function(e){return $.ajax({type:"DELETE",url:this.actionUrls.removeElement,data:JSON.stringify(e),contentType:"application/json"})},t.prototype.getElementListMarkupForEvent=function(e){return $.ajax({type:"GET",url:this.actionUrls.getElementListMarkupForEvent,data:e,dataType:"json"})},t.prototype.createEventWithLocation=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.createEventWithLocation,data:e,dataType:"json"})},t.prototype.ensureEditableEvent=function(e){return $.ajax({type:"GET",url:this.actionUrls.ensureEditableEvent,data:e,dataType:"json"})},t.prototype.editEventTitle=function(e){return CCL.CommonFunctions.safeAjax({type:"PUT",url:this.actionUrls.EditEventTitle,data:e,dataType:"json"})},t.prototype.editEventDescription=function(e){return CCL.CommonFunctions.safeAjax({type:"PUT",url:this.actionUrls.editEventDescriptionUrl,data:e,dataType:"json"})},t.prototype.editEventExtraDescription=function(e){return CCL.CommonFunctions.safeAjax({type:"PUT",url:this.actionUrls.EditEventExtraDescription,data:e,dataType:"json"})},t.prototype.editNextEventId=function(e){return CCL.CommonFunctions.safeAjax({type:"PUT",url:this.actionUrls.EditNextEventId,data:e,dataType:"json"})},t.prototype.eventScope=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.eventScopeUrl,data:e,dataType:"json"})},t.prototype.deleteEvent=function(e,t){return $.ajax({type:"DELETE",url:e.deleteEventUrl.replace("{eventId}",e.activityId.toString())+"?deleteRecurringSeries="+!t,contentType:"application/json",headers:(n={},n[this.utility.settings.AntiForgeryTokenName]=this.utility.settings.AntiForgeryTokenValue,n)});var n},t.prototype.getDatesOfEventsToBePickedAsNextEventForSchedulePage=function(e){return $.ajax({type:"GET",url:this.actionUrls.GetDatesOfEventsToBePickedAsNextEventForSchedulePage,async:!1,data:e,dataType:"json"})},t.prototype.getTimeSlotsOfEventsToBePickedAsNextEventForSchedulePage=function(e){return $.ajax({type:"GET",url:this.actionUrls.GetTimeSlotsOfEventsToBePickedAsNextEventForSchedulePage,async:!1,data:e,dataType:"json"})},t.prototype.checkIfAnyOfMyEventsFiltered=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.checkIfAnyOfMyEventsFiltered,data:e,dataType:"json"})},t.prototype.getCourseApprovalDates=function(e){return $.ajax({type:"GET",url:this.actionUrls.GetCourseApprovalDates,async:!1,data:e,dataType:"json"})},t.prototype.checkRecurringEventGroupsMembership=function(e){return $.ajax({type:"GET",url:this.actionUrls.CheckRecurringEventGroupsMembership,async:!1,data:e,dataType:"json"})},t.prototype.getEvent=function(e){return $.ajax({type:"GET",url:this.actionUrls.GetEvent,async:!1,data:e,dataType:"json"})},t.prototype.removeCalendar=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.removeCalendar,data:e})},t.prototype.changeCalendarView=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.changeCalendarView,data:e})},t.prototype.getGroupsForDropdown=function(e){return $.ajax({type:"GET",url:this.actionUrls.getGroupsForDropdown,data:e})},t.prototype.getRecurringEventDetails=function(e){return $.ajax({type:"GET",url:this.actionUrls.GetRecurringEventDetails,data:e,async:!1})},t.prototype.saveFilterPreferences=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.saveCalendarFiltersPreferences,data:e})},t.prototype.addCalendar=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.addCalendar,dataType:"html",data:e})},t.prototype.toggleCalendar=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.actionUrls.toggleCalendar,data:e})},t}(e.AjaxClientBase);t.AjaxClient=n}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(e){function t(t,n){e.call(this,t.dataAttributes,t.cssClasses,t.terms,t.ClientInstanceNames,t.PostMessageNames,n,t.constants),this.settings=t,this.controls=n,this.initSelectors(),this.initDataAttributes()}return __extends(t,e),t.prototype.getExpandableContainer=function(e){return e.closest(this.selectors.expandableContainer)},t.prototype.getManuallyAddedElementsCount=function(e){return e.find("li["+this.dataAttributes.elementListItem+"*='\"AddedManually\":true']").length},t.prototype.formatSectionNameWithCounter=function(e,t){return e+" ("+t+")"},t.prototype.getElementListAppendTarget=function(e){return e.find("."+this.settings.cssClasses.SelectedElementListAppendTarget)},t.prototype.initSelectors=function(){this.selectors.addEventDialogAttachedElementsHidden="data-"+this.settings.dataAttributes.AddEventDialogAttachedElementsHidden,this.selectors.contextDialogHeaderH2="."+this.settings.cssClasses.ContextDialogHeader+" > h2",this.selectors.expandableContainerHeaderIcon="."+this.settings.cssClasses.ExpandableContainerHeader+" > ."+this.settings.cssClasses.Icon,this.selectors.expandableContainer="."+this.settings.cssClasses.ExpandableContainer},t.prototype.initDataAttributes=function(){this.dataAttributes.addEventDialogAttachedElementsHidden=CCL.CommonFunctions.getDataSelector(this.settings.dataAttributes.AddEventDialogAttachedElementsHidden)},t}(e.CalendarUtilityBase);t.Utility=n}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t;!function(e){e[e.NotLoaded=0]="NotLoaded",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded"}(t||(t={}));var n=function(){function e(e,n,i,s){var o=this,r=t.NotLoaded,a=$("<div class='ccl-context-dialog-content-container'></div>").hide();e.after(a);var l=null,c=new ContextDialog(a,{showHeader:!1,showCloseLink:!1,useMobileViewIfNeeded:!1,width:420,marginTop:n.height(),marginLeft:-210,scrollToLastWindowOnClose:!1,cssClass:s}),d=c.closeDialog;function u(e){var t=e.position().left+e.width()/2,n=e.position().top+10;c.openDialogAt(t,n,!1)}c.setCloseFunction(function(e){d(e)}),window.addEventListener("orientationchange",function(e){return c.closeDialog(e)}),a.click(function(){return c.closeDialog()}),n.click(function(e){if(c.isOpened())c.closeDialog();else{var n=$(e.target),s=o.getParams(n);r!==t.Loaded||o.paramsAreEqual(l,s)||(r=t.NotLoaded,a.empty()),r===t.Loaded?u($(e.currentTarget)):r===t.NotLoaded&&(r=t.Loading,$.get(i,o.formatUrlParams(s),function(n){n&&(a.append(n),u($(e.currentTarget))),r=t.Loaded,l=s}).fail(function(){return r=t.NotLoaded}))}})}return e.prototype.getParams=function(e){throw new Error("Abstract method should be overriden")},e.prototype.paramsAreEqual=function(e,t){throw new Error("Abstract method should be overriden")},e.prototype.formatUrlParams=function(e){throw new Error("Abstract method should be overriden")},e}();e.BaseDetailedInfo=n}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e){function t(t,n){var i=$(".tablelisting"),s=$(".tablelisting > table > tbody > tr > td > a");e.call(this,i,s,t,n)}return __extends(t,e),t.prototype.getParams=function(e){return{Period:e.data("period"),CustomerId:e.closest("tr").children("td").eq(1).children().html()}},t.prototype.paramsAreEqual=function(e,t){return null!=e&&(e.Period===t.Period&&e.CustomerId===t.CustomerId)},t.prototype.formatUrlParams=function(e){return{periodid:e.Period,customerId:e.CustomerId}},t}(e.BaseDetailedInfo);e.ListOnlineSitesDetailedInfo=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e){function t(t,n,i){var s=$(".tabsframe > div");e.call(this,s,t,n,i)}return __extends(t,e),t.prototype.getParams=function(e){return{Period:e.data("period"),CountryCode:e.closest("tr").data("c-c")}},t.prototype.paramsAreEqual=function(e,t){return null!=e&&(e.Period===t.Period&&e.CountryCode===t.CountryCode)},t.prototype.formatUrlParams=function(e){return{periodid:e.Period,countrycode:e.CountryCode}},t}(e.BaseDetailedInfo);e.ListOnlineSummaryDetailedInfo=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;this.isUploaderDirty=function(){var e=n.getNewUploaderInstance();return!!e&&e.uploadedItems.uploadMetadataArray.length+e.uploadedItems.fileInCloudMetadataArray.length+e.uploadedItems.folderMetadataArray.length>0},this.isFormDirty=function(){return n.isUploaderDirty()||!n.customScripts.isDescriptionEmpty()||n.$titleInput.val()&&n.$titleInput.val().length>0||n.$criteriaWeightsHidden.val().length>0},this.handleConfirmDialogAndSaveButtonBehaviour=function(e){switch(e){case UploadStatus.InProgress:n.lockSaveButton(!0);break;case UploadStatus.SucceededWithErrors:case UploadStatus.Succeeded:case UploadStatus.Awaiting:case UploadStatus.Failed:n.lockSaveButton(!1)}n.updateSaveButtonState()};var i=this;window[e.ClientInstanceName]=this,this.settings=e,this.customScripts=t,this.timer=0,this.selectedLoIds=this.settings.LearningObjectiveIds,this.$criteriaWeightsHidden=$("#"+this.settings.ClientIds.CriteriaWeightsHidden),this.$iframe=$("#"+this.settings.ClientIds.Iframe),this.$manageRubricPopupTriggerLink=$("#"+this.settings.ClientIds.ManageRubricPopupTriggerLink),this.$criteriaWeightsHidden.val(JSON.stringify(this.settings.CriteriaWeights)),this.$document=$(document);var s="."+this.settings.Css.SaveButton;if(this.$saveButton=$(s),this.buttonLoadingIndicator=new CCL.ButtonLoadingIndicator(s,this.settings.Css.ButtonInProgress,null,100),this.$titleInput=$("#"+this.settings.ClientIds.Title),this.$titlePanel=$("#"+this.settings.ClientIds.TitlePanel),this.$deepLinkUrl=$("#"+this.settings.ClientIds.DeepLinkUrl),this.$deepLinkPanel=$("#"+this.settings.ClientIds.DeepLinkUrlPanel),this.linkInput=document.getElementById(this.settings.ClientIds.LinkInput),this.embedLinkTargetCheckBox=document.getElementById(this.settings.ClientIds.EmbedLinkTargetCheckBox),this.isTitleValid=this.validateTitle(),this.isDescriptionToolbarExpanded=e.IsDescriptionToolbarExpanded,this.formCheckBeforeUnload=new CCL.FormCheckBeforeUnload($("#"+this.settings.ClientIds.Form),this.settings.Terms.BeforeUnloadWarningMessage,{$cancelButtons:this.$saveButton,callback:this.isFormDirty}),this.settings.SubmitButtonLocked&&this.$saveButton.toggleHyperlink(!1),this.settings.OpenDeepLinkInNewTab)this.$titleInput.prop("disabled",!0);else if(this.$deepLinkPanel.toggle(),this.settings.IsDeepLink){var o=this.$iframe.height()+this.$titlePanel.outerHeight(!0);this.$titlePanel.toggle(),this.$iframe.css({height:o+"px"})}i.isSettingsValid=!0,CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.closeCssModalDialog,function(e){e.extendedData.updateSettings||(i.selectedLoIds=e.extendedData.loIds,i.$criteriaWeightsHidden.val(e.extendedData.criteriaWeights),$(document).trigger(n.settings.EventNames.RubricChanged,{loIds:n.selectedLoIds,criteriaWeights:e.extendedData.criteriaWeights}))}),CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.deepLinkContentReceived,function(e){e&&e.extendedData&&(i.$extendedData=JSON.stringify(e.extendedData),i.$titlePanel.show(),n.$titleInput.prop("disabled",!1),i.$titleInput.val(e.extendedData.title),i.isTitleValid=i.validateTitle(),i.$iframe.toggle(),e.extendedData.url&&""!=e.extendedData.url&&(i.$deepLinkUrl.text(e.extendedData.url),i.$deepLinkPanel.show()),i.lockSaveButton(!1),i.updateSaveButtonState())}),this.$manageRubricPopupTriggerLink.click(function(){return i.initManageManageRubricPopup(),window[i.settings.ClientIds.RubricPopup].openDialog(),!1}),this.$titleInput.on("blur",function(){i.onTitleChangeHandler()}),this.$titleInput.on("input",function(e){i.onInputChangeHandler(e,i.onTitleChangeHandler)}),this.$document.on(this.settings.EventNames.ValidStateChanged,function(e,t){i.isSettingsValid=t,i.updateSaveButtonState()}),this.$document.on(this.settings.EventNames.LearningObjectivesChanged,function(e,t){t.isSyncContext||(i.selectedLoIds=t.ids,$(document).trigger(n.settings.EventNames.UpdateMaxScore,{loIds:i.selectedLoIds,criteriaWeights:i.$criteriaWeightsHidden.val()}))}),this.$document.on(this.settings.EventNames.ToggleCriteriaWeightsVisibility,function(e,t){n.settings.ShowCriteriaWeights=t.show}),i.settings.IsDescriptionReadOnly||("undefined"!=typeof CKEDITOR?CKEDITOR.on("instanceReady",function(){var e=i.customScripts.getDescriptionEditorInput();if(e.on("blur",function(){n.onDescriptionChangeHandler()}),e.on("change",function(e){n.onInputChangeHandler(e,n.onDescriptionChangeHandler)}),e.on("contentDom",function(){e.document.on("keyup",function(e){n.onInputChangeHandler(e,n.onDescriptionChangeHandler)})}),i.isDescriptionToolbarExpanded){var t=e.getCommand(i.settings.DescriptionToolbarExpandedCommandName),s=t.editorFocus;t.editorFocus=!1,e.execCommand(i.settings.DescriptionToolbarExpandedCommandName),t.editorFocus=s}e.on(i.settings.EventNames.DescriptionToolbarExpanded,function(e){i.isDescriptionToolbarExpanded=e.data.expanded,i.toggleDescriptionToolbar()}),n.onDescriptionChangeHandler()}):this.onDescriptionChange($(this.customScripts.getDescriptionEditorInput()))),this.updateSaveButtonState(),this.buttonLoadingIndicator.disableLoadingIndicator=!this.$saveButton.getIfHyperLinkEnabled(),$("button."+this.settings.Css.CancelButton).on("click",function(){window.close()}),this.settings.OpenDeepLinkInNewTab&&window.open(this.settings.LtiSsoRedirectPage,"_blank")}return e.prototype.closeManageRubricDialog=function(){var e=$("#"+this.settings.ClientIds.RubricPopup).find("iframe").get(0).contentWindow;CCL.CommonFunctions.makePostMessageCall(e,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.submitIframe))},e.prototype.collectContent=function(){var e={};e.Title=this.$titleInput.val(),e.Description=this.customScripts.isDescriptionEmpty()?"":this.customScripts.getDescription(),e.ExtendedData=this.$extendedData;var t=this.getNewUploaderInstance();if(t&&(e.SerializedUploadResults=JSON.stringify(t.uploadedItems)),this.linkInput&&(e.Link=this.linkInput.value,this.embedLinkTargetCheckBox&&(e.EmbedLinkTarget=this.embedLinkTargetCheckBox.checked)),this.settings.IsTitleHeaderEditable){var n=document.getElementById("add-learning-element-title");n&&(e.Title=n.value)}return e.SerializedCriteriaWeights=this.$criteriaWeightsHidden.val(),e},e.prototype.lockSaveButton=function(e){this.settings.SubmitButtonLocked=e},e.prototype.validateTitle=function(){if(this.$titleInput.length>0){var e=this.$titleInput.val();return e&&e.length>0}return!0},e.prototype.validateUploads=function(){return!this.settings.IsUploadRequired||this.isUploaderDirty()},e.prototype.onDescriptionChange=function(e){var t=this;e.on("blur",function(){t.onDescriptionChangeHandler()}),e.on("input",function(e){t.onInputChangeHandler(e,t.onDescriptionChangeHandler)})},e.prototype.onTitleChangeHandler=function(){this.isTitleValid=this.validateTitle(),this.updateSaveButtonState()},e.prototype.typeWatch=function(e,t){clearTimeout(this.timer),this.timer=setTimeout(e.bind(this),t)},e.prototype.onInputChangeHandler=function(e,t){var n=e.which;n>=CCL.CommonConstants.keyCodes.arrowLeft&&n<=CCL.CommonConstants.keyCodes.arrowDown||this.typeWatch(t,500)},e.prototype.onDescriptionChangeHandler=function(){this.updateSaveButtonState()},e.prototype.initManageManageRubricPopup=function(){var e=this.settings.ManageRubricDialogUrl,t=this.getParameterByName(e,"Ids"),n=t?e.replace(t[0],t[0][0]+"Ids="+encodeURIComponent(this.selectedLoIds.join(","))):e+(-1===e.indexOf("?")?"?":"&")+"Ids="+encodeURIComponent(this.selectedLoIds.join(",")),i=this.$criteriaWeightsHidden.val();if(i){var s=this.getParameterByName(n,"CriteriaWeights");n=s?n.replace(s[0],s[0][0]+"CriteriaWeights="+encodeURIComponent(i)):n+(-1===n.indexOf("?")?"?":"&")+"CriteriaWeights="+encodeURIComponent(i)}var o=this.settings.ShowCriteriaWeights?"1":"0",r=this.getParameterByName(n,"ShowCriteriaWeights");n=r?n.replace(r[0],r[0][0]+"ShowCriteriaWeights="+o):n+(-1===n.indexOf("?")?"?":"&")+"ShowCriteriaWeights="+o,window[this.settings.ClientIds.RubricPopup].setIframeUrl(n)},e.prototype.getParameterByName=function(e,t){return RegExp("[?&]"+t+"=([^&]*)").exec(e)},e.prototype.updateSaveButtonState=function(){this.settings.SubmitButtonLocked?this.$saveButton.toggleHyperlink(!1):this.$saveButton.toggleHyperlink(this.isSettingsValid&&this.isTitleValid&&this.validateUploads()),this.buttonLoadingIndicator.disableLoadingIndicator=!this.$saveButton.getIfHyperLinkEnabled()},e.prototype.toggleDescriptionToolbar=function(){CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.SetPersonSetting,data:{key:this.settings.PersonSettingIsDescriptionToolbarExpandedKey,value:this.isDescriptionToolbarExpanded?"true":"false"}})},e.prototype.getNewUploaderInstance=function(){var e=window.document.getElementById(this.settings.ClientIds.UploadAreaClientId);return e?e[this.settings.ClientIds.UploaderControlClientInstanceName]:void 0},e}();e.AddLearningToolElement=t}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(){}return t.prototype.validateAndTransferElementStateAfterClick=function(e,t){return this.validateElementState(e,t),this.transferElementState(t)},t.prototype.transferElementStateAfterSave=function(t){return t===e.State.AttachedByUser?e.State.Saved:t===e.State.DetachedByUser?e.State.Empty:t},t.prototype.isElementChecked=function(t){return t===e.State.AttachedByUser||t===e.State.Saved},t.prototype.validateElementState=function(e,t){if(!(e&&!this.isElementChecked(t)||!e&&this.isElementChecked(t)))throw new Error("Incorrect element state occurred IsChecked "+e+" StateBeforeCheck "+t)},t.prototype.transferElementState=function(t){switch(t){case e.State.DetachedByUser:return e.State.Saved;case e.State.Empty:return e.State.AttachedByUser;case e.State.AttachedByUser:return e.State.Empty;case e.State.Saved:return e.State.DetachedByUser;default:throw new Error("Unknown State "+t)}},t}();e.Machine=t}(e.CheckboxStateMachine||(e.CheckboxStateMachine={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){var n=this;this.peerAndSelfAssessmentStateChanged=function(e){n.togglePeerAssessment(),$(document).trigger(n.settings.Triggers.StateChanged,[n.activated,n.selfAssessmentActivated])},this.deadlineChanged=function(e){n.enabled=!(n.hasDeadlinePassed||n.groupActivityEnabled)},this.groupActivityStateChanged=function(e,t){n.groupActivityEnabled=t,n.groupActivityEnabled&&(n.activated=!1,n.selfAssessmentActivated=!1),n.enabled=!(n.hasDeadlinePassed||n.groupActivityEnabled),n.selfAssessmentEnabled=!n.groupActivityEnabled},window[e]=this,this.settings=t,$(function(){n.$peerAssessmentDropDownContainer=$("#"+n.settings.Controls.PeersCountDropDownContainer),n.$peerAssessmentDropDown=$("#"+n.settings.Controls.PeersCountDropDown),n.$container=$("#"+n.settings.Controls.Container),n.$checkbox=$("#"+n.settings.Controls.Checkbox),n.$anonymousPeerAssessmentCheckbox=document.getElementById(n.settings.Controls.AnonymousPeerAssessmentCheckbox),n.$selfAssessmentCheckbox=$("#"+n.settings.Controls.SelfAssessmentCheckbox),n.customTooltipForCheckbox=new CCL.ModernCheckbox.CustomTooltipForCheckbox(n.$checkbox),n.$customTooltipForSelfAssessmentCheckbox=new CCL.ModernCheckbox.CustomTooltipForCheckbox(n.$selfAssessmentCheckbox),n.deadline=window[n.settings.ClientInstanceNames.Deadline],n.groupActivityEnabled=n.settings.GroupActivityEnabled,n.enabled=n.settings.Enabled,n.selfAssessmentEnabled=!n.settings.GroupActivityEnabled,n.$peerAssessmentDropDown.val(n.settings.PeersCount.toString()),n.togglePeerAssessment(!n.settings.Activated),n.settings.Enabled&&n.settings.HasDeadlinePassed||($(n.deadline).change(n.deadlineChanged),n.$checkbox.change(n.peerAndSelfAssessmentStateChanged),n.settings.Events.GroupActivityStateChanged&&$(document).off(n.settings.Events.GroupActivityStateChanged).on(n.settings.Events.GroupActivityStateChanged,n.groupActivityStateChanged)),n.$selfAssessmentCheckbox.change(n.peerAndSelfAssessmentStateChanged)})}return Object.defineProperty(e.prototype,"activated",{get:function(){return this.$checkbox.is(":checked")},set:function(e){this.$checkbox.toggle(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selfAssessmentActivated",{get:function(){return this.$selfAssessmentCheckbox.is(":checked")},set:function(e){this.$selfAssessmentCheckbox.toggle(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"anonymousPeerAssessmentActivated",{get:function(){return this.$anonymousPeerAssessmentCheckbox.checked},set:function(e){this.$anonymousPeerAssessmentCheckbox.checked=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"enabled",{set:function(e){this.$container.toggleClass(this.settings.CssClasses.Disabled,!e),this.$checkbox.prop("disabled",!e),this.customTooltipForCheckbox.setToolTipHtml(e?"":this.tooltip),this.customTooltipForCheckbox.enableToolTip(!e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selfAssessmentEnabled",{set:function(e){this.$selfAssessmentCheckbox.prop("disabled",!e),this.$customTooltipForSelfAssessmentCheckbox.setToolTipHtml(e?"":this.settings.Terms.SelfAssessmentDisabledWarning),this.$customTooltipForSelfAssessmentCheckbox.enableToolTip(!e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"peersToAssessCount",{get:function(){return this.$peerAssessmentDropDown.val()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDeadline",{get:function(){var e=this.deadline.getState().DateTime;return void 0!==e&&""!==e&&null!=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDeadlinePassed",{get:function(){return!!this.hasDeadline&&this.deadline.getDateTime()<new Date},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tooltip",{get:function(){var e="";return this.hasDeadlinePassed?e=this.settings.Terms.DeadlineHasPassedWarning:this.hasDeadline||(e=this.settings.Terms.DeadlineIsEmptyWarning),this.groupActivityEnabled&&(""!==e&&(e+=" "),e+=this.settings.Terms.PeerAssessmentDisabledWarning),e},enumerable:!0,configurable:!0}),e.prototype.togglePeerAssessment=function(e){void 0===e&&(e=!0),e&&(this.enabled=this.hasDeadline&&!this.hasDeadlinePassed),this.$peerAssessmentDropDownContainer.toggle(this.$checkbox.is(":checked")),this.$peerAssessmentDropDownContainer.prop("disabled",!this.$checkbox.is(":enabled")),this.$peerAssessmentDropDown.prop("disabled",!this.$checkbox.is(":enabled"))},e}();e.PeerAssessment=t}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(t){var n=function(){function t(e){var t=this;this.viewModel=e,this.onJQueryReady=function(){t._$controlElement=$("#"+t.viewModel.ContainerId),t._$whenToShowResultElement=$("."+t.viewModel.WhenToShowResultSelector,t._$controlElement),t._$whenToShowQuestionListAndAnswerElement=$("."+t.viewModel.WhenToShowQuestionListAndAnswerSelector,t._$controlElement),t._$whenToShowQuestionListAndAnswerContainer=$("#"+t.viewModel.WhenToShowQuestionListAndAnswerContainer,t._$controlElement),t._$revealCorrectAnswerContainer=$("#"+t.viewModel.RevealCorrectAnswerContainer,t._$controlElement),t._$maxAttemptsAllowedElement=$(""+t.viewModel.MaxAttemptsAllowedSelector)},this._$revealCorrectAnswerElement=$("#"+e.RevealCorrectAnswerClientId),this._deadlinePicker=window[e.DeadlineInstanceName],$(this.onJQueryReady)}return Object.defineProperty(t.prototype,"$controlElement",{get:function(){return this._$controlElement},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$whenToShowResultElement",{get:function(){return this._$whenToShowResultElement},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$whenToShowResultAllOptionElements",{get:function(){return $("option",this.$whenToShowResultElement)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$whenToShowQuestionListAndAnswerElement",{get:function(){return this._$whenToShowQuestionListAndAnswerElement},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$whenToShowQuestionListAndAnswerAllOptionElements",{get:function(){return $("option",this.$whenToShowQuestionListAndAnswerElement)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"revealCorrectAnswerElement",{get:function(){return this._$revealCorrectAnswerElement},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$whenToShowQuestionListAndAnswerContainer",{get:function(){return this._$whenToShowQuestionListAndAnswerContainer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$revealCorrectAnswerContainer",{get:function(){return this._$revealCorrectAnswerContainer},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$maxAttemptsAllowedElement",{get:function(){return this._$maxAttemptsAllowedElement},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"deadlinePicker",{get:function(){return this._deadlinePicker},enumerable:!0,configurable:!0}),t.prototype.appendOptionToWhenToShowResultElement=function(e,t){this.$whenToShowResultElement.append($("<option></option>").prop("value",e.toString()).text(t))},t.prototype.appendOptionToWhenToShowQuestionListAndAnswerElement=function(e,t){this.$whenToShowQuestionListAndAnswerElement.append($("<option></option>").prop("value",e.toString()).text(t))},Object.defineProperty(t.prototype,"$whenToShowResultAfterDeadlineOptionItem",{get:function(){return this.$getWhenToShowResultOptionItem(e.WhenToShowResult.AfterDeadline)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$whenToShowQuestionListAndAnswerAfterDeadlineOptionItem",{get:function(){return this.$getWhenToShowQuestionListAndAnswerOptionItem(e.WhenToShowQuestionListAndAnswer.AfterDeadline)},enumerable:!0,configurable:!0}),t.prototype.setTextToWhenToShowResultOption=function(e,t){$("option[value="+e.toString()+"]",this.$whenToShowResultElement).text(t)},t.prototype.setTextToWhenToShowQuestionListAndAnswerOption=function(e,t){$("option[value="+e.toString()+"]",this.$whenToShowQuestionListAndAnswerElement).text(t)},t.prototype.$getWhenToShowResultOptionItem=function(e){return $("option[value="+e.toString()+"]",this.$whenToShowResultElement)},t.prototype.$getWhenToShowQuestionListAndAnswerOptionItem=function(e){return $("option[value="+e.toString()+"]",this.$whenToShowQuestionListAndAnswerElement)},t}();t.ControlsProvider=n}(e.ResultsAndFeedbackInternals||(e.ResultsAndFeedbackInternals={}))}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){var t=function(){function e(){this.handlers=[]}return e.prototype.on=function(e){this.handlers.push(e)},e.prototype.trigger=function(e){this.handlers.slice(0).forEach(function(t){return t(e)})},e}();e.EventHandler=t;var n=function(e,t){this.previous=e,this.current=t};e.MaxAttemptsEventData=n;var i=function(){function e(e,i){var s=this;this.viewModel=e,this.controlsProvider=i,this.deadlineChanged=function(e){s.onDeadlineChangedHandler.trigger(s.hasDeadline)},this.attemptsChanged=function(e){s.onAttemptsChangedHandler.trigger(new n(s.previousMaxAttemptsAllowed,s.maxAttemptsAllowed)),s.previousMaxAttemptsAllowed=s.maxAttemptsAllowed},this.onJQueryReady=function(){s.previousMaxAttemptsAllowed=s.maxAttemptsAllowed,$(s.controlsProvider.deadlinePicker).change(s.deadlineChanged),s.controlsProvider.$maxAttemptsAllowedElement.change(s.attemptsChanged)},this.onDeadlineChangedHandler=new t,this.onAttemptsChangedHandler=new t,$(this.onJQueryReady)}return Object.defineProperty(e.prototype,"onDeadlineChanged",{get:function(){return this.onDeadlineChangedHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onAttemptsChanged",{get:function(){return this.onAttemptsChangedHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxAttemptsAllowed",{get:function(){return parseInt(this.controlsProvider.$maxAttemptsAllowedElement.val())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasDeadline",{get:function(){var e=this.controlsProvider.deadlinePicker.getState().DateTime;return void 0!==e&&""!==e&&null!=e},enumerable:!0,configurable:!0}),e.prototype.hasMaxAttemptsChangedToMultiple=function(e,t){return 1===e&&(t>1||t===this.viewModel.UnlimitedAttemptsValue)},e.prototype.hasMaxAttemptsChangedToSingle=function(e,t){return 1===t&&(e>1||e===this.viewModel.UnlimitedAttemptsValue)},e}();e.ExternalDependenciesController=i}(e.ResultsAndFeedbackInternals||(e.ResultsAndFeedbackInternals={}))}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(t){var n=function(){function t(t,n,i){var s=this;this.viewModel=t,this.controlsProvider=n,this.externalDependenciesController=i,this.removeAfterDeadline=function(){var t=s.whenToShowResult;s.controlsProvider.$whenToShowResultAfterDeadlineOptionItem.remove(),t===e.WhenToShowResult.AfterDeadline&&s.controlsProvider.$whenToShowResultElement.val(s.defaultWhenToShowResult).change()},this.addAfterDeadline=function(){if(void 0===s.controlsProvider.$whenToShowResultAfterDeadlineOptionItem[0]){var t=e.WhenToShowResult.AfterDeadline;s.controlsProvider.appendOptionToWhenToShowResultElement(t,s.getWhenToShowResultOptionText(t))}},this.deadlineChanged=function(e){e?s.addAfterDeadline():s.removeAfterDeadline()},this.replaceEachAttemptWithTheAttempt=function(){s.replaceAttempt(!0)},this.replaceTheAttemptWithEachAttempt=function(){s.replaceAttempt(!1)},this.replaceAttempt=function(t){var n=e.WhenToShowResult.AfterEachAttempt,i=t?s.getWhenToShowResultOptionAlternativeText(n):s.getWhenToShowResultOptionText(n);s.controlsProvider.setTextToWhenToShowResultOption(n,i)},this.removeAfterAllAttempts=function(t){s.controlsProvider.$getWhenToShowResultOptionItem(e.WhenToShowResult.AfterAllAttempts).remove(),t===e.WhenToShowResult.AfterAllAttempts&&s.controlsProvider.$whenToShowResultElement.val(s.defaultWhenToShowResult).change()},this.attachDefaultList=function(){if(s.controlsProvider.$whenToShowResultAllOptionElements.each(function(e,t){var n=$(t).val();$(t).text(s.getWhenToShowResultOptionText(n))}),void 0===s.controlsProvider.$getWhenToShowResultOptionItem(e.WhenToShowResult.AfterAllAttempts)[0]&&s.shouldHaveAfterAllAttemptsOption){var t=e.WhenToShowResult.AfterAllAttempts;s.controlsProvider.appendOptionToWhenToShowResultElement(t,s.getWhenToShowResultOptionText(t))}s.replaceTheAttemptWithEachAttempt()},this.adjustWhenToShowResultElementValue=function(t,n,i){if(s.externalDependenciesController.hasMaxAttemptsChangedToSingle(t,n))i===e.WhenToShowResult.AfterAllAttempts&&s.controlsProvider.$whenToShowResultElement.val(e.WhenToShowResult[e.WhenToShowResult.AfterEachAttempt]).change();else if(s.externalDependenciesController.hasMaxAttemptsChangedToMultiple(t,n)){var o=e.WhenToShowResult[e.WhenToShowResult.AfterAllAttempts];n===s.viewModel.UnlimitedAttemptsValue&&(o=e.WhenToShowResult[e.WhenToShowResult.AfterEachAttempt]),i===e.WhenToShowResult.AfterEachAttempt&&s.controlsProvider.$whenToShowResultElement.val(o).change()}},this.attemptsChanged=function(e){switch(e.current){case 1:s.replaceEachAttemptWithTheAttempt(),s.removeAfterAllAttempts(s.whenToShowResult);break;case s.viewModel.UnlimitedAttemptsValue:s.replaceTheAttemptWithEachAttempt(),s.removeAfterAllAttempts(s.whenToShowResult);break;default:s.attachDefaultList()}s.adjustWhenToShowResultElementValue(e.previous,e.current,s.whenToShowResult)},this.onJQueryReady=function(){s.buildWhenToShowResultList()},i.onDeadlineChanged.on(this.deadlineChanged),i.onAttemptsChanged.on(this.attemptsChanged),$(this.onJQueryReady)}return Object.defineProperty(t.prototype,"defaultWhenToShowResult",{get:function(){return e.WhenToShowResult[e.WhenToShowResult.AfterEachAttempt]},enumerable:!0,configurable:!0}),t.prototype.getWhenToShowResultOptionText=function(e){return this.viewModel.WhenToShowResultsOptions.filter(function(t){return t.Value===e})[0].Text},t.prototype.getWhenToShowResultOptionAlternativeText=function(e){return this.viewModel.WhenToShowResultsOptions.filter(function(t){return t.Value===e})[0].AlternativeText},t.prototype.buildWhenToShowResultList=function(){var t=this;this.controlsProvider.$whenToShowResultElement.empty(),$.each(this.viewModel.WhenToShowResultsOptions,function(n,i){i.Value===e.WhenToShowResult.AfterEachAttempt?1===t.externalDependenciesController.maxAttemptsAllowed?t.controlsProvider.appendOptionToWhenToShowResultElement(i.Value,i.AlternativeText):t.controlsProvider.appendOptionToWhenToShowResultElement(i.Value,i.Text):i.Value===e.WhenToShowResult.AfterDeadline?t.externalDependenciesController.hasDeadline&&t.controlsProvider.appendOptionToWhenToShowResultElement(i.Value,i.Text):i.Value===e.WhenToShowResult.AfterAllAttempts?t.shouldHaveAfterAllAttemptsOption&&t.controlsProvider.appendOptionToWhenToShowResultElement(i.Value,i.Text):t.controlsProvider.appendOptionToWhenToShowResultElement(i.Value,i.Text)}),this.controlsProvider.$whenToShowResultElement.val(this.viewModel.ResultsAndFeedbackState.WhenToShowResult.toString()).change(),this.deadlineChanged(this.externalDependenciesController.hasDeadline)},Object.defineProperty(t.prototype,"whenToShowResult",{get:function(){var t=this.controlsProvider.$whenToShowResultElement.val();return e.WhenToShowResult[t]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"whenToShowResultsChanged",{get:function(){return this.whenToShowResult!==this.viewModel.ResultsAndFeedbackState.WhenToShowResult},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shouldHaveAfterAllAttemptsOption",{get:function(){return 1!==this.externalDependenciesController.maxAttemptsAllowed&&this.externalDependenciesController.maxAttemptsAllowed!==this.viewModel.UnlimitedAttemptsValue&&this.whenToShowResult!==e.WhenToShowResult.WhenTeacherDecides&&this.whenToShowResult!==e.WhenToShowResult.AfterDeadline},enumerable:!0,configurable:!0}),t}();t.WhenToShowResultsController=n}(e.ResultsAndFeedbackInternals||(e.ResultsAndFeedbackInternals={}))}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function n(n,i){var s=this;this.controls=n,this.settings=i,this.ajaxParams={},this.afterOkClickCallback=function(t){if(t){s.currentElementStates=e.MapUtils.makeCopy(t),s.saveElementStates();var n=[];t.forEach(function(e,t){s.checkboxStateMachine.isElementChecked(e)&&n.push(t)}),s.updateElementListMarkup(n)}},this.currentElementStates=new Map,this.checkboxStateMachine=new e.CheckboxStateMachine.Machine,this.loadElementStates(),this.ajaxParams={locationId:this.settings.CourseId,locationType:e.AddResourceMenu.ElementExternalSourceType.Course},this.ajaxClient=new t.ElementPickerAjaxClient(this.settings.Urls,this.settings.CommonAjaxClientSettings),this.controls.AddButton.click(function(){var t={elementStates:e.MapUtils.makeCopy(s.currentElementStates),elementType:e.ElementLinkDialog.ContentElementType.Files,showAll:!0,allowFolderSelection:!1,header:s.settings.Terms.DialogTitle,afterOkClickCallback:s.afterOkClickCallback,openerPage:e.ElementLinkDialog.ElementsPopupOpener.None,relatedEntityId:s.settings.CustomActivityId};e.ElementLinkDialog.elementLinkDialogManagerInstance.openDialog(t,s.ajaxParams)});var o=$(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.SelectedElementListAppendTarget));o.on("click","."+this.settings.CssClasses.DetachElement,function(e){var t=$(e.target).closest("li"),n=t.data(s.settings.DataAttributes.ElementId),i=t.closest("."+s.settings.CssClasses.SelectedElementList),o=t.next().find("a").first();0===o.length&&(o=s.controls.AddButton),t.remove(),0===i.children("li").length&&i.remove(),o.focus(),s.detachElementFromMap(n)}),o.on("mouseenter","."+this.settings.CssClasses.SelectedElementList+" > li",function(e){var t=$(e.currentTarget).find("."+s.settings.CssClasses.ElementTitle).get(0),n=$(t).closest("a"),i=t.offsetWidth;CCL.CommonFunctions.isChrome()&&!CCL.CommonFunctions.isEdge()||i++,n.prop("title",i<t.scrollWidth?t.textContent.trim():"")})}return n.prototype.loadElementStates=function(){this.currentElementStates=e.MapUtils.jsonStringToMap(this.controls.PickerResultHidden.val(),e.MapUtils.numberKeyConverter)},n.prototype.saveElementStates=function(){this.controls.PickerResultHidden.val(e.MapUtils.mapToJsonString(this.currentElementStates))},n.prototype.updateElementListMarkup=function(e){var t=$(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.SelectedElementListAppendTarget));t.empty(),this.ajaxClient.getElementListMarkupByIds({CourseId:this.settings.CourseId,ElementIds:e}).done(function(e){return t.append($(e))})},n.prototype.detachElementFromMap=function(e){var t=this.currentElementStates.get(e),n=this.checkboxStateMachine.validateAndTransferElementStateAfterClick(!1,t);this.currentElementStates.set(e,n),this.saveElementStates()},n}();t.PickerManager=n}(e.CustomActivityElementPicker||(e.CustomActivityElementPicker={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(t){var n=function(){function t(t,n,i,s){var o=this;this.viewModel=t,this.controlsProvider=n,this.whenToShowResultsController=i,this.externalDependenciesController=s,this.removeAfterDeadline=function(){o.removeAfterDeadlineSetNewValue(o.defaultWhenToShowQuestionListAndAnswer)},this.addAfterDeadline=function(){if(o.whenToShowResultsController.whenToShowResult!==e.WhenToShowResult.WhenTeacherDecides){if(void 0===o.controlsProvider.$whenToShowQuestionListAndAnswerAfterDeadlineOptionItem[0]){var t=e.WhenToShowQuestionListAndAnswer.AfterDeadline;o.controlsProvider.appendOptionToWhenToShowQuestionListAndAnswerElement(t,o.getWhenToShowQuestionListAndAnswerOptionText(t))}}else o.removeAfterDeadlineSetNewValue(o.neverWhenToShowQuestionListAndAnswer)},this.deadlineChanged=function(e){e?o.addAfterDeadline():o.removeAfterDeadline()},this.whenToShowResultChanged=function(t){var n=o.whenToShowResultsController.whenToShowResult;n===e.WhenToShowResult.Never&&o.controlsProvider.$whenToShowQuestionListAndAnswerElement.val(e.WhenToShowQuestionListAndAnswer.Never.toString()).change(),o.buildWhenToShowQuestionListAndAnswerList(o.whenToShowQuestionListAndAnswer),o.controlsProvider.$whenToShowQuestionListAndAnswerContainer.toggle(n!==e.WhenToShowResult.Never),o.deadlineChanged(o.externalDependenciesController.hasDeadline)},this.whenToShowQuestionListAndAnswerChanged=function(t){var n=o.whenToShowQuestionListAndAnswer;n===e.WhenToShowQuestionListAndAnswer.Never&&o.controlsProvider.revealCorrectAnswerElement.toggle(!1),o.controlsProvider.$revealCorrectAnswerContainer.toggle(n!==e.WhenToShowQuestionListAndAnswer.Never)},this.replaceEachAttemptWithTheAttempt=function(){o.replaceAttempt(!0)},this.replaceTheAttemptWithEachAttempt=function(){o.replaceAttempt(!1)},this.replaceAttempt=function(t){var n=e.WhenToShowQuestionListAndAnswer.AfterEachAttempt,i=t?o.getWhenToShowQuestionListAndAnswerOptionAlternativeText(n):o.getWhenToShowQuestionListAndAnswerOptionText(n);o.controlsProvider.setTextToWhenToShowQuestionListAndAnswerOption(n,i)},this.removeAfterAllAttempts=function(t){o.controlsProvider.$getWhenToShowQuestionListAndAnswerOptionItem(e.WhenToShowQuestionListAndAnswer.AfterAllAttempts).remove(),t===e.WhenToShowQuestionListAndAnswer.AfterAllAttempts&&o.controlsProvider.$whenToShowQuestionListAndAnswerElement.val(o.defaultWhenToShowQuestionListAndAnswer).change()},this.attachDefaultList=function(){if(o.controlsProvider.$whenToShowQuestionListAndAnswerAllOptionElements.each(function(e,t){var n=$(t).val();$(t).text(o.getWhenToShowQuestionListAndAnswerOptionText(n))}),void 0===o.controlsProvider.$getWhenToShowQuestionListAndAnswerOptionItem(e.WhenToShowQuestionListAndAnswer.AfterAllAttempts)[0]&&o.shouldHaveAfterAllAttemptsOption){var t=e.WhenToShowQuestionListAndAnswer.AfterAllAttempts;o.controlsProvider.appendOptionToWhenToShowQuestionListAndAnswerElement(t,o.getWhenToShowQuestionListAndAnswerOptionText(t))}o.whenToShowResultsController.whenToShowResult===e.WhenToShowResult.WhenTeacherDecides&&o.removeAfterAllAttempts(o.whenToShowQuestionListAndAnswer),o.replaceTheAttemptWithEachAttempt()},this.adjustWhenToShowQuestionListAndAnswerElementValue=function(t,n,i){if(o.externalDependenciesController.hasMaxAttemptsChangedToSingle(t,n))i===e.WhenToShowQuestionListAndAnswer.AfterAllAttempts&&o.controlsProvider.$whenToShowQuestionListAndAnswerElement.val(e.WhenToShowQuestionListAndAnswer[e.WhenToShowQuestionListAndAnswer.AfterEachAttempt]).change();else if(o.externalDependenciesController.hasMaxAttemptsChangedToMultiple(t,n)){var s=e.WhenToShowQuestionListAndAnswer[e.WhenToShowQuestionListAndAnswer.AfterAllAttempts];n===o.viewModel.UnlimitedAttemptsValue&&(s=e.WhenToShowQuestionListAndAnswer[e.WhenToShowQuestionListAndAnswer.AfterEachAttempt]),i===e.WhenToShowQuestionListAndAnswer.AfterEachAttempt&&o.controlsProvider.$whenToShowQuestionListAndAnswerElement.val(s).change()}},this.attemptsChanged=function(e){switch(e.current){case 1:o.replaceEachAttemptWithTheAttempt(),o.removeAfterAllAttempts(o.whenToShowQuestionListAndAnswer);break;case o.viewModel.UnlimitedAttemptsValue:o.replaceTheAttemptWithEachAttempt(),o.removeAfterAllAttempts(o.whenToShowQuestionListAndAnswer);break;default:o.attachDefaultList()}o.adjustWhenToShowQuestionListAndAnswerElementValue(e.previous,e.current,o.whenToShowQuestionListAndAnswer)},this.onJQueryReady=function(){o.buildWhenToShowQuestionListAndAnswerList(o.viewModel.ResultsAndFeedbackState.WhenToShowQuestionListAndAnswer),o.controlsProvider.$whenToShowResultElement.change(o.whenToShowResultChanged),o.controlsProvider.$whenToShowQuestionListAndAnswerElement.change(o.whenToShowQuestionListAndAnswerChanged),o.controlsProvider.$whenToShowQuestionListAndAnswerContainer.toggle(o.whenToShowResultsController.whenToShowResult!==e.WhenToShowResult.Never)},s.onDeadlineChanged.on(this.deadlineChanged),s.onAttemptsChanged.on(this.attemptsChanged),$(this.onJQueryReady)}return Object.defineProperty(t.prototype,"defaultWhenToShowQuestionListAndAnswer",{get:function(){return e.WhenToShowQuestionListAndAnswer[e.WhenToShowQuestionListAndAnswer.AfterEachAttempt]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"neverWhenToShowQuestionListAndAnswer",{get:function(){return e.WhenToShowQuestionListAndAnswer[e.WhenToShowQuestionListAndAnswer.Never]},enumerable:!0,configurable:!0}),t.prototype.getWhenToShowQuestionListAndAnswerOptionText=function(e){return this.viewModel.WhenToShowQuestionListAndAnswerOptions.filter(function(t){return t.Value===e})[0].Text},t.prototype.getWhenToShowQuestionListAndAnswerOptionAlternativeText=function(e){return this.viewModel.WhenToShowQuestionListAndAnswerOptions.filter(function(t){return t.Value===e})[0].AlternativeText},t.prototype.removeAfterDeadlineSetNewValue=function(t){var n=this.whenToShowQuestionListAndAnswer;this.controlsProvider.$whenToShowQuestionListAndAnswerAfterDeadlineOptionItem.remove(),n===e.WhenToShowQuestionListAndAnswer.AfterDeadline&&this.controlsProvider.$whenToShowQuestionListAndAnswerElement.val(t).change()},Object.defineProperty(t.prototype,"shouldHaveAfterAllAttemptsOption",{get:function(){return this.whenToShowResultsController.shouldHaveAfterAllAttemptsOption},enumerable:!0,configurable:!0}),t.prototype.buildWhenToShowQuestionListAndAnswerList=function(t){var n=this;this.controlsProvider.$whenToShowQuestionListAndAnswerElement.empty(),$.each(this.viewModel.WhenToShowQuestionListAndAnswerOptions,function(t,i){i.Value===e.WhenToShowQuestionListAndAnswer.AfterEachAttempt?n.whenToShowResultsController.whenToShowResult!==e.WhenToShowResult.WhenTeacherDecides&&(1===n.externalDependenciesController.maxAttemptsAllowed?n.controlsProvider.appendOptionToWhenToShowQuestionListAndAnswerElement(i.Value,i.AlternativeText):n.controlsProvider.appendOptionToWhenToShowQuestionListAndAnswerElement(i.Value,i.Text)):i.Value===e.WhenToShowQuestionListAndAnswer.AfterAllAttempts?n.shouldHaveAfterAllAttemptsOption&&n.controlsProvider.appendOptionToWhenToShowQuestionListAndAnswerElement(i.Value,i.Text):i.Value===e.WhenToShowQuestionListAndAnswer.WithResults?n.whenToShowResultsController.whenToShowResult===e.WhenToShowResult.WhenTeacherDecides&&n.controlsProvider.appendOptionToWhenToShowQuestionListAndAnswerElement(i.Value,i.Text):i.Value===e.WhenToShowQuestionListAndAnswer.AfterDeadline?n.externalDependenciesController.hasDeadline&&n.controlsProvider.appendOptionToWhenToShowQuestionListAndAnswerElement(i.Value,i.Text):n.controlsProvider.appendOptionToWhenToShowQuestionListAndAnswerElement(i.Value,i.Text)}),void 0!==this.controlsProvider.$getWhenToShowQuestionListAndAnswerOptionItem(t)[0]?this.controlsProvider.$whenToShowQuestionListAndAnswerElement.val(t.toString()).change():this.controlsProvider.$whenToShowQuestionListAndAnswerElement.val(e.WhenToShowQuestionListAndAnswer.Never.toString()).change(),this.deadlineChanged(this.externalDependenciesController.hasDeadline)},Object.defineProperty(t.prototype,"whenToShowQuestionListAndAnswer",{get:function(){var t=this.controlsProvider.$whenToShowQuestionListAndAnswerElement.val();return e.WhenToShowQuestionListAndAnswer[t]},enumerable:!0,configurable:!0}),t}();t.WhenToShowQuestionListAndAnswerController=n}(e.ResultsAndFeedbackInternals||(e.ResultsAndFeedbackInternals={}))}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){};e.AssessmentScaleState=t;var n=function(){function e(e,t){var n=this;this.onAssessmentChanged=function(e){var t=n.$assessmentItemDropDown.find("option:selected").val(),i=t===n.settings.Constants.UseScoreItemValue;n.settings.EventNames.ToggleCriteriaWeightVisibility&&$(document).trigger(n.settings.EventNames.ToggleCriteriaWeightVisibility,{show:t!==n.settings.Constants.DoNotUseAssessmentItemValue}),0===n.$assessmentItemDropDown.length&&(i=n.settings.Permissions.IsScoreUsed),n.$maxScoreFloatingSection.toggle(i),n.onMaxScoreStateChanged(),n.settings.Permissions.UseGradeBook&&n.toggleTermAndCategoryPanel(),n.$sendToOneRosterCheckbox.prop("checked",!1);var s=parseInt(t);if(s&&n.settings.AssessmentIdsToOneRosterModuleSetupIds[s]){var o=n.settings.AssessmentIdsToOneRosterModuleSetupIds[s][0];n.$sendToOneRosterContainer.show(),n.$sendToOneRosterCheckbox.val(o.toString()),$("#"+n.settings.Controls.SendToOneRosterContainer+" > label > span.ccl-checkbox-label").html(CCL.CommonFunctions.formatString(n.settings.Terms.SendToOneRosterLabel,n.settings.OneRosterModuleSetupIdsToNames[o.toString()]))}else n.$sendToOneRosterContainer.hide();void 0!==n.onChangeHandler&&void 0!==e&&n.onChangeHandler(e)},window[e]=this,this.settings=t,$(function(){n.$assessmentItemDropDown=$("#"+n.settings.Controls.AssessmentItemDropDown),n.$maxScoreFloatingSection=$("#"+n.settings.Controls.MaxScoreFloatingSection),n.$maxScoreTextBox=$("#"+n.settings.Controls.MaxScoreTextBox),n.$assessmentRecordContainer=$("#"+n.settings.Controls.AssessmentRecordContainer),n.$termAndCategoryContainer=$("#"+n.settings.Controls.TermAndCategoryContainer),n.$categoryDropDown=$("#"+n.settings.Controls.CategoryDropDown),n.$termDropDown=$("#"+n.settings.Controls.TermDropDown),n.$addToGradeBookCheckbox=$("#"+n.settings.Controls.AddToGradeBookCheckbox),n.$sendToOneRosterContainer=$("#"+n.settings.Controls.SendToOneRosterContainer),n.$sendToOneRosterCheckbox=$("#"+n.settings.Controls.SendToOneRosterCheckbox),n.settings.Permissions.UseGradeBook&&n.$addToGradeBookCheckbox.on("change",function(e){return n.toggleTermAndCategoryContainer(e)}),n.$assessmentItemDropDown.on("change",function(e){return n.onAssessmentChanged(e)}),n.$maxScoreTextBox&&n.$maxScoreTextBox.on("blur input",function(){return n.onMaxScoreStateChanged()}).on("keydown",function(e){return n.onMaxScoreKeyDown(e)})})}return e.prototype.onChange=function(e){this.onChangeHandler=e},e.prototype.getState=function(){var e={};return e.AssessmentScaleId=parseInt(this.$assessmentItemDropDown.find("option:selected").val(),10),e.IsScore=e.AssessmentScaleId===parseInt(this.settings.Constants.UseScoreItemValue,10),e.MaxScore=parseInt(this.$maxScoreTextBox.val(),10),this.settings.Permissions.UseGradeBook&&(e.AddToGradeBook=this.$addToGradeBookCheckbox.is(":checked")),this.$categoryDropDown&&(e.CategoryId=parseInt(this.$categoryDropDown.val(),10)),this.$termDropDown&&(e.TermId=parseInt(this.$termDropDown.val(),10)),this.$sendToOneRosterCheckbox&&this.$sendToOneRosterCheckbox.is(":checked")&&(e.OneRosterModuleExtensionSetupId=this.$sendToOneRosterCheckbox.val()),e},e.prototype.useAssessment=function(){return this.$assessmentItemDropDown.find("option:selected").val()!==this.settings.Constants.DoNotUseAssessmentItemValue},e.prototype.canUseAutoMaxScore=function(){return this.settings.Permissions.CanUseAutoMaxScore},e.prototype.isValid=function(){return!(this.$assessmentItemDropDown.find("option:selected").val()===this.settings.Constants.UseScoreItemValue)||!this.$maxScoreTextBox||this.validateScore(this.$maxScoreTextBox.val())},e.prototype.updateMaxScore=function(e,t,n){var i=this;e&&0!==e.length?CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.GetCriteriaWeightTotal,data:{elementId:this.settings.ElementId,courseId:this.settings.CourseId,learningObjectiveIds:e,changedCriteriaWeights:t}}).done(function(e){var t=e.criteriaWeightTotal>0;i.calculateMaxScore(t,e.criteriaWeightTotal),n&&n()}):this.calculateMaxScore(!1,0)},e.prototype.onMaxScoreStateChanged=function(){this.settings.EventNames.MandatoryFieldsStateChangedClient&&($(document).trigger(this.settings.EventNames.MandatoryFieldsStateChangedClient),document.dispatchEvent(new CustomEvent(this.settings.EventNames.MandatoryFieldsStateChangedClient,{detail:this.getState()})))},e.prototype.calculateMaxScore=function(e,t){e?(this.$maxScoreTextBox.val((t*this.settings.NumberOfAchievementLevels).toString()),this.$maxScoreTextBox.attr("readonly","readonly"),CCL.UnobtrusiveCustomTooltipManager.setTooltipContentOnTarget(this.$maxScoreTextBox,this.settings.AutoMaxScoreToolTip)):(this.$maxScoreTextBox.removeAttr("readonly"),CCL.UnobtrusiveCustomTooltipManager.setTooltipContentOnTarget(this.$maxScoreTextBox,""))},e.prototype.validateScore=function(e){if(""===e)return!1;var t=parseFloat(e.replace(this.settings.NumberDecimalSeparator,"."));return!(isNaN(t)||t<this.settings.MaxScoreMinValue||t>this.settings.MaxScoreMaxValue)},e.prototype.toggleTermAndCategoryPanel=function(){var e=this.$assessmentItemDropDown.find("option:selected").val()!==this.settings.Constants.DoNotUseAssessmentItemValue;e&&this.$assessmentRecordContainer.is(":visible")||(this.$assessmentRecordContainer.toggle(e),this.$addToGradeBookCheckbox.prop("checked",e).change())},e.prototype.toggleTermAndCategoryContainer=function(e){var t=$(e.target).is(":checked");this.$termAndCategoryContainer.toggle(t)},e.prototype.onMaxScoreKeyDown=function(e){var t=[CCL.CommonConstants.keyCodes.del,CCL.CommonConstants.keyCodes.backspace,CCL.CommonConstants.keyCodes.tab,CCL.CommonConstants.keyCodes.escape,CCL.CommonConstants.keyCodes.enter,CCL.CommonConstants.keyCodes.shift];CCL.CommonFunctions.preventInputIncorrectCharacters(e,t)},e}();e.AssessmentScale=n}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){};e.GroupActivityState=t;var n=function(){function e(e,t){var n=this;this.peerAndSelfAssessmentStateChanged=function(e,t,i){n.peerAssessmentEnabled=t,n.selfAssessmentEnabled=i,n.enabled=n.canEdit()},this.groupActivityCheckboxChanged=function(e){n.toggleGroupActivity(),$(document).trigger(n.settings.Triggers.StateChanged,n.enabled)},window[e]=this,this.settings=t,$(function(){n.peerAssessmentEnabled=n.settings.PeerAssessmentEnabled,n.selfAssessmentEnabled=n.settings.SelfAssessmentEnabled,n.$checkBox=$("#"+n.settings.Controls.CheckboxId),n.customTooltipForCheckbox=new CCL.ModernCheckbox.CustomTooltipForCheckbox(n.$checkBox),n.$dropDown=$("#"+n.settings.Controls.DropDownId),n.$container=$("#"+n.settings.Controls.Container),n.enabled=n.canEdit(),n.toggleGroupActivity(),n.$checkBox.change(n.groupActivityCheckboxChanged),n.settings.Events.PeerAndSelfAssessmentStateChanged&&$(document).off(n.settings.Events.PeerAndSelfAssessmentStateChanged).on(n.settings.Events.PeerAndSelfAssessmentStateChanged,n.peerAndSelfAssessmentStateChanged)})}return Object.defineProperty(e.prototype,"enabled",{get:function(){return this.$checkBox.is(":checked")&&this.canEdit()},set:function(e){this.$container.toggleClass(this.settings.CssClasses.Disabled,!e),this.$checkBox.prop("disabled",!e),this.customTooltipForCheckbox.setToolTipHtml(e?"":this.tooltip),this.customTooltipForCheckbox.enableToolTip(!e)},enumerable:!0,configurable:!0}),e.prototype.getState=function(){var e={};return e.isGroupActivity=this.$checkBox.is(":checked"),e.groupType=this.$dropDown.val(),e},Object.defineProperty(e.prototype,"tooltip",{get:function(){return this.settings.AtLeastOneAnswerExistsForElement?this.settings.Terms.AnswersExistWarning:this.settings.IsLearningPathSubElement?this.settings.Terms.IsLearningPathSubElementWarning:this.peerAssessmentEnabled||this.selfAssessmentEnabled?this.settings.Terms.GroupActivityDisabledWarning:""},enumerable:!0,configurable:!0}),e.prototype.toggleGroupActivity=function(){this.$dropDown.toggle(this.$checkBox.is(":checked"))},e.prototype.canEdit=function(){return!(this.settings.AtLeastOneAnswerExistsForElement||this.settings.IsLearningPathSubElement||this.peerAssessmentEnabled||this.selfAssessmentEnabled)},e}();e.GroupActivity=n}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function t(t,n){var i=this;this.settings=n,window[t]=this,$(function(){if(i.settings.VisibilitySettings.Activation&&(i.activationControl=window[i.settings.ClientInstanceNames.ActivationControl]),i.settings.VisibilitySettings.WorkloadSetting&&(i.workloadSettingControl=window[i.settings.ClientInstanceNames.WorkloadSettingControl]),i.settingsManager=e.Manager.getInstance(),i.$saveSettingsButton=$("."+i.settings.CssClasses.SaveSettingsButton),i.attemptsControl=i.settings.VisibilitySettings.Attempts?window[i.settings.ClientInstanceNames.AttemptsControl]:null,i.resultsAndFeedbackControl=i.settings.VisibilitySettings.ResultsAndFeedback?window[i.settings.ClientInstanceNames.ResultsAndFeedbackControl]:null,i.settings.VisibilitySettings.AnonymousSubmission&&(i.$anonymousCheckBox=document.getElementById(""+i.settings.Controls.AnonymousSubmissionCheckBox)),i.settings.VisibilitySettings.PlagiarismControl&&(i.$plagiarismCheckBox=document.getElementById(i.settings.Controls.PlagiarismCheckBox),i.$showPlagiarismToStudentsCheckBox=document.getElementById(i.settings.Controls.ShowPlagiarismToStudentsCheckBox),i.$showPlagiarismToStudentsContainer=document.getElementsByClassName(i.settings.CssClasses.ShowPlagiarismToStudentsContainer)[0],i.$showPlagiarismToStudentsContainer&&(i.$showPlagiarismToStudentsContainer.setAttribute("style",i.$plagiarismCheckBox.checked?"":"display:none;"),i.$plagiarismCheckBox.onchange=function(){i.$plagiarismCheckBox.checked||(i.$showPlagiarismToStudentsCheckBox.checked=!1),i.$showPlagiarismToStudentsContainer.setAttribute("style",i.$plagiarismCheckBox.checked?"":"display:none;")})),i.settings.VisibilitySettings.Mandatory&&(i.$notMandatoryCheckBox=document.getElementById(""+i.settings.Controls.NotMandatoryCheckBox),i.settings.VisibilitySettings.AnonymousSubmission)){var t=new CCL.ModernCheckbox.CustomTooltipForCheckbox($("#"+i.settings.Controls.NotMandatoryCheckBox));t.setToolTipHtml(i.settings.Terms.MandatoryTooltipForAnonymousSubmission),t.enableToolTip(i.$anonymousCheckBox.checked),i.$anonymousCheckBox.onchange=function(){var e=i.$anonymousCheckBox.checked;i.$notMandatoryCheckBox.disabled=e,i.$notMandatoryCheckBox.checked=e,t.enableToolTip(e)}}i.settings.VisibilitySettings.Results&&(i.$resultsCheckBox=document.getElementById(""+i.settings.Controls.ResultsCheckBox)),i.settings.VisibilitySettings.Deadline&&(i.deadlinePicker=window[i.settings.ClientInstanceNames.Deadline]),i.settings.VisibilitySettings.Homework&&(i.$homeworkCheckBox=document.getElementById(""+i.settings.Controls.HomeworkCheckBox)),i.settings.VisibilitySettings.PeerAssessment&&(i.peerAssessment=window[i.settings.ClientInstanceNames.PeerAssessment]),i.settings.VisibilitySettings.GroupSubmission&&(i.groupActivitySelector=window[i.settings.ClientInstanceNames.GroupActivitySelector]),i.settings.VisibilitySettings.AssessmentScale&&(i.assessmentScaleSelector=window[i.settings.ClientInstanceNames.AssessmentScaleControl]),i.settings.VisibilitySettings.DescriptionOnSidebar&&(i.$descriptionInput=document.getElementById(""+i.settings.Controls.DescriptionTextArea)),i.settings.VisibilitySettings.AssignTo&&(i.assignToSettingControl=window[i.settings.ClientInstanceNames.AssignTo]),i.initLearningObjectivesListControl(),i.initSubmissionStatusControl()}),$(document).on(this.settings.EventNames.MandatoryFieldsStateChanged,function(){i.settings.EventNames.ValidStateChanged&&$(document).trigger(i.settings.EventNames.ValidStateChanged,i.validateMandatoryFields())}),this.settings.CanUseRubric&&(this.settings.IsAddMode?($(document).on(this.settings.EventNames.RubricChanged,function(e,t){i.learningObjectiveList.syncLearningObjectives(t.loIds),i.updateMaxScore(t.loIds,t.criteriaWeights)}),$(document).on(this.settings.EventNames.UpdateMaxScore,function(e,t){i.updateMaxScore(t.loIds,t.criteriaWeights)})):$(document).on(this.settings.EventNames.LearningObjectiveChanged,function(e,t){i.updateMaxScore(t.ids),i.settingsManager.setRefreshIframeAfterSave()})),$(document).on(this.settings.EventNames.MandatoryFieldsStateChanged+" "+this.settings.EventNames.ElementActivationChangedEventName+" "+this.settings.EventNames.DeadlineStateChanged+" "+this.settings.EventNames.WorkloadChanged,function(){i.settings.EventNames.ValidStateChanged&&$(document).trigger(i.settings.EventNames.ValidStateChanged,i.validateMandatoryFields()&&i.validateElementActivation())}),this.settings.VisibilitySettings.Deadline&&this.settings.IsDeadlineRequired&&this.settings.LearningToolId==this.settings.LearningToolIds.Assignment&&($(document).on(this.settings.EventNames.ElementActivationChangedEventName,function(){i.activationControl?i.deadlinePicker.mandatory(i.activationControl.isActive()||i.activationControl.hasTimeSpan()):i.deadlinePicker.mandatory(!0)}),this.activationControl?this.deadlinePicker.mandatory(this.activationControl.isActive()||this.activationControl.hasTimeSpan()):this.deadlinePicker.mandatory(!0),this.stateChanged())}return Object.defineProperty(t.prototype,"testSecurity",{get:function(){return window[this.settings.ClientInstanceNames.TestSecurity]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"customizedScale",{get:function(){return window[this.settings.ClientInstanceNames.CustomizedScale]},enumerable:!0,configurable:!0}),t.prototype.validateMandatoryFields=function(){var e=!0;this.settings.VisibilitySettings.AssessmentScale&&(e=this.assessmentScaleSelector.isValid());var t=!0;return this.settings.VisibilitySettings.WorkloadSetting&&(t=this.workloadSettingControl.isValid()),e&&t},t.prototype.validateElementActivation=function(){return!this.settings.IsDeadlineRequired||this.settings.LearningToolId!=this.settings.LearningToolIds.Assignment||!(!this.settings.VisibilitySettings.Deadline||this.settings.LearningToolId!=this.settings.LearningToolIds.Assignment)&&(this.activationControl&&!this.activationControl.isActive()&&!this.activationControl.hasTimeSpan()||this.deadlinePicker.isSet())},t.prototype.stateChanged=function(){this.settings.EventNames.ValidStateChanged&&$(document).trigger(this.settings.EventNames.ValidStateChanged,this.validateMandatoryFields()&&this.validateElementActivation())},t.prototype.hideFeedback=function(){this.settings.VisibilitySettings.Deadline&&this.deadlinePicker.mandatory(!1)},t.prototype.updateMaxScore=function(e,t){var n=this;void 0===t&&(t=""),this.assessmentScaleSelector.canUseAutoMaxScore()&&this.assessmentScaleSelector.updateMaxScore(e,t,function(){$(document).trigger(n.settings.EventNames.ValidStateChanged,n.validateMandatoryFields())})},t.prototype.initLearningObjectivesListControl=function(){this.learningObjectiveList||(this.learningObjectiveList=window[this.settings.ClientInstanceNames.LearningObjectiveList])},t.prototype.initSubmissionStatusControl=function(){this.settings.VisibilitySettings.SubmissionStatusForTeacher&&(this.$submissionStatus=document.getElementById(""+this.settings.Controls.SubmissionStatusControl),this.$submissionStatus.value||(this.settingsManager.showFeedbackErrorMessage(this.settings.Terms.NoSubmissionStatusesFound),this.$saveSettingsButton.toggleHyperlink(!1)))},t.prototype.collectSettings=function(){var e={};if(this.settings.VisibilitySettings.Deadline){var t=this.deadlinePicker.getState();e.Deadline=t.DateTime,e.CloseAfterDeadline=t.CloseAfterDeadline}if(this.settings.VisibilitySettings.Homework&&(e.Homework=this.$homeworkCheckBox.checked),this.settings.VisibilitySettings.AssessmentScale){var n=this.assessmentScaleSelector.getState(),i=this.customizedScale?this.customizedScale.getState():null,s={AssessmentScaleId:n.AssessmentScaleId,UseScore:n.IsScore,MaxScore:n.IsScore?n.MaxScore:0,IsCustomized:!1,OneRosterModuleExtensionSetupId:n.OneRosterModuleExtensionSetupId};i&&(s.IsCustomized=i.isCustomized,s.AssessmentItems=i.assessmentItems.map(function(e){return{AssessmentItemId:e.assessmentItemId,PercentFromAndIncl:e.percentFromAndIncl}})),e.AssessmentState=s,e.IsAddToAssessmentRecord=n.AddToGradeBook,e.TermId=n.TermId,e.CategoryId=n.CategoryId}if(this.settings.VisibilitySettings.PeerAssessment&&(this.peerAssessment.activated&&this.peerAssessment.peersToAssessCount>0&&(e.PeersToAssessCount=this.peerAssessment.peersToAssessCount,e.EnableAnonymousPeerAssessment=this.peerAssessment.anonymousPeerAssessmentActivated),e.IsSelfAssessmentActivated=this.peerAssessment.selfAssessmentActivated),this.settings.VisibilitySettings.TestSecurity&&(e.TestSecurityState=this.testSecurity.getState()),this.settings.VisibilitySettings.Attempts&&(e.AttemptsState=this.attemptsControl.getState()),this.settings.VisibilitySettings.ResultsAndFeedback&&(e.ResultsAndFeedbackState=this.resultsAndFeedbackControl.getState()),this.settings.VisibilitySettings.SubmissionStatusForTeacher&&(e.SubmissionStatusId=parseInt(this.$submissionStatus.value,10)),this.settings.VisibilitySettings.GroupSubmission){var o=this.groupActivitySelector.getState();e.IsGroupActivity=o.isGroupActivity,e.SubmissionGroupType=o.groupType}if(this.settings.VisibilitySettings.AnonymousSubmission&&(e.IsAnonymous=this.$anonymousCheckBox.checked),this.settings.VisibilitySettings.PlagiarismControl&&(e.IsCheckPlagiarism=this.$plagiarismCheckBox.checked,e.ShowPlagiarismToStudents=!!this.$showPlagiarismToStudentsCheckBox&&this.$showPlagiarismToStudentsCheckBox.checked),this.settings.VisibilitySettings.Mandatory&&(e.IsNotMandatory=this.$notMandatoryCheckBox.checked),this.activationControl){var r=this.activationControl.getActivationTimeSpanState();e.Active=r.isActive,e.UseActivationTimespan=r.useActivationTimeSpan,e.UseActivationTimespan&&(e.ActivationTimespanFrom=r.fromState.dateAsString,e.ActivationTimespanTo=r.toState.dateAsString)}return this.settings.VisibilitySettings.LearningObjectiveListDialog&&(e.LearningObjectivesIds=this.learningObjectiveList.getLearningObjectiveIds()),this.settings.VisibilitySettings.Results&&(e.IsAssessmentVisible=this.$resultsCheckBox.checked),this.settings.VisibilitySettings.WorkloadSetting&&(e.Workload=this.workloadSettingControl.getWorkloadEnabled(),e.WorkloadEstimation=this.workloadSettingControl.getWorkloadEstimation()),this.settings.VisibilitySettings.DescriptionOnSidebar&&(e.DescriptionOnSidebar=this.$descriptionInput.value),this.settings.VisibilitySettings.AssignTo&&(e.AssignTo=this.assignToSettingControl.getPickerResult()),e},t.prototype.validateControls=function(){return!this.activationControl||this.activationControl.validateControl()},t}();e.Edit=t}(e.Settings||(e.Settings={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(ItslearningWeb){var LearningToolElement;(function(LearningToolElement){var Settings;(function(Settings){!function(e){e[e.Hidden=0]="Hidden",e[e.Summary=1]="Summary",e[e.Read=2]="Read",e[e.OverlayEdit=3]="OverlayEdit"}(Settings.LearningToolElementSettingsView||(Settings.LearningToolElementSettingsView={}));var LearningToolElementSettingsView=Settings.LearningToolElementSettingsView,LearningToolElementSettingsViewAttributes=function(){},Manager=function(){function Manager(e){var t=this;this.viewAttributesMap={},window[Manager.clientInstanceName]=this,this.settings=e,$(function(){var e;t.$body=$("body"),t.$mainContainer=$("#"+t.settings.Controls.MainContainer),t.$contentFrameContainer=$("#"+t.settings.Controls.ContentFrame),t.$settingsControlContainer=$("#"+t.settings.Controls.SettingsControl),t.$editSettingsContainer=$("#"+t.settings.Controls.EditSettingsContainer),t.$readSettingsContainer=$("#"+t.settings.Controls.ReadSettingsContainer),t.$background=$("#"+t.settings.Controls.Background),!t.settings.IsAddMode&&t.$contentFrameContainer.get(0)&&(t.iframe=t.$contentFrameContainer.get(0).contentWindow),t.viewAttributesMap=((e={})[LearningToolElementSettingsView.Hidden]={isDirty:!0,cssClass:t.settings.CssClasses.Views.Hidden},e[LearningToolElementSettingsView.Summary]={$container:t.$readSettingsContainer,isDirty:!1,cssClass:t.settings.CssClasses.Views.Summary,loadViewUrl:t.settings.Urls.ReadSettings,afterLoadFunction:t.afterLoadSummarySettings},e[LearningToolElementSettingsView.Read]={$container:t.$readSettingsContainer,isDirty:!0,cssClass:t.settings.CssClasses.Views.OverlayRead,loadViewUrl:t.settings.Urls.ReadSettings,afterLoadFunction:t.afterLoadReadSettings},e[LearningToolElementSettingsView.OverlayEdit]={$container:t.$editSettingsContainer,isDirty:!0,cssClass:t.settings.CssClasses.Views.OverlayEdit,loadViewUrl:t.settings.Urls.EditSettings,afterLoadFunction:t.afterLoadEditSettings},e),t.attachEventListeners(),t.editFocusTracker=new CCL.FocusTracker(t.$settingsControlContainer),t.settings.IsHidden||(t.settings.IsAddMode?t.switchView(LearningToolElementSettingsView.OverlayEdit,t.settings.CollapsedSettingView):t.settings.CollapsedSettingView?t.switchView(LearningToolElementSettingsView.Summary,t.settings.CollapsedSettingView):t.switchView(LearningToolElementSettingsView.Read,t.settings.CollapsedSettingView))})}return Manager.getInstance=function(){return window[Manager.clientInstanceName]},Manager.prototype.afterLoadSummarySettings=function(){this.stopTrackingFocus()},Manager.prototype.afterLoadReadSettings=function(){this.stopTrackingFocus(),this.setFocusAndHighlight()},Manager.prototype.refreshExtensionFrame=function(){this.iframe&&CCL.CommonFunctions.makePostMessageCall(this.iframe,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.studentWasAssessed))},Manager.prototype.notifyExtensionSettingsUpdated=function(e){this.iframe&&(e?CCL.CommonFunctions.makePostMessageCallWithData(this.iframe,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.extensionSettingsChanged),e):CCL.CommonFunctions.makePostMessageCall(this.iframe,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.extensionSettingsChanged)))},Manager.prototype.refreshTreeMenu=function(){var e=itslTop;e&&e.reloadFolder&&!this.settings.IsLearningPathSubElement&&e.reloadFolder()},Manager.prototype.refreshPageFunctionsMenu=function(e){window[this.settings.ClientInstanceNames.ViewLearningToolElementPage].changePageFunctionsState(e)},Manager.prototype.showFeedbackErrorMessage=function(e,t){void 0===t&&(t=!1),CCL.ErrorFeedback.showFeedback(this.$settingsControlContainer,e,null,t)},Manager.prototype.hideFeedback=function(){var e=this.getSettingsEditor();null!=e&&e.hideFeedback(),CCL.ErrorFeedback.hideFeedback(this.$settingsControlContainer)},Manager.prototype.getSettingsEditor=function(){return null==this.settingsEditor&&(this.settingsEditor=window[this.settings.ClientInstanceNames.EditSettingsViewInstanceName]),this.settingsEditor},Manager.prototype.setRefreshIframeAfterSave=function(){this.settings.NeedRefreshIframeAfterSave=!0},Manager.prototype.attachEventListeners=function(){var e=this,t=$(window);CCL.CommonFunctions.attachPostMessageEventListener(t,CCL.CommonWindowMessages.MessageNames.extensionContentChanged,function(t){t.expandRead?e.switchView(LearningToolElementSettingsView.Read,!0):e.switchView(e.currentView,!0)}),CCL.CommonFunctions.attachPostMessageEventListener(t,[CCL.CommonWindowMessages.MessageNames.hideSettings,CCL.CommonWindowMessages.MessageNames.enableFullScreen],function(){e.switchView(LearningToolElementSettingsView.Hidden)}),CCL.CommonFunctions.attachPostMessageEventListener(t,[CCL.CommonWindowMessages.MessageNames.showSettings,CCL.CommonWindowMessages.MessageNames.disableFullScreen],function(t){e.currentView===LearningToolElementSettingsView.Hidden&&e.switchView(e.previousView,!t||t.ForceReload)}),CCL.CommonFunctions.attachPostMessageEventListener(t,CCL.CommonWindowMessages.MessageNames.reloadParentIframe,function(){window.location.reload(!0)}),this.settings.IsAddMode&&CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.deepLinkContentReceived,function(t){t&&t.extendedData&&e.switchView(LearningToolElementSettingsView.OverlayEdit)}),this.$body.on("click","."+this.settings.CssClasses.ChangeOptionsLink,function(){return e.switchView(LearningToolElementSettingsView.OverlayEdit,!0),!1}).on("click","."+this.settings.CssClasses.SaveSettingsButton,function(){return e.$saveSettingsButton||(e.$saveSettingsButton=$("."+e.settings.CssClasses.SaveSettingsButton)),e.$saveSettingsButton.getIfHyperLinkEnabled()&&e.save(),!1}).on("click","."+this.settings.CssClasses.SettingsDialogExpandButton,function(){e.isMobileView()||(e.switchView(LearningToolElementSettingsView.Read),CCL.CommonFunctions.safeAjaxPost({url:e.settings.Urls.CollapsedSettings}))}).on("click","."+this.settings.CssClasses.Views.Summary+" ."+this.settings.CssClasses.SectionHeaderIconLink,function(t){e.onSummaryIconClick($(t.currentTarget))}).on("click","."+this.settings.CssClasses.ShowMoreOptionsLink,function(){e.toggleMobileOptions(!e.isMobileOptionsExpanded())}).on("keydown",function(t){if(t.which===CCL.CommonConstants.keyCodes.escape)e.currentView!==LearningToolElementSettingsView.Read&&e.currentView!==LearningToolElementSettingsView.OverlayEdit||e.cancelButtonClick()}),this.settings.IsAddMode||this.$body.on("click","."+this.settings.CssClasses.CancelEditSettingsButton,function(){return e.cancelButtonClick()}).on("click","."+this.settings.CssClasses.SettingsDialogCollapseButton,function(){e.switchView(LearningToolElementSettingsView.Summary),CCL.CommonFunctions.safeAjaxPost({url:e.settings.Urls.CollapsedSettings})}),this.$background.click(function(){e.hideFeedback(),e.cancelButtonClick()}),this.settings.IsDeadlineRequired&&$(document).on(this.settings.ValidStateChanged,function(t,n){e.$saveSettingsButton||(e.$saveSettingsButton=$("."+e.settings.CssClasses.SaveSettingsButton)),e.$saveSettingsButton.toggleHyperlink(n)})},Manager.prototype.onSummaryIconClick=function(e){if(!this.isMobileView()){var t=parseInt(e.closest("."+this.settings.CssClasses.SettingSection).data(this.settings.LearningToolElementSettingTypeDataAttribute),10);this.switchToExpandedView(t)}},Manager.prototype.afterLoadEditSettings=function(){var e=this;this.settings.IsDeadlineRequired&&!this.settings.IsAddMode?$(document).on(this.settings.ValidStateChanged,function(t,n){e.$saveSettingsButton=$("."+e.settings.CssClasses.SaveSettingsButton),e.$saveSettingsButton.toggleHyperlink(n)}):this.$saveSettingsButton=$("."+this.settings.CssClasses.SaveSettingsButton),this.$cancelEdittingSettingsButton=$("."+this.settings.CssClasses.CancelEditSettingsButton),this.stopTrackingFocus(),this.settings.IsAddMode||this.editFocusTracker.startTrackFocus(),this.setFocusAndHighlight(),new CCL.ButtonLoadingIndicator("."+this.settings.CssClasses.SettingsWrapper+" ."+this.settings.CssClasses.SaveSettingsButton,this.settings.CssClasses.ButtonInProgress,null,100)},Manager.prototype.setFocusAndHighlight=function(){var e=this;setTimeout(function(){var t=e.viewAttributesMap[e.currentView].$container.find("."+e.settings.CssClasses.SettingSection);t.removeClass(e.settings.CssClasses.SettingsSectionHighlight);var n,i=e.getSectionToHighlight(t);e.controlToHighlight=0,i?(i.addClass(e.settings.CssClasses.SettingsSectionHighlight),n=e.getFirstElementToFocusInContainer(i)):e.settings.IsAddMode||(n=e.getFirstElementToFocusInContainer(e.getViewContainer(e.currentView))),e.scrollToElementIfNeed(i).done(function(){n&&!n.prop("disabled")&&n.focus()})},1)},Manager.prototype.getFirstElementToFocusInContainer=function(e){return e.find("input, a, select").not(document.getElementById(this.settings.Controls.SkipLink)).first()},Manager.prototype.getSectionToHighlight=function(e){var t=this,n=void 0;return $.each(e,function(e,i){var s=$(i);return t.controlToHighlight!==parseInt(s.data(t.settings.LearningToolElementSettingTypeDataAttribute),10)||(n=s,!1)}),n},Manager.prototype.hideAllViews=function(){this.$editSettingsContainer.hide(),this.$readSettingsContainer.hide()},Manager.prototype.showOverlayDialogIfNeeds=function(e){this.$background.toggle(e===LearningToolElementSettingsView.OverlayEdit)},Manager.prototype.switchView=function(e,t){var n=this;if(void 0===t&&(t=!1),e!==this.currentView||t){this.toggleToolTipForCurrentView(!1);var i=this.viewAttributesMap[e];t&&(i.isDirty=!0),i.isDirty&&i.loadViewUrl?$.get(i.loadViewUrl).done(function(t){i.$container.html(t),n.refreshViewUi(e,i),n.toggleToolTipForCurrentView(!0)}).fail(function(){n.alertError()}):(this.refreshViewUi(e,i),this.toggleToolTipForCurrentView(!0))}},Manager.prototype.toggleToolTipForCurrentView=function(e){this.currentView===LearningToolElementSettingsView.Summary&&CCL.UnobtrusiveCustomTooltipManager.enableTooltipOnTarget($("."+this.settings.CssClasses.SettingSection),e)},Manager.prototype.switchToExpandedView=function(e){this.controlToHighlight=isNaN(e)?0:e,this.switchView(this.settings.CanEdit?LearningToolElementSettingsView.OverlayEdit:LearningToolElementSettingsView.Read,this.settings.CanEdit)},Manager.prototype.alertError=function(e){void 0===e&&(e=""),CCL.CommonFunctions.jAlertAjaxError(e||this.settings.Terms.SomethingWentWrong,this.settings.Terms.ErrorOccured,this.settings.Terms.Ok,!1)},Manager.prototype.refreshViewUi=function(e,t){this.$mainContainer.removeClass().addClass(t.cssClass),this.previousView=this.currentView,this.currentView=e,this.hideAllViews(),this.showOverlayDialogIfNeeds(e),this.afterLoadFunction=t.afterLoadFunction,this.afterLoadFunction&&this.afterLoadFunction(),this.toggleMobileOptions(this.isMobileOptionsExpanded()),t.isDirty=!1,t.$container.show();var n=this.getViewContainer(this.currentView).find("."+this.settings.CssClasses.ShowOnlyIfMobileOptionsExpanded).length>0;this.getShowMoreLinkForCurrentView().toggle(n);var i=document.getElementById(this.settings.Controls.SkipLink);i&&i.setAttribute("href","#"+this.settings.SkipLinkTarget)},Manager.prototype.enableSaveCancelButtons=function(e){(this.$cancelEdittingSettingsButton.toggleHyperlink(e),this.$saveSettingsButton.toggleHyperlink(e),this.settings.ClientInstanceNames.ContentHolderClientInstanceName)&&window[this.settings.ClientInstanceNames.ContentHolderClientInstanceName].lockSaveButton(!e)},Manager.prototype.enableSaveCancelButtonsAndToggleSpinner=function(e){this.enableSaveCancelButtons(e),e&&$(this.$saveSettingsButton).trigger(CCL.ButtonLoadingIndicator.eventRemoveLoadingIndicator)},Manager.prototype.cancelButtonClick=function(){return this.settings.IsAddMode||(this.hideFeedback(),this.switchView(this.getViewToSwitchBack())),!1},Manager.prototype.isMobileView=function(){return $(window).width()<=CCL.CommonConstants.mediaScreenSizes.iPadPortraitMode},Manager.prototype.getViewToSwitchBack=function(){switch(this.currentView){case LearningToolElementSettingsView.Read:return LearningToolElementSettingsView.Summary;case LearningToolElementSettingsView.OverlayEdit:return this.isMobileView()?LearningToolElementSettingsView.Read:this.previousView;default:throw"Unsupported view transition"}},Manager.prototype.save=function(isLearningObjectivesRemovalConfirmed){var _this=this;void 0===isLearningObjectivesRemovalConfirmed&&(isLearningObjectivesRemovalConfirmed=!1),this.hideFeedback(),this.enableSaveCancelButtonsAndToggleSpinner(!1);var saveModel=this.collectContentAndSettings(isLearningObjectivesRemovalConfirmed),editViewInstance=window[this.settings.ClientInstanceNames.EditSettingsViewInstanceName];if(!editViewInstance.validateControls())return this.enableSaveCancelButtonsAndToggleSpinner(!0),this.showFeedbackErrorMessage(this.settings.Terms.YourInputIsInvalid,!0),void this.scrollToElementIfNeed($("."+this.settings.CssClasses.InvalidInput+":first"));CCL.CommonFunctions.safeAjaxPost({url:this.settings.Urls.SaveSettings,data:saveModel}).done(function(data){if(data.Success){if(_this.settings.IsAddMode&&data.ClientScriptToCompleteSaving)return void eval(data.ClientScriptToCompleteSaving);if(data.ClientScriptToCompleteSavingExtended){var deferred=eval(data.ClientScriptToCompleteSavingExtended);return void $.when(deferred).then(function(e){!0===e?_this.save(e):_this.enableSaveCancelButtonsAndToggleSpinner(!0)})}if(data.PageUrlToRedirect)return void(_this.settings.TopicId>0?window.top.location.replace(data.PageUrlToRedirect):window.location.replace(data.PageUrlToRedirect));_this.switchView(_this.getViewToSwitchBack(),!0),(_this.settings.NeedRefreshIframeAfterSave||data.RefreshExtensionIframe)&&_this.refreshExtensionFrame(),_this.settings.SettingsUpdateNotification&&_this.notifyExtensionSettingsUpdated(saveModel.Settings.NotificationData),_this.refreshTreeMenu(),_this.refreshPageFunctionsMenu(data.EnableElementActivationPageFeatures)}else _this.showFeedbackErrorMessage(data.Errors.join("<br />"),!0),_this.enableSaveCancelButtonsAndToggleSpinner(!0)}).fail(function(){_this.alertError(),_this.enableSaveCancelButtonsAndToggleSpinner(!0)})},Manager.prototype.collectContentAndSettings=function(e){var t=window[this.settings.ClientInstanceNames.EditSettingsViewInstanceName],n={};if(n.ElementId=this.settings.ElementId,n.IsAddMode=this.settings.IsAddMode,n.TopicId=this.settings.TopicId,n.Settings=t.collectSettings(),n.Settings.IsLearningObjectivesRemovalConfirmed=e,this.settings.ClientInstanceNames.ContentHolderClientInstanceName){var i=window[this.settings.ClientInstanceNames.ContentHolderClientInstanceName];n.Content=i.collectContent()}return n},Manager.prototype.toggleMobileOptions=function(e){var t=e?this.settings.Terms.ShowLess:this.settings.Terms.ShowMore;this.getShowMoreLinkForCurrentView().children("span").text(t),this.getViewContainer(this.currentView).toggleClass(this.settings.CssClasses.ExpandMobileOptions,e)},Manager.prototype.isMobileOptionsExpanded=function(){var e=this.getViewContainer(this.currentView);return e&&e.hasClass(this.settings.CssClasses.ExpandMobileOptions)},Manager.prototype.getShowMoreLinkForCurrentView=function(){var e=this.getViewContainer(this.currentView);return e?e.find("."+this.settings.CssClasses.ShowMoreOptionsLink):null},Manager.prototype.getViewContainer=function(e){return this.viewAttributesMap[e].$container},Manager.prototype.stopTrackingFocus=function(){this.editFocusTracker.stopTrackFocus()},Manager.prototype.scrollToElementIfNeed=function(e){if(!e)return $.when();if(this.settings.IsAddMode)return CCL.CommonFunctions.isElementFullyShownInWindow(e)||window.scrollTo(e.offset().top,0),$.when();var t=this.getViewContainer(this.currentView).find("."+this.settings.CssClasses.OverlayDialogInnerContainer);return CCL.CommonFunctions.isElementFullyShownInContainer(e,t)?$.when():t.animate({scrollTop:e.offset().top},500).promise()},Manager.prototype.refreshReadView=function(){this.switchView(this.currentView,!0)},Manager.clientInstanceName="LearningToolElementSettingsManager",Manager}();Settings.Manager=Manager})(Settings=LearningToolElement.Settings||(LearningToolElement.Settings={}))})(LearningToolElement=ItslearningWeb.LearningToolElement||(ItslearningWeb.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){};e.ManageLearnerDefinedGroupState=t;var n=function(){function e(e,t){var n=this;this.renderItem=function(e,t){return $("<li>").append(t.metadata?'<a>\n                            <img alt="" class="'+n.settings.CssClasses.AutoCompleteItem.Image+'" src="'+t.metadata.ImageUrl+'" />\n                            <span class="'+n.settings.CssClasses.AutoCompleteItem.Info+'">\n                                <span>'+t.label+"</span>\n                                "+(""!==t.metadata.Organization?'<span class="'+n.settings.CssClasses.AutoCompleteItem.Organization+'">'+t.metadata.Organization+"</span>":"")+"\n                            </span>\n                       </a>":'<span class="'+n.settings.CssClasses.AutoCompleteItem.NoMatches+'">'+n.settings.Terms.NoMatches+"</span>").addClass(n.settings.CssClasses.AutoCompleteItem.Item).appendTo(e)},this.participantsAutocomplete=function(e,t){n.participantsAutocompleteRequest&&n.participantsAutocompleteRequest.abort&&n.participantsAutocompleteRequest.abort();var i=n.getAddedPersonIds();n.participantsAutocompleteRequest=$.getJSON(n.settings.WebMethods.FindParticipants.replace("{elementId}",n.settings.ElementId.toString()).replace("{collaborationId}",n.settings.CollaborationId.toString()),{courseId:n.settings.CourseId,search:e.term}).done(function(e){var n=e.filter(function(e){return 0===i.filter(function(t){return t===e.PersonId}).length});if(n.length)t($.map(n,function(e){return{label:e.Name,value:e.Name,metadata:e}}));else{var s=[{value:t.term}];t(s)}}).always(function(){n.participantsAutocompleteRequest=void 0})},this.onRemoveClick=function(e){$(e.target).closest("."+n.settings.CssClasses.GroupList.UserContainer).remove()},window[e]=this,this.settings=t,this.$membersContainer=$("#"+this.settings.Controls.MembersContainerId),this.$groupContentContainer=$("#"+this.settings.Controls.GroupContentContainerClientId),$(function(){n.addPerson(n.settings.CurrentPerson,!0),n.settings.GroupMembers&&n.settings.GroupMembers.length&&n.settings.GroupMembers.forEach(function(e){n.addPerson(e,!1)})}),$(document).on(this.settings.Events.OnSelectUser,function(e,t){if(t){var i={};i.Name=t.Name,i.ImageUrl=t.ImageUrl,i.PersonId=t.PersonId,n.addPerson(i,!1)}})}return e.prototype.addPerson=function(e,t){this.$membersContainer.append(this.getPersonHtml(e,t))},e.prototype.getPersonHtml=function(e,t){var n=$('<div class="'+this.settings.CssClasses.GroupList.UserContainer+'"></div>'),i=$('<div class="'+this.settings.CssClasses.GroupList.ImageContainer+'"><img alt="" src="'+e.ImageUrl+'" class="'+this.settings.CssClasses.GroupList.Image+'" /></div>'),s=$('<div class="'+this.settings.CssClasses.GroupList.NameContainer+'"><span>'+e.Name+"</span></div>");n.data("meta",e).append(i).append(s);var o=$('<div class="'+this.settings.CssClasses.GroupList.RemoveLinkContainer+'"></div>');if(!t){var r=$('<a href="#">&times;</a>');r.click(this.onRemoveClick),o.append(r)}return n.append(o),n},e.prototype.getAddedPersonInfos=function(){return $.makeArray(this.$membersContainer.find("div."+this.settings.CssClasses.GroupList.UserContainer).map(function(e,t){return $(t).data("meta")}))},e.prototype.getAddedPersonIds=function(){return this.getAddedPersonInfos().map(function(e){return e.PersonId})},e.prototype.getState=function(){return{personIds:this.getAddedPersonIds()}},e}();e.ManageLearnerDefinedGroup=n}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={}));var BaseMetadata=function(e,t,n){this.name=e,this.sourceType=t,this.mimeType=n},LocalFileInputHandle=function(){function e(e){this.fileInput=e}return e.prototype.get=function(){return this.fileInput},e}(),LocalFileHandle=function(){function e(e){this.file=e}return e.prototype.get=function(){return this.file},e}(),ExternalSourceFileHandle=function(){function e(e,t,n,i){this.url=e,this.id=t,this.canBeCopied=n,this.canBeShared=i}return e.prototype.get=function(){if(objectState.isNullOrUndefined(this.id))return this.url;var e=null==this.canBeCopied||this.canBeCopied,t=null==this.canBeShared||this.canBeShared;return{url:this.url,id:this.id,canBeCopied:e,canBeShared:t}},e}(),SourceType,SourceType;!function(e){e[e.Dropbox=1]="Dropbox",e[e.Google=2]="Google",e[e.OneDriveForBusiness=3]="OneDriveForBusiness",e[e.Local=4]="Local",e[e.OneDrivePersonal=5]="OneDrivePersonal",e[e.WebDav=6]="WebDav",e[e.Ziggeo=7]="Ziggeo"}(SourceType||(SourceType={})),function(e){e.isOneDrive=function(t){return t===e.OneDrivePersonal||t===e.OneDriveForBusiness},e.isCloud=function(t){return t===e.Dropbox||t===e.Google||e.isOneDrive(t)||t===e.WebDav||t===e.Ziggeo}}(SourceType||(SourceType={}));var FileInOneDriveHandle=function(){function e(e){this.postMessageFile=e}return e.prototype.get=function(){if(objectState.isNullOrUndefined(this.postMessageFile.id))return this.postMessageFile.url;var e=null==this.postMessageFile.canBeCopied||this.postMessageFile.canBeCopied,t=null==this.postMessageFile.canBeShared||this.postMessageFile.canBeShared;return{url:this.postMessageFile.url,viewUrl:this.postMessageFile.viewUrl,downloadUrl:this.postMessageFile.downloadUrl,id:this.postMessageFile.id,canBeCopied:e,canBeShared:t}},e}(),PickerFileResult=function(){function e(e,t,n,i,s,o){this.fileHandle=e,this.name=t,this.size=n,this.sourceType=i,this.relativePath=s,this.mimeType=o}return e.prototype.getFileHandle=function(){return this.fileHandle.get()},e.createExternalSourcePickerFileResult=function(t,n,i,s,o,r,a,l){return new e(new ExternalSourceFileHandle(t,r,a,l),n,i,s,null,o)},e.createLocalPickerFileResultWithInput=function(t,n){return new e(new LocalFileInputHandle(t),n,null,SourceType.Local)},e.createLocalPickerFileResult=function(t){return new e(new LocalFileHandle(t),t.name,t.size,SourceType.Local,null,t.type)},e.createFolderPickerFileResultWithRelativePath=function(t,n){return new e(new LocalFileHandle(t),t.name,t.size,SourceType.Local,n,t.type)},e.createPickerFileResultWithFileName=function(t){return new e(new LocalFileHandle(null),t,0,SourceType.Local,null,null)},e.createOneDrivePickerFileResult=function(t){return new e(new FileInOneDriveHandle(t),t.name,t.size,t.sourceType,null,t.mimeType)},e}(),UploadMetadata=function(e){function t(t,n,i,s,o,r,a,l,c){e.call(this,n,i,r),this.id=t,this.name=n,this.sourceType=i,this.signature=s,this.signedFileRepoId=o,this.mimeType=r,this.isTemplate=a,this.customId=l,this.originalFileId=c}return __extends(t,e),t.castMetadataObjectToUploadMetadata=function(e){return new t(e.id,e.name,e.sourceType,e.signature,e.signedFileRepoId,e.mimeType,!1,e.customId,e.originalFileId)},t.updateName=function(e,t){e.name=t},t.setTemplate=function(e,t){e.isTemplate=t},t.create=function(e,n){var i=e.name,s=e.sourceType,o=e.mimeType,r=null,a=null,l=null,c=null,d=e.getFileHandle().id;return n&&(n.fileGuid&&(r=n.fileGuid),n.signedGuid&&(a=n.signedGuid),n.signedFileRepoId&&(l=n.signedFileRepoId),n.mimeType&&(o=n.mimeType),n.customId&&(c=n.customId)),new t(r,i,s,a,l,o,!1,c,d)},t}(BaseMetadata),ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb,ItslearningWeb;!function(e){!function(t){var n=e.CheckboxStateMachine.State,i=function(){function i(t,n,i,s,o,r,a,l){var c=this;void 0===l&&(l=void 0),this.courseId=t,this.eventId=n,this.utilityBase=i,this.markupBuilderBase=s,this.callbacks=o,this.addResourceDialogTitle=r,this.ajaxClientBase=a,this.mainContainer=l,this.shouldFileBeAttachedToEventImmediately=!1,this.fileUploadInProgress=!1,this.onAddResourceMenuItemLinkClick=function(t){switch(parseInt($(t.currentTarget).data(c.utilityBase.dataAttributeNames.ElementExternalSource),10)){case e.AddResourceMenu.ElementExternalSourceType.Course:c.addFromCourse();break;case e.AddResourceMenu.ElementExternalSourceType.Library:c.addFromLibrary();break;case e.AddResourceMenu.ElementExternalSourceType.Computer:c.fileUploadInProgress||c.addFromComputer()}},this.afterOkClickCallback=function(t){if(t){t.forEach(function(t,n){t!==e.CheckboxStateMachine.State.AttachedByUser&&t!==e.CheckboxStateMachine.State.DetachedByUser||c.currentElementStates.set(n,t)});var n=c.getElementIdsToAttach();c.saveElementStates(),c.callbacks.afterAttachElements&&n.length>0&&c.callbacks.afterAttachElements(n)}},this.currentElementStates=new Map,this.checkboxStateMachine=new e.CheckboxStateMachine.Machine,CCL.CommonFunctions.attachPostMessageEventListener($(window),this.utilityBase.postMessageNames.SendElementIdToCourseFeature,function(e){c.attachElement(e.elementId)})}return i.prototype.attachElement=function(e){this.currentElementStates.set(e,n.AttachedByUser),this.saveElementStates(),this.callbacks.afterAttachElements&&this.callbacks.afterAttachElements(this.getElementIdsToAttach())},i.prototype.removeElement=function(e){var t=this.utilityBase.getElementId(e);this.updateElementState(t),this.markupBuilderBase.removeElement(e,this.callbacks.afterDetachElements)},i.prototype.removeElementById=function(e){this.updateElementState(e),this.markupBuilderBase.removeElement(this.utilityBase.getElementByElementId(e),this.callbacks.afterDetachElements)},i.prototype.toggleElementActivation=function(e){this.utilityBase.toggleElementActivation(e)},i.prototype.addFakeItemToElementSection=function(e){this.markupBuilderBase.addFakeItemIntoElementSection(e,this.mainContainer)},i.prototype.removeFakeItemFromElementSection=function(){this.markupBuilderBase.removeFakeItemFromElementSection()},i.prototype.onFileSelectedImpl=function(e){var n=this;this.toggleAddFromComputerOption(!1),setTimeout(function(){n.fileUploadInProgress&&n.addFakeItemToElementSection(e[0].name)},t.CalendarClientConstants.uploadingFileTimeoutMilliseconds)},i.prototype.onFileUploadSuccessImpl=function(e){var t=this;this.fileUploadInProgress&&(this.addFileRequest=this.ajaxClientBase.createNewFileElementForEvent(this.courseId,this.eventId,e,this.shouldFileBeAttachedToEventImmediately),this.addFileRequest.done(function(e){t.removeFakeItemFromElementSection(),t.toggleAddFromComputerOption(!0),e.Success&&(t.attachElement(e.ElementId),t.callbacks.onElementListChanged&&t.callbacks.onElementListChanged()),t.addFileRequest=void 0}))},i.prototype.onFileUploadFailedImpl=function(e,t){this.cleanRequestsAndOptions(),CCL.CommonFunctions.jAjaxConfirm(t,this.utilityBase.terms.FailedFileUploadChoiceDialogTitle,this.utilityBase.terms.FailedFileUploadChoiceDialogUploadNewFile,this.utilityBase.terms.FailedFileUploadChoiceDialogCancel,function(e){e&&$("#"+Components.ComponentName.localPicker).click()}),this.markupBuilderBase.removeFakeItemFromElementSection(),this.callbacks.onErrorMessageShown&&this.callbacks.onErrorMessageShown()},i.prototype.cleanRequestsAndOptions=function(){this.addFileRequest&&(this.addFileRequest.abort(),this.addFileRequest=void 0),this.toggleAddFromComputerOption(!0)},i.prototype.addFromCourse=function(){var t={elementStates:e.MapUtils.makeCopy(this.currentElementStates),elementType:e.ElementLinkDialog.ContentElementType.All,header:this.addResourceDialogTitle,afterOkClickCallback:this.afterOkClickCallback,showAll:!1,allowFolderSelection:!0,openerPage:e.ElementLinkDialog.ElementsPopupOpener.CalendarEvent,relatedEntityId:this.eventId,maxCountOfAddedElements:this.utilityBase.constants.MaxCountOfAddedElements};e.ElementLinkDialog.elementLinkDialogManagerInstance.openDialog(t,this.ajaxParams)},i.prototype.addFromLibrary=function(){window[this.utilityBase.clientInstanceNamesBase.LibraryBrowserDialog].browseLibrary({CourseId:this.courseId})},i.prototype.addFromComputer=function(){$("#"+Components.ComponentName.localPicker).click()},i.prototype.getElementIdsToAttach=function(){var e=this,t=[];return this.currentElementStates.forEach(function(n,i){e.checkboxStateMachine.isElementChecked(n)&&t.push(i)}),t},i.prototype.updateElementState=function(e){var t=this.currentElementStates.get(e),n=this.checkboxStateMachine.validateAndTransferElementStateAfterClick(!1,t);this.currentElementStates.set(e,n),this.saveElementStates()},i.prototype.toggleAddFromComputerOption=function(e){this.fileUploadInProgress=!e,this.callbacks.onUploadFromComputer&&this.callbacks.onUploadFromComputer(this.fileUploadInProgress)},i}();t.AddEditEventElementLinkManagerBase=i}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(n){var i=function(t){function n(i,s,o,r,a,l,c){if(t.call(this,i,s,o,r,a,o.settings.Terms.AddResourceDialogTitle,l),this.utility=o,this.markupBuilder=r,!a.afterAttachElements)throw Error("Argument afterAttachElements is undefined!");this.loadElementStates(),this.ajaxParams={locationId:i,locationType:e.AddResourceMenu.ElementExternalSourceType.Course},n.instance=window[c]=this}return __extends(n,t),n.onFileUploadSuccess=function(e){n.instance.onFileUploadSuccessImpl(e)},n.onFileUploadFailed=function(e,t){n.instance.onFileUploadFailedImpl(e,t)},n.onFileSelected=function(e){n.instance.onFileSelectedImpl(e)},n.prototype.cleanAndRemoveElementStates=function(){var e=this,t=[];this.currentElementStates.forEach(function(n,i){e.checkboxStateMachine.isElementChecked(n)&&t.push(i)});for(var n=0,i=t;n<i.length;n++){var s=i[n];this.removeElementById(s)}this.saveElementStates()},n.prototype.refreshElementList=function(){this.callbacks.afterAttachElements(this.getElementIdsToAttach())},n.prototype.loadElementStates=function(){var t=this.utility.controls.elementIdsWithStatesHidden.val();this.utility.controls.elementIdsWithStatesHidden.length>0&&t&&(this.currentElementStates=e.MapUtils.jsonStringToMap(t,e.MapUtils.numberKeyConverter))},n.prototype.saveElementStates=function(){this.utility.controls.elementIdsWithStatesHidden.val(e.MapUtils.mapToJsonString(this.currentElementStates)).trigger("change")},n}(t.AddEditEventElementLinkManagerBase);n.ElementLinkManager=i}(t.EditEvent||(t.EditEvent={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(e){function t(t,n,i,s,o,r){var a=this;e.call(this,t,void 0,n,i,s,n.settings.terms.AddResourceDialogTitle,o,r.mainContainer),this.utility=n,this.markupBuilder=i,this.ajaxClient=o,this.dialog=r,this.setToggleElementInDialog=function(e){e.setToggleElement($("#popup_overlay, #popup_container"))},this.callbacks.onErrorMessageShown=function(){return a.setToggleElementInDialog(r)}}return __extends(t,e),t.prototype.getElementIdsHidden=function(){return $(this.utility.dataAttributes.addEventDialogAttachedElementsHidden)},t.prototype.emptyElementIdsHidden=function(){this.getElementIdsHidden().prop("value","[]")},t}(e.AddEditEventElementLinkManagerBase);t.ElementLinkManagerDialogBase=n}(t.ElementLink||(t.ElementLink={}))}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(t){!function(n){var i=e.CheckboxStateMachine.State,s=function(s){function o(e,n,i,o,r){var a=this;s.call(this,void 0,e,i,r,n,o),this.refreshElementList=function(e){a.ajaxClient.getElementListMarkupForEventIds(0,a.utility.controls.addEventStartDateHiddenField.value,a.getCurrentCourseId(),e,a.markupBuilder.getCurrentFakeElementTitle()).done(function(e){a.markupBuilder.rebuildElementListMarkup(a.mainContainer,e),a.mainContainer.find("."+a.utility.settings.cssClasses.ElementList).on("click","."+a.utility.settings.cssClasses.ElementListItemRemove,function(e){a.removeElement($(e.target).closest(a.utility.selectors.elementListItem))})})},this.eventTypeParser=new t.EventTypeParser(e),this.callbacks.afterAttachElements=this.refreshElementList}return __extends(o,s),o.prototype.setParameters=function(t,n){this.ajaxParams={locationId:t,locationType:e.AddResourceMenu.ElementExternalSourceType.Course},this.courseId=t,this.elementListHidden=n,this.loadElementStates()},o.prototype.generateElementSections=function(e,n){var i=this.mainContainer.find("."+this.utility.settings.cssClasses.ContextDialogContent),s=this.mainContainer.find("."+this.utility.settings.cssClasses.SelectedElementListAppendTarget);s.length>0?(s.empty(),this.emptyElementIdsHidden(),i.find("."+this.utility.settings.cssClasses.AddElementButton).remove()):n&&(s=this.markupBuilder.generateElementListAppendTarget(),i.append(s).append(this.markupBuilder.generateAttachedElementsHidden())),n&&(this.markupBuilder.renderAddButtonWithElementSections(i,{courseId:e,enableElementLinkManagement:!0,elementListMarkups:{Resources:void 0,ResourceCount:0,Homework:void 0,HomeworkCount:0}},t.EventDetailsType.ContextDialog),this.setParameters(e,this.getElementIdsHidden()))},o.prototype.onFullScreenClosed=function(){this.refreshElementList(this.getElementIdsToAttach())},o.prototype.loadElementStates=function(){var e=this;this.currentElementStates=new Map;var t=this.elementListHidden.val();this.elementListHidden.length>0&&t&&JSON.parse(t).forEach(function(t){e.currentElementStates.set(t,i.AttachedByUser)})},o.prototype.saveElementStates=function(){var e=[];this.currentElementStates.forEach(function(t,n){t===i.AttachedByUser&&e.push(n)}),this.elementListHidden.val(JSON.stringify(e))},o.prototype.setCalendarEventElementLinkManager=function(){n.ElementLinkManagerDialogBase.currentManager=window[this.utility.settings.constants.CalendarEventElementLinkManager]=this},o.prototype.getCurrentCourseId=function(){return this.eventTypeParser.parseCourseId(this.utility.controls.addEventCalendarsDropdown.val())},o}(n.ElementLinkManagerDialogBase);n.AddEventElementLinkManager=s}(t.ElementLink||(t.ElementLink={}))}(t.Schedule||(t.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(t){!function(t){var n=e.CheckboxStateMachine.State,i=function(i){function s(e,t,n,s,o){i.call(this,void 0,e,n,o,t,s),this.dialogCallbacks=o,this.isElementDeletionConfirmationShown=!1,this.shouldFileBeAttachedToEventImmediately=!0}return __extends(s,i),s.prototype.setCalendarEventElementLinkManager=function(){t.ElementLinkManagerDialogBase.currentManager=window[this.utility.settings.constants.CalendarEventElementLinkManager]=this},s.prototype.setParameters=function(t){this.currentEvent=t,this.ajaxParams={locationId:this.currentEvent.courseId,locationType:e.AddResourceMenu.ElementExternalSourceType.Course},this.courseId=this.currentEvent.courseId,this.loadElementStates(),this.eventId=t.activityId},s.prototype.onRemoveElementClick=function(e,t){var i=this,s=e.closest(this.utility.selectors.elementListItem),o=s.find("."+this.utility.settings.cssClasses.ElementListTitle).text();this.isElementDeletionConfirmationShown=!0,CCL.CommonFunctions.jAjaxConfirm(CCL.CommonFunctions.formatString(this.utility.settings.terms.removeElementConfirmation,o),CCL.CommonFunctions.formatString(this.utility.settings.terms.RemoveTooltipTemplate,o),this.utility.settings.terms.alertOkButtonCaption,this.utility.settings.terms.AlertCancelButtonCaption,function(e){if(i.isElementDeletionConfirmationShown=!1,e){i.dialogCallbacks.dialogPositionRecalculation();var t=i.utility.getElementForEventData(s);i.ajaxClient.removeElement({EventId:t.EventId,ElementId:t.ElementId}).done(function(){i.currentElementStates.set(t.ElementId,n.DetachedByUser),i.onRemoveElementsComplete(s)})}})},s.prototype.onFullScreenClosed=function(){var e=this;this.ajaxClient.getElementListMarkupForEvent({eventId:this.eventId,fakeElementTitle:this.markupBuilder.getCurrentFakeElementTitle()}).done(function(t){e.onUpdateEventElementsComplete(t)})},s.prototype.getIfElementDeletionConfirmationIsShown=function(){return this.isElementDeletionConfirmationShown},s.prototype.saveElementStates=function(){var t=this,n=[],i=[];this.currentElementStates.forEach(function(t,s){switch(t){case e.CheckboxStateMachine.State.AttachedByUser:n.push(s);break;case e.CheckboxStateMachine.State.DetachedByUser:i.push(s)}}),(n.length>0||i.length>0)&&this.ajaxClient.updateEventElements({EventId:this.currentEvent.activityId,ElementIdsToAdd:n,ElementIdsToRemove:i,FakeElementTitle:this.markupBuilder.getCurrentFakeElementTitle()}).done(function(e){t.onUpdateEventElementsComplete(e)})},s.prototype.loadElementStates=function(){var t=this;this.currentElementStates=new Map;var n=[];return this.currentDialogContainer||(this.currentDialogContainer=this.mainContainer),this.currentDialogContainer.find("."+this.utility.settings.cssClasses.ElementList).find(this.utility.selectors.elementListItem).each(function(i,s){var o=t.utility.getElementForEventData($(s));o.AddedManually&&t.currentElementStates.set(o.ElementId,e.CheckboxStateMachine.State.Saved),o.CanBeRemoved||n.push(o.ElementId)}),n},s.prototype.addFromCourse=function(){var t=this.loadElementStates(),n={elementStates:e.MapUtils.makeCopy(this.currentElementStates),disabledElementIds:t,afterOkClickCallback:this.afterOkClickCallback,maxCountOfAddedElements:this.utility.constants.MaxCountOfAddedElements,elementType:e.ElementLinkDialog.ContentElementType.All,showAll:!0,header:this.utility.settings.terms.AddResourceDialogTitle,allowFolderSelection:!0,openerPage:e.ElementLinkDialog.ElementsPopupOpener.CalendarEvent};e.ElementLinkDialog.elementLinkDialogManagerInstance.openDialog(n,this.ajaxParams)},s.prototype.onUpdateEventElementsComplete=function(e){e&&this.markupBuilder.rebuildElementListMarkup(this.currentDialogContainer,e),this.dialogCallbacks.onElementListChanged()},s.prototype.onRemoveElementsComplete=function(e){this.markupBuilder.removeElement(e,this.dialogCallbacks.dialogPositionRecalculation),this.dialogCallbacks.onElementListChanged()},s}(t.ElementLinkManagerDialogBase);t.EditEventElementLinkManager=i}(t.ElementLink||(t.ElementLink={}))}(t.Schedule||(t.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(){function t(t,n){var i=this;this.settings=n,window[t]=this,this.settings=n,this.$saveButton=$("#"+this.settings.Controls.GroupDialogOkButton),this.$cancelButton=$("#"+this.settings.Controls.GroupDialogCancelButton),this.$learnerDefinedGroupLink=$("#"+this.settings.Controls.GroupLink),this.$submitIndividuallyLink=$("#"+this.settings.Controls.SubmitIndividuallyLink),this.$withdrawLink=$("#"+this.settings.Controls.WithdrawLink),this.manageGroupDialog=window[this.settings.Controls.ManageGroupDialog],this.settingManager=e.Settings.Manager.getInstance(),$(function(){i.manageGroupDialog.setCustomScripts({afterOpenDialog:function(){setTimeout(function(){$("."+i.settings.Css.ExpandedExtensionIframe).addClass(i.settings.Css.ExpandedExtensionIframeStackedUnderSettings)},100)},beforeCloseDialog:function(){$("."+i.settings.Css.ExpandedExtensionIframe).removeClass(i.settings.Css.ExpandedExtensionIframeStackedUnderSettings)}}),i.$submitIndividuallyLink.on("click",function(){CCL.CommonFunctions.safeAjaxPost({url:i.settings.WebMethods.UseIndividualSubmission.replace("{elementId}",i.settings.ElementId.toString())}).done(function(e){return i.processResponse(e)}).fail(function(){return i.settingManager.alertError()})}),i.$learnerDefinedGroupLink.on("click",function(){i.manageGroupDialog.openDialog(!1)}),i.$withdrawLink.on("click",function(){i.settings.IsIndividualSubmission?i.withdrawFromGroup():CCL.CommonFunctions.jAjaxConfirm(i.settings.Terms.WithdrawConfirmation,i.settings.Terms.ConfirmTitle,i.settings.Terms.Yes,i.settings.Terms.No,function(e){e&&i.withdrawFromGroup()})}),i.$saveButton.on("click",function(){i.saveGroup()&&CssModal.closeDialog()}),i.$cancelButton.on("click",function(){CssModal.closeDialog()})})}return t.prototype.saveGroup=function(){var e=this;this.$saveButton.toggleHyperlink(!1);var t=$("#"+this.settings.Controls.ManageGroupDialog).find("iframe").get(0).contentWindow[this.settings.ManageGroupDialogInstanceName].getState();return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.CreateCollaborationBasedOnLearnerDefinedGroup.replace("{elementId}",this.settings.ElementId.toString()),data:{personIds:t.personIds}}).done(function(t){return e.processResponse(t)}).fail(function(){return e.settingManager.alertError()}),!0},t.prototype.withdrawFromGroup=function(){var e=this;CCL.CommonFunctions.safeAjax({type:"DELETE",url:this.settings.WebMethods.WithdrawFromLearnerDefinedGroup.replace("{elementId}",this.settings.ElementId.toString())}).done(function(t){return e.processResponse(t)}).fail(function(){return e.settingManager.alertError()})},t.prototype.processResponse=function(e){e.Success?window.location.href=window.location.href.split("#")[0]:this.settingManager.alertError(e.Message)},t}();t.LearnerDefinedGroups=n}(t.Collaboration||(t.Collaboration={}))}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t,n,i,s){this._isActive=e,this._useTimeSpan=t,this._timeZoneOffsetInSeconds=n,this._incorrectFormatTerm=i,this._dateShouldBeSetTerm=s}return Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isActive},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useActivationTimeSpan",{get:function(){return this._useTimeSpan},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fromDateTime",{get:function(){return this.fromState.date},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toDateTime",{get:function(){return this.toState.date},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isValid",{get:function(){if(!this.useActivationTimeSpan)return!0;var e=this.validationErrors;return 0===e.fromValidationError.length&&0===e.toValidationError.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fromNow",{get:function(){return!this.useActivationTimeSpan||this.useActivationTimeSpan&&null==this.fromDateTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"toInfinity",{get:function(){return!this.useActivationTimeSpan||this.useActivationTimeSpan&&null==this.toDateTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"validationErrors",{get:function(){var e={fromValidationError:"",toValidationError:""};return this.useActivationTimeSpan?(this.fromState.isValid||(e.fromValidationError=this._incorrectFormatTerm),this.toState.isValid||(e.toValidationError=this._incorrectFormatTerm),e.fromValidationError.length>0||e.toValidationError.length>0||!this.toInfinity&&this.fromNow&&(e.fromValidationError=this._dateShouldBeSetTerm),e):e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isActiveAccordingToTimeSpan",{get:function(){if(!this.useActivationTimeSpan)return this.isActive;var e=CCL.DateFunctions.getItslNow(this._timeZoneOffsetInSeconds);return!(!this.fromNow||!this.toInfinity)||(this.fromNow?this.isFirstLessThanSecond(e,this.toDateTime):this.toInfinity?this.isFirstLessThanSecond(this.fromDateTime,e):this.isFirstLessThanSecond(this.fromDateTime,e)&&this.isFirstLessThanSecond(e,this.toDateTime))},enumerable:!0,configurable:!0}),e.prototype.isFirstLessThanSecond=function(e,t){if(e&&t)return e<t},e}();e.ActivationTimeSpanState=t;var n=function(){function e(e,t){var n=this;window[e]=this,this.settings=t,this.isElementActiveNow=this.settings.IsActive,this.useTimespan=this.settings.UseActivationTimespan,$(function(){n.fillJQueryElements(),n.fromDateTimePickerInstance=window[n.settings.ClientInstances.FromDateTimePickerClientInstanceName],n.toDateTimePickerInstance=window[n.settings.ClientInstances.ToDateTimePickerClientInstanceName],n.$activationLink.add(n.$activationLabel).click(function(){n.useTimespan&&(n.useTimespan=!1),n.isElementActiveNow=!n.isElementActiveNow,n.updateControlState(),CCL.UnobtrusiveCustomTooltipManager.closeTooltip()}),n.$toggleTimespanLink.click(function(){n.useTimespan=!n.useTimespan,n.updateControlState()}),n.updateControlState(),$(n.fromDateTimePickerInstance).add($(n.toDateTimePickerInstance)).change(function(){return n.updateControlState()})})}return e.prototype.getActivationTimeSpanState=function(){var e=new t(this.isElementActiveNow,this.useTimespan,this.settings.TimeZoneOffsetInSeconds,this.settings.Terms.DateMustBeOnTheFormatX,this.settings.Terms.PleaseEnterDate);return e.useActivationTimeSpan&&(e.fromState=this.fromDateTimePickerInstance.getDateTimePickerState(),e.toState=this.toDateTimePickerInstance.getDateTimePickerState()),e},e.prototype.hasTimeSpan=function(){if(!this.useTimespan)return!1;var e=this.getActivationTimeSpanState();return e.fromState.isValid&&!e.fromState.isEmpty},e.prototype.isActive=function(){return this.isElementActiveNow},e.prototype.validateControl=function(){var e=this.getActivationTimeSpanState(),t=e.validationErrors,n={isInvalid:t.fromValidationError&&t.fromValidationError.length>0,errorMessage:t.fromValidationError,highlightInput:!0},i={isInvalid:t.toValidationError&&t.toValidationError.length>0,errorMessage:t.toValidationError,highlightInput:!0};return this.fromDateTimePickerInstance.toggleValidationError(n),this.toDateTimePickerInstance.toggleValidationError(i),e.isValid},e.prototype.isStringNullOrEmpty=function(e){return!e||0===e.length},e.prototype.fillJQueryElements=function(){this.$textAndIconContainer=$("#"+this.settings.Controls.TextAndIconContainer),this.$activationLink=$("#"+this.settings.Controls.ActivationLink),this.$activationImage=this.$activationLink.find("img"),this.$activationLabel=$("#"+this.settings.Controls.ActivationLabel),this.$toggleTimespanLink=$("#"+this.settings.Controls.ToggleTimespanLink),this.$timespanContainer=$("#"+this.settings.Controls.TimespanContainer),this.$fromDateInput=$("#"+this.settings.Controls.FromDateInput),this.$fromHoursDropDown=$("#"+this.settings.Controls.FromHoursDropDown),this.$fromMinutesDropDown=$("#"+this.settings.Controls.FromMinutesDropDown),this.$toDateInput=$("#"+this.settings.Controls.ToDateInput),this.$toHoursDropDown=$("#"+this.settings.Controls.ToHoursDropDown),this.$toMinutesDropDown=$("#"+this.settings.Controls.ToMinutesDropDown)},e.prototype.updateControlState=function(){var e=this.getActivationTimeSpanState();if(e.useActivationTimeSpan){var t=e.isActiveAccordingToTimeSpan;null!=t&&(this.isElementActiveNow=t)}this.$timespanContainer.toggle(this.useTimespan),this.$toggleTimespanLink.toggleClass(this.settings.Css.AddLink,!this.useTimespan).toggleClass(this.settings.Css.RemoveLink,this.useTimespan),this.$toggleTimespanLink.find("span").text(this.useTimespan?this.settings.Terms.RemoveScheduledVisibility:this.settings.Terms.AddScheduledVisibility),this.$activationLabel.html(this.isElementActiveNow?this.settings.Terms.ResourceIsVisible:this.settings.Terms.ResourceIsNotVisible),this.$activationImage.attr("src",this.isElementActiveNow?this.settings.Images.Active:this.settings.Images.Inactive);var n=this.isElementActiveNow?this.settings.Tooltips.ClickToMakeInvisible:this.settings.Tooltips.ClickToMakeVisible;CCL.UnobtrusiveCustomTooltipManager.setTooltipContentOnTarget(this.$activationLink,n),CCL.UnobtrusiveCustomTooltipManager.setTooltipContentOnTarget(this.$activationLabel,n),this.settings.Events.ElementActivationChangedEventName&&$(document).trigger(this.settings.Events.ElementActivationChangedEventName)},e}();e.Activation=n}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;if(window[e]=this,this.settings=t,this.$toggle=$("#"+t.Controls.CompletedToggle),this.$simpleStatusSelector=$("#"+t.Controls.SimpleStatusSelector),this.$toggle.length>0||this.$simpleStatusSelector.length>0){this.$score=$("#"+t.Controls.Score),this.$assessment=$("#"+t.Controls.Assessment);var i=$("#"+t.Controls.CompletedToggleLabel),s=$("#"+t.Controls.AssessmentLabel+", #"+t.Controls.ScoreLabel);this.$toggle.on(t.ToggleStateChangedEventName,function(e,n){var o=window[n.toggleInstanceId];o.isChecked()?i.html(t.Terms.CompletedToggleOn):i.html(t.Terms.CompletedToggleOff),s.toggleClass(t.CssClasses.MandatoryMark,o.isChecked())}),this.settings.IsAssessmentMandatoryForCompletedStatus&&(this.$score.add(this.$simpleStatusSelector).change(function(){s.toggleClass(t.CssClasses.MandatoryMark,n.isAsessmentMissingForCompleted())}),this.$assessment.on("autocompletechange",function(){s.toggleClass(t.CssClasses.MandatoryMark,n.isAsessmentMissingForCompleted())}))}this.rubricToggleChangeValue=t.RubricToggleChangeValue,this.$criteriaAssessmentToggle=$("#"+this.settings.Controls.CriteriaAssessment),this.$rubricCriteriaList=$("#"+this.settings.Controls.RubricCriteriaList),this.$criteriaAssessmentToggle.change(function(){return n.toggleCriteriaAssessmentList()})}return e.prototype.toggleCriteriaAssessmentList=function(){var e=this.$criteriaAssessmentToggle.val()===this.rubricToggleChangeValue;this.$rubricCriteriaList.toggleClass(this.settings.CssClasses.Hidden,!e)},e.prototype.isAsessmentMissingForCompleted=function(){return(this.$toggle.is(":checked")||this.$simpleStatusSelector.val()===this.settings.SimpleStatusSelectorCompletedValue)&&(this.$assessment.val()===this.settings.NotAssessedValue||""===this.$score.val())},e.prototype.validateAssessmentForCompleted=function(e,t){t.IsValid=!this.isAsessmentMissingForCompleted()},e}();e.ActivityMultipleAssessment=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){this.synchronize(e)}return Object.defineProperty(e.prototype,"currentClientTime",{get:function(){return(new Date).getTime()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"clientDeltaTime",{get:function(){return this.currentClientTime-this.clientFixedTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentServerTime",{get:function(){return new Date(this.serverFixedTime+this.clientDeltaTime)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentServerTimeWithoutSeconds",{get:function(){var e=this.currentServerTime;return e.setSeconds(0),e.setMilliseconds(0),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSynchronizeNeeded",{get:function(){return this.clientDeltaTime>3e5},enumerable:!0,configurable:!0}),e.prototype.synchronize=function(e){this.serverFixedTime=e.getTime(),this.clientFixedTime=this.currentClientTime},e}();e.DateTimeSynchronizer=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e,t){var n=this;this.endDate=new Date,window[e]=this,this.settings=t,this.datePeriod=this.settings.DatePeriod,this.startDate=$.datepicker.parseDate(this.settings.DateFormat,this.settings.StartDate),this.setEndDate(),this.weekNumber=this.settings.WeekNumber,this.dayNames=this.settings.DayNames,$(function(){n.$prevButton=$("#"+n.settings.ClientIds.PrevButton),n.$nextButton=$("#"+n.settings.ClientIds.NextButton),n.$dateShortLabel=$("#"+n.settings.ClientIds.DateShortLabel),n.$datePrefixLabel=$("#"+n.settings.ClientIds.DatePrefixLabel),n.$prevButton.click(function(){return n.goToPreviousPeriod()}),n.$nextButton.click(function(){return n.goToNextPeriod()}),n.triggerPeriodChangedEvent()})}return t.prototype.toggleNavigationButtons=function(e){this.$prevButton.toggleHyperlink(e),this.$nextButton.toggleHyperlink(e)},t.prototype.changeDatePeriod=function(e){this.startDate=$.datepicker.parseDate(this.settings.DateFormat,e),this.setEndDate(),this.setWeekNumber(),this.updateTitleLabel(),this.triggerPeriodChangedEvent()},t.prototype.toggleWeekDayMode=function(t,n){switch(this.datePeriod=t,this.datePeriod){case e.DatePeriod.Day:this.$prevButton.prop("title",this.settings.Terms.GoToThePreviousDay),this.$nextButton.prop("title",this.settings.Terms.GoToTheNextDay);break;case e.DatePeriod.Week:this.$prevButton.prop("title",this.settings.Terms.GoToThePreviousWeek),this.$nextButton.prop("title",this.settings.Terms.GoToTheNextWeek)}this.changeDatePeriod(n)},t.prototype.goToPreviousPeriod=function(){this.$prevButton.getIfHyperLinkEnabled()&&(this.setNewPeriodDates(-this.getNumberOfDaysInPeriod()),this.updateTitleLabel(),this.triggerPeriodChangedEvent(),this.$prevButton.removeAttr("disabled"),this.$prevButton.focus())},t.prototype.goToNextPeriod=function(){this.$nextButton.getIfHyperLinkEnabled()&&(this.setNewPeriodDates(this.getNumberOfDaysInPeriod()),this.updateTitleLabel(),this.triggerPeriodChangedEvent(),this.$nextButton.removeAttr("disabled"),this.$nextButton.focus())},t.prototype.setNewPeriodDates=function(e){this.startDate&&(this.setStartDate(e),this.setEndDate(),this.setWeekNumber())},t.prototype.setStartDate=function(e){this.startDate=this.addDays(this.startDate,e),this.startDate.setHours(0),this.startDate.setMinutes(0)},t.prototype.setEndDate=function(){this.endDate=this.addDays(this.startDate,this.getNumberOfDaysInPeriod()-1),this.endDate.setHours(23),this.endDate.setMinutes(59)},t.prototype.setWeekNumber=function(){this.weekNumber=$.datepicker.iso8601Week(this.startDate)},t.prototype.triggerPeriodChangedEvent=function(){$(this).trigger(t.periodChangedEventName,{startDate:this.getStartDate(),endDate:this.getEndDate()})},t.prototype.addDays=function(e,t){var n=new Date(e.valueOf());return n.setDate(n.getDate()+t),n},t.prototype.updateTitleLabel=function(){var t=this.settings.ShowWeekNumber?String.format(this.settings.Terms.WeekNumberTemplate,this.weekNumber.toString()):"",n=$.datepicker.formatDate(this.settings.DateFormat,this.startDate),i=$.datepicker.formatDate(this.settings.DateFormat,this.endDate);switch(this.$datePrefixLabel.toggle(this.datePeriod===e.DatePeriod.Day||this.settings.ShowWeekNumber),this.datePeriod){case e.DatePeriod.Day:this.$datePrefixLabel.text(this.dayNames[this.startDate.getDay()]),this.$dateShortLabel.text(n);break;case e.DatePeriod.Week:this.$datePrefixLabel.text(t),this.$dateShortLabel.text(n+" - "+i);break;default:throw new Error("Incorrect date period occurred: "+this.datePeriod+".")}},t.prototype.getNumberOfDaysInPeriod=function(){switch(this.datePeriod){case e.DatePeriod.Day:return 1;case e.DatePeriod.Week:return 7;default:throw new Error("Incorrect date period occurred: "+this.datePeriod+".")}},t.prototype.getDateTimeAsString=function(t){return t?$.datepicker.formatDate(this.settings.DateFormat,t)+" "+e.DateTimePicker.getNumberAsTwoCharString(t.getHours())+":"+e.DateTimePicker.getNumberAsTwoCharString(t.getMinutes()):""},t.prototype.getStartDate=function(){return this.getDateTimeAsString(this.startDate)},t.prototype.getEndDate=function(){return this.getDateTimeAsString(this.endDate)},t.periodChangedEventName="datePeriodSelector:periodChanged",t}();e.DatePeriodSelector=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e){function t(t,n,i,s){e.call(this,t,n,i,s)}return __extends(t,e),t.prototype.getParams=function(e){return{Date:e.attr("data-date"),MeasurementId:e.parent().parent().attr("data-kpi-m-id")}},t.prototype.paramsAreEqual=function(e,t){return null!=e&&(e.Date===t.Date&&e.MeasurementId===t.MeasurementId)},t.prototype.formatUrlParams=function(e){return{date:e.Date,measurementid:e.MeasurementId}},t}(e.BaseDetailedInfo);e.FeatureAdoptionDetailedInfo=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;window[e]=this,this.settings=t,$(function(){n.$dataHidden=$("#"+n.settings.Controls.DataHidden),n.$listContainer=$("#"+n.settings.Controls.ListContainer),n.$orderChangedHidden=$("#"+n.settings.Controls.OrderChangedHidden),n.$listContainer.on("click","."+n.settings.Css.RemoveLink,function(e){var t=$(e.currentTarget).closest("li"),i=parseInt(t.data("id"),10);n.deleteElement(i)})})}return e.prototype.getElementIds=function(){var e=this.$dataHidden.val();return e?JSON.parse(e):[]},e.prototype.updateOrder=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];if(i&&i.length){var s=parseInt(i);isNaN(s)||t.push(s)}}t.length>0&&this.$dataHidden.val(JSON.stringify(t)),this.$orderChangedHidden.val("true")},e.prototype.addElement=function(e){var t=this;return $.getJSON(this.settings.WebMethods.GetElement.replace("{elementId}",e.toString())).done(function(e){t.addElementItem(e.ElementId,e.Title,e.IsActive,e.IconUrl)})},e.prototype.addElements=function(e){var t=this;return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.GetElements.replace("{courseId}",this.settings.CourseId.toString()),data:{elementIds:e},dataType:"json"}).done(function(e){$.each(e,function(e,n){t.addElementItem(n.ElementId,n.Title,n.IsActive,n.IconUrl)})})},e.prototype.addElementItem=function(e,t,n,i){var s=JSON.parse(this.$dataHidden.val());if(-1===$.inArray(e,s)){var o=this.settings.Terms.RemoveTooltip.replace("{0}",t),r=n?"":this.settings.Css.Inactive;this.$listContainer.append($("<li></li>").attr("data-id",e).append($("<span></span>").attr("class",this.settings.Css.ListItem).append($("<span></span>").attr("class",this.settings.Css.AssignmentIcon).append($("<img>").attr("src",i)).append($("<span></span>").attr("class",r).text(t)).append("&nbsp;")).append($("<span></span>").attr("class",this.settings.Css.RemoveLink).attr("title",o).text(this.settings.DeleteChar)))),s.push(e),this.$dataHidden.val(JSON.stringify(s)),this.$orderChangedHidden.val("true")}else{var a=this.$listContainer.find(CCL.CommonFunctions.getDataSelector("id",e)+" span:first-child span:first-child span");a.text(t),a.toggleClass(this.settings.Css.Inactive,!n)}},e.prototype.deleteElement=function(e){var t=JSON.parse(this.$dataHidden.val()),n=t.indexOf(e);n>-1&&(t.splice(n,1),this.$dataHidden.val(JSON.stringify(t)));var i=this.$listContainer.find(CCL.CommonFunctions.getDataSelector("id",e));i&&i.remove()},e.prototype.deleteElements=function(e){var t=this;$.each(e,function(e,n){t.deleteElement(n)})},e}();e.ElementList=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function t(t,n){var i=this;this.viewModel=n,window[t]=this,this.controlsProvider=new e.ResultsAndFeedbackInternals.ControlsProvider(n),this.externalDependenciesController=new e.ResultsAndFeedbackInternals.ExternalDependenciesController(n,this.controlsProvider),this.whenToShowResultsController=new e.ResultsAndFeedbackInternals.WhenToShowResultsController(n,this.controlsProvider,this.externalDependenciesController),this.whenToShowQuestionListAndAnswerController=new e.ResultsAndFeedbackInternals.WhenToShowQuestionListAndAnswerController(n,this.controlsProvider,this.whenToShowResultsController,this.externalDependenciesController),$(function(){i.controlsProvider.$revealCorrectAnswerContainer.toggle(i.whenToShowQuestionListAndAnswerController.whenToShowQuestionListAndAnswer!==e.WhenToShowQuestionListAndAnswer.Never)})}return Object.defineProperty(t.prototype,"revealCorrectAnswer",{get:function(){return this.controlsProvider.revealCorrectAnswerElement.is(":checked")},enumerable:!0,configurable:!0}),t.prototype.getState=function(){return{WhenToShowResult:this.whenToShowResultsController.whenToShowResult,WhenToShowQuestionListAndAnswer:this.whenToShowQuestionListAndAnswerController.whenToShowQuestionListAndAnswer,RevealCorrectAnswer:this.revealCorrectAnswer,WhenToShowResultsChanged:this.whenToShowResultsController.whenToShowResultsChanged}},t}();e.ResultsAndFeedback=t}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function t(e,t){var n=this;this.viewModel=t,this.attemptsChanged=function(e){var t=n.maxAttemptsAllowed;n.whichAttemptCountsContainer.toggle(1!==t)},window[e]=this,$(function(){n.controlElement=$("#"+t.ContainerId),n.maxAttemptsAllowedElement=$("."+t.MaxAttemptsAllowedSelector,n.controlElement),n.whichAttemptCountsElement=$("."+t.WhichAttemptCountsSelector,n.controlElement),n.whichAttemptCountsContainer=$("#"+t.WhichAttemptCountsContainer,n.controlElement),n.maxAttemptsAllowedElement.change(n.attemptsChanged).change()})}return Object.defineProperty(t.prototype,"maxAttemptsAllowed",{get:function(){return parseInt(this.maxAttemptsAllowedElement.val(),10)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"whichAttemptCounts",{get:function(){var t=this.whichAttemptCountsElement.val();return e.WhichAttemptCounts[t]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"timeLimitValue",{get:function(){var e=window[this.viewModel.TimeLimitClientInstanceName];return null==e?0:e.getState().timeLimit},enumerable:!0,configurable:!0}),t.prototype.getState=function(){return{MaxAttemptsAllowed:this.maxAttemptsAllowed,WhichAttemptCounts:this.whichAttemptCounts,WhichAttemptCountsChanged:this.whichAttemptCounts!==this.viewModel.AttemptsState.WhichAttemptCounts,TimeLimit:this.timeLimitValue}},t}();e.Attempts=t}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){};e.DateWithAdditionalInfo=t;var n=function(){function e(e,t,n,i){if(this._dateFormat=e,n<0||n>=24||i<0||i>=60)this._isValid=!1;else if(t&&t.length){this._isEmpty=!1;try{this._date=$.datepicker.parseDate(this._dateFormat,t),this._date.setHours(n),this._date.setMinutes(i),this._isValid=!0}catch(e){this._isValid=!1}}else this._isEmpty=!0,this._isValid=!0}return Object.defineProperty(e.prototype,"isValid",{get:function(){return this._isValid},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return this._isEmpty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"date",{get:function(){return this._date},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateAsString",{get:function(){return this.isEmpty||!this.isValid?"":$.datepicker.formatDate(this._dateFormat,this._date)+" "+e.getNumberAsTwoCharString(this._date.getHours())+":"+e.getNumberAsTwoCharString(this._date.getMinutes())},enumerable:!0,configurable:!0}),e.getNumberAsTwoCharString=function(e){var t=e.toString();return 1===t.length?"0"+t:t},e}();e.DateTimePickerState=n;var i=function(){function e(e,t){var n=this;this.getDatesToHighlight=function(e,t){return new Array},window[e]=this;this.settings=t,this.$datePickerInput=$("#"+this.settings.Controls.DateInputId),this.$hoursDropDown=$("#"+this.settings.Controls.HoursDropDownId),this.$minutesDropDown=$("#"+this.settings.Controls.MinutesDropDownId),this.$validationMessage=$("#"+this.settings.Controls.ValidationMessageId),this.$textDescription=$("#"+this.settings.Controls.TextDescriptionId);var i={showOn:"focus",buttonImage:"",buttonImageOnly:!1,showButtonPanel:!0,showOtherMonths:!0,selectOtherMonths:!0};i.dateFormat=this.settings.DatePickerOptions.DateFormat,i.firstDay=this.settings.DatePickerOptions.FirstDayOfWeek,i.monthNames=this.settings.DatePickerOptions.MonthNames,i.monthNamesShort=this.settings.DatePickerOptions.MonthNamesShort,i.dayNames=this.settings.DatePickerOptions.DayNames,i.dayNamesShort=this.settings.DatePickerOptions.AbbreviatedDayNames,i.dayNamesMin=this.settings.DatePickerOptions.AbbreviatedDayNames,i.closeText=this.settings.DatePickerOptions.CloseText,i.prevText=this.settings.DatePickerOptions.PrevText,i.nextText=this.settings.DatePickerOptions.NextText,i.currentText=this.settings.DatePickerOptions.CurrentText,i.showWeek=this.settings.DatePickerOptions.ShowWeek,i.weekHeader=this.settings.DatePickerOptions.WeekHeader,i.onChangeMonthYear=function(e,t,i){n.updateDatesToHighLight(e,t)},i.beforeShowDay=function(e){var t=!0;if(!n.settings.EnableSelectingDatesInThePast){var i=new Date;t=e>=new Date(i.getFullYear(),i.getMonth(),i.getDate())}if(n.minDate&&(t=e>=n.minDateAtTheBeginningOfDay),!n.datesToHighlight||0===n.datesToHighlight.length)return[t];for(var s=[t,""],o=0;o<n.datesToHighlight.length;o++)if(n.areDatesEqual(e,n.datesToHighlight[o].Date)){s[1]=n.datesToHighlight[o].CssClass;break}return s},i.beforeShow=function(e,t){CCL.DatePickerAccessibilityAdapter.setCurrentDatePicker(n);var i=$(e).datepicker("getDate");null==i&&(i=new Date),n.updateDatesToHighLight(i.getFullYear(),i.getMonth()+1)},i.onSelect=function(e){if(n.datesToHighlight&&0!==n.datesToHighlight.length){var t=$.datepicker.parseDate(i.dateFormat,e);if(t){for(var s=0,o=0,r=0;r<n.datesToHighlight.length;r++)if(n.areDatesEqual(n.datesToHighlight[r].Date,t)){s=n.datesToHighlight[r].Date.getHours(),o=n.datesToHighlight[r].Date.getMinutes();break}0!==s||0!==o?n.setTime(s,o):n.setTime(n.settings.DefaultHours,n.settings.DefaultMinutes)}}if(n.updateTimePickerState(),n.updateDependentPicker(),n.settings.EnableAutoSelectCurrentTimeForCurrentDate&&n.dateTimeSync&&n.isDateInputTextValid()){var a=n.dateTimeSync.currentServerTime;n.areDatesEqual(n.getDateTime(),a)&&n.setTimePickerStateToCurrentTime(a)}$(n).trigger("change",n.getDateTime())},i.onClose=function(){if(CCL.CommonFunctions.isIe()){var e=n.$datePickerInput.datepicker("option","showOn");n.$datePickerInput.datepicker("option","showOn","button"),setTimeout(function(){n.$datePickerInput.focus(),setTimeout(function(){n.$datePickerInput.datepicker("option","showOn",e)})})}else n.$datePickerInput.focus()},this.$datePickerInput.on("click",function(e){return n.$datePickerInput.focus()}),this.$datePickerInput&&(this.$datePickerInput.datepicker(i),""===this.$datePickerInput.val()&&this.setTime(this.settings.DefaultHours,this.settings.DefaultMinutes),this.$datePickerInput.change(function(){n.updateTimePickerState(),$(n).trigger("change",n.getDateTime())}),this.settings.EnableTriggerDateInputBlurEvent&&this.$datePickerInput.add(this.$hoursDropDown).add(this.$minutesDropDown).on("blur",function(){return $(n).trigger("blur",n.getDateTime())})),this.$hoursDropDown.add(this.$minutesDropDown).change(function(){$(n).trigger("change",n.getDateTime()),n.toggleValidationError({isInvalid:!1})}),this.updateTimePickerState()}return Object.defineProperty(e.prototype,"dependentPicker",{set:function(e){this.dependentPickerInstance=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateTimeSynchronizer",{set:function(e){this.dateTimeSync=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minDate",{get:function(){return this.minDateValue},set:function(e){this.minDateValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minDateAtTheBeginningOfDay",{get:function(){var e=new Date(this.minDateValue.getTime());return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e},enumerable:!0,configurable:!0}),e.prototype.areDatesEqual=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()},e.prototype.setTime=function(e,t){if(this.settings.MinutesInterval>1){var n=this.getTimeOfNextInterval(e,t,this.settings.MinutesInterval);this.setDropDownValue(this.$hoursDropDown,n.hours.toString()),this.setDropDownValue(this.$minutesDropDown,n.minutes.toString())}else this.setDropDownValue(this.$hoursDropDown,e.toString()),this.setDropDownValue(this.$minutesDropDown,t.toString())},e.prototype.getTimeOfNextInterval=function(e,t,n){return 60-t<n?{hours:e+1,minutes:0}:{hours:e,minutes:Math.ceil(t/n)*n}},e.prototype.setDropDownValue=function(e,t){if(e){var n=!1;e.find("option").each(function(e,i){return i.getAttribute("value")!==t||(n=!0,!1)}),n&&e.val(t)}},e.prototype.getDateTimePickerState=function(){return new n(this.settings.DatePickerOptions.DateFormat,this.$datePickerInput.val(),this.getDropDownValue(this.$hoursDropDown),this.getDropDownValue(this.$minutesDropDown))},e.prototype.getStringValue=function(){var t=this.$datePickerInput.val();return t?t+" "+e.getNumberAsTwoCharString(this.getHours())+":"+e.getNumberAsTwoCharString(this.getMinutes()):""},e.prototype.getDateTimeAsString=function(){var t=this.getDateTime();return t?$.datepicker.formatDate(this.settings.DatePickerOptions.DateFormat,t)+" "+e.getNumberAsTwoCharString(t.getHours())+":"+e.getNumberAsTwoCharString(t.getMinutes()):""},Object.defineProperty(e.prototype,"isDateValidOrEmpty",{get:function(){return 0===this.$datePickerInput.val().length||this.isDateInputTextValid()},enumerable:!0,configurable:!0}),e.prototype.getDateTime=function(){var e;e=void 0;try{e=$.datepicker.parseDate(this.settings.DatePickerOptions.DateFormat,this.$datePickerInput.val())}catch(e){}if(e)return e.setHours(this.getHours()),e.setMinutes(this.getMinutes()),e},e.prototype.setDateTime=function(e){void 0===e?(this.$datePickerInput.val(""),this.setTime(this.settings.DefaultHours,this.settings.DefaultMinutes)):(this.$datePickerInput.val($.datepicker.formatDate(this.settings.DatePickerOptions.DateFormat,e)),this.setTime(e.getHours(),e.getMinutes())),this.updateTimePickerState(),this.updateDependentPicker()},e.prototype.toggleValidationError=function(e){e.isInvalid?(e.errorMessage&&e.errorMessage.length>0&&(this.$validationMessage.text(e.errorMessage).show(),this.$textDescription.hide()),e.highlightInput&&(this.$datePickerInput.addClass(this.settings.CssClasses.InvalidInput),this.$hoursDropDown.addClass(this.settings.CssClasses.InvalidInput),this.$minutesDropDown.addClass(this.settings.CssClasses.InvalidInput))):(this.$validationMessage.empty().hide(),this.$textDescription.show(),this.$datePickerInput.removeClass(this.settings.CssClasses.InvalidInput),this.$hoursDropDown.removeClass(this.settings.CssClasses.InvalidInput),this.$minutesDropDown.removeClass(this.settings.CssClasses.InvalidInput))},e.prototype.highlightOnAutoCorrectInvalidInput=function(e){var t=this;this.$datePickerInput.addClass(this.settings.CssClasses.InvalidInput),this.$hoursDropDown.addClass(this.settings.CssClasses.InvalidInput),this.$minutesDropDown.addClass(this.settings.CssClasses.InvalidInput),setTimeout(function(){t.$datePickerInput.removeClass(t.settings.CssClasses.InvalidInput),t.$hoursDropDown.removeClass(t.settings.CssClasses.InvalidInput),t.$minutesDropDown.removeClass(t.settings.CssClasses.InvalidInput)},e)},e.getNumberAsTwoCharString=function(e){var t=e.toString();return 1===t.length?"0"+t:t},e.prototype.getHours=function(){return this.getDropDownValue(this.$hoursDropDown)},e.prototype.getMinutes=function(){return this.getDropDownValue(this.$minutesDropDown)},e.prototype.getDropDownValue=function(e){if(!e)return 0;var t=e.val();return t&&""!==t.toString()?+t:0},e.prototype.enable=function(e){this.$datePickerInput.prop("disabled",!e),this.$hoursDropDown.add(this.$minutesDropDown).prop("disabled",!e||!this.isDateInputTextValid())},e.prototype.updateDatesToHighLight=function(e,t){this.getDatesToHighlight&&"function"==typeof this.getDatesToHighlight&&(this.datesToHighlight=this.getDatesToHighlight(new Date(e,t-2,25),new Date(e,t,6)))},e.prototype.isDateInputTextValid=function(){var e;e=void 0;try{e=$.datepicker.parseDate(this.settings.DatePickerOptions.DateFormat,this.$datePickerInput.val())}catch(e){}return null!=e},e.prototype.updateTimePickerState=function(){this.toggleValidationError({isInvalid:!1}),this.$hoursDropDown.add(this.$minutesDropDown).prop("disabled",!this.isDateInputTextValid())},e.prototype.setTimePickerStateToCurrentTime=function(e){this.setTime(e.getHours(),e.getMinutes())},e.prototype.updateDependentPicker=function(){this.dependentPickerInstance&&(this.getDateTime()>=this.dateTimeSync.currentServerTime||this.dependentPickerInstance.settings.EnableSelectingDatesInThePast)&&(this.dependentPickerInstance.minDate=this.getDateTime())},e.prototype.isFocusWithinControl=function(){return this.$datePickerInput.is(":focus")||this.$hoursDropDown.is(":focus")||this.$minutesDropDown.is(":focus")},e.prototype.closePicker=function(){this.$datePickerInput.datepicker("hide")},e.prototype.clearDateAndTime=function(e){this.setTime(this.settings.DefaultHours,this.settings.DefaultMinutes),e||this.$datePickerInput.val("")},e.prototype.getDate=function(){return this.getDateTimePickerState().date},e.prototype.setDate=function(e){this.setDateTime(e)},e}();e.DateTimePicker=i}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){};e.DeadlineState=t;var n=function(){function e(e,t){var n=this;this.peerAndSelfAssessmentStateChanged=function(e,t,i){n.emptyDeadlineValidationEnabled=t,n.$closeAfterDeadlineCheckBox.prop("checked",t||n.settings.CloseAfterDeadline).change(),n.$closeAfterDeadlineCheckBox.prop("disabled",t),n.customTooltipForCheckbox.setToolTipHtml(t?n.settings.Terms.CloseAfterDeadlineDisabledWarning:""),n.initEmptyDeadlineValidation()},window[e]=this,this.settings=t,$(function(){n.dateTimePicker=window[n.settings.ClientInstanceNames.DateTimePicker],n.$deadlineSection=$("["+n.settings.SectionDataAttribute+"]"),n.$deadlineHeaderText=n.$deadlineSection.find("."+n.settings.HeaderTextClass),n.$closeAfterDeadlineCheckBox=$("#"+n.settings.Controls.CloseAfterDeadlineCheckBox),n.customTooltipForCheckbox=new CCL.ModernCheckbox.CustomTooltipForCheckbox(n.$closeAfterDeadlineCheckBox),n.settings.HasDeadlinePassed&&n.settings.PeerAssessmentEnabled?n.enabled=!1:(n.settings.Events.PeerAndSelfAssessmentStateChanged&&$(document).off(n.settings.Events.PeerAndSelfAssessmentStateChanged).on(n.settings.Events.PeerAndSelfAssessmentStateChanged,n.peerAndSelfAssessmentStateChanged),$(n.dateTimePicker).change(function(){n.emptyDeadlineValidationEnabled&&n.dateTimePicker.getDateTimePickerState().isEmpty?n.dateTimePicker.toggleValidationError({isInvalid:!0,errorMessage:t.Terms.SetDeadline,highlightInput:!0}):$(n).trigger("change",n.dateTimePicker.getDateTime())}),n.dateTimePicker&&(n.dateTimePicker.getDatesToHighlight=function(e,t){var i=new Array;return n.settings.WebMethods.GetEventsDateTime&&n.settings.CourseId&&n.settings.CourseId>0&&CCL.CommonFunctions.safeAjax({url:n.settings.WebMethods.GetEventsDateTime,type:"POST",async:!1,data:{startDate:JSON.stringify(e),endDate:JSON.stringify(t),courseId:n.settings.CourseId}}).done(function(e){for(var t=0,s=e;t<s.length;t++){var o=s[t],r={};r.Date=n.convertStringToDate(o.Date),r.CssClass=o.CssClass,i.push(r)}}),i},$(n.dateTimePicker).on("change",function(){n.settings.Events.DeadlineStateChanged&&$(document).trigger(n.settings.Events.DeadlineStateChanged)})))})}return e.prototype.getState=function(){return{CloseAfterDeadline:!!this.settings.UseCloseAfterDeadline&&this.$closeAfterDeadlineCheckBox.is(":checked"),DateTime:this.dateTimePicker.getStringValue()}},e.prototype.isSet=function(){return this.dateTimePicker.getDateTimePickerState().isValid&&!this.dateTimePicker.getDateTimePickerState().isEmpty},e.prototype.getDateTime=function(){return this.dateTimePicker.getDateTime()},e.prototype.mandatory=function(e){this.$deadlineHeaderText.toggleClass(this.settings.CssClasses.Mandatory,e)},e.prototype.convertStringToDate=function(e){var t=e.split(".");return new Date(+t[2],+t[1]-1,+t[0],+t[3],+t[4])},Object.defineProperty(e.prototype,"enabled",{set:function(e){this.$closeAfterDeadlineCheckBox.prop("disabled",!e),this.dateTimePicker.enable(e)},enumerable:!0,configurable:!0}),e.prototype.initEmptyDeadlineValidation=function(){this.emptyDeadlineValidationEnabled||this.dateTimePicker.toggleValidationError({isInvalid:!1})},e}();e.Deadline=n}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(t){t.invalidDateAllowEmpty=function(t,n){return e.ValidatorFactory.checkToggle(function(){return!t.isDateValidOrEmpty},t,n)},t.invalidDateDenyEmpty=function(t,n){return e.ValidatorFactory.checkToggle(function(){return void 0===t.getDateTime()},t,n)},t.invalidDateAllowEmptyNoHighlight=function(t,n,i){return e.ValidatorFactory.checkNoHighlight(t,function(){return!t.isDateValidOrEmpty},n,i)},t.invalidDateDenyEmptyNoHighlight=function(t,n,i){return e.ValidatorFactory.checkNoHighlight(t,function(){return void 0===t.getDateTime()},n,i)},t.compareDates=function(t,n,i,s){return e.ValidatorFactory.checkToggle(function(){return t(n.getDateTime(),i)},n,s)}}(e.DateTimePickerValidatorFactory||(e.DateTimePickerValidatorFactory={}))}(e.Validation||(e.Validation={}))}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){!function(e){function t(e,t,n){return n&&t.isInvalid&&n(),e.toggleValidationError(t),!t.isInvalid}e.lessThanOrEqual=function(e,t){return e<=t},e.all=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return function(){return 0===e.filter(function(e){return!e()}).length}},e.until=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return function(){return e.every(function(e){return e()})}},e.checkToggle=function(e,n,i){return function(){return t(n,{isInvalid:e(),errorMessage:i,highlightInput:!0},void 0)}},e.checkNoHighlight=function(e,n,i,s){return function(){return t(e,{isInvalid:n(),errorMessage:i,highlightInput:!1},s)}}}(e.ValidatorFactory||(e.ValidatorFactory={}))}(e.Validation||(e.Validation={}))}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){this.contentMaxHeight=250,this.settings=t,window[e]=this,this.$mainContainer=$("."+t.ContainerCssClass),this.$showMore=$("#"+t.ShowMoreClientId),this.$showLess=$("#"+t.ShowLessClientId),this.showLess(!0)}return e.prototype.showMore=function(){var e=this;this.$showMore.hide(),this.expandMainContainer();var t=this.$mainContainer.height();this.$mainContainer.css("height",this.contentMaxHeight).css("overflow","hidden").animate({height:t},function(){e.expandMainContainer(),t>e.contentMaxHeight&&e.$showLess.show()})},e.prototype.showLess=function(e){var t=this;this.$showLess.hide(),this.expandMainContainer(),this.$mainContainer.height()<=this.contentMaxHeight||this.$mainContainer.css("overflow","hidden").animate({height:this.contentMaxHeight},e?0:400,function(){t.$mainContainer.css("position","relative"),t.$showMore.show(),t.$mainContainer.find(":tabbable:visible").on("focus",function(e){t.showMoreWhenOutOfView(e)})})},e.prototype.showMoreWhenOutOfView=function(e){$(e.currentTarget).offset().top>this.$mainContainer.offset().top+this.contentMaxHeight-this.$showMore.height()&&(this.showMore(),this.$mainContainer.find(":tabbable:visible").off("focus"))},e.prototype.expandMainContainer=function(){this.$mainContainer.css("height","").css("overflow","").css("position","")},e}();e.ShowMoreLessLinks=t}(e.Widgets||(e.Widgets={}))}(e.Dashboard||(e.Dashboard={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){this.controls=e,this.settings=t,this.selectors={elementLinkItem:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.ElementLinkItemId),listItemFocusedArea:"."+this.settings.CssClasses.ListItemFocusedArea,elementLinkFolderActionExpand:CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.ElementLinkFolderActionExpand)}}return e.prototype.isListItemFocusedArea=function(e){return e.is(this.selectors.listItemFocusedArea)},e.prototype.closestListItemFocusedArea=function(e){return e.closest(this.selectors.listItemFocusedArea)},e.prototype.closestElementItem=function(e){return e.closest(this.selectors.elementLinkItem)},e.prototype.getElementId=function(e){return e.data(this.settings.DataAttributes.ElementLinkItemId)},e.prototype.getCheckbox=function(e){return $("#"+this.settings.ElementItemPrefix+e)},e}();e.Utility=t}(e.ElementLinkDialog||(e.ElementLinkDialog={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.None=0]="None",e[e.Plan=1]="Plan",e[e.WorkingPortfolioTask=2]="WorkingPortfolioTask",e[e.WorkingPortfolioPersonalizedTask=3]="WorkingPortfolioPersonalizedTask",e[e.CalendarEvent=4]="CalendarEvent",e[e.LearningPath=5]="LearningPath"}(e.ElementsPopupOpener||(e.ElementsPopupOpener={}));e.ElementsPopupOpener}(e.ElementLinkDialog||(e.ElementLinkDialog={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;this.controls=e,this.settings=t,this.getParticipantCheckBox=function(e){return $("#"+n.settings.ControlIds.DialogPersonItemCheckBoxPrefix+e)},this.getGroupCheckBox=function(e){return $("#"+n.settings.ControlIds.DialogGroupItemCheckBoxPrefix+e)},this.controls.ParticipantListTBody=this.controls.ParticipantList.children("tbody"),this.controls.GroupListTBody=this.controls.GroupList.children("tbody")}return e.prototype.getItemId=function(e){return e.data(this.settings.DataAttributes.ItemId)},e.prototype.getItemType=function(e){return e.data(this.settings.DataAttributes.ItemType)},e.prototype.getItemTitle=function(e){return e.data(this.settings.DataAttributes.ItemTitle)},e.prototype.findLoadMoreItemsPointer=function(e){return e.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.LoadMoreItems))},e.prototype.getVirtualCount=function(e){return e.data(this.settings.DataAttributes.VirtualCount)},e.prototype.findListItems=function(e){return e.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.ItemId))},e.prototype.closestListItem=function(e){return e.closest(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.ItemId))},e.prototype.closestSelectedItem=function(e){return e.closest(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.ItemId))},e}();e.Utility=t}(e.ElementParticipantPicker||(e.ElementParticipantPicker={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(e){function n(n){e.call(this,n.controls.RadioButtonGroup,[[t.ItemType.Participant,n.controls.ParticipantsRadioButton],[t.ItemType.Group,n.controls.GroupsRadioButton]])}return __extends(n,e),n}(e.OptionRadioButton.OptionRadioButtonManagerBase);t.OptionRadioButtonManager=n}(e.ElementParticipantPicker||(e.ElementParticipantPicker={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(t,n){switch(this.utility=t,this.itemType=n,this.checkboxStateManager=new e.CheckboxStateManager,n){case e.ItemType.Participant:this.itemList=this.utility.controls.ParticipantListTBody,this.selectAllCheckBox=this.utility.controls.SelectAllParticipantsCheckBox,this.terms={noItemsMeetSearchCriteria:this.utility.settings.Terms.NoParticipantsFound,noItemsInCourse:this.utility.settings.Terms.NoParticipantsInCourse,searchPlaceholder:this.utility.settings.Terms.SearchForParticipants},this.getCheckbox=this.utility.getParticipantCheckBox;break;case e.ItemType.Group:this.itemList=this.utility.controls.GroupListTBody,this.selectAllCheckBox=this.utility.controls.SelectAllGroupsCheckBox,this.terms={noItemsMeetSearchCriteria:this.utility.settings.Terms.NoGroupsFound,noItemsInCourse:this.utility.settings.Terms.NoGroupsInCourse,searchPlaceholder:this.utility.settings.Terms.SearchForGroups},this.getCheckbox=this.utility.getGroupCheckBox;break;default:throw Error("Unknown ItemType "+n)}};e.DialogItemModeDependentObjects=t}(e.ElementParticipantPicker||(e.ElementParticipantPicker={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function t(){this.checkboxStateMachine=new e.CheckboxStateMachine.Machine,this.committedStateMap=new Map,this.pendingStateMap=new Map,this.ignoreCheckboxEvents=!1}return t.prototype.setInitiallySelectedItemIds=function(t){for(var n=0,i=t;n<i.length;n++){var s=i[n];this.committedStateMap.set(s,e.CheckboxStateMachine.State.Saved)}},t.prototype.getSelectedItemIds=function(){var e=this,t=new Array;return this.committedStateMap.forEach(function(n,i){e.isStateChecked(n)&&t.push(i)}),t},t.prototype.isItemPendingChecked=function(t){return this.isStateChecked(this.pendingStateMap.get(t)||e.CheckboxStateMachine.State.Empty)},t.prototype.initializePendingStateMap=function(){this.pendingStateMap=e.MapUtils.makeCopy(this.committedStateMap)},t.prototype.commitPendingStateMap=function(){this.committedStateMap=e.MapUtils.makeCopy(this.pendingStateMap)},t.prototype.withIgnoreCheckboxEvents=function(e){this.ignoreCheckboxEvents=!0;try{e()}finally{this.ignoreCheckboxEvents=!1}},t.prototype.transferPendingState=function(t){var n=t.itemId,i=t.isChecked;if(!this.ignoreCheckboxEvents){var s=this.pendingStateMap.get(n)||e.CheckboxStateMachine.State.Empty,o=this.checkboxStateMachine.validateAndTransferElementStateAfterClick(i,s);this.pendingStateMap.set(n,o)}},t.prototype.transferCommittedStateToUnchecked=function(e){var t=this.committedStateMap.get(e),n=this.checkboxStateMachine.validateAndTransferElementStateAfterClick(!1,t);this.committedStateMap.set(e,n)},t.prototype.isStateChecked=function(t){return t===e.CheckboxStateMachine.State.Saved||t===e.CheckboxStateMachine.State.AttachedByUser},t}();t.CheckboxStateManager=n}(e.ElementParticipantPicker||(e.ElementParticipantPicker={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t,n){var i=this;this.controls=t,this.settings=n,this.searchTimeoutMilliseconds=1e3,this.testToolExtensionId=5002,this.assignmentExtensionId=5006,this.pageIndex=0,this.searchDebouncer=new CCL.CallbackDebouncer(function(){return i.search()}),this.onCheckboxStateChanged=function(t){var n=$(t.currentTarget),s=n.is(":checked"),o=i.utility.closestListItem(n),r=i.utility.getItemId(o),a=i.utility.getItemType(o),l=i.utility.getItemTitle(o);!t.bubbles||i.updateSelectAllCheckBoxValue(),i.currentObjects.checkboxStateManager.transferPendingState({itemId:r,isChecked:s}),a===e.ItemType.Group?i.groupItemsSelected=i.updateSelectedOnChange(s,i.groupItemsSelected,r,l):i.personItemsSelected=i.updateSelectedOnChange(s,i.personItemsSelected,r,l)},this.onResultsRowClick=function(t){var n=$(t.currentTarget);n.find("label").find($(t.target)).length>0||i.optionRadioManager.isSelected(e.ItemType.Participant)&&n.find("a").get(0).contains(t.target)||(i.toggleOptionCheckBox(i.utility.getItemId(n),function(e){return!e}),i.updateSelectAllCheckBoxValue())},this.onSelectAllCheckBoxStateChange=function(e){var t=e.currentTarget.checked;i.utility.findListItems(i.currentObjects.itemList).each(function(e,n){i.toggleOptionCheckBox(i.utility.getItemId($(n)),t)})},this.utility=new e.Utility(t,n),this.modalDialog=window[this.settings.ClientInstanceNames.Dialog],this.personObjects=new e.DialogItemModeDependentObjects(this.utility,e.ItemType.Participant),this.groupObjects=new e.DialogItemModeDependentObjects(this.utility,e.ItemType.Group),this.currentObjects=this.settings.InitialItemType===e.ItemType.Group?this.groupObjects:this.personObjects,this.updateUiAfterSwitchBetweenParticipantsAndGroups(),this.optionRadioManager=new e.OptionRadioButtonManager(this.utility),this.isIosDevice=CCL.CommonFunctions.isIosDevice(),this.setupOkButtonClickHandler(),this.groupItemsSelected=this.settings.InitiallySelectedGroups,this.personItemsSelected=this.settings.InitiallySelectedParticipants,this.controls.ChangeLink.click(function(e){i.openDialog(),i.personObjects.checkboxStateManager.initializePendingStateMap(),i.groupObjects.checkboxStateManager.initializePendingStateMap(),i.updateCheckboxes(),e.preventDefault()});var s,o=this.controls.ParticipantListTBody.add(this.controls.GroupListTBody);o.on(((s={}).change=this.onCheckboxStateChanged,s),"input:checkbox"),o.on("click","tr",this.onResultsRowClick),this.controls.SelectAllParticipantsCheckBox&&this.controls.SelectAllParticipantsCheckBox.addEventListener("change",this.onSelectAllCheckBoxStateChange),this.controls.SelectAllGroupsCheckBox&&this.controls.SelectAllGroupsCheckBox.addEventListener("change",this.onSelectAllCheckBoxStateChange),this.setupLoadMoreOnScroll(this.controls.ParticipantList),this.setupLoadMoreOnScroll(this.controls.GroupList),this.setupRadioButtonChangeHandler(),this.setupSearch(),this.personObjects.checkboxStateManager.setInitiallySelectedItemIds(this.settings.InitiallySelectedParticipantIds),this.groupObjects.checkboxStateManager.setInitiallySelectedItemIds(this.settings.InitiallySelectedGroupIds),this.updateParticipantsText(),this.updatePickerResultHidden(),this.controls.DialogContent.keypress(function(e){e.which!==CCL.CommonConstants.keyCodes.enter||i.controls.OkButton.is(":focus")||e.preventDefault()})}return t.prototype.setupLoadMoreOnScroll=function(e){var t=this;e.on((this.isIosDevice?"touchmove":"")+" scroll",function(){var e,n=t.currentObjects.itemList;!t.isLoadingInProgress&&t.utility.findLoadMoreItemsPointer(n).length>0&&CCL.CommonFunctions.isOnScreen((e=t.utility.findListItems(n)).eq(Math.max(0,e.length-3)),.1,.1,t.isIosDevice?window.parent:window)&&t.loadMoreItems()})},t.prototype.setupRadioButtonChangeHandler=function(){var e=this;this.optionRadioManager.addOnChangeHandler(function(){e.switchCurrentObjects(),e.search()})},t.prototype.setupSearch=function(){var e=this;this.controls.SearchTextBox.on("input",function(t){""===e.controls.SearchTextBox.val()?e.search():e.searchDebouncer.invokeCallback(void 0,e.searchTimeoutMilliseconds),t.preventDefault()})},t.prototype.search=function(){this.pageIndex=0,this.loadMoreItems({cleanExistingEntries:!0})},t.prototype.loadMoreItems=function(t){var n=this,i=(void 0===t?{}:t).cleanExistingEntries,s=void 0!==i&&i,o=this.currentObjects.itemList;this.isLoadingInProgress=!0,s&&(o.empty(),this.controls.NoItemsFoundPanel.hide(),this.controls.AjaxLoader.show(),this.controls.GroupList.hide(),this.controls.ParticipantList.hide()),this.itemsRequest&&this.itemsRequest.abort&&this.itemsRequest.abort(),this.itemsRequest=this.searchOrLoadMore(),this.itemsRequest.done(function(e){n.utility.findLoadMoreItemsPointer(o).remove(),o.append(e);var t=n.utility.findLoadMoreItemsPointer(o),i=n.utility.findListItems(o).length,s=0!==i,r=t.length>0?n.utility.getVirtualCount(t):i;n.controls.PageInfo.toggle(s).text(CCL.CommonFunctions.formatString(n.settings.Terms.ShowingXofYLabelFormat,i,r)),o.toggle(s),n.controls.NoItemsFoundPanel.toggle(!s),n.pageIndex++,n.updateCheckboxes()}).always(function(){n.itemsRequest=void 0,n.isLoadingInProgress=!1,n.controls.AjaxLoader.hide(),n.utility.controls.ParticipantList.toggle(n.currentObjects.itemType===e.ItemType.Participant),n.utility.controls.GroupList.toggle(n.currentObjects.itemType===e.ItemType.Group),0===n.utility.findListItems(o).length&&(n.controls.GroupList.hide(),n.controls.ParticipantList.hide())})},t.prototype.setupOkButtonClickHandler=function(){var e=this;this.controls.OkButton.click(function(t){e.applySelectedItems(),e.applyKpiOnSave(),CssModal.closeDialog(),t.preventDefault()})},t.prototype.applySelectedItems=function(){this.personObjects.checkboxStateManager.commitPendingStateMap(),this.groupObjects.checkboxStateManager.commitPendingStateMap(),this.updatePickerResultHidden(),this.updateParticipantsText()},t.prototype.updateParticipantsText=function(){var e=this.personItemsSelected.length+this.groupItemsSelected.length>0;this.controls.ParticipantText.toggle(e),this.controls.NoOneIsChosenLabel.toggle(!e),e&&this.controls.ParticipantText.text(this.getParticipantsText(this.personItemsSelected,this.groupItemsSelected))},t.prototype.getParticipantsText=function(e,t){return 0===e.length?0===t.length?null:1===t.length?this.settings.Terms.TaskAssignedToX.replace("{0}",t[0].Title):this.settings.Terms.TaskAssignedToXGroups.replace("{0}",t.length):1===e.length?0===t.length?this.settings.Terms.TaskAssignedTo1Participant:1===t.length?this.settings.Terms.TaskAssignedTo1ParticipantY.replace("{0}",t[0].Title):this.settings.Terms.TaskAssignedTo1ParticipantYGroups.replace("{0}",t.length):0===t.length?this.settings.Terms.TaskAssignedToXParticipants.replace("{0}",e.length):1===t.length?this.settings.Terms.TaskAssignedToXParticipantsY.replace("{0}",e.length).replace("{1}",t[0].Title):this.settings.Terms.TaskAssignedToXParticipantsYGroups.replace("{0}",e.length).replace("{1}",t.length)},t.prototype.updateCheckboxes=function(){var e=this;this.currentObjects.checkboxStateManager.withIgnoreCheckboxEvents(function(){e.utility.findListItems(e.currentObjects.itemList).each(function(t,n){var i=$(n),s=e.utility.getItemId(i);e.toggleOptionCheckBox(s,e.currentObjects.checkboxStateManager.isItemPendingChecked(s))})}),this.updateSelectAllCheckBoxValue()},t.prototype.openDialog=function(){this.controls.SearchTextBox.focus(),this.modalDialog.openDialog(!1),this.controls.SearchTextBox.val(""),this.search()},t.prototype.searchOrLoadMore=function(){var t={ElementOrParentFolderId:this.settings.ElementOrParentFolderId,PageIndex:this.pageIndex,Search:this.controls.SearchTextBox.val(),IsGroups:this.optionRadioManager.isSelected(e.ItemType.Group)};return CCL.CommonFunctions.safeAjaxPost({url:this.settings.Urls.GetParticipantOrGroupListContent,data:t,dataType:"html"})},t.prototype.updateSelectAllCheckBoxValue=function(){var e=Array.from(this.currentObjects.itemList.get(0).querySelectorAll("input[type=checkbox]"));this.currentObjects.selectAllCheckBox&&(this.currentObjects.selectAllCheckBox.checked=e.every(function(e){return e.checked}))},t.prototype.updateSelectedOnChange=function(e,t,n,i){return e?t.some(function(e){return e.Id===n})||t.push({Id:n,Title:i}):t=t.filter(function(e){return e.Id!==n}),t},t.prototype.updatePickerResultHidden=function(){var e={ParticipantIds:this.personObjects.checkboxStateManager.getSelectedItemIds(),GroupIds:this.groupObjects.checkboxStateManager.getSelectedItemIds()};this.controls.PickerResultHidden.val(JSON.stringify(e))},t.prototype.toggleOptionCheckBox=function(e,t){var n=this.currentObjects.getCheckbox(e);if(n){var i="boolean"==typeof t?t:t(n.is(":checked"));n.is(":checked")!==i&&(n.prop("checked",i),n.trigger("change"))}},t.prototype.switchCurrentObjects=function(){this.currentObjects=this.optionRadioManager.isSelected(e.ItemType.Participant)?this.personObjects:this.groupObjects,this.updateUiAfterSwitchBetweenParticipantsAndGroups()},t.prototype.updateUiAfterSwitchBetweenParticipantsAndGroups=function(){this.utility.controls.ParticipantList.toggle(this.currentObjects.itemType===e.ItemType.Participant),this.utility.controls.GroupList.toggle(this.currentObjects.itemType===e.ItemType.Group),this.utility.controls.SearchTextBox.prop("placeholder",this.currentObjects.terms.searchPlaceholder)},t.prototype.applyKpiOnSave=function(){null!=this.settings.KpiModel&&this.settings.KpiModel.ElementType>0&&(this.settings.KpiModel.ExtensionId!==this.assignmentExtensionId&&this.settings.KpiModel.ExtensionId!==this.testToolExtensionId||CCL.CommonFunctions.measureKpi(this.settings.KpiModel.Url,this.settings.KpiModel.Section,this.settings.KpiModel.Measurement,this.settings.KpiModel.Context))},t}();e.PickerManager=t}(e.ElementParticipantPicker||(e.ElementParticipantPicker={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t){var n=this;e.enrolInCoursesInstance=this,this.coursesTableSelector=t.CoursesTableSelector,this.checkboxColumnSelector=t.CheckboxColumnSelector,this.alertMessageText=t.AlertMessageText,$(t.ToolbarSelector+" a").click(function(e){return n.checkBeforeEnrolWithdraw(e)})}return t.prototype.isAnyCourseSelected=function(){return $(this.coursesTableSelector+" "+this.checkboxColumnSelector+" input:checked").length>0},t.prototype.checkBeforeEnrolWithdraw=function(e){if(!this.isAnyCourseSelected())return e.preventDefault(),jAlert(this.alertMessageText),!1},t}();e.EnrolInCourses=t}(e.Courses||(e.Courses={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;this.isTopicSelected=function(){return parseInt(n.topicPickerInstance.getSelectedItem().id,10)>n.settings.NotChosenOptionValue},this.settings=e,this.controls=t,$(function(){n.controls.ShowInPlannerCheckbox.change(function(){var e=n.controls.ShowInPlannerCheckbox.is(":checked");e||(n.topicPickerInstance.closeMenu(),n.planPickerInstance.closeMenu()),n.controls.TopicPlanPanel.toggle(e)}),n.settings.UseTopics&&(n.planPickerInstance.toggleEnabled(n.isTopicSelected()&&n.controls.ShowInPlannerCheckbox.is(":enabled")),n.topicPickerInstance.onchange(function(){n.planPickerInstance.toggleEnabled(!1),n.isTopicSelected()||!n.planPickerInstance.hasAnyItems()?(n.topicPickerInstance.toggleEnabled(!1),n.controls.PlanPicker.hide(),n.controls.NoPlansLabel.hide(),n.controls.Loader.show(),$.ajax({type:"GET",url:n.settings.Actions.GetPlansForCourseAndTopic,data:{courseId:n.settings.CourseId,topicId:n.topicPickerInstance.getSelectedItem().id,selectPlanLabel:n.settings.Resources.SelectPlan}}).always(function(){n.controls.Loader.hide(),n.planPickerInstance.toggleEnabled(n.isTopicSelected()),n.topicPickerInstance.toggleEnabled(!0)}).done(function(e){var t=e.length>1||!n.isTopicSelected();n.planPickerInstance.loadMenu(e),n.planPickerInstance.selectItem(2===e.length?e[1].id:n.settings.NotChosenOptionValue),n.controls.PlanPicker.toggle(t),n.controls.NoPlansLabel.toggle(!t),n.planPickerInstance.resizeComponent()})):(n.planPickerInstance.selectItem(n.settings.NotChosenOptionValue),n.controls.PlanPicker.show(),n.controls.NoPlansLabel.hide(),n.planPickerInstance.resizeComponent())}))})}return Object.defineProperty(e.prototype,"topicPickerInstance",{get:function(){return void 0===this.topicPickerInstanceValue?this.topicPickerInstanceValue=window[this.settings.ClientInstanceNames.Topic]:this.topicPickerInstanceValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"planPickerInstance",{get:function(){return void 0===this.planPickerInstanceValue?this.planPickerInstanceValue=window[this.settings.ClientInstanceNames.Plan]:this.planPickerInstanceValue},enumerable:!0,configurable:!0}),e}();e.ElementPlanPicker=t}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=e.CalendarControllerModels.EventType,i=function(){function e(e){this.utility=e}return e.prototype.parseEventType=function(e){var t,i,s=function(t){return parseInt(e.substring(t.length),10)};return this.hasEventTypePrefix(this.coursePrefix,e)?(t=n.Course,i=s(this.coursePrefix)):this.hasEventTypePrefix(this.projectPrefix,e)?(t=n.Project,i=s(this.projectPrefix)):(t=n.Person,i=0),{eventType:t,locationId:i}},e.prototype.parseCourseId=function(e){var t=this.parseEventType(e);if(t.eventType!==n.Course)throw Error("Invalid location: expected course, got "+e);return t.locationId},e.prototype.hasEventTypePrefix=function(e,t){return t&&t.startsWith(e)&&t.length>e.length},Object.defineProperty(e.prototype,"coursePrefix",{get:function(){return this.utility.settings.locationPrefixes.courseValuePrefix},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"projectPrefix",{get:function(){return this.utility.settings.locationPrefixes.projectValuePrefix},enumerable:!0,configurable:!0}),e}();t.EventTypeParser=i}(e.Schedule||(e.Schedule={}))}(e.Calendar||(e.Calendar={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(t){var n=this;this.findSectionOrMeasurement=function(e,t){$.getJSON(n.settings.FindSectionOrMeasurementUrl,{search:e.term},function(e){t($.map(e,function(e){return{value:e.Name,isMeasurement:e.IsMeasurement,id:e.Id}}))})},this.renderSearchBoxItem=function(e,t){return $("<li/>").append("<span "+(t.isMeasurement?"":"class='h-fnt-bd'")+">"+t.value+"</span>").appendTo(e)},this.selectSearchBoxItem=function(e,t){n.searchKpiContent(t.item.value,t.item.id)},this.searchKpiContent=function(e,t){window.location.search="?"+n.settings.SearchStringParamName+"="+e+"&"+n.settings.SearchValueParamName+"="+(t||"")},e.measureFilterInstance=this,this.settings=t,this.settings.Controls.SearchBoxContainer.on(this.settings.TextSearchEvent,function(e,t){return n.searchKpiContent(t,null)})};e.MeasureFilter=t}(e.FeatureAdoption||(e.FeatureAdoption={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.SingleFile=1]="SingleFile",e[e.MultipleFiles=2]="MultipleFiles",e[e.MultipleFilesAndFolders=3]="MultipleFilesAndFolders"}(e.UploadType||(e.UploadType={}));e.UploadType;!function(e){e[e.Pending=1]="Pending",e[e.InProgress=2]="InProgress",e[e.Success=3]="Success",e[e.Error=4]="Error",e[e.PartialSuccess=5]="PartialSuccess"}(e.UploadStatus||(e.UploadStatus={}));e.UploadStatus}(e.Folder||(e.Folder={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e,t,n){var i=this;this.settings=e,this.summaryParser=t,this.feedbackManager=n,this.handleInitialUploadSummary=function(e){if(e.IsProcessingInProgress)return i.feedbackManager.showInformationFeedback(i.settings.uploadInProgressMessage),i.wasPollingStarted=!0,void i.checkStatusAfterInterval();i.handleUploadsFinished(e)},this.checkStatusAfterInterval=function(){setTimeout(i.checkUploadStatus,i.settings.pollingIntervalInMilliseconds)},this.checkUploadStatus=function(){var e={folderId:i.settings.folderId};$.getJSON(i.settings.statusServiceUrl,e).then(i.handleSubsequentUploadSummary).fail(i.handleErrorResponse)},this.handleSubsequentUploadSummary=function(e){e.IsProcessingInProgress?i.checkStatusAfterInterval():i.handleUploadsFinished(e)},this.handleUploadsFinished=function(e){i.feedbackManager.hideInformationFeedback(),i.summaryParser.isThereOnlyOneSingleFileUpload(e)?i.handleOneSingleFileUploadFinished(e):i.summaryParser.areThereAnyUploadsToHandle(e)&&i.handleManyFileUploadsFinished(e)},this.handleOneSingleFileUploadFinished=function(e){if(i.summaryParser.areAllUploadsFinishedWithSuccess(e)){var t=i.summaryParser.getFileNamesForSingleFileUploads(e)[0],n=CCL.CommonFunctions.htmlEncode(t),s=i.settings.singleFileXUploadSuccessMessage.replace("{0}","<strong>"+n+"</strong>");i.feedbackManager.showInformationFeedback(s),i.refreshTreeMenuIfNeeded()}else i.feedbackManager.showErrorFeedback(i.settings.singleFileUploadErrorMessage)},this.handleManyFileUploadsFinished=function(e){i.summaryParser.areAllUploadsFinishedWithSuccess(e)?i.displayMessageWithRefreshInstructionsIfNeeded(i.settings.multipleFileUploadSuccessMessage):i.summaryParser.areUploadsFinishedWithPartialSuccess(e)?i.displayMessageWithRefreshInstructionsIfNeeded(i.settings.partialSuccessMessage):i.feedbackManager.showErrorFeedback(i.settings.multipleFileUploadErrorMessage)},this.displayMessageWithRefreshInstructionsIfNeeded=function(e){if(i.shouldDisplayRefreshButton()){var t="<strong>"+e+"</strong> "+i.settings.pleaseRefreshThePageToSeeThemMessage;i.feedbackManager.showInformationFeedback(t,i.refreshElementsList)}else i.refreshTreeMenuIfNeeded(),i.feedbackManager.showInformationFeedback(e)},this.shouldDisplayRefreshButton=function(){return i.wasPollingStarted},this.handleErrorResponse=function(e){401===e.status?i.redirectToLogOutPage():i.checkStatusAfterInterval()},this.redirectToLogOutPage=function(){window.itslTop.location.replace(i.settings.logOutPageUrl)},this.refreshElementsList=function(){i.refreshTreeMenuIfNeeded(),i.refreshWindow()},this.refreshTreeMenuIfNeeded=function(){if(i.settings.isTreeMenuRendered){var e=new CCL.CommonWindowMessages.GenericMessage(i.settings.refreshTreeMenuPostMessageName);CCL.CommonFunctions.makePostMessageCall(window.parent,e)}},this.refreshWindow=function(){location.reload()},t.areThereAnyUploadsToHandle(e.initialSummary)&&this.handleInitialUploadSummary(e.initialSummary)};e.UploadStatusChecker=t}(e.Folder||(e.Folder={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e,t,n){var i=this;this.refreshButtonText=n,this.showInformationFeedback=function(e,t){var n={disableAutomaticHiding:!0};t&&(n.extraButtonName=i.refreshButtonText,n.extraButtonCallback=t),CCL.InformationFeedback.showFeedback(i.informationFeedbackContainer,e,n)},this.showErrorFeedback=function(e){CCL.CommonFunctions.isMobileDevice(),CCL.ErrorFeedback.showFeedback(i.errorFeedbackContainer,e,function(){})},this.hideInformationFeedback=function(){CCL.InformationFeedback.hideFeedback(i.informationFeedbackContainer)},this.informationFeedbackContainer=$("#"+e),this.errorFeedbackContainer=$("#"+t)};e.UploadStatusFeedbackManager=t}(e.Folder||(e.Folder={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){var t=this;this.areThereAnyUploadsToHandle=function(e){return e&&(e.IsProcessingInProgress||e.UploadInfos&&e.UploadInfos.length>0)},this.isThereOnlyOneSingleFileUpload=function(t){return t&&t.UploadInfos&&1===t.UploadInfos.length&&t.UploadInfos[0].UploadType===e.UploadType.SingleFile},this.areAllUploadsFinishedWithSuccess=function(t){return t&&t.UploadInfos&&t.UploadInfos.length>0&&t.UploadInfos.every(function(t){return t.Status===e.UploadStatus.Success})},this.areUploadsFinishedWithPartialSuccess=function(t){return t&&t.UploadInfos&&(t.UploadInfos.some(function(t){return t.Status===e.UploadStatus.PartialSuccess})||t.UploadInfos.some(function(t){return t.Status===e.UploadStatus.Success})&&t.UploadInfos.some(function(t){return t.Status===e.UploadStatus.Error}))},this.getFileNamesForSingleFileUploads=function(n){return n&&n.UploadInfos?n.UploadInfos.filter(function(t){return t.UploadType===e.UploadType.SingleFile}).map(t.getSingleFileUploadFileName):[]},this.getSingleFileUploadFileName=function(e){return e.Details&&e.Details.Name?e.Details.Name:""}};e.UploadSummaryParser=t}(e.Folder||(e.Folder={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function n(n){this.settings=n,this.elementLinkDialogManagerInstance=e.ElementLinkDialog.elementLinkDialogManagerInstance,t.learningObjectiveStateRepositoryManagerInstance=this,this.hasAnyChanges=!1}return n.prototype.openDialog=function(n,i){var s=this,o=[],r={elementStates:t.LearningObjectiveRepositoryHelper.convertElementIdsToElementStateMapping(i,e.CheckboxStateMachine.State.AttachedByUser),disabledElementIds:i,showAll:!0,header:this.settings.Terms.Header,elementType:e.ElementLinkDialog.ContentElementType.LearningObjectives,allowFolderSelection:!0,openerPage:e.ElementLinkDialog.ElementsPopupOpener.None,afterOkClickCallback:function(t){t&&(t.forEach(function(t,n){t!==e.CheckboxStateMachine.State.AttachedByUser&&t!==e.CheckboxStateMachine.State.Saved||o.push(n)}),o.length>0&&(s.hasAnyChanges=!0,s.connectElementsToState(o,n)))},afterCloseDialogCallback:function(){s.hasAnyChanges&&setTimeout(function(){location.reload()},100)}},a={countryCode:this.settings.CountryCode};this.elementLinkDialogManagerInstance.openDialog(r,a)},n.prototype.deleteLearningObjectivesFromState=function(e,t){$.ajax({type:"DELETE",url:this.settings.Urls.DeleteLearningObjectivesFromState,data:{learningObjectiveId:e,stateId:t},dataType:"html"}).done(function(){location.reload()})},n.prototype.connectElementsToState=function(e,t){$.ajax({type:"PUT",url:this.settings.Urls.AddLearningObjectivesToState,data:{learningObjectiveIds:e,stateId:t},dataType:"html"}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})},n}();t.LearningObjectiveStateRepositoryManager=n}(e.LearningObjectiveRepository||(e.LearningObjectiveRepository={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){var t=this;this.dialogSelfClickHandler=function(e){e.stopPropagation(),t.contextDialog.isOpened()&&window.setTimeout(function(){t.contextDialog.closeDialog()},100)},this.contextDialogControlId="#"+e.ContextDialogControlId,this.alignmentReportItemSelector=$(e.ReportItemSelector),this.contextDialogActivatorSelector=$(e.ContextDialogActivatorSelector),this.activeItemClassName=e.ActiveItemClassName,this.contextDialogContentContainerSelector=e.ContextDialogContentContainerSelector,this.filterContainer=$(e.FilterContainerSelector),this.filterDataAttributeSuffix=e.FilterDataAttributeSuffix,this.itemsContainer=$(e.ItemsContainerSelector),this.measureViewAlignedUrl=e.MeasureViewAlignedUrl,this.measureViewNotAlignedUrl=e.MeasureViewNotAlignedUrl,this.measureViewAttachedDataUrl=e.MeasureViewAttachedDataUrl,this.initContextDialog(),this.initReportItem(),this.initFilter()}return e.prototype.openContextDialog=function(e){this.contextDialog.isOpened()&&this.contextDialog.closeDialog(),this.contextDialog.openDialogAt(e.x,e.y)},e.prototype.initReportItem=function(){var e=this;this.contextDialogActivatorSelector.on("click",function(t){var n=$(t.currentTarget);n.addClass(e.activeItemClassName);var i=n.find(e.contextDialogContentContainerSelector).html();e.contextDialog.setContent(i);var s=n.position();e.openContextDialog({x:s.left,y:s.top}),e.contextDialog.setBeforeCloseDialog(function(){$(t.currentTarget).removeClass(e.activeItemClassName)}),$.ajax(e.measureViewAttachedDataUrl)})},e.prototype.initContextDialog=function(){var e=this;this.contextDialog=new ContextDialog(this.contextDialogControlId,{showHeader:!1,blackThemeActivated:!1,showCloseLink:!0,width:"404px",scrollToLastWindowOnClose:!1,useMobileViewIfNeeded:!0,marginTop:35,marginLeft:-2,marginRight:0,marginBottom:0,cssClass:"itsl-lo-alignment-report-context-dialog"}),$(document).on({"contextdialog:show":function(){window.setTimeout(function(){e.contextDialog.mainContainer.on("click",e.dialogSelfClickHandler)},100)},"contextdialog:close":function(){e.contextDialog.mainContainer.off("click",e.dialogSelfClickHandler)}})},e.prototype.initFilter=function(){var e=this,t=this.filterContainer.find("a[data-"+this.filterDataAttributeSuffix+"]"),n=t.map(function(t,n){return $(n).data(e.filterDataAttributeSuffix)}).get().join(" ");t.click(function(i){var s=$(i.target);t.removeClass(e.activeItemClassName),s.addClass(e.activeItemClassName);var o=s.data(e.filterDataAttributeSuffix);e.itemsContainer.removeClass(n).addClass(o),"filter-aligned"===o?$.ajax(e.measureViewAlignedUrl):"filter-not-aligned"===o&&$.ajax(e.measureViewNotAlignedUrl)})},e}();e.AlignmentReport=t}(e.LearningObjective||(e.LearningObjective={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){this._settings=e,this._parameters=e.ParametersNames}return e.prototype.browseLibrary=function(e){var t=CCL.CommonFunctions.setQueryStringParameter(this._settings.BrowseLibraryUrl,this._parameters.CourseId,e.CourseId||this._settings.CourseId);e.RelatedEntityId&&(t=CCL.CommonFunctions.setQueryStringParameter(t,this._parameters.RelatedEntityId,e.RelatedEntityId)),e.ElementCategory&&(t=CCL.CommonFunctions.setQueryStringParameter(t,this._parameters.ElementType,e.ElementCategory)),e.CustomId&&(t=CCL.CommonFunctions.setQueryStringParameter(t,this._parameters.CustomId,e.CustomId)),e.LearningObjectivesIds&&e.LearningObjectivesIds.length>0&&(t=CCL.CommonFunctions.setQueryStringParameter(t,this._parameters.LearningObjectiveId,e.LearningObjectivesIds.join(","))),e.FolderId&&(t=CCL.CommonFunctions.setQueryStringParameter(t,this._parameters.FolderId,e.FolderId)),this.browserDialog.setIframeUrl(t,!0),this.browserDialog.openDialog()},e.prototype.setDialogCustomScripts=function(e){this.browserDialog.setCustomScripts(e)},Object.defineProperty(e.prototype,"browserDialog",{get:function(){return window[this._settings.ModalId]},enumerable:!0,configurable:!0}),e}();e.LibraryBrowser=t}(e.Library||(e.Library={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){var t=this;this.settings=e,this.iframeHolders=$(),this.loadEmbedContentDebouncer=new CCL.CallbackDebouncer(function(){return t.loadEmbedContentAsync()}),this.loadEmbedContentTimeoutInMilliseconds=300,this.embedConsideredVisibleRatio=.2,this.loadEmbedContentAftercallTimes=5,this.embedIframeShowAnimationSpeedInMilliseconds=500,$(window).on("pageshow "+(this.settings.isIosDevice?"touchmove":"scroll"),function(){return t.loadEmbedContentDebouncer.invokeCallback(0,t.loadEmbedContentTimeoutInMilliseconds)})}return e.prototype.loadEmbedContentAsync=function(e){var t=this;void 0===e&&(e=-1);var n=this.getPendingIframeHolder();if(n){var i=this.createAjaxLoader();e>-1&&i.height(e);var s=this.createIframe(this.getEmbedIframeUrl(n),!1);this.findClosestEmbedBox(n).append(i),n.append(s),s.one("load",function(){s.fadeIn(t.embedIframeShowAnimationSpeedInMilliseconds),t.loadEmbedContentAftercallIterationNumber=1,t.loadEmbedContentDebouncer.invokeCallback(0,t.loadEmbedContentTimeoutInMilliseconds)})}else this.loadEmbedContentAftercallIterationNumber>0&&(this.loadEmbedContentDebouncer.invokeCallback(0,this.loadEmbedContentAftercallIterationNumber*this.loadEmbedContentTimeoutInMilliseconds),this.loadEmbedContentAftercallIterationNumber+=1,this.loadEmbedContentAftercallIterationNumber>this.loadEmbedContentAftercallTimes&&(this.loadEmbedContentAftercallIterationNumber=0))},e.prototype.findIframeHolders=function(e){return e.find("[data-"+this.settings.dataAttributes.embedIframeUrl+"]")},e.prototype.appendIframeHolders=function(e){this.iframeHolders=this.iframeHolders.add(this.findIframeHolders(e))},e.prototype.getEmbedIframeUrl=function(e){return e.data(this.settings.dataAttributes.embedIframeUrl)},e.prototype.createAjaxLoader=function(){return $("<div class='"+this.settings.cssClasses.ajaxLoader+"'></div>")},e.prototype.findAjaxLoader=function(e){return e.find("."+this.settings.cssClasses.ajaxLoader)},e.prototype.createIframe=function(e,t){return $("<iframe src='"+e+"' width='100%' height='100%' scrolling='no' class='"+this.settings.cssClasses.noBorder+"' allowfullscreen "+(t?"":"style='display:none'")+"></iframe>")},e.prototype.removeAjaxLoader=function(e){e.find("."+this.settings.cssClasses.ajaxLoader).remove()},e.prototype.isEmbedInProgress=function(e){return this.findAjaxLoader(e).length>0},e.prototype.getPendingIframeHolder=function(){for(var t=0;t<this.iframeHolders.length;t++){var n=this.iframeHolders.eq(t),i=this.findClosestBulletinItem(n);if(!this.isEmbedInProgress(n)&&!e.isEmbedFinished(n)&&!this.isEmbedError(i)&&this.isOnScreen(i))return n}},e.isEmbedFinished=function(e){return e.find("iframe").length>0},e.prototype.isEmbedError=function(e){return e.find("."+this.settings.cssClasses.oembedError).length>0},e.prototype.isOnScreen=function(e){return CCL.CommonFunctions.isOnScreen(e,this.embedConsideredVisibleRatio,this.embedConsideredVisibleRatio,this.settings.isIosDevice?window.parent:window)},e.prototype.findClosestEmbedBox=function(e){return e.closest(this.settings.selectors.embedBox)},e.prototype.findClosestBulletinItem=function(e){return e.closest(this.settings.selectors.bulletinItem)},e}();e.EmbedAsynchronousLoader=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=e.Controls.Validation.ValidatorFactory,i=e.Controls.Validation.DateTimePickerValidatorFactory,s=500,o=function(){function e(e){var t=this;this.utility=e,this.undoBadInputActiveFrom=function(){t.activeFrom.highlightOnAutoCorrectInvalidInput(s),setTimeout(function(){t.activeFrom.setDateTime(t.currentStrategyValue.activeFromDate)},s)},this.undoBadInputActiveTo=function(){t.activeTo.highlightOnAutoCorrectInvalidInput(s),setTimeout(function(){t.activeTo.minDate=t.utility.dateTimeSynchronizer.currentServerTimeWithoutSeconds,t.activeTo.minDate.setMinutes(t.activeTo.minDate.getMinutes()+5),t.activeTo.setDateTime(!t.currentStrategyValue.activeToDate||t.currentStrategyValue.activeToDate<t.activeTo.minDate?t.activeTo.minDate:t.currentStrategyValue.activeToDate)},s)},this.runCheckOnBlurEvent(this.activeFrom,n.until(i.invalidDateDenyEmptyNoHighlight(this.activeFrom,this.utility.settings.Resources.InvalidDateFormat,this.undoBadInputActiveFrom),n.checkNoHighlight(this.activeFrom,function(){return t.activeFrom.getDateTime()<t.activeFrom.minDate},"",this.undoBadInputActiveFrom))),this.runCheckOnBlurEvent(this.activeTo,n.until(i.invalidDateAllowEmptyNoHighlight(this.activeTo,this.utility.settings.Resources.InvalidDateFormat,this.undoBadInputActiveTo),n.checkNoHighlight(this.activeTo,function(){return t.activeTo.getDateTime()<=t.activeTo.minDate},"",this.undoBadInputActiveTo),n.checkNoHighlight(this.activeTo,function(){return t.activeTo.getDateTime()<=t.activeFrom.getDateTime()},this.utility.settings.Resources.ActiveFromDateShouldBeLaterThanActiveToDate,void 0)))}return Object.defineProperty(e.prototype,"currentStrategy",{set:function(e){this.currentStrategyValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeFrom",{get:function(){return window[this.utility.settings.ClientInstances.FromDateTimePicker]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeTo",{get:function(){return window[this.utility.settings.ClientInstances.ToDateTimePicker]},enumerable:!0,configurable:!0}),e.prototype.validateDates=function(){var e=this;return n.all(i.invalidDateDenyEmpty(this.activeFrom,this.utility.settings.Resources.InvalidDateFormat),n.until(n.checkNoHighlight(this.activeFrom,function(){return e.activeFrom.getDateTime()<e.activeFrom.minDate},"",this.undoBadInputActiveFrom),i.invalidDateAllowEmpty(this.activeTo,this.utility.settings.Resources.InvalidDateFormat),n.checkNoHighlight(this.activeTo,function(){return e.activeTo.getDateTime()<=e.utility.dateTimeSynchronizer.currentServerTimeWithoutSeconds},"",this.undoBadInputActiveTo),i.compareDates(n.lessThanOrEqual,this.activeTo,this.activeFrom.getDateTime(),this.utility.settings.Resources.ActiveFromDateShouldBeLaterThanActiveToDate)))()},e.prototype.runCheckOnBlurEvent=function(e,t){$(e).on("blur",function(){setTimeout(function(){e.isFocusWithinControl()||t()},1)})},e}();t.ScheduleDialogInputValidator=o}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){this.inputValidator=t,this.utilityValue=e,this.activeFromPickerInstance.dependentPicker=this.activeToPickerInstance}return Object.defineProperty(e.prototype,"activeFromDate",{get:function(){throw new Error("Abstract method should be overriden")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeToDate",{get:function(){throw new Error("Abstract method should be overriden")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strategicData",{get:function(){return this.strategicDataValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"utility",{get:function(){return this.utilityValue},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeFromPickerInstance",{get:function(){return window[this.utility.settings.ClientInstances.FromDateTimePicker]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"activeToPickerInstance",{get:function(){return window[this.utility.settings.ClientInstances.ToDateTimePicker]},enumerable:!0,configurable:!0}),e.prototype.loadDialogState=function(e,t){this.strategicDataValue=t,this.inputValidator.currentStrategy=this,this.utility.synchronizeDateTimePicker(this.activeFromPickerInstance),this.activeFromPickerInstance.toggleValidationError({isInvalid:!1}),this.activeToPickerInstance.toggleValidationError({isInvalid:!1}),this.loadDialogStateDone(e)},e.prototype.persistDialogState=function(){this.inputValidator.validateDates()&&(this.persistValidatedDialogState(),this.inputValidator.currentStrategy=void 0)},e.prototype.loadDialogStateDone=function(e){throw new Error("Abstract method should be overriden")},e.prototype.persistValidatedDialogState=function(){throw new Error("Abstract method should be overriden")},e}();e.ScheduleDialogBaseStorageStrategy=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e){function t(t,n){e.call(this,t,n),this.resetStorage()}return __extends(t,e),Object.defineProperty(t.prototype,"activeFromDate",{get:function(){return this.storage.activeFrom},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeToDate",{get:function(){return this.storage.activeTo},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeFrom",{get:function(){return CCL.SerializableDateTimeConverter.fromDate(this.storage.activeFrom)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"activeTo",{get:function(){return CCL.SerializableDateTimeConverter.fromDate(this.storage.activeTo)},enumerable:!0,configurable:!0}),t.prototype.resetStorage=function(){this.storage={activeFrom:void 0,activeTo:void 0}},t.prototype.loadDialogStateDone=function(e){e.OkButton.val(this.utility.settings.Resources.ApplyButtonText);var t=this.utility.dateTimeSynchronizer.currentServerTimeWithoutSeconds;(!this.storage.activeFrom||this.storage.activeFrom<t)&&(this.storage.activeFrom=t),this.storage.activeTo&&this.storage.activeTo<t&&(this.storage.activeTo=t),this.activeFromPickerInstance.minDate=t,this.activeToPickerInstance.minDate=t,this.activeFromPickerInstance.setDateTime(this.storage.activeFrom),this.activeToPickerInstance.setDateTime(this.storage.activeTo)},t.prototype.persistValidatedDialogState=function(){this.storage={activeFrom:this.activeFromPickerInstance.getDateTime(),activeTo:this.activeToPickerInstance.getDateTime()},this.storage.activeFrom||this.storage.activeTo?this.utility.ajaxClient.getTimeSpan({ActiveFrom:CCL.SerializableDateTimeConverter.fromDate(this.storage.activeFrom),ActiveTo:CCL.SerializableDateTimeConverter.fromDate(this.storage.activeTo)}).done(this.strategicData.onSuccess).always(CssModal.closeDialog):CssModal.closeDialog()},t}(e.ScheduleDialogBaseStorageStrategy);e.ScheduleDialogTemporaryStorageStrategy=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(t){function n(e,n){t.call(this,e,n)}return __extends(n,t),Object.defineProperty(n.prototype,"activeFromDate",{get:function(){return this.activeFrom},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"activeToDate",{get:function(){return this.activeTo},enumerable:!0,configurable:!0}),n.prototype.loadDialogStateDone=function(t){var n=this;t.OkButton.val(this.utility.settings.Resources.OkButtonText),this.activeFromPickerInstance.setDateTime(void 0),this.activeToPickerInstance.setDateTime(void 0),this.activeFrom=void 0,this.activeTo=void 0,this.utility.ajaxClient.getSchedule(this.strategicData.lightBulletinId).done(function(t){return e.GenericResponseHandler.handle(t,function(){var e=t.ResponseData;n.activeFrom=CCL.SerializableDateTimeConverter.toDate(e.ActiveFrom),n.activeTo=CCL.SerializableDateTimeConverter.toDate(e.ActiveTo),n.activeFromPickerInstance.setDateTime(n.activeFrom),n.activeFromPickerInstance.minDate=CCL.SerializableDateTimeConverter.toDate(e.Created),n.activeToPickerInstance.setDateTime(n.activeTo),n.activeToPickerInstance.minDate=new Date},function(){CssModal.closeDialog(),t.Code===e.GenericResponseCode.LightBulletinNotFound&&n.utility.removeBulletin(n.utility.getBulletinById(n.strategicData.lightBulletinId))})})},n.prototype.persistValidatedDialogState=function(){this.utility.ajaxClient.updateSchedule({LightBulletinId:this.strategicData.lightBulletinId,Schedule:{ActiveFrom:CCL.SerializableDateTimeConverter.fromDate(this.activeFromPickerInstance.getDateTime()),ActiveTo:CCL.SerializableDateTimeConverter.fromDate(this.activeToPickerInstance.getDateTime())},BulletinsDisplayMode:this.strategicData.bulletinsDisplayMode}).done(this.strategicData.onSuccess).always(CssModal.closeDialog)},n}(e.ScheduleDialogBaseStorageStrategy);e.ScheduleDialogAjaxStorageStrategy=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){this.utility=e}return Object.defineProperty(e.prototype,"areCommentsDisabledForNewBulletins",{get:function(){return this.areCommentsDisabledForNewBulletinsValue},set:function(e){this.areCommentsDisabledForNewBulletinsValue=e,this.utility.controls.AddMenu.ToggleCommentsOptionSpan.text(this.getToggleCommentsTerm(e)),document.dispatchEvent(new CustomEvent("setEnableCommentsInNewAnnouncement__c3136486287f4dd5b8c2d5465d479485",{detail:{enableCommentsInNewAnnouncement:!e}}))},enumerable:!0,configurable:!0}),e.prototype.resetCommentsDisabledForNewBulletins=function(){this.areCommentsDisabledForNewBulletins=this.utility.settings.DisableLightBulletinCommentsDefaultValue},e.prototype.togglePossibilityToAddComments=function(e,t){t&&CCL.DomElementClass.GetInstanceForElement(e.CommentControlClientInstanceName).togglePossibilityToAddComments(!e.DisableComments)},e.prototype.getToggleCommentsTerm=function(e){return e?this.utility.settings.Resources.EnableComments:this.utility.settings.Resources.DisableComments},e}();e.LightBulletinCommentToggler=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){this.scrollTopTimeoutMilliseconds=200,this.animationTimeInMilliseconds=e.animationTimeInMilliseconds}return e.prototype.animateShow=function(e,t){var n=!1;e.slideDown(this.animationTimeInMilliseconds,function(){n||(n=!0,t&&t(),e.css("overflow",""))})},e.prototype.animateHideAndRemove=function(e,t){this.animateHide(e,function(){e.remove(),t&&t()})},e.prototype.animateScrollTop=function(e,t){var n=this;setTimeout(function(){$("html, body").animate({scrollTop:e},{duration:n.animationTimeInMilliseconds,complete:t})},this.scrollTopTimeoutMilliseconds)},e.prototype.animateHide=function(e,t){e.slideUp(this.animationTimeInMilliseconds,t)},e}();e.LightBulletinAnimator=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e.maxCountOfAddedElements=50,e.animationTimeInMilliseconds=250,e.watchEmbedsPasteTimeoutInMilliseconds=50,e.watchEmbedsKeyUpTimeoutInMilliseconds=1500,e.dataAttributeNames={pendingProcessId:"pending-process-id",loadedProcessId:"loaded-process-id"}}(e.LightBulletinConstants||(e.LightBulletinConstants={}))}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function n(t){this.utility=t,this.elementStates=new Map,this.settings=t.settings,this.checkboxStateMachine=new e.CheckboxStateMachine.Machine,this.newsContentBlock=this.utility.controls.Container.parents("."+this.settings.CssClasses.WidgetCbNews)}return n.prototype.onResourceButtonClick=function(n,i,s,o,r){var a=this,l=this.elementStates.has(n)?this.elementStates.get(n):this.initiallyLoadElementStatesFromUi(n,i),c={locationId:this.settings.CourseId,locationType:this.settings.LocationTypeCourse};e.ElementLinkDialog.elementLinkDialogManagerInstance.openDialog({elementStates:e.MapUtils.makeCopy(l),afterOkClickCallback:function(t){return a.onDialogAddButtonClick(n,i,e.MapUtils.makeCopy(t),s,o,r)},afterCloseDialogCallback:function(){a.utility.animator.animateScrollTop(n>0?i.offset().top:a.newsContentBlock.offset().top,function(){return a.utility.editor.getBulletinEditorTextarea(i).focus()})},maxCountOfAddedElements:t.LightBulletinConstants.maxCountOfAddedElements,elementType:e.ElementLinkDialog.ContentElementType.All,showAll:!0,header:this.settings.Resources.ElementLinkDialogHeader,allowFolderSelection:!0},c)},n.prototype.onDetachResourceButtonClick=function(t,n,i,s){var o=i.data(this.settings.DataAttributes.ElementLinkElementId);this.elementStates.has(t)||this.elementStates.set(t,this.initiallyLoadElementStatesFromUi(t,n));var r=this.elementStates.get(t),a=r.get(o),l=this.checkboxStateMachine.validateAndTransferElementStateAfterClick(!1,a);r.set(o,l),l===e.CheckboxStateMachine.State.Empty?(i.remove(),s()):l===e.CheckboxStateMachine.State.DetachedByUser&&this.hideWhenEditOrRemoveWhenNew(t,i,s),this.toggleDetailedView(n)},n.prototype.resetUnsavedElementLinks=function(t,n){if(this.elementStates.has(t)){var i=this.utility.getElementLinkList(n),s=[],o=[];this.forEachElementState(t,function(t,n){t===e.CheckboxStateMachine.State.AttachedByUser?s.push(n):t===e.CheckboxStateMachine.State.DetachedByUser&&o.push(n)});var r=this.elementStates.get(t),a=void 0;for(a=0;a<s.length;a++){var l=s[a];i.find("[data-"+this.settings.DataAttributes.ElementLinkElementId+'="'+l+'"]').remove(),r.delete(l)}for(a=0;a<o.length;a++){l=o[a];this.utility.animator.animateShow(i.find("[data-"+this.settings.DataAttributes.ElementLinkElementId+'="'+l+'"]')),r.set(l,e.CheckboxStateMachine.State.Saved)}this.toggleDetailedView(n)}},n.prototype.getElementIdsForBulletin=function(t){var n=[],i=[];return this.forEachElementState(t,function(t,s){t===e.CheckboxStateMachine.State.AttachedByUser?n.push(s):t===e.CheckboxStateMachine.State.DetachedByUser&&i.push(s)}),{elementsToAttach:n,elementsToDetach:i}},n.prototype.cleanAppendData=function(t,n){var i=this;if(0===t)this.elementStates.delete(t);else{var s=this.elementStates.get(t),o=[];this.forEachElementState(t,function(t,n){t!==e.CheckboxStateMachine.State.AttachedByUser&&t!==e.CheckboxStateMachine.State.DetachedByUser||o.push(n)});var r=this.utility.getElementLinkList(n);o.forEach(function(t){var n=i.checkboxStateMachine.transferElementStateAfterSave(s.get(t));s.set(t,n),n===e.CheckboxStateMachine.State.Empty&&r.find("[data-"+i.settings.DataAttributes.ElementLinkElementId+'="'+t+'"]').remove()})}},n.prototype.onDialogAddButtonClick=function(n,i,s,o,r,a){var l=this;r(),this.elementStates.set(n,s);var c=this.utility.getElementLinkList(i);0===c.length&&(c=$(this.utility.controls.Container.data(this.settings.DataAttributes.ElementLinkList)),i.find("[data-"+this.settings.DataAttributes.ElementLinkAppendTarget+"]").append(c).prop("hidden",!1));var d=[],u=[];this.forEachElementState(n,function(t,i){var s=c.find("[data-"+l.settings.DataAttributes.ElementLinkElementId+'="'+i+'"]');switch(t){case e.CheckboxStateMachine.State.Empty:s.remove();break;case e.CheckboxStateMachine.State.AttachedByUser:0===s.length?u.push(i):d.push(i);break;case e.CheckboxStateMachine.State.Saved:l.utility.animator.animateShow(s),d.push(i);break;case e.CheckboxStateMachine.State.DetachedByUser:l.hideWhenEditOrRemoveWhenNew(n,s)}}),u.length>0?this.utility.ajaxClient.elementLinkItemsContent(u).done(function(e){e&&(c.append($(e)),l.sortElementLinks(c),l.toggleDetailedView(i),i.find("."+l.settings.CssClasses.ElementLinkDelete).show(),a&&a())}).fail(function(e,t,n){o(),CCL.CommonFunctions.alertAjaxError(e,t,n)}):this.toggleDetailedView(i),u.length+d.length>=t.LightBulletinConstants.maxCountOfAddedElements&&this.utility.toggler.toggleResourceButton(i,!1)},n.prototype.sortElementLinks=function(e){var t=this;e.children("li").get().sort(function(e,n){var i=t.settings.IsElementListSortOrderAscending?e:n,s=t.settings.IsElementListSortOrderAscending?n:e,o="data-"+t.settings.DataAttributes.ElementLinkListItemSortExpression;return $(i).attr(o).localeCompare($(s).attr(o))}).forEach(function(t){e.append(t)})},n.prototype.getNumberOfAttachedElements=function(t){var n=this.elementStates.get(t),i=new Set([e.CheckboxStateMachine.State.Saved,e.CheckboxStateMachine.State.AttachedByUser]);return Array.from(n.values()).filter(function(e){return i.has(e)}).length},n.prototype.toggleDetailedView=function(e){var t=this.utility.getElementLinkList(this.utility.getCurrentBulletinItemOrNew(e)),n=this.utility.getBulletinId(e),i=this.getNumberOfAttachedElements(n);t.parent().prop("hidden",0===i);var s=t.children("li").removeClass(this.settings.CssClasses.ElementLinkListItemDetailedView).filter(":visible");1===i&&s.addClass(this.settings.CssClasses.ElementLinkListItemDetailedView)},n.prototype.initiallyLoadElementStatesFromUi=function(t,n){var i=this,s=new Map;return this.utility.getElementLinkList(n).children("li").each(function(t,n){var o=$(n).data(i.settings.DataAttributes.ElementLinkElementId);s.set(o,e.CheckboxStateMachine.State.Saved)}),this.elementStates.set(t,s),s},n.prototype.forEachElementState=function(e,t){var n=this.elementStates.get(e);n&&n.forEach(t)},n.prototype.hideWhenEditOrRemoveWhenNew=function(e,t,n){0===e?t.remove():t.hide(),"function"==typeof n&&n()},n}();t.ElementLinkBuilder=n}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){this.oembedErrorCssClasses=e,this.oembedErrorResources=t,this.linkParser=new CCL.LinkParser}return e.prototype.hasOembedError=function(e){return 0!==e.find("."+this.oembedErrorCssClasses.OembedBoxError).length},e.prototype.generateOembedError=function(e,t,n,i){var s=this;e.oembedPlaceHolder.find("iframe").remove();var o=$("<a>").prop("target","_blank").prop("href",e.originalEmbedCode).text(this.linkParser.getDomain(e.originalEmbedCode)),r=CCL.CommonFunctions.formatString(this.oembedErrorResources.OembedErrorMessage,o.get(0).outerHTML),a=$('<div class="'+this.oembedErrorCssClasses.OembedErrorContentBlock+'"></div>').append('<p class="'+this.oembedErrorCssClasses.OembedErrorTitle+'">'+this.oembedErrorResources.OembedErrorTitle+"</p>").append('<span class="'+this.oembedErrorCssClasses.OembedErrorMessage+'">'+r+"</span>").append("<br />").append($('<button type="button" class="'+this.oembedErrorCssClasses.OembedErrorTryAgain+'">'+this.oembedErrorResources.OembedErrorTryAgain+"</button>").on("click",function(){var o="function"==typeof n?n():0,r=e.oembedPlaceHolder.find("."+s.oembedErrorCssClasses.OembedBoxError),a=r.outerHeight();r.remove(),e.oembedPlaceHolder.find("iframe").remove(),t.loadEmbedContentAsync(a+o),"function"==typeof i&&i()}));return $('<div class="'+this.oembedErrorCssClasses.OembedBoxError+" "+this.oembedErrorCssClasses.Clearfix+'"></div>').append('<span class="'+this.oembedErrorCssClasses.OembedErrorImageBox+'"></span>').append(a)},e}();e.EmbedError=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e){this.utility=e,this.settings=e.settings,this.controls=e.controls}return t.prototype.getBulletinEditorTextarea=function(e){return this.utility.isAddMode(e)?this.utility.svelteControls.newBulletinTextArea:e.data(t.bulletinEditorDataAttribute)},t.prototype.getBulletinEditorInstance=function(e){return e.data(t.bulletinEditorInstanceDataAttribute)},t.prototype.createBulletinEditor=function(n){var i=new e.LightBulletinEditorInstance(n.bulletinItem,n,this.utility);return n.bulletinItem.data(t.bulletinEditorInstanceDataAttribute,i),i},t.prototype.removeBulletinEditorInstanceDataAttribute=function(e){e.removeData(t.bulletinEditorInstanceDataAttribute)},t.bulletinEditorDataAttribute="bulletinEditor",t.bulletinEditorInstanceDataAttribute="bulletinEditorInstance",t}();e.LightBulletinEditor=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t,n){this.bulletinItem=e,this.editor=t,this.utility=n;var i=$(this.utility.controls.Container.attr("data-"+this.utility.settings.DataAttributes.BulletinItemEditorButtonsTemplate));this.editorButtons=i,this.bulletinId=this.utility.getBulletinId(e)}return Object.defineProperty(e.prototype,"applyButton",{get:function(){return this.utility.getAddEditButton(this.bulletinItem)},enumerable:!0,configurable:!0}),e.prototype.removeBulletinEditor=function(){this.editorButtons.remove()},e}();e.LightBulletinEditorInstance=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){this.utility=e}return e.prototype.applyNewImageLoadingComplete=function(e){var t=this,n=this.filterNewImageBoxes(this.utility.getImageBox(e));this.utility.getImage(n).one("load",function(){return n.removeClass(t.utility.settings.CssClasses.ImageBoxLoading)})},e.prototype.hideOrRemoveImageBoxFromContainer=function(e){this.hideOrRemoveImageBox(this.utility.getImageBox(e))},e.prototype.hideOrRemoveImageBox=function(e){this.filterNewImageBoxes(e).remove(),this.filterNotNewImageBoxes(e).hide()},e.prototype.resetUnsavedImage=function(e){var t=this.utility.getImageBox(e);this.filterNewImageBoxes(t).remove(),this.filterNotNewImageBoxes(t).show(),this.removeImageError(e),this.clearAddImageButtonFileInputValue(e)},e.prototype.getParsedUploadResult=function(e){return this.parseSerialzedImageData(this.filterNewImageBoxes(this.utility.getImageBox(e)).last().find("input[type='hidden']"))},e.prototype.getDeleteAttachedImageValue=function(e){var t,n=this.utility.getImageBox(e);return 0===this.filterNewImageBoxes(n).length&&(t=this.filterNotNewImageBoxes(n)).length>0&&t.length===t.not(":visible").length},e.prototype.applyImageEditsIfNeeded=function(e,t){var n=this.utility.getImageBox(e),i=this.filterNewImageBoxes(n),s=this.filterNotNewImageBoxes(n),o=s.filter(":hidden");i.length>0&&(s.remove(),this.utility.setImageIsNew(i,!1),t&&i.find("[data-"+this.utility.settings.DataAttributes.BulletinAttachedImageLink+"]").prop("href",t)),o.length>0&&o.remove(),this.removeImageError(e)},e.prototype.removeImageError=function(e){this.utility.getImageError(e).remove()},e.prototype.addImageButtonFileInputHasValue=function(e){return!!e.find(this.utility.selectors.addImageButtonFileInput).val()&&this.utility.getVisibleImageBox(e).length>0},e.prototype.clearAddImageButtonFileInputValue=function(e){e.find(this.utility.selectors.addImageButtonFileInput).val("")},e.prototype.filterNewImageBoxes=function(e){var t=this;return e.filter(function(e,n){return t.utility.getImageIsNew($(n))})},e.prototype.filterNotNewImageBoxes=function(e){var t=this;return e.filter(function(e,n){return!t.utility.getImageIsNew($(n))})},e.prototype.parseSerialzedImageData=function(e){return e.length>0?CCL.CommonFunctions.safeParseJson(e.val()):void 0},e}();e.LightBulletinImageBox=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function t(e){var t=this;this.utility=e,this.watchEmbedsDebouncer=new CCL.CallbackDebouncer(function(e){var n=e.editor,i=e.enabled;return t.switchWatchEmbeds(n,i)})}return t.prototype.toggleOembedEditClasses=function(e,t){e.find("."+this.utility.settings.CssClasses.OembedBoxHeader).toggle(!t.isViewMode),this.utility.getVisibleOembedBox(e).toggleClass(this.utility.settings.CssClasses.OembedBoxEditMode,!t.isViewMode&&!t.isEmbedInProgress)},t.prototype.switchWatchEmbeds=function(e,t){this.utility.watchEmbeds.switchWatchEmbedsInBulletinItem(e,t)},t.prototype.toggleResourceButton=function(e,t){this.utility.getCurrentBulletinItemOrNew(e).find(this.utility.selectors.addResourceAction).prop("disabled",!t)},t.prototype.toggleAddImageButton=function(e,t){var n=this.utility.getAddImageButton(e);n.prop("disabled",!t),n.find(this.utility.selectors.addImageButtonFileInput).toggle(t)},t.prototype.toggleAddToOtherCoursesButton=function(e,t){this.utility.getAddToOtherCoursesButton(e).prop("disabled",!t)},t.prototype.toggleAttachingActionsToBulletin=function(t,n){var i=this.utility.getCurrentBulletinItemOrNew(t);this.toggleResourceButton(i,!(n.hasVisibleOembedBox||n.isEmbedInProgress||n.maxCountOfAddedElementsReached||n.hasVisibleImage||n.isMultiCourseLightBulletin));var s=n.hasVisibleOembedBox||n.isEmbedInProgress||n.hasAttachedElementLinks||n.hasVisibleImage;this.toggleAddImageButton(i,!(n.hasVisibleOembedBox||n.isEmbedInProgress||n.hasAttachedElementLinks));var o=e.Controls.MultipleCourseSearchSelector.multipleCourseSearchSelectorDialogClientInstance.getAvailableCoursesCount();this.toggleAddToOtherCoursesButton(i,!n.hasAttachedElementLinks&&o>0),this.watchEmbedsDebouncer.invokeCallback({editor:this.utility.getEditorByItem(i),enabled:!s},500)},t.prototype.toggleBulletinAttachmentButtons=function(e,t){this.toggleResourceButton(e,t),this.toggleAddImageButton(e,t)},t}();t.LightBulletinToggler=n}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function n(e,t,n,i){this.controls=e,this.settings=t,this.editorsById=new Map,this.initSelectors(),this.initClasses(n,i)}return n.prototype.getEditorById=function(e){return this.editorsById.get(e)},n.prototype.getEditorByItem=function(e){var t=this.getBulletinId(e);return this.getEditorById(t)},n.prototype.registerEditor=function(e){var t=e.id?e.id:0;this.editorsById.set(t,e);var n=e.id?this.getBulletinById(e.id):$(document.getElementById("ad46fb9725b3540a79a214c02ab269ef9"));e.bulletinItem=n},n.prototype.synchronizeDateTimePicker=function(e){var t=this;e.dateTimeSynchronizer=this.dateTimeSynchronizer,this.dateTimeSynchronizer.isSynchronizeNeeded&&this.ajaxClient.getCurrentDateTime().done(function(e){return t.dateTimeSynchronizer.synchronize(CCL.SerializableDateTimeConverter.toDateWithSeconds(e))})},n.prototype.validateBulletinAndToggleControlsWithText=function(e,t){var n=this.textValidator.validateBulletinText(e,this.getCurrentBulletinItemOrNew(t));return this.toggler.toggleAttachingActionsToBulletin(t,n),n},n.prototype.validateBulletinAndToggleControls=function(e){var t=this.getBulletinId(e),n=this.getEditorById(t);return this.validateBulletinAndToggleControlsWithText(n.getData().plainText,e)},n.prototype.isAddMode=function(e){return 0===e.length||e.get(0)===this.controls.NewBulletinItem.get(0)},n.prototype.isViewMode=function(e){return 0===this.getAddEditButton(e).length},n.prototype.getBulletinId=function(e){return e.data(this.settings.DataAttributes.BulletinId)||0},n.prototype.getBulletinById=function(e){return this.controls.Container.find("[data-"+this.settings.DataAttributes.BulletinId+"='"+e+"']")},n.prototype.findBulletinItemByChild=function(e){return e.closest(this.selectors.bulletinItem)},n.prototype.getCurrentBulletinItemOrNew=function(e){return this.isAddMode(e)?this.controls.NewBulletinItem:e},n.prototype.getAddEditButton=function(e){return this.isAddMode(e)?this.controls.PostNewBulletin:e.find(this.selectors.applyEditAction)},n.prototype.getAddImageButton=function(e){return this.getCurrentBulletinItemOrNew(e).find(this.selectors.addImageButton)},n.prototype.getAddToOtherCoursesButton=function(e){return this.controls.AddMenu.AddToOtherCoursesButton},n.prototype.removeBulletin=function(e){this.animator.animateHideAndRemove(e.closest("li"))},n.prototype.getOembedBox=function(e){return e.find("."+this.settings.CssClasses.OembedBox)},n.prototype.getVisibleOembedBox=function(e){return this.getOembedBox(e).filter(":visible")},n.prototype.hasVisibleOembedBox=function(e){return this.getVisibleOembedBox(e).length>0},n.prototype.getHiddenOembedBox=function(e){return this.getOembedBox(e).filter(":hidden")},n.prototype.getImageBox=function(e){return e.find("."+this.settings.CssClasses.ImageBox)},n.prototype.getImageError=function(e){return e.find("."+this.settings.CssClasses.ImageError)},n.prototype.getVisibleImageBox=function(e){return this.getImageBox(e).filter(":visible")},n.prototype.hasVisibleImage=function(e){return this.getVisibleImageBox(e).length>0},n.prototype.getHiddenImageBox=function(e){return this.getImageBox(e).filter(":hidden")},n.prototype.hasHiddenImage=function(e){return this.getHiddenImageBox(e).length>0},n.prototype.getImageIsNew=function(e){return e.data(this.settings.DataAttributes.ImageIsNew)},n.prototype.setImageIsNew=function(e,t){e.data(this.settings.DataAttributes.ImageIsNew,t)},n.prototype.getImage=function(e){return e.find("[data-"+this.settings.DataAttributes.BulletinAttachedImage+"]")},n.prototype.setScheduleTimeSpanForNewAnnouncement=function(e){var t=e.activeFromText,n=e.activeToText;document.dispatchEvent(new CustomEvent("setScheduleTimeSpan__44ff08603407443c8cea5022a3f1474a",{detail:{activeFromText:t,activeToText:n}}))},n.prototype.hasOembedAttachedOrLoading=function(e,t){var n=this.getCurrentBulletinItemOrNew(e);return this.hasVisibleOembedBox(n)||t.isEmbedInProgress(n)},n.prototype.getElementLinkList=function(e){return e.find("[data-"+this.settings.DataAttributes.ElementLinkList+"]")},n.prototype.countResourcesOnUi=function(e){return this.getElementLinkList(this.getCurrentBulletinItemOrNew(e)).find("li").filter(":visible").length},n.setTabindexToHiddenElements=function(e,t,n){var i=t?t.getBoundingClientRect().top:0,s=t&&(t.offsetWidth>0||t.offsetHeight>0);e.find(n).each(function(e,t){var n=t.getBoundingClientRect().top;i<n&&s?$(t).attr("tabindex","-1"):$(t).removeAttr("tabindex")})},n.prototype.initSelectors=function(){this.selectors={newBulletinTextArea:"#"+this.settings.ClientIds.NewBulletinTextAreaContainer+" textarea",applyEditAction:"."+this.settings.CssClasses.EditModeSaveButton,addResourceAction:"[data-"+this.settings.DataAttributes.BulletinAction+'="'+this.settings.DataAttributes.BulletinActionAddResourceValue+'"]',bulletinItem:"[data-"+this.settings.DataAttributes.BulletinId+"]",mediaAppendTarget:"[data-"+this.settings.DataAttributes.MediaAppendTarget+"]",addImageButton:"."+this.settings.CssClasses.AddImageButton,addImageButtonFileInput:"."+this.settings.CssClasses.AddImageButtonFileInput,lightBulletinActionDropDownItem:"[data-"+this.settings.SingleItemDataDataAttributes.LightBulletinActionDropDownItem+"]"}},n.prototype.initClasses=function(n,i){this.editor=new t.LightBulletinEditor(this),this.watchEmbeds=new t.LightBulletinWatchEmbeds(n,this),this.imageBox=new t.LightBulletinImageBox(this),this.toggler=new t.LightBulletinToggler(this),this.textExpander=new CCL.TextExpander(this.settings.TextExpanderSettings),this.embedAsynchronousLoader=new t.EmbedAsynchronousLoader({isIosDevice:this.settings.IsIosDevice,cssClasses:{noBorder:this.settings.CssClasses.Border0,ajaxLoader:this.settings.CssClasses.AjaxLoader,oembedError:this.settings.OembedErrorCssClasses.OembedBoxError},selectors:{embedBox:"."+this.settings.CssClasses.OembedBox+":visible",bulletinItem:this.selectors.bulletinItem},dataAttributes:{embedIframeUrl:this.settings.DataAttributes.EmbedIframeUrl}}),this.textValidator=new t.LightBulletinTextValidator(this),this.ajaxClient=new t.LightBulletinAjaxClient(this.settings,i),this.animator=new t.LightBulletinAnimator({animationTimeInMilliseconds:t.LightBulletinConstants.animationTimeInMilliseconds}),this.commentToggler=new t.LightBulletinCommentToggler(this),this.elementLinkBuilder=new t.ElementLinkBuilder(this),this.oembedError=new t.EmbedError(this.settings.OembedErrorCssClasses,this.settings.OembedErrorResources),this.linkParser=new CCL.LinkParser,this.dateTimeSynchronizer=new e.Controls.DateTimeSynchronizer(CCL.SerializableDateTimeConverter.toDateWithSeconds(this.settings.Today)),this.singleItemDataManager=new t.LightBulletinSingleItemDataManager(this.settings.SingleItemDataDataAttributes,this.settings.SingleItemDataResources),this.svelteControls=new t.LightBulletinSvelteControls(this)},n}();t.LightBulletinUtility=n}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t,n){var i=this;this.utility=n,this.tryAgainBulletinIds=[],this.embedTextChangeHandlers=new Map,this.watchEmbedTextChangeHandler=function(t,n){i.embedCallbackDebouncer.invokeCallback({editor:t,text:n},e.LightBulletinConstants.watchEmbedsKeyUpTimeoutInMilliseconds)},this.embedCallbackDebouncer=new CCL.CallbackDebouncer(t)}return t.prototype.switchWatchEmbedsInBulletinItem=function(e,t){t&&!e.isRtfInAnnouncementsEnabled?this.watchEmbeds(e):this.stopWatchEmbeds(e)},t.prototype.watchEmbeds=function(e){var t=this;if(e&&!e.isRtfInAnnouncementsEnabled){this.stopWatchEmbeds(e);var n=function(n){return t.watchEmbedTextChangeHandler(e,n)};e.registerTextHandler(n),this.embedTextChangeHandlers.set(e,n)}},t.prototype.stopWatchEmbeds=function(e){if(this.embedTextChangeHandlers.has(e)){var t=this.embedTextChangeHandlers.get(e);e.removeTextHandler(t),this.embedTextChangeHandlers.delete(e)}},t.prototype.shouldAppendOembedError=function(e){var t=e.oembedPlaceHolder;if(this.utility.oembedError.hasOembedError(e.oembedPlaceHolder))return!1;var n=this.utility.findBulletinItemByChild(t),i=this.utility.getBulletinId(n);return-1===this.tryAgainBulletinIds.indexOf(i)&&(this.utility.isAddMode(n)||t.data(this.utility.settings.DataAttributes.OembedIsNew))?(t.remove(),!1):this.utility.countResourcesOnUi(n)<=0},t.prototype.appendOembedError=function(e){var t=this,n=e.oembedPlaceHolder,i=this.utility.findBulletinItemByChild(n),s=this.utility.getBulletinId(i),o=this.tryAgainBulletinIds.indexOf(s);-1!==o&&(n.data(this.utility.settings.DataAttributes.OembedIsNew,!1),this.tryAgainBulletinIds.splice(o,1)),n.append(this.utility.oembedError.generateOembedError(e,this.utility.embedAsynchronousLoader,function(){t.tryAgainBulletinIds.push(s);var n=e.oembedPlaceHolder.outerHeight();t.utility.toggler.toggleOembedEditClasses(i,{isViewMode:t.utility.isViewMode(i),isEmbedInProgress:!0});var o=n-e.oembedPlaceHolder.outerHeight();return t.utility.linkParser.removeFromSkipUrl(e.originalEmbedCode),o},function(){t.utility.isViewMode(i)||t.utility.validateBulletinAndToggleControls(i)})),n.removeClass(this.utility.settings.CssClasses.OembedBoxLoading)},t}();e.LightBulletinWatchEmbeds=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e){var t=this;this.controls=e,this.modalDialog=window[this.dialogId],this.controls.OkButton.click(function(e){e.preventDefault(),t.currentStrategy.persistDialogState()})}return Object.defineProperty(e.prototype,"dialogId",{get:function(){return this.controls.Container.prop("id")},enumerable:!0,configurable:!0}),e.prototype.openDialog=function(e){this.currentStrategy=e.strategy,this.modalDialog.openDialog(!1),this.currentStrategy.loadDialogState(this.controls,e.strategicData)},e}();e.ScheduleDialogManager=t}(e.ScheduleDialog||(e.ScheduleDialog={}))}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t,n){this.settings=e,this.textExpander=t,this.getBulletinId=n}return e.prototype.renderShowMoreLink=function(e,t,n){var i=this;void 0===n&&(n=function(){}),e.each(function(e,s){var o=$(s),r=i.findClickablePlaceholder(o);i.textExpander.registerExpanderItem({key:i.getBulletinId(o),clickablePlaceholder:r,collapsibleContainer:i.findCollapsibleTextContainer(o),contentPanel:i.findContent(o),initialStateExpanded:t,onClickCallback:n}),r.removeAttribute("style")})},e.prototype.findClickablePlaceholder=function(e){return this.findByDataAttribute(e,this.settings.DataAttributes.ClickablePlaceholder).get(0)},e.prototype.findCollapsibleTextContainer=function(e){return this.findByDataAttribute(e,this.settings.DataAttributes.CollapsibleTextContainer)},e.prototype.findContent=function(e){return this.findByDataAttribute(e,this.settings.DataAttributes.Content).get(0)},e.prototype.findByDataAttribute=function(e,t){return e.find("[data-"+t+"]")},e}();e.ShowMoreLinkRenderer=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e){this.utility=e,this.settings=e.settings}return t.prototype.validateBulletinText=function(t,n){var i=this.utility.embedAsynchronousLoader.isEmbedInProgress(n),s=this.checkNotEmpty(t),o=this.utility.hasVisibleOembedBox(n),r=this.utility.countResourcesOnUi(n),a=e.lightBulletinContentBlockInstance.isMultiCourseLightBulletin(n);return{isPlainTextTooLong:this.validatePlainTextBeingTooLong(t),passedEmptyTextValidation:s||o,isEmbedInProgress:i,hasVisibleOembedBox:o,maxCountOfAddedElementsReached:r===e.LightBulletinConstants.maxCountOfAddedElements,hasAttachedElementLinks:r>0,hasVisibleImage:this.utility.hasVisibleImage(n),isMultiCourseLightBulletin:a}},t.prototype.canAnnouncementBePosted=function(e){var t=e.isEmbedInProgress,n=void 0!==t&&t,i=e.isPlainTextTooLong,s=void 0!==i&&i,o=e.passedEmptyTextValidation;return!n&&(void 0===o||o)&&!s},t.prototype.toggleTextRelatedErrorMessages=function(e,t,n){var i=t.isEmbedInProgress,s=void 0!==i&&i,o=t.isPlainTextTooLong,r=void 0!==o&&o,a=t.passedEmptyTextValidation,l=void 0===a||a,c="";l?r?c=this.createTextTooLongMessage(n.length):s&&(c=this.settings.Resources.IsEmbedInProgressError):c=this.settings.Resources.NoTextYetError,this.toggleTextareaError({editorTextareaErrorMessage:c,hasEditorTextareaError:!this.canAnnouncementBePosted({isEmbedInProgress:s,isPlainTextTooLong:r,passedEmptyTextValidation:l}),lightBulletinId:e})},t.prototype.checkNotEmpty=function(e){return $.trim(e).length>0},t.prototype.toggleTextareaError=function(e){var t=e.editorTextareaErrorMessage,n=e.hasEditorTextareaError,i=e.lightBulletinId;document.dispatchEvent(new CustomEvent("toggleEditorTextareaValidation__ec26995b5f864c43af19a9bc1dc53eda",{detail:{editorTextareaErrorMessage:t,hasEditorTextareaError:n,lightBulletinId:i}}))},t.prototype.validatePlainTextBeingTooLongAndToggleTextareaError=function(e,t){this.toggleTextRelatedErrorMessages(e,{isPlainTextTooLong:this.validatePlainTextBeingTooLong(t)},t)},t.prototype.validatePlainTextBeingTooLong=function(e){return e&&e.length>this.settings.TextMaxLength},t.prototype.createTextTooLongMessage=function(e){return CCL.CommonFunctions.formatString(this.settings.Resources.TextTooLongError,this.settings.TextMaxLength,e)},t}();e.LightBulletinTextValidator=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(e){function t(t,n){e.call(this,t.CommonAjaxClientSettings,n),this.settings=t}return __extends(t,e),t.prototype.page=function(e,t,n){return $.ajax({type:"GET",url:this.settings.Urls.Page,data:{courseId:this.settings.CourseId,boundaryLightBulletinId:e,boundaryLightBulletinActiveFromTicks:t,displayMode:n}})},t.prototype.createLightBulletin=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.settings.Urls.CreateLightBulletin,data:{inputData:e},dataType:"html"})},t.prototype.updateLightBulletin=function(e){return CCL.CommonFunctions.safeAjax({type:"PUT",url:this.settings.Urls.UpdateLightBulletin,data:{inputData:e},dataType:"json"})},t.prototype.getSchedule=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.settings.Urls.GetSchedule,data:{lightBulletinId:e},dataType:"json"})},t.prototype.getCurrentDateTime=function(){return CCL.CommonFunctions.safeAjaxPost({url:this.settings.Urls.GetCurrentDateTime,dataType:"json"})},t.prototype.getTimeSpan=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.settings.Urls.GetTimeSpan,data:e,dataType:"json",headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:this.settings.AntiForgeryHeaderName,headerValue:this.settings.AntiForgeryHeaderValue})})},t.prototype.updateSchedule=function(e){return CCL.CommonFunctions.safeAjax({type:"PUT",url:this.settings.Urls.UpdateSchedule,data:e,dataType:"json",headers:CCL.CommonFunctions.getAntiForgeryAjaxHeader({headerName:this.settings.AntiForgeryHeaderName,headerValue:this.settings.AntiForgeryHeaderValue})})},t.prototype.setBulletinCommentsAvailability=function(e,t){return CCL.CommonFunctions.safeAjax({type:"PUT",url:this.settings.Urls.SetBulletinCommentsAvailability,data:{bulletinId:e,disableComments:t},dataType:"json"})},t.prototype.toggleLightBulletinSubscriptionForPerson=function(e,t){return CCL.CommonFunctions.safeAjax({type:"PUT",url:this.settings.Urls.ToggleLightBulletinSubscriptionForPerson,data:{lightBulletinId:e,subscribe:t},dataType:"json"})},t.prototype.embed=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.settings.Urls.Embed,data:{embedUrl:e},dataType:"html"})},t.prototype.elementLinkItemsContent=function(e){return CCL.CommonFunctions.safeAjaxPost({url:this.settings.Urls.ElementLinkItemsContent,data:{elementIds:e},dataType:"html"})},t.prototype.getBulletinElementLinksAnnouncementCompleted=function(e){return $.get(this.settings.Urls.IsBulletinElementLinksAnnouncementCompletedUrl+"?courseId="+e)},t.prototype.uploadImage=function(e,t,n){return $.ajax({type:"PUT",url:this.settings.Urls.UploadImage+"?courseId="+e+"&lightBulletinId="+t,contentType:!1,processData:!1,dataType:"html",data:n})},t.prototype.callInsertOrUpdatePersonSettingService=function(e,t){return CCL.CommonFunctions.safeAjaxPost({url:this.settings.Urls.InsertOrUpdateSetting,data:{name:e,value:t}})},t}(e.CommonAjaxClient);t.LightBulletinAjaxClient=n}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(){}return e.listenToEmbedSizePostmessages=function(e,t,n,i){CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.getEmbeddedContentSize,function(s){var o=e.find("#"+s.oembedPlaceHolderId),r=o.hasClass(t)?o:o.find("."+t);s.height&&(r.css("height",s.height),n.removeAjaxLoader(o.parent()),i&&i(o))})},e}();e.EmbedResizer=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=e.Controls.MultipleCourseSearchSelector.MultipleCourseSearchSelector,i=function(){function i(e,n){var i=this;this.controls=e,this.settings=n,this.pendingEmbedProcessManager=new t.PendingEmbedProcessManager,this.embedBufferMap=new Map,this.uploadImagePromiseQueue=new CCL.PromiseQueue,this.afterAddingComment=function(e){var t=e.userData.sourceId,n=i.utility.getBulletinById(t);i.singleItemDataManager.subscribeToCommentsIfNeeded(n,t)},this.lightBulletinMenuClicked=function(e){var n=e.detail,s=n.lightBulletinDropDownMenuActionType,o=n.lightBulletinId,r=i.utility.getBulletinById(o);switch(s){case t.LightBulletinDropDownMenuActionType.SetCommentsAvailability:var a=!i.singleItemDataManager.getSingleItemData(r).DisableComments;i.ajaxClient.setBulletinCommentsAvailability(o,a).done(function(e){t.GenericResponseHandler.handle(e,function(){var e=i.singleItemDataManager.refreshSingleItemData(r,function(e){return e.DisableComments=a});i.commentToggler.togglePossibilityToAddComments(e,i.settings.AllowedToCommentAnnouncements),i.singleItemDataManager.updateSingleItemDataSvelte(o,{disableComments:a})},function(){e.Code===t.GenericResponseCode.LightBulletinNotFound&&i.utility.removeBulletin(r)})}).fail(i.ajaxClient.handleAjaxError),i.resetFocusOnCurrentItem(r);break;case t.LightBulletinDropDownMenuActionType.ScheduleBulletin:t.ScheduleDialog.ScheduleDialogManager.instance.openDialog({strategy:i.ajaxStorageStrategy,strategicData:{lightBulletinId:o,bulletinsDisplayMode:i.activationFilterCurrentValue,onSuccess:function(e){e.dateTimeLabelText?i.singleItemDataManager.updateSingleItemDataSvelte(o,{dateTimeLabelText:e.dateTimeLabelText,dateTimeLabelToolTip:e.dateTimeLabelToolTip}):(i.utility.removeBulletin(r),i.showInformationFeedback(e.InformationFeedbackButtonText,e.CurrentDisplayMode+"_Course_"+e.CourseId,i.settings.Resources.BulletinHasBeenEditedButDoesNotMatchFilter))}}}),i.resetFocusOnCurrentItem(r);break;case t.LightBulletinDropDownMenuActionType.ToggleSubscription:var l=i.singleItemDataManager.getSingleItemData(r).SubscriptionStatus!==t.PersonSubscriptionStatus.Subscribed;i.ajaxClient.toggleLightBulletinSubscriptionForPerson(o,l).done(function(e){return t.GenericResponseHandler.handle(e,function(){return i.singleItemDataManager.updateSubscriptionStatus(r,o,l)},function(){e.Code===t.GenericResponseCode.LightBulletinNotFound&&i.utility.removeBulletin(r)})}).fail(i.ajaxClient.handleAjaxError),i.resetFocusOnCurrentItem(r);break;case t.LightBulletinDropDownMenuActionType.ImmersiveReader:var c=o;window.fetch("/restapi/personal/immersivereader/v1?ResourceType=Bulletin&ResourceId="+c).then(function(e){if(!e.ok)throw Error(e.statusText);e.json().then(function(e){var t={accessToken:e.AccessToken,subDomain:e.SubDomain,content:{title:e.Title,chunks:[{content:e.Text}]},options:{uiLang:e.UiLang,uiZIndex:1e6}};window.ImmersiveReader.launchAsync(t.accessToken,t.subDomain,t.content,t.options)})})}},this.onDeleteImageButtonClick=function(e){var t=$(e.target),n=i.utility.getCurrentBulletinItemOrNew(i.utility.findBulletinItemByChild(t));i.utility.imageBox.hideOrRemoveImageBox(t.closest("."+i.settings.CssClasses.ImageBox)),i.utility.imageBox.clearAddImageButtonFileInputValue(n),i.focusOnEditor(n),i.utility.validateBulletinAndToggleControls(n)},this.checkInputForEmbedUrl=function(e){i.watchEmbeds.stopWatchEmbeds(e.editor);var n=e.editor.bulletinItem,s=i.utility.getCurrentBulletinItemOrNew(n),o=e.editor.id?n.find(i.selectors.mediaAppendTarget):$(e.editor.editorContainer).closest(i.selectors.mediaAppendTarget);if(!i.utility.hasVisibleOembedBox(o)&&0===i.utility.countResourcesOnUi(n)){var r=i.utility.linkParser.getFirstLink(e.text);if(r&&r.length<=i.settings.EmbedUrlMaxLength){i.toggler.toggleBulletinAttachmentButtons(n,!1),i.utility.imageBox.removeImageError(s);var a=i.embedAsynchronousLoader.createAjaxLoader();o.append(a);var l=i.pendingEmbedProcessManager.createProcess(i.ajaxClient.embed(r));a.data(t.LightBulletinConstants.dataAttributeNames.pendingProcessId,l.processId),l.ajaxRequest.done(function(e){var n=$(e);o.append(n);var s=i.embedAsynchronousLoader.findIframeHolders(n),r=i.embedAsynchronousLoader.createIframe(i.embedAsynchronousLoader.getEmbedIframeUrl(s),!0);s.append(r),s.data(t.LightBulletinConstants.dataAttributeNames.loadedProcessId,l.processId),i.pendingEmbedProcessManager.clearProcessAjaxRequest(l)}).fail(function(c){a.remove(),l.pendingStatus!==t.PendingProcessStatus.Aborted&&(i.pendingEmbedProcessManager.setProcessFailed(l),i.ajaxClient.handleAjaxError(c),i.watchEmbeds.watchEmbeds(e.editor),i.watchEmbeds.shouldAppendOembedError({originalEmbedCode:r,oembedPlaceHolder:o})&&i.watchEmbeds.appendOembedError({originalEmbedCode:r,oembedPlaceHolder:o}),i.toggler.toggleOembedEditClasses(s,{isViewMode:!1,isEmbedInProgress:!0}),i.utility.validateBulletinAndToggleControls(n)),i.watchEmbeds.watchEmbeds(e.editor)})}else i.watchEmbeds.watchEmbeds(e.editor)}},t.lightBulletinContentBlockInstance=this,this.utility=new t.LightBulletinUtility(e,n,this.checkInputForEmbedUrl,function(){return i.formCheckBeforeUnload.DetachHandler()}),this.watchEmbeds=this.utility.watchEmbeds,this.selectors=this.utility.selectors,this.editor=this.utility.editor,this.toggler=this.utility.toggler,this.embedAsynchronousLoader=this.utility.embedAsynchronousLoader,this.textValidator=this.utility.textValidator,this.commentToggler=this.utility.commentToggler,this.ajaxClient=this.utility.ajaxClient,this.elementLinkBuilder=this.utility.elementLinkBuilder,this.singleItemDataManager=this.utility.singleItemDataManager,this.svelteControls=this.utility.svelteControls,(this.settings.CanAddNewBulletins||this.settings.HasOwnBulletin)&&(this.scheduleDialogInputValidator=new t.ScheduleDialogInputValidator(this.utility),this.temporaryStorageStrategy=new t.ScheduleDialogTemporaryStorageStrategy(this.utility,this.scheduleDialogInputValidator),this.ajaxStorageStrategy=new t.ScheduleDialogAjaxStorageStrategy(this.utility,this.scheduleDialogInputValidator)),this.boundaryLightBulletinId=this.settings.InitialPageData.BoundaryLightBulletinId,this.boundaryLightBulletinActiveFromTicks=this.settings.InitialPageData.BoundaryLightBulletinActiveFromTicks,this.activationFilterCurrentValue=this.settings.BulletinsDisplayMode;var s=function(){i.setupFormCheckBeforeUnload(),i.setupControls(),i.setupControlsEvents(),i.setupEventListeners()};this.settings.CanAddNewBulletins?(document.addEventListener("NewAnnouncementItemMount_b11bc092f6b943c9b02eb93c9b3e6bbd",function(e){i.svelteControls.setNewBulletinSvelteControls(),s()}),document.addEventListener("AnnouncementBulletinFirstLinkChanged_3ed55af064034b6faed39a98b13756f4",function(e){var t=e.detail;t.linkUrl.toLowerCase().startsWith("http")||(t.linkUrl="https://"+t.linkUrl),i.utility.registerEditor(t.editor),i.startEmbeddingUrl(t.editor,t.linkUrl)}),document.addEventListener("AnnouncementBulletinRegisterEditor_f4064f7ea601406eab05bcf206ba170d",function(e){var t=e.detail;if(i.utility.registerEditor(t),i.settings.CanAddNewBulletins){var n=i.utility.getEditorById(0);i.setupEditorAndApplyButton({editor:n,applyButton:i.controls.PostNewBulletin},function(){return i.createLightBulletin()}),i.watchEmbeds.watchEmbeds(n),n.registerTextHandler(function(e){return i.textValidator.validatePlainTextBeingTooLongAndToggleTextareaError(0,e)})}})):s()}return i.prototype.isMultiCourseLightBulletin=function(e){return this.utility.getBulletinId(e)>0?this.singleItemDataManager.getSingleItemData(e).IsMultiCourseLightBulletin:this.postedToCoursesInNewBulletin&&this.postedToCoursesInNewBulletin.length>0},i.prototype.onActivationFilterChanged=function(e){this.activationFilterCurrentValue=parseInt(e,10),this.ajaxClient.callInsertOrUpdatePersonSettingService(this.settings.BulletinsContentBlockDisplayModePersonSettingName,e).done(WidgetLayout._reloadWindow)},i.prototype.resetFocusOnCurrentItem=function(e){if(e.length){var t=e.get(0).querySelector("textarea,button,input:not([type='hidden'])");t&&t.focus()}},i.prototype.focusOnEditor=function(e){this.utility.editor.getBulletinEditorTextarea(e).focus()},i.prototype.uploadImage=function(t){var n=this,i=$(t.target).closest(this.utility.selectors.addImageButtonFileInput);if(!i.prop("disabled")){var s=e.UploadFileHelper.getFormDataWithAttachedFilesAndFileSizes(t.target).formData;if(s){var o=this.utility.findBulletinItemByChild(i),r=this.utility.isAddMode(o)?i.closest(this.selectors.mediaAppendTarget):o.find(this.selectors.mediaAppendTarget),a=this.utility.getCurrentBulletinItemOrNew(o);this.utility.imageBox.hideOrRemoveImageBoxFromContainer(r),this.utility.imageBox.removeImageError(r),this.watchEmbeds.stopWatchEmbeds(this.utility.getEditorByItem(o)),this.toggler.toggleResourceButton(o,!1),this.toggler.toggleAddImageButton(o,!1),r.append(this.embedAsynchronousLoader.createAjaxLoader());this.uploadImagePromiseQueue.enqueue(function(){return n.ajaxClient.uploadImage(n.settings.CourseId,n.utility.getBulletinId(o),s).always(function(){n.editor.getBulletinEditorTextarea(o).focus(),n.embedAsynchronousLoader.removeAjaxLoader(r)}).done(function(e){n.utility.isViewMode(a)||n.utility.hasVisibleImage(a)||(r.append($(e)),n.utility.validateBulletinAndToggleControls(o),n.utility.imageBox.applyNewImageLoadingComplete(r),n.utility.getImageError(a).length>0&&n.utility.imageBox.clearAddImageButtonFileInputValue(a))}).fail(function(e){n.utility.validateBulletinAndToggleControls(o),n.utility.imageBox.clearAddImageButtonFileInputValue(a),n.ajaxClient.handleAjaxError(e)})})}}},i.prototype.setupEventListeners=function(){this.listenToEmbedPostmessages(),this.listenToEmbedSizePostmessages()},i.prototype.setupControls=function(){this.showMoreRenderer=new t.ShowMoreLinkRenderer(this.settings.ShowMoreLinkRendererSettings,this.utility.textExpander,this.utility.getBulletinId),this.singleItemDataManager.setupSingleItemSvelte(this.controls.Container.find(this.selectors.bulletinItem).get(),{isStream:!1}),this.loadEmbedContent(this.controls.Container),this.setupShowMoreLink(),this.commentToggler.resetCommentsDisabledForNewBulletins()},i.prototype.setupFormCheckBeforeUnload=function(){var i,s=this;this.settings.CanAddNewBulletins?(CCL.DialogWhiteList.allowDialogWithId(e.ElementLinkDialog.elementLinkDialogManagerInstance.getDialogId()),CCL.DialogWhiteList.allowDialogWithId(t.ScheduleDialog.ScheduleDialogManager.instance.dialogId),CCL.DialogWhiteList.allowDialogWithId(n.instance.dialogId),i={enabled:!0,clearStateCallback:function(){s.utility.imageBox.resetUnsavedImage(s.controls.NewBulletinItem),s.resetUnsavedEmbed(s.controls.NewBulletinItem,0,{preserveAjaxLoader:!1}),s.elementLinkBuilder.resetUnsavedElementLinks(0,s.controls.NewBulletinItem),s.utility.validateBulletinAndToggleControls(s.controls.NewBulletinItem),s.textValidator.toggleTextareaError({editorTextareaErrorMessage:"",hasEditorTextareaError:!1,lightBulletinId:0}),s.controls.Container.find(s.selectors.bulletinItem).each(function(e,t){var n=$(t);s.utility.isViewMode(n)||s.cancelEditMode(s.editor.getBulletinEditorInstance(n))})}}):i={enabled:!1,clearStateCallback:function(){}},this.formCheckBeforeUnload=new CCL.FormCheckBeforeUnload(this.controls.Container.closest("form"),this.settings.Resources.FormBeforeUnloadWarning,{callback:function(){return s.isAddingEditingBulletinsNotFinished()},whiteList:i})},i.prototype.setupShowMoreLink=function(){var e=this;this.renderShowMoreLink(this.controls.Container.find(this.selectors.bulletinItem)),this.controls.Container.find(this.selectors.bulletinItem).each(function(n,i){var s=$(i);t.LightBulletinUtility.setTabindexToHiddenElements(s,e.showMoreRenderer.findClickablePlaceholder(s),"."+e.settings.CssClasses.ElementLink)})},i.prototype.renderShowMoreLink=function(e,n){var i=this;void 0===n&&(n=!1),this.showMoreRenderer.renderShowMoreLink(e,n,function(e,n){return t.LightBulletinUtility.setTabindexToHiddenElements(e,n,"."+i.settings.CssClasses.ElementLink)})},i.prototype.loadEmbedContent=function(e){this.embedAsynchronousLoader.appendIframeHolders(e),this.embedAsynchronousLoader.loadEmbedContentAsync()},i.prototype.setupControlsEvents=function(){var i=this;this.controls.ShowMoreLink.click(function(e){i.controls.ShowMoreLink.hide(),i.ajaxClient.page(i.boundaryLightBulletinId,i.boundaryLightBulletinActiveFromTicks,i.settings.BulletinsDisplayMode).done(function(e){var t=void 0,n=$.trim(e).length>0?(t=$(e)).filter("[data-"+i.settings.DataAttributes.PageData+"]"):$();if(n.length>0&&t){var s=n.data(i.settings.DataAttributes.PageData);i.controls.Container.append(t),n.remove(),i.renderShowMoreLink(t.find(i.selectors.bulletinItem)),i.boundaryLightBulletinId=s.BoundaryLightBulletinId,i.boundaryLightBulletinActiveFromTicks=s.BoundaryLightBulletinActiveFromTicks,i.controls.ShowMoreLink.toggle(s.NeedToShowMore),i.loadEmbedContent(t),i.singleItemDataManager.setupSingleItemSvelte(t.find(i.selectors.bulletinItem).get(),{isStream:!1})}}).fail(i.ajaxClient.handleAjaxError),e.preventDefault()}),this.controls.Container.on("click","."+this.settings.CssClasses.OembedDelete,function(e){return i.lightBulletinDeleteEmbedClicked(e)}),this.controls.Container.on("click",this.selectors.addResourceAction,function(e){var t=$(e.target);if(!t.closest(i.selectors.addResourceAction).prop("disabled")){var n=i.utility.findBulletinItemByChild(t),s=i.utility.getCurrentBulletinItemOrNew(n),o=i.utility.getEditorByItem(n);i.utility.hasVisibleOembedBox(s)||i.elementLinkBuilder.onResourceButtonClick(i.utility.getBulletinId(n),s,function(){i.watchEmbeds.watchEmbeds(o),i.toggler.toggleAddImageButton(n,!0)},function(){i.watchEmbeds.stopWatchEmbeds(o),i.toggler.toggleAddImageButton(n,!1),i.toggler.toggleResourceButton(n,!0);var e=i.utility.getVisibleOembedBox(s);i.embedAsynchronousLoader.removeAjaxLoader(e.closest(i.selectors.mediaAppendTarget)),i.removeOembedBox(e,n),i.utility.imageBox.removeImageError(s)},function(){i.utility.validateBulletinAndToggleControls(n)})}}),this.controls.Container.on("click","."+this.settings.CssClasses.ElementLinkDelete,function(e){var t=$(e.currentTarget).closest("."+i.settings.CssClasses.ElementLinkListItem),n=i.utility.findBulletinItemByChild(t);i.elementLinkBuilder.onDetachResourceButtonClick(i.utility.getBulletinId(n),n,t,function(){i.focusOnEditor(n),i.utility.validateBulletinAndToggleControls(n)})}),this.controls.Container.on("click","."+this.settings.CssClasses.ImageDelete,this.onDeleteImageButtonClick),this.controls.Container.on("click",this.utility.selectors.addImageButtonFileInput,function(e){var t=i.utility.getCurrentBulletinItemOrNew(i.utility.findBulletinItemByChild($(e.target)));i.utility.hasVisibleImage(t)&&!confirm(i.settings.Resources.ReloadImageConfirmation)&&e.preventDefault()}),this.controls.Container.on("change",this.utility.selectors.addImageButtonFileInput,function(e){return i.uploadImage(e)}),this.controls.Container.on("click",this.utility.selectors.addImageButton,function(e){return i.clickOnFileInputInsideAddImageButton($(e.target))}),this.utility.controls.AddMenu.Menu.on(this.utility.settings.IsIosDevice?"touchstart":"click","a, button",function(s){s.preventDefault();var o=s.currentTarget;switch(o){case i.utility.controls.AddMenu.ToggleCommentsOptionButton.get(0):i.commentToggler.areCommentsDisabledForNewBulletins=!i.commentToggler.areCommentsDisabledForNewBulletins;break;case i.utility.controls.AddMenu.ScheduleOptionButton.get(0):t.ScheduleDialog.ScheduleDialogManager.instance.openDialog({strategy:i.temporaryStorageStrategy,strategicData:{onSuccess:function(e){return i.utility.setScheduleTimeSpanForNewAnnouncement({activeFromText:e.activeFromText,activeToText:e.activeToText})}}});break;case i.utility.controls.AddMenu.AddToOtherCoursesButton.get(0):var r=$(o);if(r.prop("disabled"))return;var a=i.utility.findBulletinItemByChild(r);n.instance.openDialog(i.postedToCoursesInNewBulletin,function(){CssModal.closeDialog(),i.setPostedToCourses(e.Controls.MultipleCourseSearchSelector.multipleCourseSearchSelectorDialogClientInstance.selectedCourses),i.utility.validateBulletinAndToggleControls(a)})}i.resetFocusOnCurrentItem(i.utility.controls.NewBulletinItem)}),document.addEventListener("announcementDropDownMenuClick_b8079c41162443528e2a8153c4f924e8",function(e){return i.lightBulletinMenuClicked(e)}),document.addEventListener("announcementEnterEditMode_9d7f6b81a631464fa1151d4859dc3f15",function(e){var t=e.detail;i.utility.registerEditor(t),t.registerTextHandler(function(e){return i.textValidator.validatePlainTextBeingTooLongAndToggleTextareaError(t.id,e)}),i.utility.validateBulletinAndToggleControlsWithText(t.getData().plainText,t.bulletinItem),i.textValidator.toggleTextareaError({editorTextareaErrorMessage:"",hasEditorTextareaError:!1,lightBulletinId:0}),i.appendBulletinEditor(t.id,i.editor.createBulletinEditor(t)),i.toggleViewEditMode(t.bulletinItem,!1,!1)}),document.addEventListener("announcementCancelEditMode_4125eb2308614a9387522f34c49fb632",function(e){var t=i.utility.getBulletinById(e.detail.lightBulletinId);i.cancelEditMode(i.editor.getBulletinEditorInstance(t),!1)})},i.prototype.clickOnFileInputInsideAddImageButton=function(e){e.prop("disabled")||e.find(this.utility.selectors.addImageButtonFileInput).click()},i.prototype.setPostedToCourses=function(e){this.postedToCoursesInNewBulletin=e,document.dispatchEvent(new CustomEvent("setPostedToCourseTitles__9bdecb2a48644a1282e7964c3d72a1df",{detail:{postedToCourseTitles:e&&e.length>0?e.map(function(e){return e.Title}):[]}})),this.utility.controls.AddMenu.AddToOtherCoursesSpan.text(this.postedToCoursesInNewBulletin&&this.postedToCoursesInNewBulletin.length>0?this.utility.settings.Resources.EditListOfCourses:this.utility.settings.Resources.AddToOtherCourses)},i.prototype.startEmbeddingUrl=function(e,n){var i=this;this.watchEmbeds.stopWatchEmbeds(e);var s=e.bulletinItem,o=this.utility.getCurrentBulletinItemOrNew(s),r=e.id?s.find(this.selectors.mediaAppendTarget):$(e.editorContainer).closest(this.selectors.mediaAppendTarget);if(!this.utility.hasVisibleOembedBox(r)&&0===this.utility.countResourcesOnUi(s)){this.toggler.toggleBulletinAttachmentButtons(s,!1),this.utility.imageBox.removeImageError(o);var a=this.embedAsynchronousLoader.createAjaxLoader();r.append(a);var l=this.pendingEmbedProcessManager.createProcess(this.ajaxClient.embed(n));a.data(t.LightBulletinConstants.dataAttributeNames.pendingProcessId,l.processId),l.ajaxRequest.done(function(e){var n=$(e);r.append(n);var s=i.embedAsynchronousLoader.findIframeHolders(n),o=i.embedAsynchronousLoader.createIframe(i.embedAsynchronousLoader.getEmbedIframeUrl(s),!0);s.append(o),s.data(t.LightBulletinConstants.dataAttributeNames.loadedProcessId,l.processId),i.pendingEmbedProcessManager.clearProcessAjaxRequest(l)}).fail(function(e){a.remove(),l.pendingStatus!==t.PendingProcessStatus.Aborted&&(i.pendingEmbedProcessManager.setProcessFailed(l),i.ajaxClient.handleAjaxError(e),i.toggler.toggleOembedEditClasses(o,{isViewMode:!1,isEmbedInProgress:!0}),i.utility.validateBulletinAndToggleControls(s))})}},i.prototype.listenToEmbedPostmessages=function(){var e=this;CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.getEmbeddedContentData,function(n){var i=e.controls.Container.find("#"+n.oembedPlaceHolderId),s=e.utility.findBulletinItemByChild(i),o={originalEmbedCode:n.originalEmbedCode,oembedPlaceHolder:i},r=e.embedAsynchronousLoader.findIframeHolders(i),a=r.data(t.LightBulletinConstants.dataAttributeNames.loadedProcessId),l=e.pendingEmbedProcessManager.getProcessById(a);n.isPlainLink||e.utility.countResourcesOnUi(s)>0||i.data(e.settings.DataAttributes.OembedIsNew)&&e.utility.isViewMode(s)||l&&l.pendingStatus===t.PendingProcessStatus.Aborted?(e.controls.Container.removeClass(e.settings.CssClasses.OembedBoxLoading),e.embedAsynchronousLoader.removeAjaxLoader(i.closest(e.selectors.mediaAppendTarget)),i.removeClass(e.settings.CssClasses.OembedContent),n.isPlainLink&&e.utility.linkParser.skipUrl(n.originalEmbedCode),e.watchEmbeds.shouldAppendOembedError(o)?(e.embedBufferMap.set(e.utility.getBulletinId(s),o),e.watchEmbeds.appendOembedError(o)):i.remove(),a&&(e.pendingEmbedProcessManager.removeProcessById(a),r.removeData(t.LightBulletinConstants.dataAttributeNames.loadedProcessId))):(e.embedBufferMap.set(e.utility.getBulletinId(s),o),i.removeClass(e.settings.CssClasses.OembedBoxLoading),i.data(e.settings.DataAttributes.OembedIsNew)&&(e.embedAsynchronousLoader.removeAjaxLoader(i.closest(e.selectors.mediaAppendTarget)),i.find("."+e.settings.CssClasses.OembedBoxHeader).show()),e.toggler.toggleOembedEditClasses(s,{isViewMode:e.utility.isViewMode(s),isEmbedInProgress:!1})),e.utility.validateBulletinAndToggleControls(s)})},i.prototype.listenToEmbedSizePostmessages=function(){var e=this;t.EmbedResizer.listenToEmbedSizePostmessages(this.controls.Container,this.settings.CssClasses.OembedContent,this.embedAsynchronousLoader,function(n){var i=e.utility.findBulletinItemByChild(n);e.utility.isViewMode(i)||e.utility.validateBulletinAndToggleControls(i);var s=e.embedAsynchronousLoader.findIframeHolders(n),o=s.data(t.LightBulletinConstants.dataAttributeNames.loadedProcessId);o&&(e.pendingEmbedProcessManager.removeProcessById(o),s.removeData(t.LightBulletinConstants.dataAttributeNames.loadedProcessId))})},i.prototype.lightBulletinDeleteEmbedClicked=function(e){var t=$(e.target),n=this.utility.findBulletinItemByChild(t),i=t.closest("."+this.settings.CssClasses.OembedBox+":visible");this.removeOembedBox(i,n,i.data(this.settings.DataAttributes.OembedIsNew));var s=this.utility.isAddMode(n)?this.utility.getEditorById(0):this.utility.getEditorByItem(n);this.watchEmbeds.watchEmbeds(s),this.focusOnEditor(n),this.utility.validateBulletinAndToggleControls(n)},i.prototype.toggleViewEditMode=function(e,n,i){void 0===i&&(i=!0);var s=e.find("[data-"+this.settings.SingleItemDataDataAttributes.LightBulletinSingleItemTextMountPoint+"]"),o=this.showMoreRenderer.findClickablePlaceholder(e);if(n||this.utility.textExpander.expand(this.showMoreRenderer.findCollapsibleTextContainer(e),o),s.toggle(n&&s.html().length>0),o.style.display=n?null:"none",t.LightBulletinUtility.setTabindexToHiddenElements(e,o,"."+this.settings.CssClasses.ElementLink),i&&this.singleItemDataManager.updateSingleItemDataSvelte(this.utility.getBulletinId(e),{isEditMode:!n}),this.toggler.toggleOembedEditClasses(e,{isViewMode:n,isEmbedInProgress:this.embedAsynchronousLoader.isEmbedInProgress(e)}),!n){var r=this.utility.getEditorByItem(e);this.utility.validateBulletinAndToggleControlsWithText(r.getData().plainText,e)}e.find("."+this.settings.CssClasses.ElementLinkDelete).toggle(!n),e.find("."+this.utility.settings.CssClasses.ImageBoxHeader).toggle(!n),e.find("."+this.settings.CssClasses.ImageBox).toggleClass(this.settings.CssClasses.ImageBoxEditMode,!n)},i.prototype.isAddingEditingBulletinsNotFinished=function(){return this.isPostingNewBulletin()||this.controls.NewBulletinItem.find("li[data-"+this.settings.DataAttributes.ElementLinkElementId+"]").length>0||this.utility.imageBox.addImageButtonFileInputHasValue(this.controls.NewBulletinItem)||this.controls.Container.find(this.selectors.applyEditAction).length>0},i.prototype.isPostingNewBulletin=function(){return this.settings.CanAddNewBulletins&&this.textValidator.checkNotEmpty(this.utility.getEditorById(0).getData().plainText)},i.prototype.createLightBulletin=function(){var n=this,i=this.utility.getEditorById(0).getData(),s=i.plainText,o=i.rtfContent,r=this.embedBufferMap.get(0),a=r?r.originalEmbedCode:void 0;this.removeOembedBox(this.utility.getOembedBox(this.controls.NewBulletinItem),this.controls.NewBulletinItem);var l=this.elementLinkBuilder.getElementIdsForBulletin(0),c=this.postedToCoursesInNewBulletin?this.postedToCoursesInNewBulletin.map(function(e){return e.CourseId}):[],d={CourseId:this.settings.CourseId,AdditionalCourseIds:c,Text:s,RtfContent:o,EmbedUrl:a,DisableComments:this.commentToggler.areCommentsDisabledForNewBulletins,ElementIdsToAttach:l.elementsToAttach,UploadResult:this.utility.imageBox.getParsedUploadResult(this.controls.NewBulletinItem),Schedule:{ActiveFrom:this.temporaryStorageStrategy.activeFrom,ActiveTo:this.temporaryStorageStrategy.activeTo},BulletinsDisplayMode:this.activationFilterCurrentValue};this.ajaxClient.createLightBulletin(d).done(function(i){if(i){var s=void 0;try{s=JSON.parse(i)}catch(e){}if(s&&s.Code===t.GenericResponseCode.AnnouncementTextValidationError)return void n.textValidator.toggleTextareaError({editorTextareaErrorMessage:s.ErrorMessage,hasEditorTextareaError:!0,lightBulletinId:0});var o=$(i);if(o.is(":visible")){document.dispatchEvent(new CustomEvent("removeEmptyState__24bd5932b78346e894e1964a50ae7cbe"));var r=$("<li style='display:none;'>"+i+"</li>").addClass(n.settings.CssClasses.ListItem).addClass(n.settings.CssClasses.PositionRelative);n.settings.PinnedLightBulletinId>0?n.utility.getBulletinById(n.settings.PinnedLightBulletinId).closest("li").after(r):n.controls.NewBulletinItem.after(r),n.utility.animator.animateShow(r,function(){return n.renderShowMoreLink(r.find(n.selectors.bulletinItem),!0)}),n.singleItemDataManager.setupSingleItemSvelte(r.find(n.selectors.bulletinItem).get(),{isStream:!1});var a=n.embedAsynchronousLoader.findIframeHolders(r);if(a.length>0){var l=n.embedAsynchronousLoader.createAjaxLoader();r.find(n.selectors.mediaAppendTarget).append(l),a.append(n.embedAsynchronousLoader.createIframe(n.embedAsynchronousLoader.getEmbedIframeUrl(a),!0))}}else n.showInformationFeedback(o.data(n.settings.DataAttributes.InformationFeedbackButtonText),o.data(n.settings.DataAttributes.ActivationFilterValueToShowBulletin),n.settings.Resources.BulletinHasBeenCreatedButDoesNotMatchFilter);var c=n.utility.getEditorById(0);c.clear(),n.watchEmbeds.watchEmbeds(c)}n.elementLinkBuilder.cleanAppendData(0,void 0),n.temporaryStorageStrategy.resetStorage(),n.commentToggler.resetCommentsDisabledForNewBulletins(),n.setPostedToCourses([]),e.Controls.MultipleCourseSearchSelector.multipleCourseSearchSelectorDialogClientInstance.clear(),n.utility.getVisibleImageBox(n.controls.NewBulletinItem).remove(),n.utility.imageBox.clearAddImageButtonFileInputValue(n.controls.NewBulletinItem),n.utility.imageBox.removeImageError(n.controls.NewBulletinItem),n.utility.getElementLinkList(n.controls.NewBulletinItem).remove(),n.utility.validateBulletinAndToggleControls(n.controls.NewBulletinItem),n.utility.setScheduleTimeSpanForNewAnnouncement({activeFromText:null,activeToText:null})}).fail(function(e){n.ajaxClient.handleAjaxError(e)})},i.prototype.showInformationFeedback=function(e,t,n){var i=this;CCL.InformationFeedback.showFeedbackWithextraButton(this.controls.InformationFeedbackMainContainer,n,e,function(){CCL.InformationFeedback.hideFeedback(i.controls.InformationFeedbackMainContainer),i.onActivationFilterChanged(t)})},i.prototype.setupEditorAndApplyButton=function(e,n){var i=this,s=e.editor?e.editor:this.utility.getEditorById(0);e.applyButton.click(function(t){var o=s.getData().plainText,r=i.utility.validateBulletinAndToggleControlsWithText(o,s.bulletinItem);i.textValidator.toggleTextRelatedErrorMessages(s.id,r,o),i.textValidator.canAnnouncementBePosted(r)?n():e.editor.focus()}),s.bulletinItem.data(t.LightBulletinEditor.bulletinEditorDataAttribute,s)},i.prototype.appendBulletinEditor=function(e,n){var i=this;n.bulletinItem.find("[data-"+this.settings.DataAttributes.BulletinItemEditorButtonsTarget+"]").append(n.editorButtons),n.editorButtons.get(0).querySelector("[data-"+this.settings.SingleItemDataDataAttributes.LightBulletinSingleItemEditModeButtonsMountPoint+"]").dispatchEvent(new CustomEvent("renderAnnouncementItemEditModeButtons_8066a084582049679fade77c69c7fc3b",{bubbles:!0,detail:{lightBulletinId:e}})),this.setupEditorAndApplyButton(n,function(){var s=i.embedBufferMap.get(n.bulletinId),o=i.elementLinkBuilder.getElementIdsForBulletin(n.bulletinId),r=n.editor.getData(),a=r.plainText,l=r.rtfContent;i.ajaxClient.updateLightBulletin({BulletinId:n.bulletinId,Text:a,RtfContent:l,EmbedUrl:s?s.originalEmbedCode:void 0,ElementIdsToAttach:o.elementsToAttach,ElementIdsToDetach:o.elementsToDetach,UploadResult:i.utility.imageBox.getParsedUploadResult(n.bulletinItem),DeleteAttachedImage:i.utility.imageBox.getDeleteAttachedImageValue(n.bulletinItem)}).done(function(s){t.GenericResponseHandler.handle(s,function(){i.utility.getHiddenOembedBox(n.bulletinItem).remove();var t=s.ResponseData;i.embedAsynchronousLoader.removeAjaxLoader(n.bulletinItem),n.removeBulletinEditor(),i.singleItemDataManager.updateSingleItemDataSvelte(e,{isEditMode:!1,rtfContent:t.RtfContent,text:t.PlainText}),t.RtfContent&&document.dispatchEvent(new CustomEvent("updateSingleAnnouncementText_bd6a35a2b8bf4f4c914d59f37e073450",{detail:{lightBulletinId:e}})),i.utility.getVisibleOembedBox(n.bulletinItem).data(i.settings.DataAttributes.OembedIsNew,!1),i.renderShowMoreLink(n.bulletinItem,!0),i.toggleViewEditMode(n.bulletinItem,!0),i.elementLinkBuilder.cleanAppendData(n.bulletinId,n.bulletinItem),i.utility.imageBox.applyImageEditsIfNeeded(n.bulletinItem,t.LargeImageUrl)},function(){switch(s.Code!==t.GenericResponseCode.AnnouncementTextValidationError&&i.cancelEditMode(n),s.Code){case t.GenericResponseCode.LightBulletinNotFound:i.utility.removeBulletin(n.bulletinItem);break;case t.GenericResponseCode.AnnouncementTextValidationError:i.textValidator.toggleTextareaError({editorTextareaErrorMessage:s.ErrorMessage,hasEditorTextareaError:!0,lightBulletinId:e})}},{shouldAlertErrorMessage:function(){return s.Code!==t.GenericResponseCode.AnnouncementTextValidationError}})}).fail(function(e,t,s){i.cancelEditMode(n),i.ajaxClient.handleAjaxError(e)})})},i.prototype.cancelEditMode=function(e,t){void 0===t&&(t=!0),this.resetUnsavedEmbed(e.bulletinItem,e.bulletinId,{preserveAjaxLoader:!0}),this.utility.imageBox.resetUnsavedImage(e.bulletinItem),e.removeBulletinEditor(),t&&this.singleItemDataManager.updateSingleItemDataSvelte(e.bulletinId,{isEditMode:!1}),this.editor.removeBulletinEditorInstanceDataAttribute(e.bulletinItem),this.toggleViewEditMode(e.bulletinItem,!0),this.renderShowMoreLink(e.bulletinItem,!0),this.elementLinkBuilder.resetUnsavedElementLinks(e.bulletinId,e.bulletinItem)},i.prototype.resetUnsavedEmbed=function(e,n,i){var s=this.utility.getVisibleOembedBox(e),o=this.embedAsynchronousLoader.findIframeHolders(s).data(t.LightBulletinConstants.dataAttributeNames.loadedProcessId)||this.embedAsynchronousLoader.findAjaxLoader(e).data(t.LightBulletinConstants.dataAttributeNames.pendingProcessId);o&&this.pendingEmbedProcessManager.cancelProcess(o);var r=s.data(this.settings.DataAttributes.OembedIsNew);r&&this.removeOembedBox(s,e);var a=this.utility.getHiddenOembedBox(e);if(a.length>0){a.show();var l=a.data(this.settings.DataAttributes.OembedUrl);this.embedBufferMap.set(n,{oembedPlaceHolder:a,originalEmbedCode:l})}i.preserveAjaxLoader&&!r||this.embedAsynchronousLoader.removeAjaxLoader(e)},i.prototype.removeOembedBox=function(e,t,n){if(void 0===n&&(n=!0),e.length>0){var i=this.embedBufferMap.get(this.utility.getBulletinId(t));i&&e.data(this.settings.DataAttributes.OembedUrl,i.originalEmbedCode),n?e.remove():e.hide(),this.embedBufferMap.delete(this.utility.getBulletinId(t))}},i.prototype.setupOnboardingFeatures=function(){var e=this;this.settings.CanAddNewBulletins&&this.ajaxClient.getBulletinElementLinksAnnouncementCompleted(this.settings.CourseId).done(function(t){t&&e.setupElementLinksAnnouncementContextDialog(t)}).fail(this.ajaxClient.handleAjaxError)},i.prototype.setupElementLinksAnnouncementContextDialog=function(e){var t=this,n=$(this.selectors.addResourceAction);if(n.is(":visible")){n.after(e);var i,s="#"+this.utility.settings.ElementLinksAnnouncementContainerClientId,o=new ContextDialog(s,{marginTop:n.height(),marginLeft:(n.width()-420)/2,valign:"bottom",width:420,zIndex:1,blackThemeActivated:!0,closeWithOutsideClick:!1,showHeader:!1,showCloseLink:!1,scrollToLastWindowOnClose:!1,useMobileViewIfNeeded:!1,allowAccessToParentWindow:!1,expandParentFrame:!1});this.controls.Container.on("click",s+","+this.selectors.addResourceAction,function(){$(s).is(":visible")&&o.closeDialog()});var r=function(){if(CCL.CommonFunctions.isOnScreen(n,.5,.5,t.utility.settings.IsIosDevice?window.parent:window)){var e=n.position().left+n.width()/2+10,i=n.position().top+10;return o.openDialogAt(e,i,!1),!0}return!1};(i=r())||$(window).on(this.utility.settings.IsIosDevice?"touchmove":"scroll",function(){i||r()})}else setTimeout(this.setupElementLinksAnnouncementContextDialog,50)},i}();t.LightBulletinContentBlock=i}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){this.utility=e}return e.prototype.folderContent=function(e){return $.ajax({type:"GET",url:this.utility.settings.Urls.FolderContent,data:e,dataType:"html"})},e}();e.ElementLinkDialogAjaxClient=t}(e.ElementLinkDialog||(e.ElementLinkDialog={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n;!function(e){e[e.Expanded=1]="Expanded",e[e.Collapsed=2]="Collapsed",e[e.Loading=3]="Loading"}(n||(n={}));var i=function(){function i(n,i){var s=this;this.controls=n,this.settings=i,this.inputTypeCheckboxSelector="input:checkbox",this.updateElementStateAndToggleOkButtonEnabled=function(e){var t=$(e.target),n=s.utility.closestElementItem(t),i=s.updateElementState(n,t.is(":checked"));if(s.controls.OkButton.prop("disabled",!s.currentParams.allowEmptySubmit&&(0===i||i>s.currentParams.maxCountOfAddedElements)),n.find(s.inputTypeCheckboxSelector).first().focus(),s.currentParams.disallowMultipleSelection){var o=s.utility.getElementId(n),r=s.getCheckedElements();if(r.length>1){var a=new Array;$.each(r,function(e,t){t!==o&&a.push(t)});var l=a[0],c=s.utility.getCheckbox(l);c.prop("checked",!1),c.trigger("change")}}},this.utility=new t.Utility(n,i),this.modalDialog=window[this.getDialogId()],this.ajaxClient=new t.ElementLinkDialogAjaxClient(this.utility),this.checkboxStateMachine=new e.CheckboxStateMachine.Machine,this.setupListItemFocusedAreaClickHandler(),this.setupOkButtonClickHandler(),this.modalDialog.setCustomScripts({afterOpenDialogAjaxDynamicallySuccess:function(){return s.onFolderContentLoaded()},afterCloseDialog:function(){void 0!==s.currentParams.afterCloseDialogCallback&&s.currentParams.afterCloseDialogCallback()}}),this.preventExternalFormSubmitAndMakeSaveOnEnterKey()}return i.prototype.openDialog=function(e,t){this.currentParams=e,$.extend(t,{elementType:this.currentParams.elementType,showAll:this.currentParams.showAll}),this.ajaxParams=t,this.currentParams.openerPage&&(t.openerPage=this.currentParams.openerPage),this.currentParams.relatedEntityId&&(t.relatedEntityId=this.currentParams.relatedEntityId),this.currentParams.learningObjectiveId&&(t.learningObjectiveId=this.currentParams.learningObjectiveId),this.modalDialog.setAjaxUrl(this.settings.Urls.DialogContent,t,!1),this.modalDialog.setTitle(this.currentParams.header),this.modalDialog.openDialog(!1),this.modalDialog.setPreferredSize(this.settings.PreferredWidth,0);var n=this.countCheckedElements(),i=!(null!=this.currentParams.maxCountOfAddedElements&&n>this.currentParams.maxCountOfAddedElements)&&(this.currentParams.allowEmptySubmit||n>0&&this.countElementsChanged()>0);this.controls.OkButton.prop("disabled",!i)},i.prototype.refreshDialog=function(e){var t=void 0===e?{}:e,n=t.showAll,i=void 0!==n&&n,s=t.isFilteredByLearningObjectives,o=void 0!==s&&s;this.isFilteredByLearningObjectives=o,this.ajaxParams.showAll=i,this.currentParams.showAll=i,this.modalDialog.setAjaxUrl(this.settings.Urls.DialogContent,this.ajaxParams,!0)},i.prototype.closeDialog=function(){CssModal.closeDialog()},i.prototype.getDialogId=function(){return this.controls.Container.prop("id")},i.prototype.onFolderContentLoaded=function(){var e=this;this.currentParams.elementStates.forEach(function(t,n){if(e.checkboxStateMachine.isElementChecked(t)){var i=e.utility.getCheckbox(n);i&&i.length&&i.prop("checked",!0)}}),this.currentParams.disabledElementIds&&this.currentParams.disabledElementIds.forEach(function(t){var n=e.utility.getCheckbox(t);n&&n.length&&n.prop("disabled",!0)})},i.prototype.setupOkButtonClickHandler=function(){var e=this;this.controls.OkButton.on("click",function(t){t.preventDefault(),e.controls.OkButton.is(":visible")&&e.controls.OkButton.is(":enabled")&&(e.currentParams.afterOkClickCallback(e.currentParams.elementStates),CssModal.closeDialog())})},i.prototype.setupListItemFocusedAreaClickHandler=function(){var e,t=this;this.controls.Container.on(((e={}).change=this.updateElementStateAndToggleOkButtonEnabled,e),this.inputTypeCheckboxSelector),this.controls.Container.on("click",this.utility.selectors.listItemFocusedArea,function(e){var n=$(e.target),i=t.utility.closestElementItem(n);if(t.isClickTargetEnabled(n,i)){if(t.targetIsFolderActionExpand(n))t.expandOrCollapseFolder(i);else if(t.utility.isListItemFocusedArea(n)&&t.isCheckboxExistAndEnabled(i)){var s=t.utility.getCheckbox(t.utility.getElementId(i));s.toggle(!s.is(":checked"))}}else t.isFolder(i)&&t.expandOrCollapseFolder(i)}),this.controls.Container.on("keyup",this.utility.selectors.listItemFocusedArea,function(e){if(e.which===CCL.CommonConstants.keyCodes.space&&!CCL.CommonFunctions.isFirefox()){var n=$(e.target);t.targetIsFolderActionExpand(n)&&t.expandOrCollapseFolder(t.utility.closestElementItem(n))}})},i.prototype.preventExternalFormSubmitAndMakeSaveOnEnterKey=function(){var e=this;this.controls.DialogContent.keypress(function(t){t.which!==CCL.CommonConstants.keyCodes.enter||e.controls.OkButton.is(":focus")||(t.preventDefault(),e.controls.OkButton.click())})},i.prototype.isClickTargetEnabled=function(e,t){return 0===t.find(this.utility.selectors.elementLinkFolderActionExpand).length||this.targetIsFolderActionExpand(e)||this.currentParams.allowFolderSelection&&(!this.isFilteredByLearningObjectives||this.currentParams.showAll)&&this.isCheckboxExistAndEnabled(t)},i.prototype.targetIsFolderActionExpand=function(e){return e.is(this.utility.selectors.elementLinkFolderActionExpand)||e.closest(this.utility.selectors.elementLinkFolderActionExpand).length>0},i.prototype.isFolder=function(e){return e.find(this.utility.selectors.elementLinkFolderActionExpand).length>0},i.prototype.updateElementState=function(t,n){var i=this.utility.getElementId(t),s=this.currentParams.elementStates.get(i)||e.CheckboxStateMachine.State.Empty,o=this.checkboxStateMachine.validateAndTransferElementStateAfterClick(n,s);return this.currentParams.elementStates.set(i,o),this.countCheckedElements()},i.prototype.countElementsChanged=function(){return e.MapUtils.reduce(this.currentParams.elementStates,function(t,n,i){return i===e.CheckboxStateMachine.State.AttachedByUser||i===e.CheckboxStateMachine.State.DetachedByUser?t+1:t},0)},i.prototype.countCheckedElements=function(){var t=this;return e.MapUtils.reduce(this.currentParams.elementStates,function(e,n,i){return t.checkboxStateMachine.isElementChecked(i)?e+1:e},0)},i.prototype.getCheckedElements=function(){var t=this;return e.MapUtils.reduce(this.currentParams.elementStates,function(e,n,i){return t.checkboxStateMachine.isElementChecked(i)&&e.push(n),e},new Array)},i.prototype.expandOrCollapseFolder=function(e){var t=this,i=e.find(this.utility.selectors.elementLinkFolderActionExpand).first(),s=i.data(this.settings.DataAttributes.ElementLinkFolderActionExpand),o=e.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.ElementLinkFolderAppendTarget)).first();s?s===n.Expanded?this.setFolderState(o,i,n.Collapsed):s===n.Collapsed&&this.setFolderState(o,i,n.Expanded):(this.setFolderState(o,i,n.Loading),this.ajaxClient.folderContent({folderId:this.utility.getElementId(e),elementType:this.currentParams.elementType,openerPage:this.currentParams.openerPage,relatedEntityId:this.currentParams.relatedEntityId,learningObjectiveId:this.currentParams.learningObjectiveId,showAll:this.currentParams.showAll}).done(function(e){o.append(e),t.setFolderState(o,i,n.Expanded),t.onFolderContentLoaded()}))},i.prototype.isCheckboxExistAndEnabled=function(e){var t=this.utility.getCheckbox(this.utility.getElementId(e));return t&&t.is(":enabled")},i.prototype.setFolderState=function(e,t,i){e.toggle(i===n.Expanded),this.utility.closestListItemFocusedArea(t).find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.ElementLinkFolderTitle)).toggleClass(this.settings.CssClasses.FontBold,i===n.Expanded),t.data(this.settings.DataAttributes.ElementLinkFolderActionExpand,i);var s=t.find("."+this.settings.CssClasses.FolderStateExpanded+",."+this.settings.CssClasses.FolderStateCollapsed);s.toggleClass(this.settings.CssClasses.FolderStateCollapsed,i!==n.Expanded),s.toggleClass(this.settings.CssClasses.FolderStateExpanded,i===n.Expanded),s.closest("."+this.settings.CssClasses.ExpandButton).attr("aria-label",i===n.Expanded?this.settings.Terms.CollapseFolder:this.settings.Terms.ExpandFolder)},i.prototype.isClosestLabel=function(e){return e.closest("label").length>0},i}();t.ElementLinkDialogManager=i}(e.ElementLinkDialog||(e.ElementLinkDialog={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){window[e]=this,this.settings=t,this.eventNames=t.EventNames,this.initialize()}return e.prototype.initialize=function(){!this.settings.UsesNestedLearningObjectiveSelectorMode&&this.settings.LearningObjectivesEditorClientId&&(this.objectivesEditor=window.parent[this.settings.LearningObjectivesEditorClientId]);var e=this;$(document).on(this.eventNames.EmptyStateChangedEventName,function(t,n){$(e.settings.ClientCssSelectorOfTopWarningFeedbackSelector).toggle(n.isAnyEmpty),e.objectivesEditor&&e.objectivesEditor.handleCriteriaEmptyStateChangedEvent(n.isAnyEmpty,n.loUpdate)}).on(this.eventNames.DeleteLearningObjectiveEventName,function(t,n){e.settings.UsesNestedLearningObjectiveSelectorMode&&(n.reloadPage?(e.haveChangedLos=!0,e.removeLearningObjective(n.learningObjectiveId,n.learningObjectiveGroupId),e.updateUrlAndReload()):e.removeLearningObjective(n.learningObjectiveId,n.learningObjectiveGroupId))}).on(this.eventNames.CriteriaWeightsChangedEventName,function(t,n){e.objectivesEditor?(e.objectivesEditor.updateCriteriaWeights(n.data),e.objectivesEditor.updateLearningObjectivesCriteriaWeights(n.loCriteriaWeights)):$("#"+e.settings.CriteriaWeightsHiddenClientId).val(JSON.stringify(n.data))}),CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.submitIframe,function(){var t=$("#"+e.settings.CriteriaWeightsHiddenClientId).val(),n=[],i=window[e.settings.LearningObjectivesControlClientId].selectedIds;$.each(i,function(e,t){n.push(parseInt(t))}),CCL.CommonFunctions.makePostMessageCall(window.parent,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.closeCssModalDialog,{loIds:n,criteriaWeights:t}))})},e.prototype.updateUrlAndReload=function(){if(this.haveChangedLos){var e=document.location.href,t=this.getParameterByName(e,"Ids"),n=window[this.settings.LearningObjectivesControlClientId].selectedIds,i=t?e.replace(t[0],t[0][0]+"Ids="+encodeURIComponent(n.join(","))):e+(-1==e.indexOf("?")?"?":"&")+"Ids="+encodeURIComponent(n.join(",")),s=$("#"+this.settings.CriteriaWeightsHiddenClientId).val();if(s){var o=this.getParameterByName(i,"CriteriaWeights");i=o?i.replace(o[0],o[0][0]+"CriteriaWeights="+encodeURIComponent(s)):i+(-1==i.indexOf("?")?"?":"&")+"CriteriaWeights="+encodeURIComponent(s)}var r=this.settings.ShowCriteriaWeights?"1":"0",a=this.getParameterByName(i,"ShowCriteriaWeights");i=a?i.replace(a[0],a[0][0]+"ShowCriteriaWeights="+r):i+(-1==i.indexOf("?")?"?":"&")+"ShowCriteriaWeights="+r,document.location.replace(i)}},e.prototype.addLearningObjectives=function(e){for(var t=[],n=0;n<e.length;n++)t.push(parseInt(e[n]));window[this.settings.LearningObjectivesControlClientId].setSelectedIds(t,!0),$(document).trigger(this.eventNames.SelectionSavedEventName),window[this.settings.LearningObjectivesControlClientId].showSuccessFeedback(),this.haveChangedLos=!0,this.triggerLearningObjectivesDescription()},e.prototype.closeDialogAndRedirect=function(e){var t=window.parent;t.CssModal.closeDialog(),t.location=e},e.prototype.removeLearningObjective=function(e,t){for(var n=window[this.settings.LearningObjectivesControlClientId].selectedIds,i=this.getLearningObjectiveIdsFromGroup(e,t,n),s=0;s<i.length;s++)n.splice(n.indexOf(i[s].toString()),1);window[this.settings.LearningObjectivesControlClientId].setSelectedIds(n,!0),this.triggerLearningObjectivesDescription()},e.prototype.getLearningObjectiveIdsFromGroup=function(e,t,n){var i=[];if(t)for(var s=JSON.parse($("#"+this.settings.LearningObjectiveGroupsHiddenClientId).val()||"{}"),o=0;o<n.length;o++){var r=n[o];s[r.toString()]&&s[r.toString()]===t&&i.push(r)}else i.push(e);return i},e.prototype.triggerLearningObjectivesDescription=function(){var e=window[this.settings.LearningObjectivesControlClientId].selectedIds;$("#"+this.settings.AddLearningObjectiveDescriptionClientId).toggle(0==e.length)},e.prototype.getParameterByName=function(e,t){return RegExp("[?&]"+t+"=([^&]*)").exec(e)},e}();e.ManageMultipleCriteriaPopup=t}(e.Rubric||(e.Rubric={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(){function t(n){var i=this;this.showManageRubricModal=function(){$.get(i.settings.WebMethods.GetCriteria).done(function(e){var t=window[i.settings.RubricDialogClientInstanceName],n="&Ids="+e.LoIds.join(","),s="";if(e.UseAssessmentOrScore){var o=e.CriteriaWeights;s="&ShowCriteriaWeights=True&CriteriaWeights="+JSON.stringify(o)}var r=n+s;t.setIframeUrl(i.settings.WebMethods.ManageRubricDialogUrl+r),t.openDialog()})},this.updateCriteria=function(t){var n=t.extendedData;if(!n.updateSettings&&void 0!==n.loIds&&void 0!==n.criteriaWeights){var s={};s.LoIds=n.loIds,n.criteriaWeights&&(s.CriteriaWeights=JSON.parse(n.criteriaWeights)),CCL.CommonFunctions.safeAjaxPost({url:i.settings.WebMethods.UpdateCriteria,data:s}).done(function(){e.Settings.Manager.getInstance().refreshReadView()})}},this.settings=n,window[t.clientInstanceName]=this;var s=$(window);CCL.CommonFunctions.attachPostMessageEventListener(s,CCL.CommonWindowMessages.MessageNames.assignmentShowManageRubric,function(){i.showManageRubricModal()}),CCL.CommonFunctions.attachPostMessageEventListener(s,CCL.CommonWindowMessages.MessageNames.closeCssModalDialog,function(e){i.updateCriteria(e)})}return t.clientInstanceName="AssignmentListenerClientInstanceName",t}();t.AssignmentListener=n}(e.Controls||(e.Controls={}))}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){e.makeCopy=function(e){var t=new Map;return e.forEach(function(e,n,i){t.set(n,e)}),t},e.reduce=function(e,t,n){var i=n;return e.forEach(function(e,n,s){i=t(i,n,e)}),i},e.mapToJsonString=function(e){var t=Object.create(null);return e.forEach(function(e,n){return t[n.toString()]=e}),JSON.stringify(t)},e.jsonStringToMap=function(e,t){for(var n=e?JSON.parse(e):{},i=new Map,s=0,o=Object.keys(n);s<o.length;s++){var r=o[s];i.set(t(r),n[r])}return i},e.stringKeyConverter=function(e){return e},e.numberKeyConverter=function(e){return parseInt(e,10)}}(e.MapUtils||(e.MapUtils={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function t(t){this.defaultLabelColor=null,this.animate=!1,e.assessmentLettersInstance=this,this.context=t,e.assessmentLettersInstance.context.Settings.IsMentorCanSendReminders&&$("#"+e.assessmentLettersInstance.context.Controls.SendReminderButtonId).on("click",this.SendReminder),this.SetTimestamp(e.assessmentLettersInstance.context.Settings.SendDate)}return t.prototype.SendReminder=function(){CCL.CommonFunctions.safeAjaxPost({url:e.assessmentLettersInstance.context.WebMethods.SendReminderUrl,data:{termId:e.assessmentLettersInstance.context.Settings.TermId,organisationId:e.assessmentLettersInstance.context.Settings.OrganisationId}}).done(function(t){e.assessmentLettersInstance.SetTimestamp(t)}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})},t.prototype.SetTimestamp=function(t){if(null!==t){var n=$("#"+e.assessmentLettersInstance.context.Controls.TimestampLabelId),i=n.text();n.text(CCL.CommonFunctions.formatString(e.assessmentLettersInstance.context.Settings.TimestampText,t)),i&&this.blink(n)}},t.prototype.blink=function(t){this.animate||(this.animate=!0,this.defaultLabelColor||(this.defaultLabelColor=t.css("color")),t.css("color","#F9F5BE"),t.animate({color:this.defaultLabelColor},1e3,function(){e.assessmentLettersInstance.animate=!1}))},t}();e.TermAssessmentOverview=t}(e.Mentor||(e.Mentor={}))}(e.Assessment||(e.Assessment={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){this.onboardingControlUrl=e,this.$targetElement=t}return e.prototype.renderOnboarding=function(){var e=this;$.ajax({url:this.onboardingControlUrl,type:"GET",cache:!1}).done(function(t){if(t&&0!==t.length){var n=$(t);e.$targetElement.prepend(n)}})},e}();e.FinalModalLoader=t;var n=function(e){function t(t,n){e.call(this,n),this.context=t}return __extends(t,e),t.prototype.init=function(){OnboardingSystem.onboardingManagerInstance.registerControl(this),this.initEvents(),this.$finalModalOverlayModal.overlayModal("open")},t.prototype.initEvents=function(){var e=this;$(document).on(CCL.OverlayModalEvents.hide,function(t,n){e.onOverlayModalHide(t,n)})},t.prototype.onOverlayModalHide=function(e,t){t.closeType!==CCL.OverlayModalCloseType.CloseButtonClicked&&t.closeType!==CCL.OverlayModalCloseType.EscapeKeyPressed||this.$finalModalOverlayModal.get(0).id===t.activeElement.id&&CCL.OverlayModal.instance&&CCL.OverlayModal.instance.close()},t}(OnboardingSystem.OnboardingControl);e.FinalModal=n}(e.Calendar||(e.Calendar={}))}(e.Onboarding||(e.Onboarding={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){this.onboardingControlUrl=e,this.$targetElement=t}return e.prototype.renderOnboarding=function(){var e=this;$.ajax({url:this.onboardingControlUrl,type:"GET",cache:!1}).done(function(t){if(t&&0!==t.length){var n=$(t);e.$targetElement.prepend(n)}})},e}();e.RecurringEventModalLoader=t;var n=function(e){function t(t,n){e.call(this,n),this.context=t}return __extends(t,e),t.prototype.init=function(){OnboardingSystem.onboardingManagerInstance.registerControl(this)},t}(OnboardingSystem.OnboardingControl);e.RecurringEventModal=n}(e.Calendar||(e.Calendar={}))}(e.Onboarding||(e.Onboarding={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){this.onboardingControlUrl=e,this.$targetElement=t}return e.prototype.renderOnboarding=function(){var e=this;$.ajax({url:this.onboardingControlUrl,type:"GET",cache:!1}).done(function(t){if(t&&0!==t.length){var n=$(t);e.$targetElement.prepend(n)}})},e}();e.CalendarModalLoader=t;var n=function(e){function t(t,n){e.call(this,n),this.context=t}return __extends(t,e),t.prototype.init=function(){OnboardingSystem.onboardingManagerInstance.registerControl(this),this.initEvents(),this.$welcomeModalOverlayModal.overlayModal("open")},t.prototype.initEvents=function(){var e=this;this.$LetsGoButton.click(function(){e.onLetsGoButtonClick()}),this.$NoThanksButton.click(function(){e.onNoThanksButtonClick()}),$(document).on(CCL.OverlayModalEvents.hide,function(t,n){e.onOverlayModalHide(t,n)})},t.prototype.hideWelcomeModalAndCompleteFeature=function(e){var t;CCL.CommonFunctions.safeAjax({url:this.context.OnboardingProxyUrl,type:"PUT",headers:(t={},t[this.context.AntiForgerySettings.HeaderName]=this.context.AntiForgerySettings.HeaderValue,t)}),this.raiseEvent(OnboardingSystem.ControlEvents.courseModernExistingWelcomeModalCompleted)},t.prototype.onLetsGoButtonClick=function(){CCL.OverlayModal.instance.close(),this.hideWelcomeModalAndCompleteFeature(!1)},t.prototype.onNoThanksButtonClick=function(){CCL.OverlayModal.instance.close(),this.hideWelcomeModalAndCompleteFeature(!0)},t.prototype.onOverlayModalHide=function(e,t){t.closeType!==CCL.OverlayModalCloseType.CloseButtonClicked&&t.closeType!==CCL.OverlayModalCloseType.EscapeKeyPressed||this.$welcomeModalOverlayModal.get(0).id===t.activeElement.id&&(this.hideWelcomeModalAndCompleteFeature(!0),CCL.OverlayModal.instance&&CCL.OverlayModal.instance.close())},t}(OnboardingSystem.OnboardingControl);e.CalendarModal=n}(e.Calendar||(e.Calendar={}))}(e.Onboarding||(e.Onboarding={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e,t){this.coursesMenuCallToActionUrl=e,this.$targetElement=t}return e.prototype.renderOnboarding=function(){var e=this;$.ajax({url:this.coursesMenuCallToActionUrl,type:"GET",cache:!1}).done(function(t){if(t&&0!==t.length){var n=$(t);e.$targetElement.prepend(n),e.$targetElement.find(".ccl-context-dialog-arrow").css("left",e.$targetElement.outerWidth()/2)}})},e}();e.CoursesMenuCallToActionLoader=t;var n=function(e){function t(t,n){e.call(this,n),this.context=t}return __extends(t,e),t.prototype.onGotItClick=function(){$("."+this.context.Controls.CoursesMenuCallToActionId).hide()},t.prototype.init=function(){OnboardingSystem.onboardingManagerInstance.registerControl(this);var e,t=this,n=$("."+t.context.Controls.CoursesMenuCallToActionId);n.click(function(){return t.onGotItClick()}),n.show(),this.coursesMenuItemIsVisible()&&CCL.CommonFunctions.safeAjax({url:this.context.OnboardingProxyUrl,type:"PUT",headers:(e={},e[this.context.AntiForgerySettings.HeaderName]=this.context.AntiForgerySettings.HeaderValue,e)})},t.prototype.coursesMenuItemIsVisible=function(){return $(this.context.Controls.CoursesMenuItemSelector).is(":visible")},t}(OnboardingSystem.OnboardingControl);e.CoursesMenuCallToAction=n}(e.TopMenu||(e.TopMenu={}))}(e.Onboarding||(e.Onboarding={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e,t){var n=this;this.context=t,this.controls=e,this.getExternalGrades(),$(document).on(this.context.Pager.OnPageNumberChangedEventName+" "+this.context.Pager.OnPageSizeChangedEventName,function(e,t){return n.pagerEventHandler(t)})}return t.prototype.refreshGrid=function(t,n){var i=this;$.post(this.context.WebMethods.GetExternalGradebookContent,{courseId:this.context.CourseId,pageIndex:t,pageSize:n}).done(function(e){if(null!=e){var t=$(e);i.controls.Container.replaceWith(t),i.controls.Container=t,i.getExternalGrades()}}).fail(function(t){e.Utils.handleAjaxError(t)})},t.prototype.pagerEventHandler=function(e){if(e===this.context.Pager.Name){var t=window[e];this.refreshGrid(t.pageNumber,t.pageSize)}},t.prototype.getExternalGrades=function(){var e=this;$.post(this.context.WebMethods.GetExternalGradesForCourse,{courseId:this.context.CourseId}).done(function(t){null!=t&&null!=t.length&&t.length>0?e.fillGrades(t):e.clearGrades()}).fail(function(){e.clearGrades()})},t.prototype.fillGrades=function(e){var n=this;this.controls.Container.find("[data-"+this.context.DataAttributes.LineItemSourcedId+"]").each(function(i,s){var o=$(s),r=o.data(n.context.DataAttributes.LineItemSourcedId),a=o.data(n.context.DataAttributes.PersonSourcedId),l=t.defaultCellText;$.each(e,function(e,t){if(r===t.LineItemSourcedId&&a===t.PersonSourcedId)return l=n.getCellText(t),!1}),o.text(l)})},t.prototype.getCellText=function(e){var n=t.defaultCellText;null!=e.Score&&e.Score.length>0&&(n=e.Score);var i=t.defaultCellText;return null!=e.Scale&&e.Scale.length>0&&(i=e.Scale),n+" / "+i},t.prototype.clearGrades=function(){this.controls.Container.find("[data-"+this.context.DataAttributes.LineItemSourcedId+"]").empty().text(t.defaultCellText)},t.defaultCellText="-",t}();e.ExternalGradebook=t}(e.OneRoster||(e.OneRoster={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e,t){var n=this;this.context=e,this.controls=t,this.mappingTypesList.on("change",function(){return n.onMappingTypeChanged()}),this.existingAssessmentsList.on("change",function(){return n.onGradeBookItemChanged()}),this.existingAssessmentScalesList.on("change",function(){return n.onAssessmentScaleChanged()}),this.bindButtonsToEvent()}return Object.defineProperty(t.prototype,"mappingTypesList",{get:function(){return this.controls.MappingTypesList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"existingAssessmentsList",{get:function(){return this.controls.ExistingAssessmentsList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"existingAssessmentScalesList",{get:function(){return this.controls.ExistingAssessmentScalesList},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentButton",{get:function(){return this.controls.SendButton.length?this.controls.SendButton:this.controls.SaveButton},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"settings",{get:function(){return this.context.Settings},enumerable:!0,configurable:!0}),t.addOrUpdateDraftItem=function(e){var n=!0;$.each(t.draftItems,function(t,i){if(e.SyncKey.toLowerCase()===i.SyncKey.toLowerCase())return i.GradeType=e.GradeType,i.AssessmentRecordItemId=e.AssessmentRecordItemId,i.AssessmentScaleId=e.AssessmentScaleId,n=!1,!1}),n&&t.draftItems.push(e)},t.getDraftItemsBySyncKeys=function(e){var n=[];return $.each(e,function(e,i){$.each(t.draftItems,function(e,t){if(t.SyncKey.toLowerCase()===i.toLowerCase())return n.push(t),!1})}),n},t.prototype.bindButtonsToEvent=function(){var e=this,t=CCL.CommonFunctions.isMobileDevice()?"touchstart":"click";this.controls.SaveButton.is(":disabled")||this.controls.SaveButton.on(t,function(){return e.saveResults()}),this.controls.SendButton.is(":disabled")||this.controls.SendButton.on(t,function(){return e.sendResults()})},t.prototype.onMappingTypeChanged=function(){this.setControlAvailability(this.mappingTypesList,!1);var e=parseInt(this.mappingTypesList.find("option:selected").val(),10);this.mappingTypesList.toggleClass(this.context.CssClasses.DefaultMappingType,e===this.context.Settings.MappingTypeEnum.NotLinked);var t=this.settings.LineItemsSyncKeys;switch(e){case this.context.Settings.MappingTypeEnum.NotLinked:this.hideAndClearAssessmentsDropDownList(),this.hideAssessmentScalesDropDownList(),this.createDraftVersion(this.context.Settings.MappingTypeEnum.NotLinked,t);break;case this.context.Settings.MappingTypeEnum.OverallAverage:this.hideAndClearAssessmentsDropDownList(),this.setButtonAvailability(!1),this.settings.DoesOverallAverageHaveMultipleScales?this.showAssessmentScalesDropDownList():this.onAssessmentScaleChanged();break;case this.context.Settings.MappingTypeEnum.Assessment:case this.context.Settings.MappingTypeEnum.FinalAssessment:this.hideAssessmentScalesDropDownList(),this.setButtonAvailability(!1),this.populateAndShowAssessmentsDropDownList();break;case this.context.Settings.MappingTypeEnum.Manual:this.hideAssessmentScalesDropDownList(),this.hideAndClearAssessmentsDropDownList(),this.createDraftVersion(this.context.Settings.MappingTypeEnum.Manual,t)}this.setControlAvailability(this.mappingTypesList,!0)},t.prototype.onGradeBookItemChanged=function(){this.setControlAvailability(this.existingAssessmentsList,!1);var e=parseInt(this.existingAssessmentsList.find("option:selected").val(),10);if(e!==this.context.Settings.ExistingAssessmentDefaultValue){this.setControlAvailability(this.mappingTypesList,!1);var t=parseInt(this.mappingTypesList.find("option:selected").val(),10),n=this.settings.LineItemsSyncKeys;this.createDraftVersion(t,n,e),this.setControlAvailability(this.mappingTypesList,!0)}else this.setButtonAvailability(!1);this.setControlAvailability(this.existingAssessmentsList,!0)},t.prototype.hideAndClearAssessmentsDropDownList=function(){this.controls.ExistingAssessmentsList.hide().empty()},t.prototype.populateAndShowAssessmentsDropDownList=function(){this.controls.ExistingAssessmentsList.empty();var e=parseInt(this.controls.MappingTypesList.find("option:selected").val(),10),t={courseId:this.settings.CourseId,termId:this.settings.TermId};e===this.context.Settings.MappingTypeEnum.Assessment?this.populateGradebookItemsList(this.context.WebMethods.GetNormalAssessments,t):e===this.context.Settings.MappingTypeEnum.FinalAssessment&&this.populateGradebookItemsList(this.context.WebMethods.GetFinalAssessments,t),this.controls.ExistingAssessmentsList.show()},t.prototype.onAssessmentScaleChanged=function(){this.setControlAvailability(this.existingAssessmentScalesList,!1);var e=parseInt(this.existingAssessmentScalesList.find("option:selected").val(),10);if(e!==this.context.Settings.AssessmentScaleDefaultValue){this.setControlAvailability(this.mappingTypesList,!1);var t=this.settings.LineItemsSyncKeys;this.createDraftVersion(this.context.Settings.MappingTypeEnum.OverallAverage,t,null,e),this.setControlAvailability(this.existingAssessmentScalesList,!0)}else this.setButtonAvailability(!1);this.setControlAvailability(this.existingAssessmentScalesList,!0)},t.prototype.showAssessmentScalesDropDownList=function(){this.existingAssessmentScalesList.show()},t.prototype.hideAssessmentScalesDropDownList=function(){this.existingAssessmentScalesList.hide()},t.prototype.populateGradebookItemsList=function(t,n){var i=this;$.get(t,n).done(function(e){i.controls.ExistingAssessmentsList.append($("<option />").val(i.context.Settings.ExistingAssessmentDefaultValue.toString()).text(i.context.LanguageTerms.ExistingAssessmentDefaultText)),$.each(e,function(e,t){i.controls.ExistingAssessmentsList.append($("<option />").val(t.GradeBookItemId.toString()).text(t.Title))})}).fail(function(t){e.Utils.handleAjaxError(t)})},t.prototype.createDraftVersion=function(n,i,s,o){null==s&&(s=this.context.Settings.ExistingAssessmentDefaultValue),null==o&&(o=this.context.Settings.AssessmentScaleDefaultValue),$.each(i,function(e,i){t.addOrUpdateDraftItem({SyncKey:i,GradeType:n,AssessmentRecordItemId:s,AssessmentScaleId:o})}),this.updateGradingPeriodSection(),e.LineItemsResults.refreshGrid(this.settings.AggregatedSyncItemId)},t.prototype.setButtonAvailability=function(e){this.setControlAvailability(this.currentButton,e)},t.prototype.setControlAvailability=function(e,t){t?e.removeAttr("disabled"):e.attr("disabled","disabled")},t.prototype.disableMappingControls=function(){this.setControlAvailability(this.mappingTypesList,!1),this.setControlAvailability(this.existingAssessmentsList,!1),this.setControlAvailability(this.existingAssessmentScalesList,!1),this.currentButton.addClass(this.context.CssClasses.ButtonWithLoader)},t.prototype.enableMappingControls=function(){this.setControlAvailability(this.mappingTypesList,!0),this.setControlAvailability(this.existingAssessmentsList,!0),this.setControlAvailability(this.existingAssessmentScalesList,!0),this.currentButton.removeClass(this.context.CssClasses.ButtonWithLoader),this.currentButton.blur()},t.prototype.sendResults=function(){this.handleButtonClick(this.context.WebMethods.SendResults,{courseId:this.settings.CourseId,lineItemIds:this.settings.LineItemsSyncKeys})},t.prototype.saveResults=function(){this.handleButtonClick(this.context.WebMethods.SaveResults,{courseId:this.settings.CourseId,termId:this.settings.TermId,draftItems:t.getDraftItemsBySyncKeys(this.settings.LineItemsSyncKeys)})},t.prototype.handleButtonClick=function(t,n){var i=this;this.currentButton.is(":disabled")||(this.disableMappingControls(),$.post(t,n).done(function(t){var n=i.controls.InformationFeedbackPlaceholder.offset();i.updateGradingPeriodSection(),e.LineItemsResults.refreshGrid(i.settings.AggregatedSyncItemId),t&&t.feedbackMessage&&t.feedbackMessage.length>0&&$(document).trigger(e.GradeExport.showFeedbackEventTitle,[t.feedbackMessage,n]),i.enableMappingControls()}).fail(function(t){e.Utils.handleAjaxError(t),i.enableMappingControls()}))},t.prototype.updateGradingPeriodSection=function(t,n){void 0===t&&(t=!0),void 0===n&&(n=!1),e.GradingPeriod.refreshSection(this.context.Settings.GradingPeriodId,t,n)},t.draftItems=[],t}();e.AggregatedSyncItem=t}(e.OneRoster||(e.OneRoster={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e,t,n,i,s,o,r){this.courseId=e,this.assessmentRecordId=t,this.termId=n,this.gradingPeriodId=i,this.isExpanded=o,this.isSentAreaExpanded=r,this.draftLineItemGradeTypes=s},n=function(){function n(e,t){var i=this;this.context=e,this.controls=t;var s=CCL.CommonFunctions.isMobileDevice()?"touchstart":"click";this.controls.GradingPeriodsSectionHeader.on(s,function(){return i.onGradingPeriodsHeaderClick()}),this.controls.SentLineItemsSectionHeader.on(s,function(){return i.onSentLineItemsHeaderClick()}),$(document).off(n.getUpdateSectionEventTitle(this.context.Settings.GradingPeriodId)),$(document).on(n.getUpdateSectionEventTitle(this.context.Settings.GradingPeriodId),function(e,t,n,s){return i.updateGradingPeriodSection(t,n,s)})}return n.prototype.onGradingPeriodsHeaderClick=function(){this.controls.AllLineItemsSection.slideToggle("slow"),this.controls.GradingPeriodsSection.toggleClass(this.context.CssClasses.GradingPeriodSectionCollapsedClass),this.controls.GradingPeriodsSectionHeader.toggleClass(this.context.CssClasses.GradingPeriodSectionHeaderCollapsedClass)},n.prototype.onSentLineItemsHeaderClick=function(){this.controls.SentLineItems.slideToggle("slow"),this.controls.SentLineItemsSectionHeader.toggleClass(this.context.CssClasses.SentLineItemsSectionHeaderCollapsedClass)},n.getUpdateSectionEventTitle=function(e){return""+n.updateSectionEventTitle+e},n.refreshSection=function(t,i,s){void 0===i&&(i=!0),void 0===s&&(s=!1),$(document).trigger(n.getUpdateSectionEventTitle(t),[i,s,e.AggregatedSyncItem.draftItems])},n.prototype.updateGradingPeriodSection=function(n,i,s){var o=this,r=!this.controls.GradingPeriodsSection.hasClass(this.context.CssClasses.GradingPeriodSectionCollapsedClass),a=!this.controls.SentLineItemsSectionHeader.hasClass(this.context.CssClasses.SentLineItemsSectionHeaderCollapsedClass),l=new t(this.context.Settings.CourseId,this.context.Settings.AssessmentRecordId,this.context.Settings.TermId,this.context.Settings.GradingPeriodId,s,r||n,a||i);$.post(this.context.WebMethods.GradingPeriod,l).done(function(e){if(e&&0!==e.length){var t=$(e);$(o.controls.GradingPeriodsSection).replaceWith(t),$(o.controls.GradingPeriodsSection).removeClass(o.context.CssClasses.GradingPeriodSectionCollapsedClass)}}).fail(function(t){e.Utils.handleAjaxError(t)})},n.updateSectionEventTitle="GradingPeriod:UpdateGradingPeriodSection",n}();e.GradingPeriod=n}(e.OneRoster||(e.OneRoster={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e,t,n,i,s){this.courseId=e,this.personId=t,this.lineItemSyncKey=n,this.scoreListItemExtensionId=i,this.currentScore=s},n=function(e,t,n,i,s,o){void 0===s&&(s=""),void 0===o&&(o=""),this.courseId=e,this.assessmentRecordId=t,this.termId=n,this.studentNameSearchText=s,this.selectedAggregatedLineItemId=o,this.draftLineItemGradeTypes=i},i=function(){function t(i,s){var o=this;this.context=s,this.controls=i,this.initSearch(),$(document).off(t.refreshGridEventTitle),$(document).on(t.refreshGridEventTitle,function(t,i){return o.updateLineItemsResultsSection(new n(o.context.Settings.CourseId,o.context.Settings.AssessmentRecordId,o.context.Settings.TermId,e.AggregatedSyncItem.draftItems,"",i))})}return t.refreshGrid=function(e){$(document).trigger(t.refreshGridEventTitle,e)},t.prototype.initSearch=function(){var e=this;this.controls.SearchImage.on("click",function(){return e.onSearchStudentClick()}),this.controls.SearchInput.on("keydown",function(t){return e.onSearchInputKeyDown(t)})},t.prototype.onSearchStudentClick=function(){this.searchStudents(this.controls.SearchInput.val())},t.prototype.preventEventPropagation=function(e){e.cancelBubble=!0,e.returnValue=!1,e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},t.prototype.onSearchInputKeyDown=function(e){e.keyCode===CCL.CommonConstants.keyCodes.enter&&(this.preventEventPropagation(e),this.searchStudents($(e.target).val()))},t.prototype.searchStudents=function(t){this.updateLineItemsResultsSection(new n(this.context.Settings.CourseId,this.context.Settings.AssessmentRecordId,this.context.Settings.TermId,e.AggregatedSyncItem.draftItems,t||""))},t.prototype.updateLineItemsResultsSection=function(t){var n=this;$.post(this.context.WebMethods.LineItemsResults,t).done(function(e){if(e&&0!==e.length){var i=n.controls.SearchInput.attr("id"),s=$(e);n.controls.LineItemsResultsTable.parent().empty().prepend(s),t.studentNameSearchText&&$("#"+i).val(t.studentNameSearchText)}}).fail(function(t){e.Utils.handleAjaxError(t)})},t.prototype.handleAjaxError=function(e){e.status>=CCL.CommonConstants.httpStatusCodes.badRequest&&e.responseText&&alert(e.responseText)},t.refreshGridEventTitle="LineItemsResults:refreshGrid",t}();e.LineItemsResults=i;var s=function(){function n(e,t){var n=this;this.lineItemCellSelectionChangedEventName="LineItemResultCell:LineItemCellSelectionChanged",this.controls=e,this.context=t,this.isSelected=!1;var i=CCL.CommonFunctions.isMobileDevice();this.controls.LineItemResultCell.on(i?"touchstart":"click",function(){return n.focusCell()}),i||this.controls.LineItemResultCell.on("mouseenter",function(){return n.focusCell()}),this.controls.LineItemResultCell.focus(function(){return n.onLineitemResultCellFocus()}),this.controls.LineItemResultCell.find("*").addBack().blur(function(){return n.onLineitemResultCellBlur()}),$(document).on(this.lineItemCellSelectionChangedEventName,function(e,t){n.isSelected&&t!==n.controls.LineItemResultCell.attr("id")&&n.controls.LineItemResultCell.blur()}),this.controls.AssessmentScaleItemsList.on("change",function(e){return n.onAssessmentScaleItemChanged(e)})}return n.prototype.focusCell=function(){this.isSelected||this.controls.LineItemResultCell.focus()},n.prototype.onLineitemResultCellFocus=function(){this.isSelected||($(document).trigger(this.lineItemCellSelectionChangedEventName,this.controls.LineItemResultCell.attr("id")),this.controls.LineItemResultCell.addClass(this.context.CssClasses.SelectedCellCssClass),this.controls.LineItemResultCell.height(this.controls.LineItemResultCell.innerHeight()),this.isSelected=!0)},n.prototype.onLineitemResultCellBlur=function(){var e=this;setTimeout(function(){var t=$(document.activeElement);t.is(e.controls.LineItemResultCell)||0!==e.controls.LineItemResultCell.has(t).length||(e.controls.LineItemResultCell.removeClass(e.context.CssClasses.SelectedCellCssClass),e.controls.LineItemResultCell.css("height",""),e.isSelected=!1)},0)},n.prototype.onAssessmentScaleItemChanged=function(e){var n=$(e.target);n.attr("disabled","disabled");var i=this.controls.AssessmentScaleItemsList.val(),s=new t(this.context.Settings.CourseId,this.context.Settings.PersonId,this.context.Settings.LineItemSyncKey,i,this.context.Settings.CurrentScore);this.setCustomScoreListItemExtensionForPerson(s),n.removeAttr("disabled")},n.prototype.setCustomScoreListItemExtensionForPerson=function(t){var n=this,i=JSON.stringify(t);$.ajax({type:"POST",url:this.context.WebMethods.SetCustomScoreListItemExtensionForPerson,data:i,dataType:"json",contentType:"application/json; charset=utf-8"}).done(function(){n.controls.AssessmentScaleCurrentItemLabel.text(n.controls.AssessmentScaleItemsList.find("option:selected").text())}).fail(function(t){e.Utils.handleAjaxError(t)})},n}();e.LineItemResultCell=s}(e.OneRoster||(e.OneRoster={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(){}return e.handleAjaxError=function(e){e.status>=CCL.CommonConstants.httpStatusCodes.badRequest&&(null!=e.responseText&&e.responseText.length>0||null!=e.statusText&&e.statusText.length>0)&&alert(null!=e.responseText&&e.responseText.length>0?e.responseText:e.statusText)},e}();e.Utils=t}(e.OneRoster||(e.OneRoster={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;window[e]=this,this.settings=t,$(t.AccordionSelector+" "+t.SectionSelector).click(function(e){n.ShowFeedbackItems(e)})}return e.prototype.ShowFeedbackItems=function(e){var t=$(e.currentTarget);if(!t.data(this.settings.AccordionSectionLoadedDataAttribute)){t.data(this.settings.AccordionSectionLoadedDataAttribute,!0);var n,i=t.find(this.settings.ContentSelector),s=i.children().first().data(this.settings.CourseIdDataAttribute);n=s?{courseId:s,termId:this.settings.TermId,personId:this.settings.PersonId,personCustomerId:this.settings.PersonCustomerId,reportRoleEnumValue:this.settings.ReportRoleEnumValue,readOnly:this.settings.ReadOnly,returnUrl:this.settings.ReturnUrl,linksTarget:this.settings.LinksTarget}:{termId:this.settings.TermId,personId:this.settings.PersonId},$.ajax({type:"GET",url:this.settings.WebMethod,data:n,success:function(e,t,n){i.empty().append($(e))},error:function(e,t,n){i.empty(),CCL.CommonFunctions.alertAjaxError(e,t,n)}})}},e}();e.PersonAssessment=t}(e.Person||(e.Person={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(t,n){var i=this;this.planLoadingProcessId=null,window[t]=this,e.instanceName=t,this.settings=n,this.terms=n.Terms,this.css=n.Css,this.webMethods=n.WebMethods,this.currentDisplayMode=n.CurrentDisplayMode,$("."+this.css.ExpanderLink).click(function(e){i.expanderLinkClick(e)}),CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.MultipleSwitcher.onClickEventName,function(e){var t=parseInt(e.extendedData.Key);t!==i.currentDisplayMode&&(i.currentDisplayMode=t,i.toggleEnableDisplayModeSwitcher(!1),CCL.CommonFunctions.safeAjaxPost({url:i.webMethods.TogglePlannerDisplayMode,data:{plannerDisplayMode:i.currentDisplayMode}}).done(function(){i.toggleEnableDisplayModeSwitcher(!0),i.refreshExpandedGrids()}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n),i.toggleEnableDisplayModeSwitcher(!0)}))}),setTimeout(function(){i.startLoadingMonitor()},100)}return e.getInstance=function(){return window[e.instanceName]},e.prototype.openViewCellContentDialog=function(e,t,n,i,s,o){var r=(t=t||window.event).target||t.srcElement;if(!(r&&$(r).closest("a,input,button,textarea").length>0)){var a=window[this.settings.ViewHtmlTextCellContentDialog];if(null!=a&&null!=this.webMethods.GetPlanHtmlTextCellContent){var l={courseId:n,planId:i,columnId:s,childId:0,filterPersonId:o};a.setAjaxUrl(this.webMethods.GetPlanHtmlTextCellContent,l);var c=$(e).closest("."+this.css.TableCell).children("."+this.css.PlanCellTitle).text();a.setTitle(c),a.setAfterOpenDialogAjaxDynamicallySuccess(function(){CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(a.getContent())}),a.openDialog()}}},e.prototype.expanderLinkClick=function(e){e.preventDefault();var t=$(e.currentTarget),n=t.parent(),i=t.closest("."+this.css.CoursePlansContainer).find("."+this.css.Plans),s=t.data("grid"),o=window[s];n.toggleClass(this.css.Expanded),n.hasClass(this.css.Expanded)?(this.refreshPlanGrid(o),t.prop("title",this.terms.CollapseTooltip)):t.prop("title",this.terms.ExpandTooltip),i.slideToggle("fast")},e.prototype.refreshExpandedGrids=function(){var e=this;$("."+this.css.ExpanderLink).each(function(t,n){var i=$(n),s=i.parent(),o=i.data("grid"),r=window[o];r.ajaxSettings.dataSourceWebMethodParams.currentDisplayMode=e.currentDisplayMode,r.setMode(e.currentDisplayMode===e.settings.DisplayModes.Table?e.css.GridViewModes.TableView:e.css.GridViewModes.DefaultView),s.hasClass(e.css.Expanded)&&e.refreshPlanGrid(r)})},e.prototype.refreshPlanGrid=function(e){if(e.isLoadingInProgress())return!1;this.startLoadingMonitor(),e.refresh()},e.prototype.startLoadingMonitor=function(){var e=this;if(null==this.planLoadingProcessId){this.toggleEnableDisplayModeSwitcher(!1);var t=$("."+this.css.ExpanderLink);this.planLoadingProcessId=setInterval(function(){var n=!0;t.each(function(e,t){var i=$(t).data("grid");if(window[i].isLoadingInProgress())return n=!1,!1}),n&&(clearTimeout(e.planLoadingProcessId),e.planLoadingProcessId=null,e.toggleEnableDisplayModeSwitcher(!0),t.each(function(e,t){var n=$(t).data("grid"),i=window[n],s=$("#"+i.gridClientID);CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(s)}))},500)}},e.prototype.toggleEnableDisplayModeSwitcher=function(e){window[this.settings.DisplayModeSwitcher].toggleEnableSwitcher(e)},e}();e.AggregatedPlanner=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(){function t(n,i){var s=this;window[n]=this,t.clientInstanceName=n,this.settings=i,this.inlineEditorOptions={multiline:{multiline:!0,autoResize:!0,editFieldCssClass:this.settings.Css.EditModeTextboxMultiline,watermarkCssClass:this.settings.Css.Watermark},singleline:{submitOnEnter:!0,editFieldAutoWidth:!1,editFieldCssClass:this.settings.Css.EditModeTextboxSingleline,watermarkCssClass:this.settings.Css.Watermark,editFieldDisplayInline:!0}},$(function(){var t={};t[e.PlannerConstants.events.HybridEditorItemInlineModeChanged]=function(e,t){s.onColumnInlineModeChanged(e,t)},t[e.PlannerConstants.events.HybridEditorItemTextUpdated]=function(e,t){s.onColumnTextUpdated(e,t)},t[e.PlannerConstants.events.HybridEditorItemAjaxError]=function(e,t){s.onAjaxError(e,t)},t[e.PlannerConstants.events.HybridEditorItemSaveError]=function(e,t){s.onSaveError(e,t)},$(document).on(t,"div["+e.PlannerConstants.dataAttributes.HybridEditorItem+"]")})}return t.prototype.replaceMediaContentWithPlaceholders=function(){return!1},t.prototype.getSettings=function(t){var n,i,s,o,r=this.settings.Css.Watermark;switch(t.Type){case e.ClientColumnType.TopicTitle:n=this.settings.WebMethods.UpdateTopicTitle,i={courseId:this.settings.CourseId,topicId:t.EntityId},s="inline",o=this.settings.Terms.TopicTitleWatermark,r="";break;case e.ClientColumnType.TopicDescription:n=this.settings.WebMethods.UpdateTopicDescription,i={courseId:this.settings.CourseId,topicId:t.EntityId},s="hybrid",o=this.settings.Terms.ClickToAddText;break;case e.ClientColumnType.PlanDescription:n=this.settings.WebMethods.UpdatePlanDescription,i={courseId:this.settings.CourseId,planId:t.EntityId,replaceElementsWithPlaceholders:t.IsPlanColumn&&this.replaceMediaContentWithPlaceholders()},s="hybrid",o=this.settings.Terms.PlanDescriptionWatermark;break;case e.ClientColumnType.PlanTitle:n=this.settings.WebMethods.UpdatePlanTitle,i={courseId:this.settings.CourseId,planId:t.EntityId},s="inline",o=this.settings.Terms.PlanTitleWatermark,r="";break;case e.ClientColumnType.ClassHours:n=this.settings.WebMethods.UpdateClassHours,i={courseId:this.settings.CourseId,planId:t.EntityId},s="inline",o="0",r="";break;default:n=this.settings.WebMethods.UpdateCustomColumnContent,s="hybrid",o=this.settings.Terms.ClickToAddText,i={courseId:this.settings.CourseId,columnId:t.ColumnId,entityId:t.EntityId,replaceElementsWithPlaceholders:t.IsPlanColumn&&this.replaceMediaContentWithPlaceholders()}}return{hybridEditorClientId:this.settings.HybridEditorClientId,editModeEnabled:s,webMethodParams:i,saveContentWebUrl:n,inlineEditorOptions:this.getInlineEditorOptions(t),editorDialogTitle:this.settings.Terms.Edit+" "+t.ColumnTitle,textContainerWatermark:o,textContainerWatermarkCssClass:r,encodePayload:!1}},t.prototype.getInlineEditorOptions=function(n){var i=this.inlineEditorOptions.singleline;return this.isMultilineColumn(n.Type)?i=this.inlineEditorOptions.multiline:n.Type===e.ClientColumnType.PlanTitle?i=$.extend({},this.inlineEditorOptions.singleline,t.planTitleMaxLength):n.Type===e.ClientColumnType.ClassHours&&(i=$.extend({},this.inlineEditorOptions.singleline,t.classHoursMaxLength)),i},t.prototype.isMultilineColumn=function(t){return t===e.ClientColumnType.TopicDescription||t===e.ClientColumnType.PlanDescription||t===e.ClientColumnType.RichText},t.prototype.onColumnInlineModeChanged=function(t,n){var i=$("#"+t.target.id),s=this.getColumnData(i);s&&(n.isEditMode||n.isNewTextSaved||s.Type!==e.ClientColumnType.ClassHours||this.removeErrorControlFromCell(i))},t.prototype.onSaveError=function(t,n){var i=$("#"+t.target.id),s=n.errorText,o=this.getColumnData(i);o&&(s&&s.length&&o.Type===e.ClientColumnType.ClassHours&&(this.getErrorControl(i).length||(i.append(this.renderErrorControl(s)),i.addClass(this.settings.Css.Error))))},t.prototype.onAjaxError=function(e,t){t.xhrObject.status>=CCL.CommonConstants.httpStatusCodes.badRequest&&alert(t.xhrObject.responseText?CCL.CommonFunctions.htmlDecode(t.xhrObject.responseText):this.settings.Terms.ErrorMessage)},t.prototype.onColumnTextUpdated=function(t,n){var i=$("#"+t.target.id),s=this.getColumnData(i);i&&(s&&s.Type===e.ClientColumnType.ClassHours&&this.removeErrorControlFromCell(i),this.updateNoPrintContent(i,n.html),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(i),s.Type===e.ClientColumnType.TopicTitle&&n.customData&&e.PlannerUtility.updateTopicFolderNode(n.customData.folderId,n.customData.folderName),this.measureKpiEditPlan())},t.prototype.removeErrorControlFromCell=function(e){var t=this.getErrorControl(e);t.length&&($(e).removeClass(this.settings.Css.Error),t.remove())},t.prototype.updateNoPrintContent=function(e,t){e.closest("."+this.settings.Css.CellWrapper).toggleClass(this.settings.Css.NoPrint,0===$.trim(t).length)},t.prototype.getErrorControl=function(e){return $(e).children("div.error")},t.prototype.renderErrorControl=function(e){return"<div class='error'>"+e+"</div>"},t.planTitleMaxLength=255,t.classHoursMaxLength=5,t.hybridEditorItemIdDataAttr="hybrid-editor-item-id",t}();t.PlannerInlineCellBase=n}(t.InlineCell||(t.InlineCell={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(t){function n(e,n){t.call(this,e,n)}return __extends(n,t),n.prototype.getEditorItemSettings=function(e){var n=$("#"+e),i=this.getColumnData(n);return t.prototype.getSettings.call(this,i)},n.prototype.measureKpiEditPlan=function(){e.CbPlanner.getInstance().measureEditPlan()},n.prototype.getColumnData=function(t){var n=t.closest("."+this.settings.Css.CbCellContainer),i=t.closest("."+this.settings.Css.CbPlanContainer);return{ColumnId:parseInt(n.data(e.PlannerConstants.dataAttributes.ColumnId),10),Type:parseInt(n.data(e.PlannerConstants.dataAttributes.ColumnType),10),IsPlanColumn:!0,EntityId:parseInt(i.data(e.PlannerConstants.dataAttributes.PlanId),10),ColumnTitle:n.data(e.PlannerConstants.dataAttributes.ColumnTitle)}},n}(t.PlannerInlineCellBase);t.PlannerCBInlineCell=n}(t.InlineCell||(t.InlineCell={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){!function(t){var n=function(){function t(e){var t=this;this.settings=e,this.terms=e.Terms,this.css=e.Css,this.contextDialog=new ContextDialog("#"+this.settings.TimeSpanPickerContentPanelId,{title:this.terms.DateContextDialogTitle,footerContent:this.settings.TimeSpanPickerFooterPanelId,setFocus:!1,width:592,zIndex:5}),this.closeContextDialog=this.contextDialog.closeDialog,$(function(){t.contextDialog.setCloseFunction(function(e){return t.onCloseDialog(e)}),$(document).on("click","."+t.css.EditPlanTimeSpan,function(e){t.contextDialog.mainContainer.is(":visible")||t.editPlanDate(e)}),$("#"+t.settings.CloseContextDialogButton).click(function(){return t.saveChanges()})})}return t.prototype.hasPreservedEvents=function(e){var t=!1,n=this.getTimeSpanData(e);n&&(n.Events&&(t=n.Events.filter(function(e){return e.PreservePlanConnection>0}).length>0));return t},t.prototype.editPlanDate=function(e){var t=this,n=$(e.currentTarget),i=this.getDatePicker();this.contextDialog.mainContainer.removeClass(this.css.CellError),this.currentPlanId=this.getCurrentPlanId(n),this.setDefaultDate(),i.setShowPopUpCallback(function(){t.openContextDialog(e),t.contextDialog.mainContainer.find(":radio:checked:first").focus()}),i.showTimeSpan(this.getTimeSpanData(this.currentPlanId),this.currentPlanId)},t.prototype.onCloseDialog=function(e){if(e&&$(e.target).parents().andSelf().hasClass("ui-datepicker"))return;this.closeContextDialog()},t.prototype.saveChanges=function(){var t=this,n=this.getDatePicker();if(this.hasPreservedEvents(this.currentPlanId))this.closeContextDialog();else{var i=void 0;switch(n.getCurrentMode()){case e.DatePickerMode.TimeSpan:i=this.updatePlanTimeSpan(this.currentPlanId);break;case e.DatePickerMode.WeekAndDay:i=this.updatePlanWeekAndDay(this.currentPlanId);break;case e.DatePickerMode.Event:i=this.updatePlanEvents(this.currentPlanId)}i&&i.always(function(){return t.focusOnDateEditAction(t.currentPlanId)})}},t.prototype.getTimeSpanHidden=function(t){return $("."+this.css.CellContent).find("input:hidden"+CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.PlanId,t))},t.prototype.getTimeSpanData=function(e){var t=this.getTimeSpanHidden(e);return JSON.parse(t.val())},t.prototype.closeDatePicker=function(){this.closeContextDialog()},t.prototype.getDatePicker=function(){return window[this.settings.TimeSpanPickerInstanceName]},t}();t.PlanDateCellBase=n}(t.DateCell||(t.DateCell={}))}(t.Plan||(t.Plan={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){!function(t){var n=function(t){function n(n){t.call(this,n),this.courseId=n.CourseId,this.$contentBlockContainer=$("#"+n.ContentBlockClientId),this.cbPlanner=e.CbPlanner.getInstance()}return __extends(n,t),n.prototype.updatePlanTimeSpan=function(t){var n=this,i=this.getDatePicker();return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.UpdatePlanTimeSpan,data:{courseId:this.courseId,planId:t,start:i.getStartDate(),stop:i.getStopDate(),filterStartDate:this.cbPlanner.getFilterStartDate(),filterStopDate:this.cbPlanner.getFilterStopDate()}}).done(function(t){t?n.finalizeUpdateDate(t):i.showErrorMsg(e.DatePickerMode.TimeSpan)}).fail(function(){i.showErrorMsg(e.DatePickerMode.TimeSpan)})},n.prototype.updatePlanWeekAndDay=function(t){var n=this,i=this.getDatePicker();return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.UpdatePlanWeekAndDay,data:{courseId:this.courseId,planId:t,start:i.getStartWeek(),stop:i.getStopWeek(),filterStartDate:this.cbPlanner.getFilterStartDate(),filterStopDate:this.cbPlanner.getFilterStopDate()}}).done(function(t){t?n.finalizeUpdateDate(t):i.showErrorMsg(e.DatePickerMode.WeekAndDay)}).fail(function(){i.showErrorMsg(e.DatePickerMode.WeekAndDay)})},n.prototype.updatePlanEvents=function(t){var n=this,i=this.getDatePicker(),s=i.getEvents();return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.UpdatePlanEvents,data:{courseId:this.courseId,planId:t,activityIds:s,filterStartDate:this.cbPlanner.getFilterStartDate(),filterStopDate:this.cbPlanner.getFilterStopDate()}}).done(function(t){t?n.finalizeUpdateDate(t):i.showErrorMsg(e.DatePickerMode.Event)}).fail(function(){i.showErrorMsg(e.DatePickerMode.Event)})},n.prototype.setDefaultDate=function(){this.getDatePicker().setDefaultDate(this.cbPlanner.getFilterStartDate())},n.prototype.openContextDialog=function(e){var t=$(e.target).closest("."+this.settings.Css.CellContent),n=t.position(),i=t.offset(),s=n.left+i.left+10,o=n.top+i.top-70;this.contextDialog.openDialogAt(s,o,!1)},n.prototype.focusOnDateEditAction=function(e){$("."+this.css.EditPlanTimeSpan).focus()},n.prototype.updateContent=function(t,n){var i=$("."+this.settings.Css.PlanContainer+CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.PlanId,t)).find("."+this.css.CellContent),s=i.parent();i.replaceWith(n),this.cbPlanner.toggleTooltipForField(s.find("."+this.css.CellContent),!0,this.settings.Terms.Tooltip)},n.prototype.getCurrentPlanId=function(t){return parseInt(t.closest("."+this.settings.Css.PlanContainer).data(e.PlannerConstants.dataAttributes.PlanId).toString(),10)},n.prototype.finalizeUpdateDate=function(e){this.closeDatePicker(),e.hidePlan?(this.showFeedback(e.message,e.extraButtonText,e.navigationUrl,e.periodStartDate),this.hidePlan(e.planId)):this.updateContent(e.planId,e.dateCell)},n.prototype.showFeedback=function(e,t,n,i){var s=this;CCL.InformationFeedback.showFeedbackWithextraButton(this.$contentBlockContainer,e,t,function(){n?window.location.href=n:i&&s.cbPlanner.changeDatePeriod(i),CCL.InformationFeedback.hideFeedback(s.$contentBlockContainer)})},n.prototype.hidePlan=function(t){$("."+this.settings.Css.PlanContainer).length>1?$("."+this.settings.Css.PlanContainer+CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.PlanId,t)).remove():this.cbPlanner.reloadPlans()},n}(t.PlanDateCellBase);t.PlanCbDateCell=n}(t.DateCell||(t.DateCell={}))}(t.Plan||(t.Plan={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){!function(t){var n=function(){function t(e,n,i){var s=this;t.clientInstanceName=e,window[e]=this,this.settings=n,this.$plannerContainer=i,$(function(){s.loSelector=window[s.settings.LearningObjectiveSelectorInstanceName],s.attachEvents()})}return t.getPlanLearningObjectivesCellInstance=function(){return window[t.clientInstanceName]},t.prototype.updateContent=function(e,t){this.getLearningObjectivesListCell(t).html(e)},t.prototype.updateLearningObjectives=function(e){var t=this,n=this.currentPlanId;CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.AddPlanLearningObjectives,data:{courseId:this.settings.CourseId,learningObjectiveIds:e,planId:n}}).done(function(e){e&&t.updateContent(e.ControlHtml,n)}).fail(CCL.CommonFunctions.alertAjaxError)},t.prototype.removeLOFromPlan=function(e,t,n){var i={courseId:this.settings.CourseId,planId:e,learningObjectiveId:t};return null!=n&&(i.showCollapsedList=n),CCL.CommonFunctions.safeAjax({type:"DELETE",url:this.settings.WebMethods.RemovePlanLearningObjective,data:i}).fail(CCL.CommonFunctions.alertAjaxError)},t.prototype.attachEvents=function(){var e=this;this.$plannerContainer.on("click","."+this.settings.Css.AddLearningObjectives,function(t){e.currentPlanId=e.getCurrentPlanId($(t.currentTarget)),e.loSelector.setSelectedIds(e.getLearningObjectiveIds(e.currentPlanId,!1),!0),e.loSelector.openDialog()}),$(document).on("click","."+this.settings.Css.RemoveLearningObjective,function(t){var n=$(t.currentTarget);e.removeLearningObjective(n)})},t.prototype.getLearningObjectiveDataAttribute=function(t){return t?e.PlannerConstants.dataAttributes.RepositoryLearningObjectiveId:e.PlannerConstants.dataAttributes.LearningObjectiveId},t}();t.PlanLearningObjectivesCellBase=n}(t.LearningObjectivesCell||(t.LearningObjectivesCell={}))}(t.Plan||(t.Plan={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){!function(t){var n=function(t){function n(n,i){t.call(this,n,i,e.CbPlanner.getInstance().getContainer())}return __extends(n,t),n.prototype.removeLearningObjective=function(n){var i=this,s=this.getCurrentPlanId(n),o=parseInt(n.closest("."+this.settings.Css.LearningObjectivesListItem).data(e.PlannerConstants.dataAttributes.LearningObjectiveId),10);t.prototype.removeLOFromPlan.call(this,s,o).done(function(){n.closest("."+i.settings.Css.LearningObjectivesListItem).remove()})},n.prototype.getCurrentPlanId=function(t){var n=t.closest("."+this.settings.Css.CbPlanContainer);return parseInt(n.data(e.PlannerConstants.dataAttributes.PlanId),10)},n.prototype.getLearningObjectivesListCell=function(t){return $("."+this.settings.Css.CbPlanContainer+CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.PlanId,t)).find("."+this.settings.Css.AddLearningObjectives).closest("."+this.settings.Css.CbCellContainer)},n.prototype.getLearningObjectiveIds=function(e,t){var n=this.getLearningObjectivesListCell(e),i=this.getLearningObjectiveDataAttribute(t),s=n.find("."+this.settings.Css.LearningObjectivesListItem+CCL.CommonFunctions.getDataSelector(i));return $.map(s,function(e){return parseInt($(e).data(i),10)})},n}(t.PlanLearningObjectivesCellBase);t.PlanCbLearningObjectivesCell=n}(t.LearningObjectivesCell||(t.LearningObjectivesCell={}))}(t.Plan||(t.Plan={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e,t){this.planId=e,this.columnId=t};e.PlanColumnId=t;var n=function(){function n(t,i){var s=this;window[t]=this,n.instanceName=t,this.settings=i,this.events=i.Events,this.css=i.Css,this.webMethods=i.WebMethods,this.terms=i.Terms,this.data=i.DataAttributes,this.currentDisplayMode=i.CurrentDisplayMode,this.kpi=i.Kpi,this.courseId=this.settings.CourseId,this.container=$("#"+i.Controls.ContainerId),this.plannerFilter=$("#"+i.Controls.PlannerFilterId),this._ajaxLoader=$("#"+i.Controls.AjaxLoader),this._ajaxLoaderOverlay=$("#"+i.Controls.AjaxLoaderOverlay),setTimeout(function(){s.showNoTopicMessageIfNecessary()},0);var o=this;this.settings.Events&&this.settings.Events.TimelineControlInitialized&&this.currentDisplayMode===this.settings.DisplayModes.Timeline&&$(document).on(this.settings.Events.TimelineControlInitialized,function(){s.toggleEnableDisplayModeSwitcher(!1),s.toggleTimelineMode(!0),s.toggleEnableDisplayModeSwitcher(!0)}),CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.MultipleSwitcher.onClickEventName,function(e){var t=parseInt(e.extendedData.Key);t!==o.currentDisplayMode&&(o.currentDisplayMode=t,null!=o.webMethods&&null!=o.webMethods.Common&&null!=o.webMethods.Common.TogglePlannerDisplayMode?(o.toggleEnableDisplayModeSwitcher(!1),CCL.CommonFunctions.safeAjaxPost({url:o.webMethods.Common.TogglePlannerDisplayMode,data:{courseId:o.settings.CourseId,plannerDisplayMode:o.currentDisplayMode,childId:o.settings.ChildId}}).done(function(){o.toggleEnableDisplayModeSwitcher(!0),o.changeDisplayMode()}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n),o.toggleEnableDisplayModeSwitcher(!0)})):o.changeDisplayMode())}),this.settings.ReadOnlyMode||(CCL.CommonFunctions.attachPostMessageEventListener($(window),e.PlannerConstants.postMessages.SendElementIdToCourseFeature,function(t){e.Cells.Plan.ResourcesCell.PlanActivityResourceCell.getPlanActivityResourceCellInstance().refreshResourcesCell(t.relatedEntityId,t.customId,!0)}),$.fn.scrollParent=function(){return $(document)})}return n.prototype.changeDisplayMode=function(){var t=this;this.toggleTimelineMode(this.isTimelineCurrentMode()),this.isTimelineCurrentMode()||$.each(e.Cards.TopicCard.getAllTopicCards(),function(e,n){n.changeDisplayMode(t.currentDisplayMode)})},n.getInstance=function(){return window[n.instanceName]},n.prototype.getSetDateDialog=function(){return window[this.settings.Controls.SetDateDialog]},n.prototype.getLibraryBrowserDialog=function(){return window[this.settings.Controls.LibraryBrowserDialog]},n.prototype.getTopicColorPicker=function(){return window[this.settings.TopicColorPickerInstanceName]},n.prototype.openViewCellContentDialog=function(e,t,n,i){var s=(t=t||window.event).target||t.srcElement;if(!(s&&$(s).closest("a,input,button,textarea").length>0)){var o=window[this.settings.Controls.ViewHtmlTextCellContentDialog];if(null!=o&&null!=this.webMethods.Column.GetPlanHtmlTextCellContent){var r;r=null==this.settings.PublicAccessKey?{courseId:this.settings.CourseId,planId:n,columnId:i,childId:this.settings.ChildId,filterPersonId:0}:{publicAccessKey:this.settings.PublicAccessKey,planId:n,columnId:i},o.setAjaxUrl(this.webMethods.Column.GetPlanHtmlTextCellContent,r);var a=$(e).closest("."+this.css.TableCell).children("."+this.css.PlanCellTitle).text();o.setTitle(a),o.setAfterOpenDialogAjaxDynamicallySuccess(function(){CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(o.getContent())}),o.openDialog()}}},n.prototype.getContainer=function(){return this.container},n.prototype.getPlannerFilter=function(){return this.plannerFilter},n.prototype.getPlannerFeedback=function(){return window[this.settings.Controls.Feedback]},n.prototype.showConfirmDialog=function(e,t,n,i){void 0===n&&(n=""),void 0===i&&(i="");var s=""===n?this.terms.Yes:n,o=""===i?this.terms.No:i;CCL.CommonFunctions.jAjaxConfirm(e,this.terms.ConfirmTitle,s,o,t)},n.prototype.parseDateFromString=function(e){return null!=e?$.datepicker.parseDate(this.settings.DateFormat,e):null},n.prototype.showNoTopicMessageIfNecessary=function(){this.isTimelineCurrentMode()||this.settings.UseTopics&&this.container.find("."+this.css.NoTopicsMessage).toggle(!this.hasTopicsOrPlansWithoutTopic())},n.prototype.togglePlannerSharing=function(){$("#"+this.settings.Controls.ShareMenuItem).toggle(this.hasTopics()),$("#"+this.settings.Controls.StopSharingMenuItem).toggle(this.hasTopics())},n.prototype.measureEditPlan=function(){CCL.CommonFunctions.measureKpi(this.kpi.Url,this.kpi.Section,this.kpi.EditPlanMeasurement,this.kpi.Context)},n.prototype.hasTopicCardContainers=function(t){return!!this.settings.UseTopics&&e.Cards.TopicCard.getAllTopicCardContainers(t).length>0},n.prototype.hasTopics=function(){return this.hasTopicCardContainers(!0)},n.prototype.hasTopicsOrPlansWithoutTopic=function(){return this.hasTopicCardContainers(!1)},n.prototype.getPlannerCellCssClass=function(){return this.currentDisplayMode===this.settings.DisplayModes.Table?this.css.TableCell:this.css.ListCell},n.prototype.toggleEnableDisplayModeSwitcher=function(e){window[this.settings.Controls.DisplayModeSwitcher].toggleEnableSwitcher(e)},n.prototype.isTimelineCurrentMode=function(){return this.currentDisplayMode===this.settings.DisplayModes.Timeline},n.prototype.getCurrentDisplayMode=function(){return this.currentDisplayMode},n.prototype.isTableCurrentMode=function(){return this.currentDisplayMode===this.settings.DisplayModes.Table},n.prototype.toggleTimelineMode=function(t){var n=$("#"+this.settings.Controls.GridContainerId);n&&(this.settings.UseTopics?n.toggle(!t):e.Cards.TopicCard.getAllTopicCards()[0].getPlanGrid().getRowsContainer().toggle(!t));var i=e.PlannerTimeline.getInstance();i&&i.toggleTimeline(t,!this.settings.UseTopics||this.hasTopics()),this.disableTopicToolbarActionItems(t),this.toggleSearch(!t)},n.prototype.disableTopicToolbarActionItems=function(t){if(!this.settings.ReadOnlyMode)if(this.settings.UseTopics){var n=$("#"+this.settings.Controls.AddTopicLink),i=$("#"+this.settings.Controls.ActionLink),s=[];s.push(n),s.push(i),e.Cards.TopicCard.disableMenuItems(s,t,this.settings.Css.DisabledMenuItem,this.settings.Css.DisabledMenuItemContainer,this.settings.Terms.DisableTopicMenuTooltip)}else{e.Cards.TopicCard.getAllTopicCards()[0].disablePlanMenu(t)}},n.prototype.toggleSearch=function(e){var t=document.querySelector(this.settings.Controls.SearchField);null!=t&&(t.style.display=e?"":"none")},n.prototype.loadLargePlanTextContent=function(e){var n=this,i=$("."+CCL.CommonFunctions.getDataSelector(this.data.TopicId,e)).find("."+this.css.HtmlTextContentPlaceHolder);if(0!==i.length){var s=new Array;$.each(i,function(e,i){var o=$(i);s.push(new t(o.data(n.data.PlanId),o.data(n.data.ColumnId)))}),this.processPlanColumnChunks(this.prepareChunks(s)).done(function(){return n.completeLoadingLargePlanContent(e)})}else this.completeLoadingLargePlanContent(e)},n.prototype.stopSharingPlanner=function(){var e=this;this.showConfirmDialog(this.settings.Terms.StopSharingPlannerConfirmText,function(t){t&&(e.toggleLoading(!0),CCL.CommonFunctions.safeAjaxPost({url:e.webMethods.ShareablePlanner.StopSharingPlanner,data:{courseId:e.settings.CourseId,plannerShareableObjectId:e.settings.ShareableObjectId}}).done(function(){window.location=window.location}).fail(function(t,n,i){e.toggleLoading(!1),CCL.CommonFunctions.alertAjaxError(t,n,i)}))})},n.prototype.processPlanColumnChunks=function(e){var t=this,n=e.splice(0,this.settings.ChunkSizeForLoadingLargeText);return 0===n.length?$.when():$.when.apply($,n.map(function(e){return t.getPlanCellsWithLargeTextPromise(e)})).then(function(){t.processPlanColumnChunks(e)})},n.prototype.prepareChunks=function(e){if(!e||0===e.length)return new Array;for(var t=new Array,n=!0;n;){var i=e.splice(0,this.settings.ChunkSizeForLoadingLargeText);t.push(i),n=e.length>0}return t},n.prototype.getPlanCellsWithLargeTextPromise=function(t){var n=this,i=new Array,s=new Array;t.forEach(function(e){i.push(e.planId),s.push(e.columnId)});var o=null==this.settings.PublicAccessKey?{courseId:this.settings.CourseId,planIds:i,columnIds:s,childId:this.settings.ChildId,currentDisplayMode:this.currentDisplayMode}:{publicAccessKey:this.settings.PublicAccessKey,planIds:i,columnIds:s,currentDisplayMode:this.currentDisplayMode};return CCL.CommonFunctions.safeAjaxPost({url:this.webMethods.Plan.LoadCellsWithLargeText,data:o}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)}).done(function(t){if(t&&($.each(t.cellList,function(e,t){var i=n.getPlanTextContentPlaceHolder(t.PlanId,t.ColumnId);i.replaceWith(t.Content),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(i)}),t.columnDataList)){var i=e.Cells.InlineCell.PlannerInlineCell.getInstance();i&&i.addColumnsToEdit(t.columnDataList)}})},n.prototype.getPlanTextContentPlaceHolder=function(e,t){return $("."+this.css.HtmlTextContentPlaceHolder+CCL.CommonFunctions.getDataSelector(this.data.PlanId,e)+CCL.CommonFunctions.getDataSelector(this.data.ColumnId,t))},n.prototype.toggleLoading=function(e){this._ajaxLoaderOverlay.toggle(e),this._ajaxLoader.toggle(e)},n.prototype.completeLoadingLargePlanContent=function(t){var n=e.Cards.TopicCard.getInstance(t);n.removePlanGridMessage(),n.loadingLargePlanContentCompleted=!0},n}();e.Planner=n}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(){function t(n){var i=this;this.loadingLargePlanContentCompleted=!0,this.isSearching=!1,window[t.getTopicCardInstanceName(n.TopicId)]=this,this._settings=n;var s=e.Planner.getInstance();this._topicId=this._settings.TopicId,s.settings.ReadOnlyMode||(this._termStartDate=s.parseDateFromString(this._settings.TermStartDate),this._termEndDate=s.parseDateFromString(this._settings.TermEndDate)),this.hasPlans=this._settings.HasPlans,this.hasConnectedFolder=this._settings.HasConnectedFolder,this.isSearching=this._settings.IsSearching,$(function(){i._planGrid=window[i._settings.PlanGridInstanceName],i._container=$("#"+i._settings.ContainerId),i._topicExpander=i._container.find("."+t.css.TopicExpander),i._topicCheckBox=$("#"+i._settings.TopicCheckBoxId),i._topicExpanderLink=i._container.find("#"+i._settings.TopicExpanderLinkId),i._topicColorPickerLink=i._container.find("#"+i._settings.TopicColorPickerLinkId),i.attachEvents(),i.isTopicExpanded()&&!s.isTimelineCurrentMode()&&$(function(){i.refreshPlanGrid(),i._settings.PlanIdToScroll>0&&(i._planIdToScroll=i._settings.PlanIdToScroll)})})}return t.setCommonSettings=function(n){t.planner=e.Planner.getInstance(),t.commonSettings=n,t.css=t.commonSettings.Css,t.terms=t.commonSettings.Terms,t.isIos=t.planner.settings.IsIos,t.URL=window.URL;var i=new t.URL(document.location).searchParams;t.searchText=i.has("SearchText")?i.get("SearchText"):null,t.planner.settings.ReadOnlyMode||t.hideTopicMoveOptionsIfNecessary(),null!=n.DisplayModeSwitcher&&(t.planner.settings.Controls.DisplayModeSwitcher=n.DisplayModeSwitcher)},t.getInstance=function(e){return window[t.getTopicCardInstanceName(e)]},t.getInstanceByContainer=function(e){var n=e.data(t.planner.data.TopicId);return window[t.getTopicCardInstanceName(n)]},t.prototype.getColorPickerLink=function(){return this._topicColorPickerLink},t.prototype.getColorSchema=function(){return this._settings.TopicColorSchema},t.prototype.getTopicCardContainer=function(){return this._container},t.topicCardsExist=function(){return null!=t.commonSettings},t.getAllTopicCardContainers=function(e){if(!t.topicCardsExist())return $();var n="";return e&&(n="[data-"+t.planner.data.TopicId+"!=0]"),$("."+t.commonSettings.Css.TopicContainer+n)},t.getAllTopicCards=function(){var e=new Array;return t.getAllTopicCardContainers().each(function(n,i){var s=t.getInstanceByContainer($(i));null!=s&&e.push(s)}),e},t.getTopicCardsForTopicIds=function(e){var n=new Array;return null!=e&&e.length>0&&t.getAllTopicCardContainers().each(function(i,s){var o=t.getInstanceByContainer($(s));null!=o&&e.indexOf(o._topicId)>-1&&n.push(o)}),n},t.getPlansForAllTopics=function(){return t.topicCardsExist()?$("."+t.css.Plans+" ."+t.css.PlanContainer):$()},t.getParentTopicCardContainer=function(e){return e.closest("."+t.commonSettings.Css.TopicContainer)},t.getParentTopicCard=function(e){var n=t.getParentTopicCardContainer(e);return t.getInstanceByContainer(n)},t.getParentPlanContainer=function(e){return e.closest("."+t.commonSettings.Css.PlanContainer)},t.prototype.getPlanGrid=function(){return this._planGrid},t.prototype.getSelectedPlanIds=function(n){var i=this._planGrid.getSelectedValues();if(!i.length){if(n){var s=e.Planner.getInstance().terms;CCL.CommonFunctions.jAjaxAlert(t.terms.NothingSelected,s.Alert,s.Ok)}return null}return i},t.prototype.clearPlanSelection=function(){return this._planGrid.toggleSelectAll(!1)},t.clearAllTopicSelection=function(){t.planner.getContainer().find("."+t.css.TopicSelector).each(function(e,n){var i=t.getParentTopicCard($(n));i&&i.isTopicSelected()&&i._topicCheckBox&&(i._topicCheckBox.prop("checked",!1),i.toggleTopicSelection())})},t.getSelectedTopicIds=function(n){var i=[];if(t.topicCardsExist()&&t.planner.getContainer().find("."+t.css.TopicSelector).each(function(e,n){var s=t.getParentTopicCard($(n));s&&s.isTopicSelected()&&i.push(s._topicId)}),!i.length){if(n){var s=e.Planner.getInstance().terms;CCL.CommonFunctions.jAjaxAlert(s.NoTopicsSelected,s.Alert,s.Ok)}return null}return i},t.prototype.showPlanFeedbackMessage=function(e,t){this._planGrid.getFeedback().showMessage(e,t)},t.prototype.appendNewPlan=function(n,i){this._planGrid.removeEmptyText(),this._planGrid.getRowsContainer().append(n),t.planner.currentDisplayMode===t.planner.settings.DisplayModes.Table&&this._planGrid.updateHeaderRowCheckBoxSelection(),i&&this.scrollToPlan(i),e.Cells.Plan.ResourcesCell.PlanActivityResourceCell.getPlanActivityResourceCellInstance().initDragAndDrop(this._container)},t.prototype.removePlansFromGrid=function(e,t){for(var n in e)e.hasOwnProperty(n)&&this.getPlanContainerById(e[n]).remove();this._planGrid.updateFreezeState(),0===this._planGrid.getRowsCount()&&this._planGrid.getRowsContainer().html(t)},t.prototype.getPlanContainerById=function(e){return this._planGrid.getRowById(e)},t.prototype.sortPlans=function(e){for(var t in e)e.hasOwnProperty(t)&&this._planGrid.getRowsContainer().append(this.getPlanContainerById(e[t]))},t.prototype.refreshPlanGrid=function(e,n){var i=this,s={isSearching:this.isSearching,searchText:t.searchText,planIds:n};if(this._planGrid.isLoadingInProgress())return!1;t.startLoadingMonitor(),t.planner.settings.ReadOnlyMode||this.disablePlanMenu(!0),this._planGrid.refresh(s).done(function(){CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(i._planGrid.getRowsContainer()),e&&e()})},t.prototype.getTopicExpander=function(){return this._topicExpander},t.prototype.getTopicExpanderLink=function(){return this._topicExpanderLink},t.prototype.updateTopicExpanderLink=function(e){this._topicExpanderLink.html(e)},t.prototype.toggleTopicSelection=function(){var e=this.isTopicSelected();this._planGrid.toggleSelectAll(e),this._planGrid.toggleDisableAll(e),this.disablePlanMenu(e,t.terms.DisabledMenuItemTooltip),this.toggleDisablePlanActionMenu(e)},t.prototype.isTopicSelected=function(){return!!this._topicCheckBox&&this._topicCheckBox.is(":checked")},t.prototype.getTopicId=function(){return this._topicId},t.prototype.getTopicName=function(){return this._settings.TopicName},t.prototype.setTopicColorSchema=function(e,n){this._settings.TopicColorSchema=e,this._container.find("."+t.css.TopicColorContainer).removeClass().addClass(t.css.TopicColorContainer).addClass(n)},t.prototype.getLastPlanId=function(){return this._planGrid.getRowPrimaryKeyValueByIndex(this._planGrid.getRowsCount()-1)},t.prototype.getPlanIds=function(){return this._planGrid.getAllValues()},t.prototype.containsPlanElements=function(t){var n=this,i=!1;return $.each(t,function(t,s){return!(n.getPlanContainerById(s).find(e.Cells.Plan.ResourcesCell.PlanActivityResourceCell.getActivityResourceListItemSelector()).length>0)||(i=!0,!1)}),i},t.prototype.updatePlanCellsCallback=function(e){if(null!=e){for(var t={needToReloadFolders:!1},n=0;n<e.length;n++)this.refreshCell(e[n],t);var i=itslTop;t.needToReloadFolders&&i.reloadFolder&&i.reloadFolder("item0","planner",!0,!0)}},t.prototype.redirectToSharePlans=function(e){var t=CCL.CommonFunctions.formatString(this._settings.SharePlansPageUrlTemplate,e);window.location=t},t.prototype.redirectToShareTopic=function(){var e=CCL.CommonFunctions.formatString(this._settings.ShareTopicPageUrlTemplate,this._topicId);window.location=e},t.setDefaultDate=function(e,n){var i=t.getInstance(n);if(i){var s=Date.now(),o=null!=i._termStartDate&&s<i._termStartDate||null!=i._termEndDate&&s>i._termEndDate?i._termStartDate:null;e.setDefaultDate(null!=o?o:null)}},t.prototype.setTermDates=function(e,t){this._termStartDate=e,this._termEndDate=t},t.hideTopicMoveOptionsIfNecessary=function(){var e=t.getAllTopicCardContainers(!0);e.length>0&&$.each(e,function(n,i){var s=$(i).find(CCL.CommonFunctions.getDataSelector(t.planner.data.DropDownMenuClientId)).attr("data-"+t.planner.data.DropDownMenuClientId);if(s){var o=$(document).find("#"+s);o&&(o.find(CCL.CommonFunctions.getDataSelector(t.planner.data.TopicMoveUpMenu)+","+CCL.CommonFunctions.getDataSelector(t.planner.data.TopicMoveDownMenu)).show(),0===n&&o.find(CCL.CommonFunctions.getDataSelector(t.planner.data.TopicMoveUpMenu)).hide(),n===e.length-1&&o.find(CCL.CommonFunctions.getDataSelector(t.planner.data.TopicMoveDownMenu)).hide())}})},t.prototype.showPlanActionMenu=function(){$("."+t.planner.css.PlanActionMenu).show()},t.prototype.hidePlanMoveOptionsIfNecessary=function(){var e=this._planGrid.getRows();if(e.length>0){$("."+t.planner.css.PlanMoveUpMenuItem+CCL.CommonFunctions.getDataSelector(t.planner.data.TopicId,this._topicId)).show(),$("."+t.planner.css.PlanMoveDownMenuItem+CCL.CommonFunctions.getDataSelector(t.planner.data.TopicId,this._topicId)).show();var n=e.first().data(t.planner.data.GridRowId);$("."+t.planner.css.PlanMoveUpMenuItem+CCL.CommonFunctions.getDataSelector(t.planner.data.PlanId,n)).hide();var i=e.last().data(t.planner.data.GridRowId);$("."+t.planner.css.PlanMoveDownMenuItem+CCL.CommonFunctions.getDataSelector(t.planner.data.PlanId,i)).hide()}},t.topicExpanderLinkClick=function(e){e.preventDefault();var n=$(e.currentTarget),i=t.getParentTopicCardContainer(n),s=t.getInstanceByContainer(i),o=i.find("."+t.css.Plans),r=s.getTopicExpander(),a=s.getPlanGrid();r.toggleClass(t.css.TopicExpanded),r.hasClass(t.css.TopicExpanded)?(a.getFeedback().hide(),s.refreshPlanGrid(),n.prop("title",t.terms.CollapseTooltip)):n.prop("title",t.terms.ExpandTooltip),o.slideToggle("fast")},t.prototype.scrollToPlan=function(e){var n=this,i=0,s=window,o=!1;t.isIos&&window!==itslTop&&(i+=$('iframe[name="mainmenu"]',itslTop.document).offset().top,s=itslTop,o=!0),$("html, body",s.document).stop().animate({scrollTop:i+this.getPlanContainerById(e).offset().top-this._planGrid.getToolbarElement().outerHeight()},function(){t.isIos&&n._planGrid.updateFreezeState(o)})},t.prototype.changeDisplayMode=function(e){this.updateGridView(e);var n=!(e===t.planner.settings.DisplayModes.Timeline);t.planner.settings.UseTopics&&(n=n&&this.isTopicExpanded()),n&&this.refreshPlanGrid()},t.disableMenuItems=function(e,t,n,i,s){$.each(e,function(e,o){var r=$(o),a=r.parent("li"),l=r.html(),c=r.attr("class");if(a.children("span."+n).remove(),t){a.addClass(i),r.hide();var d=$("<span>").attr("class",c).attr("disabled","disabled").addClass(n).html(l);null!=s&&d.prop("title",s),r.after(d)}else a.removeClass(i),r.show()})},t.prototype.disablePlanMenu=function(e,n){var i=this._container.find("."+t.css.PlanGridToolbar).children("."+t.css.PlanGridToolbarItemsLeft).find("."+t.css.IconLink);t.disableMenuItems(i,e,t.css.DisabledMenuItem,t.css.DisabledMenuItemContainer,n)},t.prototype.toggleDisablePlanActionMenu=function(e){var n=this._container.find($("."+t.planner.css.PlanActionMenu));$.each(n,function(n,i){var s=$(i);s.toggleHyperlink(!e),s.prop("title",e?t.terms.DisabledMenuItemTooltip:"")})},t.prototype.removePlanGridMessage=function(){this._planGrid.removeGridMessage()},t.prototype.scrollToSelectedPlanOnLoad=function(e){var n=this;e<=0||setTimeout(function(){n._container.find("."+t.planner.css.HtmlTextCellViewer+" img[height]").each(function(e,t){var n=$(t),i=parseInt(n.attr("height"))/parseInt(n.attr("width"));isNaN(i)||n.height()||(n.addClass("temp-height"),n.height(i*n.width()))}),n.scrollToPlan(n._settings.PlanIdToScroll),$(window).one("resize",function(){$(".temp-height").removeClass("temp-height").height("")})},500)},t.getTopicCardInstanceName=function(e){return t.commonSettings.TopicCardInstanceNamePrefix+e},t.prototype.isTopicExpanded=function(){return this._topicExpander.hasClass(t.css.TopicExpanded)},t.prototype.refreshCell=function(t,n){switch(t.ColumnType){case e.ColumnType.Date:this.refreshDateCell(t);break;case e.ColumnType.LearningObjectives:this.refreshPlanLoCell(t);break;case e.ColumnType.Resources:case e.ColumnType.Activities:case e.ColumnType.Elements:this.refreshElementCell(t),n.needToReloadFolders=!0}},t.prototype.refreshDateCell=function(t){e.Cells.Plan.DateCell.PlanDateCell.getPlanDateCellInstance().updateContent(t.Content,t.PlanId,t.Properties.planActive),t.Properties.expanderText&&this.updateTopicExpanderLink(t.Properties.expanderText)},t.prototype.refreshElementCell=function(t){e.Cells.Plan.ResourcesCell.PlanActivityResourceCell.getPlanActivityResourceCellInstance().updateContent(t.Content,t.PlanId,t.ColumnId,!1,!1)},t.prototype.refreshPlanLoCell=function(t){e.Cells.Plan.LearningObjectivesCell.PlanLearningObjectivesCell.getPlanLearningObjectivesCellInstance().updateContent(t.Content,t.PlanId)},t.prototype.attachEvents=function(){var e=this;t.planner.settings.ReadOnlyMode||($(document).on(t.planner.events.PlanActivationChanged,function(t,n){var i=n.planActivations;null!=i&&$.each(i,function(t,n){e.getPlanContainerById(n.planId).length>0&&e._planGrid.toggleRowStatus(n.planId,n.planActive)})}),this._planGrid.getGridElement().on(CclResponsiveGrid.LoadingCompletedEventName,function(){e.showPlanActionMenu(),e.toggleTopicSelection(),e.hidePlanMoveOptionsIfNecessary()})),this._planGrid.getGridElement().on(CclResponsiveGrid.LoadingCompletedEventName,function(){e.loadLargePlanTextContent(),null!=e._planIdToScroll&&(e.scrollToSelectedPlanOnLoad(e._planIdToScroll),e._planIdToScroll=null)}),this._topicExpanderLink.click(t.topicExpanderLinkClick),this._topicCheckBox&&this._topicCheckBox.change(function(){return e.toggleTopicSelection()}),t.planner.settings.ReadOnlyMode||this._topicColorPickerLink.click(function(){e._container.off(t.planner.events.ColorPickerColorChange),e._topicId>0&&(t.planner.getTopicColorPicker().setupAndOpenTopicColorPicker(e._topicId),e._container.on(t.planner.events.ColorPickerColorChange,function(n,i){t.planner.getTopicColorPicker().updateTopicColor(e._topicId,i)}))})},t.prototype.loadLargePlanTextContent=function(){this._planGrid.totalCount>0&&(this.loadingLargePlanContentCompleted=!1,this._planGrid.addGridLoadingMessage(),t.planner.loadLargePlanTextContent(this._topicId))},t.prototype.updateGridView=function(e){this._planGrid.ajaxSettings.dataSourceWebMethodParams.currentDisplayMode=e,this._planGrid.setMode(e===t.planner.settings.DisplayModes.Table?t.planner.css.GridViewModes.TableView:t.planner.css.GridViewModes.DefaultView)},t.startLoadingMonitor=function(){if(null==t.planLoadingProcessId){t.planner.toggleEnableDisplayModeSwitcher(!1);var n=t.getAllTopicCards();t.planLoadingProcessId=setInterval(function(){var i=!0;$.each(n,function(e,t){return!(t.getPlanGrid().isLoadingInProgress()||!t.loadingLargePlanContentCompleted)||(i=!1,!1)}),i&&(clearTimeout(t.planLoadingProcessId),t.planLoadingProcessId=null,t.planner.toggleEnableDisplayModeSwitcher(!0),t.planner.settings.ReadOnlyMode||e.Cells.Plan.ResourcesCell.PlanActivityResourceCell.getPlanActivityResourceCellInstance().initDragAndDrop())},500)}},t.planLoadingProcessId=null,t}();t.TopicCard=n}(e.Cards||(e.Cards={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(){function n(t,i){window[t]=this,n.instanceName=t,this.settings=i,this.css=this.settings.Css,this._planner=e.Planner.getInstance()}return n.getInstance=function(){return window[n.instanceName]},n.prototype.togglePlanContentExpanderLink=function(e,t,n){var i=$(e);i.hasClass(this.css.ExpanderLinkExpanded)?this.collapsePlanContentItems(i):this.expandPlanContentItems(i,t,n)},n.prototype.collapsePlanContentItems=function(e){var t=e.parent().find("li").toArray();t.splice(0,this.settings.MaxCountOfPlanContentItemsToDisplay),$.each(t,function(e,t){$(t).hide()}),e.children("span").first().text(this.settings.Terms.ShowMore),e.removeClass(this.css.ExpanderLinkExpanded)},n.prototype.expandPlanContentItems=function(e,t,n){if(e.parent().find("ul").hasClass(this.css.ContentListPartiallyLoaded))n&&n(e);else{var i=e.parent().find("li").toArray();i.splice(0,this.settings.MaxCountOfPlanContentItemsToDisplay),$.each(i,function(e,t){$(t).show()}),e.children("span").first().text(this.settings.Terms.ShowLess),e.addClass(this.css.ExpanderLinkExpanded)}},n.prototype.loadAllPlanElements=function(e,n,i){var s,o=this;s=null==this._planner.settings.PublicAccessKey?{courseId:this._planner.settings.CourseId,planId:n,columnId:i,childId:this._planner.settings.ChildId,dashboardHierarchyId:this._planner.settings.DashboardHierarchyId,dashboardName:this._planner.settings.DashboardName}:{publicAccessKey:this._planner.settings.PublicAccessKey,planId:n,columnId:i},$.get(this.settings.WebMethods.LoadAllPlanElements,$.param(s,!0)).done(function(s){o._planner.settings.ReadOnlyMode?e.closest("."+o._planner.getPlannerCellCssClass()).html(s.ControlHtml):t.ResourcesCell.PlanActivityResourceCell.getPlanActivityResourceCellInstance().updateContent(s.ControlHtml,n,i,!1,!1)}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})},n.prototype.loadAllLearningObjectives=function(e,n){var i,s=this;i=null==this._planner.settings.PublicAccessKey?{courseId:this._planner.settings.CourseId,planId:n,childId:this._planner.settings.ChildId}:{publicAccessKey:this._planner.settings.PublicAccessKey,planId:n},CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.LoadAllPlanLearningObjectives,data:i}).done(function(i){s._planner.settings.ReadOnlyMode?e.closest("."+s._planner.getPlannerCellCssClass()).html(i.ControlHtml):t.LearningObjectivesCell.PlanLearningObjectivesCell.getPlanLearningObjectivesCellInstance().updateContent(i.ControlHtml,n)}).fail(CCL.CommonFunctions.alertAjaxError)},n}();t.PlanExpandableContentCellCommonLogic=n}(t.Plan||(t.Plan={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(n){!function(n){!function(n){var i=function(){function n(e,t,n){this.fileUploadInProgress=!1,this.fakeElementItemId="fakeElementItemId",this.uploadProgressDataAttributeName="upload-in-progress",this.settings=e,this.courseId=t,this.controls=n}return n.prototype.multipleFilesUploadedToResourcesCell=function(e,t){var n=new CCL.CommonWindowMessages.GenericMessage("showMultipleFilesUploadToPlannerFeedback"),i={planId:e,columnId:t,uploadStarted:!0};CCL.CommonFunctions.makePostMessageCallWithData(window.itslTop,n,i)},n.prototype.attachEvents=function(){var n=this;$(document).on("click","."+this.settings.Css.RemoveFromPlanLink,function(e){var t=$(e.currentTarget);n.removeElementFromPlan(t)}).on("click","."+this.settings.Css.AddElementMenuItem+", ."+this.settings.Css.AddElementShowAllMenuItem,function(i){var s=$(i.currentTarget);switch(n.getDataAttributeValueAsNumber(s,t.PlannerConstants.dataAttributes.ElementExternalSource)){case e.AddResourceMenu.ElementExternalSourceType.Library:n.addFromLibrary(s);break;case e.AddResourceMenu.ElementExternalSourceType.Course:n.addFromCourse(s);break;case e.AddResourceMenu.ElementExternalSourceType.Computer:1===n.getDataAttributeValueAsNumber(s,n.uploadProgressDataAttributeName)?CCL.CommonFunctions.jAlertAjaxError(n.settings.Terms.WaitUntilPreviousFileIsUploaded,"",n.settings.Terms.Ok,!1):n.addFromComputer(s)}CCL.AlternativeChoiceManager.closeOpenedDialog()}).on("click","."+this.settings.Css.AddElementLink,function(e){n.openElementSelector($(e.currentTarget))}),this.attachSpecificEvents()},n.prototype.openElementSelector=function(n){var i=this,s=this.getPlanId(n),o=this.getElementType(n),r=this.getColumnId(n),a=this.getFolderId(n),l=this.settings.ElementSelectorClientInstanceNameTemplate.replace("{0}",o.toString()),c=window[l],d=c.getFirstColumn().find("a");d.each(function(e,t){var n=$(t);n.attr("href",i.updateAddLinkUrl(n.attr("href"),s,a))}),c.getSecondColumn().find("a").each(function(e,n){$(n).attr("data-"+t.PlannerConstants.dataAttributes.PlanId,s).attr("data-"+t.PlannerConstants.dataAttributes.ColumnId,r).attr("data-"+t.PlannerConstants.dataAttributes.FolderId,a)});var u=c.getSecondColumn().find(CCL.CommonFunctions.getDataSelector(t.PlannerConstants.dataAttributes.ElementExternalSource,e.AddResourceMenu.ElementExternalSourceType.Computer));u.css("opacity",this.fileUploadInProgress?"0.5":""),u.attr("data-"+this.uploadProgressDataAttributeName,this.fileUploadInProgress?"1":"0"),c.openDialog(n,this.getElementDialogOffset()),CCL.CommonFunctions.isMobileDevice()||d.first().focus()},n.prototype.deletePlanElement=function(e,t,n){var i={courseId:this.courseId,planId:e,elementId:t,deleteFromCourse:n};return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.DeletePlanElement,data:i}).fail(CCL.CommonFunctions.alertAjaxError)},n.prototype.addFromLibrary=function(e){var n=this.getDataAttributeValueAsNumber(e,t.PlannerConstants.dataAttributes.ElementType),i=this.getDataAttributeValueAsNumber(e,t.PlannerConstants.dataAttributes.PlanId),s=this.getDataAttributeValueAsNumber(e,t.PlannerConstants.dataAttributes.FolderId),o=this.getDataAttributeValueAsNumber(e,t.PlannerConstants.dataAttributes.ColumnId),r=this.getLibraryBrowserDialog(),a={RelatedEntityId:i,ElementCategory:this.getElementCategoryAsStringByElementType(n),FolderId:s,CustomId:o.toString()};a.LearningObjectivesIds=this.getLearningObjectiveIds(i,!0),r.browseLibrary(a)},n.prototype.addFromCourse=function(n){var i=this,s=this.getDataAttributeValueAsNumber(n,t.PlannerConstants.dataAttributes.ElementType),o=this.getDataAttributeValueAsNumber(n,t.PlannerConstants.dataAttributes.PlanId),r=this.getDataAttributeValueAsNumber(n,t.PlannerConstants.dataAttributes.ColumnId),a={locationId:this.courseId,locationType:e.AddResourceMenu.ElementExternalSourceType.Course},l=[],c=new Map;this.loadCurrentElementStates(o,r,c);var d={elementStates:c,elementType:s,showAll:!1,header:this.getElementLinkDialogTitle(s),afterOkClickCallback:function(t){t&&(t.forEach(function(t,n){t!==e.CheckboxStateMachine.State.AttachedByUser&&t!==e.CheckboxStateMachine.State.Saved||l.push(n)}),l.length>0&&i.updatePlanElements(o,l,r))},allowFolderSelection:s!==e.ElementLinkDialog.ContentElementType.Activities,openerPage:e.ElementLinkDialog.ElementsPopupOpener.Plan,relatedEntityId:o};e.ElementLinkDialog.elementLinkDialogManagerInstance.openDialog(d,a)},n.prototype.addFromComputer=function(e){this.currentPlanId=this.getDataAttributeValueAsNumber(e,t.PlannerConstants.dataAttributes.PlanId),this.currentColumnId=this.getDataAttributeValueAsNumber(e,t.PlannerConstants.dataAttributes.ColumnId),$("#"+Components.ComponentName.localPicker).click()},n.prototype.onFileUploadSuccess=function(e){var t=this;this.fileUploadInProgress&&CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.CreateNewFileForPlan,data:{courseId:this.courseId,planId:this.currentPlanId,fileName:e.name,fileId:e.id,signedFileId:e.signature}}).done(function(e){e.Success?t.refreshResourcesCell(t.currentPlanId,t.currentColumnId,!0):($("#"+t.fakeElementItemId).remove(),CCL.CommonFunctions.jAlertAjaxError(t.settings.Terms.SomethingWentWrong,t.settings.Terms.ErrorOccurred,t.settings.Terms.Ok,!1))}).fail(function(){$("#"+t.fakeElementItemId).remove(),CCL.CommonFunctions.jAlertAjaxError(t.settings.Terms.SomethingWentWrong,t.settings.Terms.ErrorOccurred,t.settings.Terms.Ok,!1)}).always(function(){t.fileUploadInProgress=!1,t.currentColumnId=void 0,t.currentPlanId=void 0})},n.prototype.onFileUploadFailed=function(e,t){var n=this;this.fileUploadInProgress=!1,CCL.CommonFunctions.jAjaxConfirm(t,this.settings.Terms.FailedFileUploadChoiceDialogTitle,this.settings.Terms.FailedFileUploadChoiceDialogUploadNewFile,this.settings.Terms.FailedFileUploadChoiceDialogCancel,function(e){e?$("#"+Components.ComponentName.localPicker).click():(n.currentColumnId=void 0,n.currentPlanId=void 0)}),$("#"+this.fakeElementItemId).remove()},n.prototype.onFileSelected=function(e){this.fileUploadInProgress=!0;var t='<li id="'+this.fakeElementItemId+'" class="'+this.settings.Css.ActivityResourceListItem+'">\n    <div class="'+this.settings.Css.FakeElementContainer+'">\n        <i class="'+this.settings.Css.FakeElementTitle+'">'+e[0].name+"</i>\n    </div>\n</li>";this.getActivityResourceList(this.currentPlanId,this.currentColumnId).append($(t)),$("#"+this.fakeElementItemId+" ."+this.settings.Css.FakeElementContainer).prepend($(this.controls.LoadingWheel).addClass(""+this.settings.Css.FakeElementImage))},n.prototype.updatePlanElements=function(e,t,n){var i=this;return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.UpdatePlanElements,data:{courseId:this.courseId,planId:e,elementIds:t,columnId:n}}).done(function(){i.refreshResourcesCell(e,n,!0)}).fail(CCL.CommonFunctions.alertAjaxError)},n.prototype.getDataAttributeValueAsNumber=function(e,t){return parseInt(e.attr("data-"+t),10)},n.prototype.getElementLinkDialogTitle=function(t){return t===e.ElementLinkDialog.ContentElementType.Activities?this.settings.Terms.AddActivityModalTitle:this.settings.Terms.AddResourceModalTitle},n.prototype.getElementCategoryAsStringByElementType=function(n){switch(n){case e.ElementLinkDialog.ContentElementType.Resources:return t.ElementCategory[t.ElementCategory.Resource];case e.ElementLinkDialog.ContentElementType.Activities:return t.ElementCategory[t.ElementCategory.Activity];default:return}},n.prototype.loadCurrentElementStates=function(t,n,i){CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.GetPlanElements,data:{courseId:this.courseId,planId:t,columnId:n}}).done(function(t){t&&$.each(t.elementIds,function(t,n){i.set(n,e.CheckboxStateMachine.State.Saved)})}).fail(CCL.CommonFunctions.alertAjaxError)},n.prototype.getPlanContainer=function(e){return e.closest("."+this.settings.Css.PlanContainer)},n.prototype.updateAddLinkUrl=function(e,t,n){for(var i=e.lastIndexOf("?"),s=e.substring(0,i),o=e.substring(i+1).split("&"),r=0;r<o.length;r++){var a=o[r].substring(0,o[r].indexOf("="));a.toLowerCase()===this.settings.RequestParameters.FolderId.toLowerCase()?o[r]=a+"="+n:a.toLowerCase()===this.settings.RequestParameters.RelatedEntityId.toLowerCase()&&(o[r]=a+"="+t)}return s+"?"+o.join("&")},n.prototype.getElementType=function(e){return this.getDataAttributeValueAsNumber(e,t.PlannerConstants.dataAttributes.ElementType)},n}();n.PlanResourcesCellBase=i}(n.ResourcesCell||(n.ResourcesCell={}))}(n.Plan||(n.Plan={}))}(t.Cells||(t.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){!function(n){var i=function(n){function i(t,s,o){n.call(this,s,s.CourseId,o),window[t]=this,i.instanceName=t,this.attachEvents(),this.cbPlanner=e.CbPlanner.getInstance()}return __extends(i,n),i.getPlanActivityResourceCellInstance=function(){return window[i.instanceName]},i.onFileUploadSuccess=function(e){i.getPlanActivityResourceCellInstance().onFileUploadSuccess(e)},i.onFileUploadFailed=function(e,t){i.getPlanActivityResourceCellInstance().onFileUploadFailed(e,t)},i.onFileSelected=function(e){i.getPlanActivityResourceCellInstance().onFileSelected(e)},i.prototype.refreshResourcesCell=function(e,t,n){this.reloadPlanElements(e,t),n&&this.measureKpiEditPlan()},i.prototype.refreshResourcesCellWithElement=function(t){var n=this.cbPlanner.getContainer().find("."+this.settings.Css.ActivityResourceListItem+CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.ElementId,t));n&&this.reloadPlanElements(this.getPlanId(n),this.getColumnId(n))},i.prototype.attachSpecificEvents=function(){var e=this;$(document).on("click","."+this.settings.Css.AddHomework,function(t){e.openElementSelector($(t.currentTarget))})},i.prototype.removeElementFromPlan=function(t){var i=this,s=t.closest("."+this.settings.Css.ActivityResourceListItem),o=this.getPlanId(t),r=this.getDataAttributeValueAsNumber(s,e.PlannerConstants.dataAttributes.ElementId);n.prototype.deletePlanElement.call(this,o,r,!1).done(function(){s.remove(),i.measureKpiEditPlan()})},i.prototype.getLibraryBrowserDialog=function(){return this.cbPlanner.getLibraryBrowserDialog()},i.prototype.getActivityResourceCell=function(e,t){return this.getActivityResourceList(e,t).closest("."+this.settings.Css.CbCellContainer)},i.prototype.getActivityResourceList=function(t,n){return $("."+this.settings.Css.PlanContainer+CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.PlanId,t)).find("."+this.settings.Css.ActivityResourceCell)},i.prototype.getLearningObjectiveIds=function(e,n){var i=t.LearningObjectivesCell.PlanLearningObjectivesCellBase.getPlanLearningObjectivesCellInstance();return i?i.getLearningObjectiveIds(e,n):[]},i.prototype.measureKpiEditPlan=function(){this.cbPlanner.measureEditPlan()},i.prototype.reloadPlanElements=function(e,t){var n=this;CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.ReloadPlanElements,data:{courseId:this.courseId,planId:e,columnId:t}}).done(function(i){n.getActivityResourceCell(e,t).html(i.ControlHtml)}).fail(CCL.CommonFunctions.alertAjaxError)},i.prototype.getPlanId=function(t){var n=this.getPlanContainer(t);return this.getDataAttributeValueAsNumber(n,e.PlannerConstants.dataAttributes.PlanId)},i.prototype.getColumnId=function(e){return 0},i.prototype.getElementDialogOffset=function(){return-35},i.prototype.getFolderId=function(t){var n=this.getPlanContainer(t);return this.getDataAttributeValueAsNumber(n,e.PlannerConstants.dataAttributes.FolderId)},i}(n.PlanResourcesCellBase);n.PlanCbResourcesCell=i}(t.ResourcesCell||(t.ResourcesCell={}))}(t.Plan||(t.Plan={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(t,n){var i=this;this.name=t,this.settings=n,window[this.name]=this,e.instanceName=this.name,this.settings=n,this.$useTopicsCheckbox=$("#"+this.settings.ClientIds.UseTopics),this.topicColumnsGrid=window[this.settings.TopicColumnsGridInstanceName],this.planColumnsGrid=window[this.settings.PlanColumnsGridInstanceName],this.$enableAnonymousAccessCheckbox=$("#"+this.settings.ClientIds.EnableAnonymousAccess),this.$addPlanRichTextColumnLink=$("#"+this.settings.ClientIds.AddPlanColumnLink),this.$addTopicCustomColumnLink=$("#"+this.settings.ClientIds.AddTopicCustomColumnLink),this.$topicCustomLimitMessage=$("#"+this.settings.ClientIds.TopicCustomLimitMessage),this.countOfPlanRichTextColumns=this.settings.PlanRichColumnsCount,this.countOfTopicCustomColumns=this.settings.PlanTopicCustomColumnsCount,this.deletedTopicColumns=new Array,this.deletedPlanColumns=new Array,$(function(){i.toggleTopicSettings(),i.togglePublicCopyLink(),i.togglePlanDefaultStatusContainer(),i.toggleAddPlanRichTextColumnLink(),i.toggleAddTopicCustomColumnLink(),i.toggleElementsColumns(),i.disableDragAndDropForColumnsByIds(i.settings.NotReorderableTopicColumnIds,!0),i.disableDragAndDropForColumnsByIds(i.settings.NotReorderablePlanColumnIds,!1),i.attachEvents(),i.findRowTeplates()})}return e.getInstance=function(){return window[e.instanceName]},e.prototype.deleteCustomColumn=function(e,t){var n=this,i=$(e),s=i.closest("."+this.settings.Css.GridRow);return i.data(this.settings.DataAttributes.HasData)?this.showConfirmDialog(t?this.settings.Terms.DeleteCustomTopicColumnConfirmText:this.settings.Terms.DeleteCustomPlanColumnConfirmText,function(e){e&&(n.cacheDeletedItem(s,t),s.remove())}):(this.cacheDeletedItem(s,t),s.remove()),t?(this.countOfTopicCustomColumns--,this.toggleAddTopicCustomColumnLink()):(this.countOfPlanRichTextColumns--,this.toggleAddPlanRichTextColumnLink()),!1},e.prototype.afterOpenCopyPublicLinkDialog=function(){CCL.CommonFunctions.safeAjaxPost({url:this.settings.MeasureCopyPublicLinkUrl})},e.prototype.save=function(){var e=!0;return this.$useTopicsCheckbox.prop("checked")&&(e=this.validateColumnNames(this.topicColumnsGrid,!0)),(e=this.validateColumnNames(this.planColumnsGrid,e)&&e)?(this.collectDataForSaving(),!0):(event.stopPropagation(),!1)},e.prototype.showConfirmDialog=function(e,t){CCL.CommonFunctions.jAjaxConfirm(e,this.settings.Terms.ConfirmTitle,this.settings.Terms.Yes,this.settings.Terms.No,t)},e.prototype.cacheDeletedItem=function(e,t){var n={};n.Id=e.data(this.settings.DataAttributes.GridRowId),n.IsDeleted=!0,n.Id>0&&(t?this.deletedTopicColumns.push(n):this.deletedPlanColumns.push(n))},e.prototype.addTopicCustomColumn=function(){this.$addTopicCustomColumnLink.getIfHyperLinkEnabled()&&(this.addGridRow(this.topicColumnsGrid,this.$topicColumnTemplate),this.countOfTopicCustomColumns++,this.toggleAddTopicCustomColumnLink())},e.prototype.addPlanCustomColumn=function(){this.$addPlanRichTextColumnLink.getIfHyperLinkEnabled()&&(this.addGridRow(this.planColumnsGrid,this.$planColumnTemplate),this.countOfPlanRichTextColumns++,this.toggleAddPlanRichTextColumnLink())},e.prototype.findRowTeplates=function(){this.$topicColumnTemplate=this.topicColumnsGrid.getRowById(this.settings.TemplateColumnId),this.$topicColumnTemplate.detach(),this.$planColumnTemplate=this.planColumnsGrid.getRowById(this.settings.TemplateColumnId),this.$planColumnTemplate.detach()},e.prototype.addGridRow=function(e,t){var n=t.clone(!0).data(this.settings.DataAttributes.GridRowId,this.settings.NewColumnId);e.getRowsContainer().append(n);var i=t.find(this.settings.ShowOnCoursePageInputSelector);if(i.length>0){var s=CCL.CommonFunctions.formatString(this.settings.ToggleInstanceNameTemplate,i[0].id),o=window[s],r=s+"_clone"+(new Date).getTime();o.clone(n,r)}n.find("input."+this.settings.Css.ColumnTitle).focus()},e.prototype.validateColumnNames=function(e,t){var n,i=this,s=!0;return e.getRowsContainer().find("input."+this.settings.Css.ColumnTitle+":visible").each(function(e,t){var o=$(t);s=i.validateColumnName(o)&&s,null!=n||s||(n=o)}),null!=n&&t&&window.scrollTo(0,n.offset().top),s},e.prototype.validateColumnName=function(e){return 0===e.val().trim().length?(e.parent().find("."+this.settings.Css.ErrorContainer).css("visibility","visible"),!1):(e.parent().find("."+this.settings.Css.ErrorContainer).css("visibility",""),!0)},e.prototype.toggleTopicSettings=function(){var e=this.$useTopicsCheckbox.prop("checked");$("#"+this.settings.ClientIds.TopicsHolder).toggle(e);var t=$("#"+this.settings.ClientIds.CreateFolderForEachNewTopic);e?(t.removeProp("readonly"),t.off("click",this.disabledCheckboxOnClick)):(t.prop("readonly","readonly"),t.on("click",this.disabledCheckboxOnClick))},e.prototype.togglePublicCopyLink=function(){var e=this.$enableAnonymousAccessCheckbox.prop("checked");$("#"+this.settings.ClientIds.CopyPublicLink).toggle(e)},e.prototype.togglePlanDefaultStatusContainer=function(){var e=$("#"+this.settings.ClientIds.PlanActivationTypeDropdown).val()===this.settings.PlanActivationTypeManually;$("#"+this.settings.ClientIds.AutoActivationInfoContainer).toggle(!e),$("#"+this.settings.ClientIds.PlanDefaultStatusContainer).toggle(e)},e.prototype.toggleElementsColumns=function(){for(var e=$("#"+this.settings.ClientIds.ElementColumnsRadioList+" input:checked").val()===this.settings.UseGenericElementsColumn,t=this.planColumnsGrid,n=0;n<this.settings.SeparateElementColumnIds.length;n++)$(t.getRowById(this.settings.SeparateElementColumnIds[n])).toggle(!e);$(t.getRowById(this.settings.GenericElementsColumnId)).toggle(e)},e.prototype.setDefaultSelfPacePlanWorkflow=function(){$("#"+this.settings.ClientIds.SelfPacedPlanTypeRadioButton+":checked").length>0&&$("#"+this.settings.ClientIds.PlanWorkflowRadioListLinearRadioButton).prop("checked",!1)},e.prototype.reorderFieldSuccess=function(){$("#"+this.settings.ClientIds.ReorderDataHiddenField).val("true")},e.prototype.collectDataForSaving=function(){if(this.$useTopicsCheckbox.prop("checked")){var e=$("#"+this.settings.ClientIds.TopicColumnDataHiddenField),t=this.topicColumnsGrid.getRowsContainer().find("."+this.settings.Css.GridRow);this.collectData(e,t,this.deletedTopicColumns)}var n=$("#"+this.settings.ClientIds.PlanColumnDataHiddenField),i=this.planColumnsGrid.getRowsContainer().find("."+this.settings.Css.GridRow);this.collectData(n,i,this.deletedPlanColumns)},e.prototype.collectData=function(e,t,n){var i=this,s=new Array;t.each(function(e,t){var o=$(t),r=o.find("."+i.settings.Css.ColumnTitle),a=o.find("."+i.settings.Css.ColumnType),l=o.find("."+i.settings.Css.ColumnVisibleFor),c=o.find(i.settings.ShowOnCoursePageInputSelector),d={};d.Id=o.data(i.settings.DataAttributes.GridRowId),d.Title=r.val().trim(),d.ColumnType=a.val(),d.VisibleFor=l.val(),d.ShowOnCoursePage=c.is(":checked"),d.IsDeleted=!1,s.push(d),s=s.concat(n)}),e.val(JSON.stringify(s))},e.prototype.attachEvents=function(){var e=this;this.$useTopicsCheckbox.on("change",function(){e.toggleTopicSettings()}),this.$enableAnonymousAccessCheckbox.on("change",function(){e.togglePublicCopyLink()}),$("#"+this.settings.ClientIds.PlanActivationTypeDropdown).on("change",function(){e.togglePlanDefaultStatusContainer()}),this.topicColumnsGrid.getRowsContainer().find("input."+this.settings.Css.ColumnTitle).on("input paste",function(t){var n=$(t.currentTarget);e.validateColumnName(n)}),this.planColumnsGrid.getRowsContainer().find("input."+this.settings.Css.ColumnTitle).on("input paste",function(t){var n=$(t.currentTarget);e.validateColumnName(n)}),$("#"+this.settings.ClientIds.ElementColumnsRadioList).on("change",function(){e.toggleElementsColumns()}),$("#"+this.settings.ClientIds.SelfPacedPlanTypeRadioButton).on("change",function(){e.setDefaultSelfPacePlanWorkflow()})},e.prototype.disableDragAndDropForColumnsByIds=function(e,t){for(var n=t?this.topicColumnsGrid:this.planColumnsGrid,i=0;i<e.length;i++)n.getRowById(e[i]).removeClass(this.settings.Css.ReorderableGridRow)},e.prototype.toggleAddPlanRichTextColumnLink=function(){var e=this.countOfPlanRichTextColumns<this.settings.MaxNumberOfRichTextColumnsInPlan;this.$addPlanRichTextColumnLink.toggleHyperlink(e),e?this.$addPlanRichTextColumnLink.removeAttr("title"):this.$addPlanRichTextColumnLink.attr("title",this.settings.Terms.AddPlanRichTextColumnLinkDisabledTooltip)},e.prototype.toggleAddTopicCustomColumnLink=function(){var e=this.countOfTopicCustomColumns<this.settings.MaxNumberOfTopicCustomColumns;this.$addTopicCustomColumnLink.toggleHyperlink(e),e?(this.$addTopicCustomColumnLink.removeAttr("title"),this.$topicCustomLimitMessage.hide()):(this.$addTopicCustomColumnLink.attr("title",this.settings.Terms.AddTopicCustomColumnLinkDisabledTooltip),this.$topicCustomLimitMessage.show())},e.prototype.disabledCheckboxOnClick=function(){return!1},e.prototype.CopyToClipboard=function(){var e=document.querySelector('[id$="SharePlanPublicLink"]').value;window.navigator.clipboard?window.navigator.clipboard.writeText(e):document.execCommand("copy"),document.getElementsByClassName("feedback")[0].setAttribute("style","visibility:visible")},e.prototype.HideFeedbackMessage=function(){"visible"==document.getElementsByClassName("feedback")[0].style.visibility&&document.getElementsByClassName("feedback")[0].setAttribute("style","visibility:hidden")},e}();e.CustomizePlanner=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){};e.CurrentParameters=t;var n=function(){function e(e,t){window[e]=this,this.settings=t,this.$container=$("#"+this.settings.Controls.ContainerId)}return e.prototype.clearContainer=function(){this.$container&&(this.$container.find("iframe,object").css("visibility","hidden"),this.$container.html(""))},e.prototype.openDialog=function(e,t,n,i,s){this.currentParameters||(this.currentParameters={}),this.currentParameters.EventId=t,this.currentParameters.CourseId=e,null!=n&&window[this.settings.Controls.DialogTarget].setTitle(n),null!=i&&(this.currentParameters.ViewForPersonId=i),null!=s&&(this.currentParameters.ChildId=s),this.clearContainer(),window[this.settings.Controls.DialogTarget].openDialog()},e.prototype.loadEventPlans=function(){if(this.currentParameters){var e=this.$container;e&&$.ajax({type:"GET",url:this.settings.WebMethods.GetEventPlansXhtml,async:!1,data:{courseId:this.currentParameters.CourseId,eventUniqueId:this.currentParameters.EventId,childId:null==this.currentParameters.ChildId?0:this.currentParameters.ChildId,viewForPersonId:null==this.currentParameters.ViewForPersonId?0:this.currentParameters.ViewForPersonId,dashboardHierarchyId:this.settings.DashboardHierarchyId}}).done(function(t){e.html(t.contentHtml),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(e)}).fail(function(t){return e.html(t.responseText)})}},e.prototype.togglePlanDetails=function(e,t,n,i,s,o){var r=this,a=this,l=$(e),c=l.parent().find("."+this.settings.CssClasses.PlanContainerCss),d=c.is(":visible");l.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.PlanDetailsExpanderImage)).toggleClass(this.settings.CssClasses.ForwardImage,d).toggleClass(this.settings.CssClasses.ChevronDownImage,!d),c.data(this.settings.DataAttributes.PlanDetailsContentLoaded)||$.ajax({type:"GET",url:this.settings.WebMethods.GetSinglePlanXhtml,async:!1,data:{courseId:t,planId:n,childId:i,viewForPersonId:s,showFullPlannerLink:o,dashboardHierarchyId:this.settings.DashboardHierarchyId}}).done(function(e){c.html(e.contentHtml),c.data(a.settings.DataAttributes.PlanDetailsContentLoaded,"true"),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(c)}).fail(function(e){return c.html(e.responseText)}),c.slideToggle("fast",function(){l.prop("title",c.is(":visible")?r.settings.Terms.HideDetails:r.settings.Terms.ViewDetails),c.css("overflow","")})},e}();e.EventPlansDialog=n}(e.Dialogs||(e.Dialogs={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(){function t(n,i){var s=this;window[n]=this,t.instanceName=n,this._settings=i,this._planner=e.Planner.getInstance(),document.getElementById(i.MoveToTopicOkButtonId).addEventListener("click",function(){s.movePlansToTopicOkBtnClick()},!1),document.getElementById(i.MoveToTopicCancelButtonId).addEventListener("click",function(){s.movePlansToTopicCancelBtnClick()},!1)}return t.getInstance=function(){return window[t.instanceName]},t.prototype.openDialog=function(t,n){void 0===n&&(n=null);var i=e.Cards.TopicCard.getInstance(t);null==n&&(n=i.getSelectedPlanIds(!0)),null!=n&&(this.initTopicDropDownListControl(),this._topicId=t,this._planIds=n,this.reloadTopicList(),this._topicDropDownList.value=t.toString(),this._topicDropDownList.childNodes.length>0&&this.getCssModal().openDialog())},t.prototype.movePlansToTopicOkBtnClick=function(){var t=this,n=this._topicId,i=Number.parseInt(this._topicDropDownList.value);if(n!=i){var s=e.Cards.TopicCard.getInstance(n),o=e.Cards.TopicCard.getInstance(i),r=s.getPlanGrid(),a=o?o.getPlanGrid():null;CCL.CommonFunctions.safeAjaxPost({url:this._planner.webMethods.Plan.MovePlansToTopic,data:{courseId:this._planner.settings.CourseId,srcTopicId:n,dstTopicId:i,planIds:this._planIds,start:this._planner.settings.FilterStartDate,end:this._planner.settings.FilterEndDate,showPlanDates:this._planner.settings.ShowDates}}).done(function(e){if(r.toggleSelectAll(!1),s.hasPlans=e.srcTopicHasPlans,o&&a){a.removeEmptyText();var n=!o.hasPlans&&t._planner.currentDisplayMode===t._planner.settings.DisplayModes.Table;o.hasPlans=!0}if(a&&a.getGridElement().is(":visible"))if(n){o.refreshPlanGrid();for(var i=0;i<e.sortedPlanIds.length;i++)r.getRowById(e.sortedPlanIds[i]).remove()}else{for(var l=a.getRowsContainer(),c=0;c<e.sortedPlanIds.length;c++)l.append(r.getRowById(e.sortedPlanIds[c]));t._planner.currentDisplayMode===t._planner.settings.DisplayModes.Table&&a.updateHeaderRowCheckBoxSelection(),o&&o.isTopicSelected()&&o.toggleTopicSelection()}else for(i=0;i<e.sortedPlanIds.length;i++)r.getRowById(e.sortedPlanIds[i]).remove();0===r.getRowsCount()&&r.getRowsContainer().html(e.emptyGridText),s.updateTopicExpanderLink(e.srcExpanderText),s.hidePlanMoveOptionsIfNecessary(),o&&(o.updateTopicExpanderLink(e.dstExpanderText),o.hidePlanMoveOptionsIfNecessary()),CssModal.closeDialog()}).always(function(e){t.emptyTopicDropdownListControl()})}else CssModal.closeDialog()},t.prototype.movePlansToTopicCancelBtnClick=function(){this.emptyTopicDropdownListControl()},t.prototype.initTopicDropDownListControl=function(){null==this._topicDropDownList&&(this._topicDropDownList=document.getElementById(this._settings.TopicDropDownListId))},t.prototype.emptyTopicDropdownListControl=function(){for(;this._topicDropDownList.lastChild;)this._topicDropDownList.removeChild(this._topicDropDownList.lastChild)},t.prototype.reloadTopicList=function(){var e=this;this.emptyTopicDropdownListControl(),CCL.CommonFunctions.safeAjax({url:this._planner.webMethods.Topic.GetTopicIdsAndNames+"/"+this._planner.settings.CourseId,async:!1}).done(function(t){for(var n in t){var i=t[n],s=document.createElement("option");s.appendChild(document.createTextNode(i)),s.value=n,e._topicDropDownList.appendChild(s)}})},t.prototype.getCssModal=function(){return window[this._settings.MoveToTopicCssModalId]},t}();t.PlanMoveToTopicDialog=n}(e.Dialogs||(e.Dialogs={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t,n;!function(e){e[e.Initial=0]="Initial",e[e.Progress=1]="Progress",e[e.Error=2]="Error",e[e.Result=3]="Result"}(t||(t={})),function(e){e[e.CopyPlans=0]="CopyPlans",e[e.CopyTopics=1]="CopyTopics"}(n||(n={}));var i=function(){function i(e,t){this.settings=t,window[e]=this,i.instanceName=e,this.terms=t.Terms,this.css=t.Css,this.controls=t.Controls,this.webMethods=t.WebMethods,this.controlInitialized=!1}return i.prototype.open=function(e,i,s,o){if(null!=i){if(this.initControls(),this.idsToCopy=i(),e){if(null==this.idsToCopy||!this.idsToCopy.length)return void CCL.CommonFunctions.jAlertAjaxError(this.terms.NoTopicsSelected,this.terms.Alert,this.terms.Ok,!1);if(this.currentCopyMode=n.CopyTopics,1==this.idsToCopy.length){var r=document.querySelector('div[data-topic-id="'+this.idsToCopy[0]+'"] input[type="hidden"]').getAttribute("value");this.$selectCourseLabel.text(this.terms.CopyXTo.replace("{0}",r))}else this.$selectCourseLabel.text(this.terms.CopyTopicsToCourse)}else{if(null==this.idsToCopy||!this.idsToCopy.length)return void CCL.CommonFunctions.jAlertAjaxError(this.terms.NoPlansSelected,this.terms.Alert,this.terms.Ok,!1);this.currentCopyMode=n.CopyPlans,this.$selectCourseLabel.text(this.terms.CopyPlansToCourse)}this.clearSelectionCallback=s,this.topicIdForCopyPlans=o,this.setCopyStage(t.Initial),this.getCssModal().openDialog()}},i.prototype.copy=function(){this.$coursesList.val()?(this.setCopyStage(t.Progress),this.copyInternal(this.currentCopyMode===n.CopyPlans?this.webMethods.CopyPlans:this.webMethods.CopyTopics)):this.$selectCourseErrorContainer.show()},i.prototype.copyInternal=function(e){var n=this,i=this.$optionOverwriteAssessmentCriteria.length>0&&this.$optionOverwriteAssessmentCriteria.prop("checked");CCL.CommonFunctions.safeAjaxPost({url:e,data:{sourceCourseId:this.settings.CourseId,targetCourseId:parseInt(this.$coursesList.val()),targetTopicId:parseInt(this.$targetCourseTopicsDropdown.val()),copyDates:this.$optionCopyDates.prop("checked"),copyResourcesAndActivities:this.$optionCopyResourcesAndActivities.prop("checked"),overwriteAssessmentCriteria:i,elementIds:this.idsToCopy}}).done(function(e){n.$resultMessageHolder.html(e.ResultMessage),n.$resultNotesHolder.hide(),e.ResultWarningNotes.length>0&&(n.$resultNotesHolder.show(),n.$resultNotesHolder.find("ol").html(e.ResultWarningNotes).show()),n.setCopyStage(t.Result)}).fail(function(){n.setCopyStage(t.Error)})},i.prototype.updateTopicsDropdown=function(e){var n=this;0!==e&&(this.$targetCourseTopicsDropdown.children().remove(),CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.GetTopics,data:{courseId:this.settings.CourseId,targetCourseId:e,originalTopicId:this.topicIdForCopyPlans}}).done(function(e){0===e.length&&n.$targetCourseTopicsPanel.hide();var t=n.settings.TopicsDropdownDefaultValue,i=$.grep(e,function(e){return!e.IsNewGroup});t=n.addItemsToTopicDropdown(i,n.$targetCourseTopicsDropdown);var s=$.grep(e,function(e){return e.IsNewGroup});if(s.length){var o=$("<optgroup></optgroup>").attr("label",n.terms.CreateNewTopic);n.addItemsToTopicDropdown(s,o),o.appendTo(n.$targetCourseTopicsDropdown)}n.$targetCourseTopicsDropdown.val(t.toString())}).fail(function(){n.setCopyStage(t.Error)}))},i.prototype.addItemsToTopicDropdown=function(e,t){var n=this.settings.TopicsDropdownDefaultValue;return $.each(e,function(e,i){t.append($("<option />").val(i.TopicId.toString()).text(i.Name)),i.Selected&&(n=i.TopicId)}),n},i.prototype.getCssModal=function(){return window[this.settings.CssModalClientInstance]},i.prototype.initControls=function(){var e=this;this.controlInitialized||(this.$selectCourseLabel=$("#"+this.controls.SelectCourseLabel),this.$coursesList=$("#"+this.controls.CoursesList),this.$optionCopyDates=$("#"+this.controls.OptionCopyDates),this.$optionOverwriteAssessmentCriteria=$("#"+this.controls.OptionOverwriteAssessmentCriteria),this.$optionCopyResourcesAndActivities=$("#"+this.controls.OptionCopyResourcesAndActivities),this.$resultMessageHolder=$("#"+this.controls.ResultMessageHolder),this.$resultNotesHolder=$("#"+this.controls.ResultNotesHolder),this.$overwriteAssessmentCriteriaPanel=$("#"+this.controls.OverwriteAssessmentCriteriaPanel),this.$dialogCancelButton=$("#"+this.controls.DialogCancelButton),this.$dialogOkButton=$("#"+this.controls.DialogOkButton),this.$dialogCloseButton=$("."+this.css.DialogCloseButton),this.$initialPanel=$("#"+this.controls.InitialPanel),this.$progressPanel=$("#"+this.controls.ProgressPanel),this.$resultPanel=$("#"+this.controls.ResultPanel),this.$errorPanel=$("#"+this.controls.ErrorPanel),this.$copyOptions=$("#"+this.controls.CopyOptions),this.$targetCourseTopicsPanel=$("#"+this.controls.TargetCourseTopicsPanel),this.$targetCourseTopicsDropdown=$("#"+this.controls.TargetCourseTopicsList),this.$selectCourseErrorContainer=this.$initialPanel.find("."+this.css.CopyError),this.$coursesList.on("change",function(t){e.onCourseListChange(t)}),this.controlInitialized=!0)},i.prototype.setCopyStage=function(n){switch(n){case t.Initial:this.$coursesList.val(null),this.$optionCopyDates.prop("checked",!1),this.$optionCopyResourcesAndActivities.prop("checked",!0),this.$overwriteAssessmentCriteriaPanel.length>0&&(this.$overwriteAssessmentCriteriaPanel.show(),this.setOverwriteAssessmentCriteriaControlsState(e.CopyDialogOverwriteAssessmentCriteriaState.Show,!0)),this.$targetCourseTopicsPanel.hide(),this.$dialogOkButton.text(this.terms.Copy),this.$copyOptions.hide(),this.$selectCourseErrorContainer.hide();break;case t.Result:null!=this.clearSelectionCallback&&this.clearSelectionCallback();break;case t.Error:this.$dialogOkButton.text(this.terms.Retry)}this.$dialogCloseButton.toggle(n!==t.Progress),this.$dialogCancelButton.toggle(n!==t.Progress).text(n===t.Initial?this.terms.Cancel:this.terms.Close),this.$dialogOkButton.toggle(n===t.Initial||n===t.Error),this.$initialPanel.toggle(n===t.Initial),this.$progressPanel.toggle(n===t.Progress),this.$resultPanel.toggle(n===t.Result),this.$errorPanel.toggle(n===t.Error)},i.prototype.setOverwriteAssessmentCriteriaControlsState=function(t,n){this.$optionOverwriteAssessmentCriteria.length>0&&(this.$optionOverwriteAssessmentCriteria.prop("disabled",t===e.CopyDialogOverwriteAssessmentCriteriaState.Disable),this.$overwriteAssessmentCriteriaPanel.toggleClass(this.css.Inactive,t===e.CopyDialogOverwriteAssessmentCriteriaState.Disable),this.$overwriteAssessmentCriteriaPanel.find("#"+this.controls.OverwriteAssessmentCriteriaLabel).toggle(t===e.CopyDialogOverwriteAssessmentCriteriaState.Disable),n&&this.$optionOverwriteAssessmentCriteria.prop("checked",!1))},i.prototype.onCourseListChange=function(t){var i=$(t.currentTarget).val();if(this.$selectCourseErrorContainer.toggle(!i),this.$copyOptions.toggle(0!==i.length),this.currentCopyMode===n.CopyPlans&&0!==i.length){var s=!0;this.settings.CourseIdsNotUsedTopics&&($.each(this.settings.CourseIdsNotUsedTopics,function(e,t){return t!==i||(s=!1,!1)}),this.$targetCourseTopicsPanel.toggle(s)),s&&this.updateTopicsDropdown(i)}if(this.$overwriteAssessmentCriteriaPanel.length>0)if(this.settings.OverwriteAssessmentCriteriaStateData){var o=parseInt(this.settings.OverwriteAssessmentCriteriaStateData[i]);this.$overwriteAssessmentCriteriaPanel.toggle(o!==e.CopyDialogOverwriteAssessmentCriteriaState.Hide),this.$optionOverwriteAssessmentCriteria.length>0&&this.setOverwriteAssessmentCriteriaControlsState(o,!1)}else this.$overwriteAssessmentCriteriaPanel.toggle(i!==this.settings.CourseId)},i}();e.PlannerCopyDialog=i}(e.Dialogs||(e.Dialogs={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(n,i){window[n]=this,t.instanceName=n,this._settings=i,this._terms=i.Terms,this._planner=e.Planner.getInstance(),this._courseId=this._planner.settings.CourseId}return t.getInstance=function(){return window[t.instanceName]},t.prototype.addTopic=function(e,t,n,i){CCL.CommonFunctions.safeAjaxPost({url:this._planner.webMethods.Topic.AddTopic,data:{courseId:this._courseId,topicName:e,topicColorSchema:t},success:function(e){null!=n&&n(),e&&e.refreshUrl&&(window.location.href=e.refreshUrl)},error:function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n),null!=i&&i()}})},t.prototype.shareTopic=function(t,n){var i=this;if(t){var s=e.Cards.TopicCard.getInstance(t);CCL.CommonFunctions.safeAjaxPost({url:this._planner.webMethods.ShareablePlanner.CheckTopicDataForSharing,data:{courseId:this._courseId,topicId:t,isTopicSharedByAnotherAuthor:n}}).done(function(e){e&&e.conflictMessage?CCL.CommonFunctions.jAjaxAlert(e.conflictMessage,i._planner.terms.Alert,i._planner.terms.Ok):e&&e.warningMessage?i._planner.showConfirmDialog(e.warningMessage,function(e){e&&s.redirectToShareTopic()}):s.redirectToShareTopic()}).fail(CCL.CommonFunctions.alertAjaxError)}},t.prototype.stopSharingTopic=function(e,t){var n=this;t&&CCL.CommonFunctions.safeAjaxPost({url:this._planner.webMethods.ShareablePlanner.StopSharingTopic,data:{courseId:this._courseId,topicId:t}}).done(function(e){e&&e.message?CCL.CommonFunctions.jAjaxAlert(e.message,n._planner.terms.Alert,n._planner.terms.Ok):window.location=window.location}).fail(CCL.CommonFunctions.alertAjaxError)},t.prototype.deleteTopic=function(e){this.deleteTopics([e],!1)},t.prototype.deleteTopics=function(t,n){var i=this;if(void 0===t&&(t=null),void 0===n&&(n=!0),n&&null==t&&(t=e.Cards.TopicCard.getSelectedTopicIds(!0)),null!=t){var s=this.getDeleteTopicsConfirmationMessage(t);this._planner.showConfirmDialog(s,function(n){n&&CCL.CommonFunctions.safeAjaxPost({url:i._planner.webMethods.Topic.DeleteTopics,data:{courseId:i._courseId,topicIds:t}}).done(function(t){t.deletedTopics.length>0&&($.each(t.deletedTopics,function(t,n){n.topicId&&n.topicId>0&&(e.Cards.TopicCard.getInstance(n.topicId).getTopicCardContainer().remove(),i.updateFilterAfterDeleting(n.topicId));n.folderId&&n.folderId>0&&e.PlannerUtility.deleteTopicFolderNode(n.folderId)}),e.Cards.TopicCard.hideTopicMoveOptionsIfNecessary(),i._planner.showNoTopicMessageIfNecessary(),i.showTopicFeedbackMessage(t.restoreText),i._planner.togglePlannerSharing())}).fail(CCL.CommonFunctions.alertAjaxError)},this._planner.terms.Delete,this._planner.terms.Cancel)}},t.prototype.restoreTopics=function(e){CCL.CommonFunctions.safeAjaxPost({url:this._planner.webMethods.Topic.RestoreTopics,data:{courseId:this._courseId,topicIds:e}}).done(function(e){e&&e.refreshUrl&&(window.location.href=e.refreshUrl)}).fail(CCL.CommonFunctions.alertAjaxError)},t.prototype.moveUpTopic=function(t){if(t){var n=e.Cards.TopicCard.getInstance(t).getTopicCardContainer(),i=n.prev();if(i){var s=e.Cards.TopicCard.getInstanceByContainer(i).getTopicId();CCL.CommonFunctions.safeAjaxPost({url:this._planner.webMethods.Topic.SwapTopics,data:{courseId:this._courseId,firstTopicId:t,secondTopicId:s},success:function(t){t&&(n.insertBefore(i),e.Cards.TopicCard.hideTopicMoveOptionsIfNecessary())},error:CCL.CommonFunctions.alertAjaxError})}}},t.prototype.moveDownTopic=function(t){if(t){var n=e.Cards.TopicCard.getInstance(t).getTopicCardContainer(),i=n.next();if(i){var s=e.Cards.TopicCard.getInstanceByContainer(i).getTopicId();CCL.CommonFunctions.safeAjaxPost({url:this._planner.webMethods.Topic.SwapTopics,data:{courseId:this._courseId,firstTopicId:t,secondTopicId:s},success:function(t){t&&(n.insertAfter(i),e.Cards.TopicCard.hideTopicMoveOptionsIfNecessary())},error:CCL.CommonFunctions.alertAjaxError})}}},t.prototype.updateFilterAfterDeleting=function(e){var t=this._planner.getPlannerFilter().find("optgroup[label='Topic']");t.find("option[value='t"+e+"']").remove(),0===t.find("option[value^='t']").length&&t.remove()},t.prototype.showTopicFeedbackMessage=function(e){this._planner.getPlannerFeedback().showMessage(CCL.FeedbackType.Information,e)},t.prototype.getDeleteTopicsConfirmationMessage=function(t){if(null==t||0===t.length)return"";var n=e.Cards.TopicCard.getTopicCardsForTopicIds(t),i=!1;n.forEach(function(e){e.hasConnectedFolder&&(i=!0)});var s=t.length>1;return i?s?this._terms.DeleteTopicsConnectedToFolderConfirmText:this._terms.DeleteOneTopicConnectedToFolderConfirmText:s?this._terms.DeleteTopicsConfirmText:this._terms.DeleteOneTopicConfirmText},t}();e.TopicCommonLogic=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function t(e){var n=this;window[t.instanceName]=this,this.playPlanContentItemIdAttributeName=e,$("body").on("click",CCL.CommonFunctions.getDataSelector(this.playPlanContentItemIdAttributeName),function(e){e.preventDefault();var i=$(e.currentTarget);if(i){var s=i.data(n.playPlanContentItemIdAttributeName);s&&t.openPlayPlanDialog(s)}});var i=itslTop.history.state;if(i&&i.playPlanDialogState){var s=i.playPlanDialogState;s.itemId&&$(function(){var e=s.itemId;t.openPlayPlanDialog(e)})}}return t.openPlayPlanDialog=function(t){var n=t.split("_")[0];e.PlayPlanDialog.getClientInstance().open(n,t)},t.getInstance=function(){return window[t.instanceName]},t.instanceName="playPlanDialogOpenerClientInstanceName",t}();e.PlayPlanDialogOpener=t}(e.Dialogs||(e.Dialogs={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(t){var n=this;this.indexDialogWidth=500,this.itemIdDataAttributeName="itemId",this.lastPlanItemIndexBeforeNavigateByTreeLink=void 0,this.lastTreeLinkIdToNavigate=void 0,this.onEscape=function(e){e.which===CCL.CommonConstants.keyCodes.escape&&(n.indexDialog.isOpened()?n.indexDialog.closeDialog():n.toggleDialog(!1))},this.closeTooltip=function(e){setTimeout(function(){return n.toolTip.closeTooltip()},e)},this.openTooltip=function(e,t,i){setTimeout(function(){n.toolTip.isTooltipOpened()||n.$tooltipContentLabel.html(t),n.toolTip.openTooltip(e,n.tooltipPositionSettings)},i)},window[e.clientInstanceName]=this,this.settings=t,$(function(){n.$body=$("body"),n.$bodyWrapper=$("."+n.settings.CssClasses.BodyWrapper),n.$dialog=$("#"+n.settings.Controls.Dialog),n.$topicColumnNameLabel=$("#"+n.settings.Controls.TopicColumnNameLabel),n.$planColumnNameLabel=$("#"+n.settings.Controls.PlanColumnNameLabel),n.$topicTitleLabel=$("#"+n.settings.Controls.TopicTitleLabel),n.$planTitleLabel=$("#"+n.settings.Controls.PlanTitleLabel),n.$errorLabel=$("#"+n.settings.Controls.ErrorMessageLabel),n.$frame=$("#"+n.settings.Controls.Frame),n.$loadingIndicator=$("#"+n.settings.Controls.LoadingIndicator),n.$prevButtons=$("."+n.settings.CssClasses.PrevButton),n.$nextButtons=$("."+n.settings.CssClasses.NextButton),n.$indexButtons=$("."+n.settings.CssClasses.IndexButton),n.$indexCancelMobileButton=$("#"+n.settings.Controls.IndexMobileCancelButton),n.$closeButton=$("#"+n.settings.Controls.CloseButton),n.$tooltipContentLabel=$("#"+n.settings.Controls.TooltipContentLabel),n.$indexDialogContainer=$("#"+n.settings.Controls.IndexContainer),n.focusTracker=new CCL.FocusTracker(n.$dialog),n.$prevButtons.click(function(){return n.goToPreviousItem()}),n.$nextButtons.click(function(){return n.goToNextItem()}),n.$indexButtons.click(function(e){e.preventDefault(),n.openIndexDialog()}),n.$indexCancelMobileButton.click(function(){return n.indexDialog.closeDialog()}),n.$closeButton.click(function(){n.toggleDialog(!1)}),n.initTooltip(),n.toggleToolTip(n.$indexButtons,n.settings.Terms.ShowAllResources,!0),n.toggleToolTip(n.$closeButton,n.settings.Terms.CloseThisPlan,!0),n.indexDialog=new ContextDialog(n.$indexDialogContainer,{setFocus:!0,showHeader:!1,showCloseLink:!1,showArrow:!0,expandParentFrame:!1,closeOnEscape:!1,footerContent:n.settings.Controls.IndexMobileCancelContainer,width:n.indexDialogWidth,zIndex:5,marginTop:1,marginLeft:0,align:"right",valign:"bottom",arrowOffset:"manual",arrowLeft:n.indexDialogWidth-n.$indexButtons.outerWidth()/2}),CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.fullScreenDialogOpening,function(e,t){n.notifyFullScreenDialog(t)}.bind(n))})}return e.prototype.registerTreeLinkCustomHandler=function(){var e=this;CCL.CustomTreeLinkNavigationManager.registerCustomHandler(function(t){e.handleTreeLinkNavigationEvent(t)})},e.prototype.removeTreeLinkCustomHandler=function(){CCL.CustomTreeLinkNavigationManager.removeCustomHandler()},e.prototype.handleTreeLinkNavigationEvent=function(e){var t=this;if(this.lastTreeLinkIdToNavigate=e.linkId,this.lastPlanItemIndexBeforeNavigateByTreeLink=this.currentPlanItemIndex,!e.linkId||e.sourceId<=0){var n=e.context===CCL.TreeLinkContext.library;this.showInformationFeedback(n?this.settings.TreeLinkHandlerSettings.Terms.TreeLinkIsInLibrary:this.settings.TreeLinkHandlerSettings.Terms.ErrorOccurred)}else{var i=this.settings.TreeLinkHandlerSettings.TreeLinksGetInfoForCustomNavigation.replace("{id}",e.linkId).replace("{sourceElementId}",e.sourceId.toString()),s=function(){return t.lastTreeLinkIdToNavigate!==e.linkId||t.lastPlanItemIndexBeforeNavigateByTreeLink!==t.currentPlanItemIndex};$.get(i).done(function(n){if(!s())if(n.HasError)t.showInformationFeedback(n.ErrorDescription);else{var i=t.settings.TreeLinkHandlerSettings.KpiSettings;CCL.CommonFunctions.measureKpi(i.url,i.section,i.clickOnTreeLinkMeasurement,i.context).always(function(){if("_blank"!==e.target){var i=t.playPlanItems.filter(function(e){return e.ElementId===n.TargetElementId});i.length?t.loadPlayPlanItem(i[0]):itslTop.location.assign(n.TargetElementUrl)}else window.open(n.TargetElementContentUrl,"_blank")})}}).fail(function(){s()||t.showInformationFeedback(t.settings.TreeLinkHandlerSettings.Terms.ErrorOccurred)})}},e.getClientInstance=function(){return window[e.clientInstanceName]},e.prototype.open=function(e,t){this.playPlanItems=null,this.disableNavigationButtonsIfNeeds(),this.clearContentFrame(),this.toggleDialog(!0),this.loadPlanItems(e,t)},e.prototype.notifyFullScreenDialog=function(e){e&&CCL.CommonFunctions.makePostMessageCall(e,new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.fullScreenDialogCollapseTitle))},e.prototype.displayOnboardingIfNeeds=function(){var e=this;this.isNavigationButtonDisabled(this.$nextButtons)||$.get(this.settings.WebMethods.PlayPlanNavigationOnboardingFeatureUrl).done(function(t){var n;t.IsCompleted||(e.openTooltip(e.$nextButtons,e.settings.Terms.GoToNextResource,500),CCL.CommonFunctions.safeAjax({url:e.settings.WebMethods.PlayPlanNavigationOnboardingFeatureUrl,type:"PUT",headers:(n={},n[e.settings.AntiforgerySettings.HeaderName]=e.settings.AntiforgerySettings.HeaderValue,n)}))})},e.prototype.adjustDialogPositionOnIosDevice=function(e){if(CCL.CommonFunctions.isIosDevice()){var t=$(itslTop).height()-this.$closeButton.height();this.$bodyWrapper.css("overflow",e?"hidden":""),this.$bodyWrapper.height(e?""+t:"auto")}},e.prototype.toggleDialog=function(e){this.suspendUpdateBreadCrumbsAndNavigation(e),this.toggleEscapeHandler(e),this.adjustDialogPositionOnIosDevice(e),this.$body.css("overflow",e?"hidden":""),this.$dialog.toggle(e),e?(this.hideInformationFeedback(!1),CCL.CommonFunctions.makePostMessageCall(window.itslTop,{messageName:CCL.CommonWindowMessages.MessageNames.expandContentAreaFrame}),this.suspendExpandCollaplseContentAreaFrame(!0),this.registerTreeLinkCustomHandler(),this.$startLink=$(":focus"),this.$closeButton.focus(),this.focusTracker.startTrackFocus()):(this.clearContentFrame(),this.suspendExpandCollaplseContentAreaFrame(!1),CCL.CommonFunctions.makePostMessageCall(window.itslTop,{messageName:CCL.CommonWindowMessages.MessageNames.collapseContentAreaFrame}),this.removeTreeLinkCustomHandler(),this.focusTracker.stopTrackFocus(),this.$startLink.focus()),IframeResizer.reportSetIframeDefaultHeight()},e.prototype.toggleEscapeHandler=function(e){e?this.$body.on("keyup",this.onEscape):this.$body.off("keyup",this.onEscape)},e.prototype.clearContentFrame=function(){this.hideInformationFeedback(),this.updateHistoryState(null),this.setFrameUrl("about:blank")},e.prototype.loadPlanItems=function(e,t){var n=this;this.loadPlanItemsInProgress||(this.loadPlanItemsInProgress=!0,this.toggleHeaderLoadingText(!0),this.$errorLabel.hide(),CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.LoadItems,data:{planId:e}}).done(function(e){n.toggleHeaderLoadingText(!1);var i=e;if(i){i.TopicColumnName&&n.$topicColumnNameLabel.text(i.TopicColumnName+":"),i.PlanColumnName&&n.$planColumnNameLabel.text(i.PlanColumnName+":"),i.TopicTitle&&n.$topicTitleLabel.text(i.TopicTitle),i.PlanTitle&&n.$planTitleLabel.text(i.PlanTitle),n.$topicColumnNameLabel.toggle(i.UseTopics),n.$topicTitleLabel.toggle(i.UseTopics),n.$planColumnNameLabel.toggle(i.UseTopics),n.playPlanItems=i.Items,n.updateIndexDialogContainer(),n.currentPlanItemIndex=-1;var s=n.playPlanItems.filter(function(e){return e.ItemId===t})[0];s?n.loadPlayPlanItem(s):n.navigateToPlayPlanItem(0),n.displayOnboardingIfNeeds(),CCL.CommonFunctions.applyIframely()}}).fail(function(e){e.status>=CCL.CommonConstants.httpStatusCodes.badRequest&&(null!=e.responseText&&e.responseText.length>0||null!=e.statusText&&e.statusText.length>0)?n.showErrorMessage(null!=e.responseText&&e.responseText.length>0?e.responseText:e.statusText):n.showUnableToShowPlanErrorMessage()}).always(function(){n.loadPlanItemsInProgress=!1}))},e.prototype.toggleHeaderLoadingText=function(e){e?(this.$topicColumnNameLabel.add(this.$planColumnNameLabel).add(this.$topicTitleLabel).text(""),this.$planTitleLabel.text(this.settings.Terms.Loading)):this.$planTitleLabel.text("")},e.prototype.loadPlayPlanItem=function(e){this.hideInformationFeedback(),this.updateHistoryState(e),e?(this.currentPlanItemIndex=this.playPlanItems.indexOf(e),this.disableNavigationButtonsIfNeeds(),this.markCurrentItemAsSelected(e),this.setFrameUrl(e.ContentUrl)):this.showUnableToShowPlanErrorMessage()},e.prototype.updateHistoryState=function(e){var t=itslTop.history.state||{};e?t.playPlanDialogState={itemId:e.ItemId}:t.playPlanDialogState&&delete t.playPlanDialogState,itslTop.history.replaceState(t,null)},e.prototype.markCurrentItemAsSelected=function(e){this.$indexDialogContainer.find("."+this.settings.CssClasses.IndexItem).removeClass(this.settings.CssClasses.IndexSelectedItem);var t=CCL.CommonFunctions.getDataSelector(this.itemIdDataAttributeName,e.ItemId);this.$indexDialogContainer.find("."+this.settings.CssClasses.IndexItem+t).addClass(this.settings.CssClasses.IndexSelectedItem)},e.prototype.navigateToPlayPlanItem=function(e){this.currentPlanItemIndex!==e&&this.loadPlayPlanItem(this.playPlanItems[e])},e.prototype.goToPreviousItem=function(){this.isNavigationButtonDisabled(this.$prevButtons)||this.currentPlanItemIndex>=1&&this.loadPlayPlanItem(this.playPlanItems[this.currentPlanItemIndex-1])},e.prototype.goToNextItem=function(){this.isNavigationButtonDisabled(this.$nextButtons)||this.currentPlanItemIndex<this.playPlanItems.length-1&&this.loadPlayPlanItem(this.playPlanItems[this.currentPlanItemIndex+1])},e.prototype.openIndexDialog=function(){if(!this.isNavigationButtonDisabled(this.$indexButtons)){var e=this.$indexButtons.offset().left+this.$indexButtons.outerWidth()-this.indexDialogWidth,t=this.$indexButtons.outerHeight();this.indexDialog.openDialogAt(e,t,!1),this.closeTooltip(0);var n=this.playPlanItems[this.currentPlanItemIndex-1];if(n){var i=this.$indexDialogContainer.find("."+this.settings.CssClasses.IndexItem+CCL.CommonFunctions.getDataSelector(this.itemIdDataAttributeName,n.ItemId));this.$indexDialogContainer.animate({scrollTop:i.offset().top})}}},e.prototype.updateIndexDialogContainer=function(){var e=this;this.$indexDialogContainer.html("");var t=$('<ul class="'+this.settings.CssClasses.IndexList+'"></ul>');$.each(this.playPlanItems,function(n,i){e.renderItem(t,i,n)}),t.appendTo(this.$indexDialogContainer)},e.prototype.renderItem=function(e,t,n){var i=this;$("<li data-"+this.itemIdDataAttributeName+"="+t.ItemId+">").append('<a href="javascript:void(0);">\n                             <img alt="" src="'+t.IconUrl+'" class="'+this.settings.CssClasses.IndexItemIcon+'"/>\n                             <span class="'+this.settings.CssClasses.IndexItemTitle+'">'+t.ItemTitle+"</span>\n                        </a>").addClass(this.settings.CssClasses.IndexItem).appendTo(e).click(function(){i.indexDialog.closeDialog(),i.navigateToPlayPlanItem(n)})},e.prototype.showUnableToShowPlanErrorMessage=function(){this.showErrorMessage(this.settings.Terms.UnableToShowPlan)},e.prototype.showErrorMessage=function(e){this.$errorLabel.text(e),this.$errorLabel.show(),this.$loadingIndicator.hide()},e.prototype.showInformationFeedback=function(e){CCL.InformationFeedback.showFeedback(this.$dialog,e,{disableAutomaticHiding:!0})},e.prototype.hideInformationFeedback=function(e){void 0===e&&(e=!0),CCL.InformationFeedback.hideFeedback(this.$dialog,e)},e.prototype.disableNavigationButtonsIfNeeds=function(){this.disableNavigationButton(this.$nextButtons,null==this.playPlanItems||this.currentPlanItemIndex===this.playPlanItems.length-1,this.settings.Terms.GoToNextResource),this.disableNavigationButton(this.$prevButtons,null==this.playPlanItems||0===this.currentPlanItemIndex,this.settings.Terms.GoToPreviousResource),this.disableNavigationButton(this.$indexButtons,null==this.playPlanItems||1===this.playPlanItems.length,this.settings.Terms.ShowAllResources)},e.prototype.disableNavigationButton=function(e,t,n){var i=this.isNavigationButtonDisabled(e)!==t;e.toggleHyperlink(!t),i&&this.toggleToolTip(e,n,!t)},e.prototype.suspendUpdateBreadCrumbsAndNavigation=function(e){CCL.CommonFunctions.makePostMessageCall(itslTop,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.suspendUpdateBreadCrumbsAndNavigation,{suspend:e}))},e.prototype.suspendExpandCollaplseContentAreaFrame=function(e){CCL.CommonFunctions.makePostMessageCall(itslTop,new CCL.CommonWindowMessages.GenericMessageWithData(CCL.CommonWindowMessages.MessageNames.suspendExpandCollaplseContentAreaFrame,{suspend:e}))},e.prototype.setFrameUrl=function(e){e?(this.$frame.prop("src",e),this.$loadingIndicator.hide()):(this.$frame.contents().find("html").html(""),this.$loadingIndicator.show())},e.prototype.isNavigationButtonDisabled=function(e){return!e.getIfHyperLinkEnabled()},e.prototype.initTooltip=function(){this.tooltipPositionSettings={My:"right+23 top",At:"center bottom+10",Arrow:"bottom"},this.$toolTipContainer=$("#"+this.settings.Controls.TooltipContainer);var e={contentContainer:this.$toolTipContainer,zIndex:10};this.toolTip=new CCL.CustomTooltip("playPlanToolTip",e,this.settings.CssClasses.CustomTooltipCssClasses),this.$toolTipContainer.show()},e.prototype.toggleToolTip=function(e,t,n){var i=this;CCL.CommonFunctions.isMobileDevice()||(n?e.on("mouseover",function(){i.indexDialog.isOpened()||i.openTooltip(e,t,0)}).on("mouseleave",function(){return i.closeTooltip(0)}):(this.closeTooltip(0),e.off("mouseover mouseleave")))},e.clientInstanceName="playPlanDialogClientInstanceName",e}();e.PlayPlanDialog=t}(e.Dialogs||(e.Dialogs={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(n){var i=function(){function n(e,t){this.settings=t,window[e]=this,this.$okButton=$("#"+this.settings.Controls.OkButton),this.$cancelButton=$("#"+this.settings.Controls.CancelButton)}return n.prototype.open=function(n,i,s,o){var r=this;if(null!=n){this.updateGridViewCallback=i,this.clearSelectionCallback=s,this.planIdList=n,this.toggleInProcess(!1),this.datePicker=window[this.settings.ClientInstanceNames.TimeSpanPicker],this.setPlanDatesModal=window[this.settings.ClientInstanceNames.SetPlanDatesModal],this.datePicker.callbacks.onUserSelectionUpdated||(this.datePicker.callbacks.onUserSelectionUpdated=function(){r.setPlanDatesModal.adjustWindowSize()}),this.datePicker.clearData(),this.datePicker.setRecurringMode(this.planIdList),this.datePicker.showCurrentMode();var a=t.Cells.Plan.DateCell.PlanDateCell.getPlanDateCellInstance(),l=n.filter(function(e){return a.hasPreservedEvents(e)});this.datePicker.togglePreservedEventsWillNotBeUsedPanel(l.length>0),null!=o&&e.Planner.Cards.TopicCard.setDefaultDate(this.datePicker,o),this.setPlanDatesModal.openDialog()}},n.prototype.setPlanDates=function(){if(this.toggleInProcess(!0),this.datePicker=window[this.settings.ClientInstanceNames.TimeSpanPicker],null!=this.datePicker&&this.datePicker.validateDates())switch(this.datePicker.getCurrentMode()){case t.DatePickerMode.TimeSpan:this.updatePlansTimeSpan();break;case t.DatePickerMode.WeekAndDay:this.updatePlansWeekAndDay();break;case t.DatePickerMode.Event:this.updatePlansEvents()}else this.toggleInProcess(!1)},n.prototype.toggleInProcess=function(e){this.$okButton.toggleClass(this.settings.CssClasses.InProgress,e),e?(this.$okButton.attr("disabled","disabled"),this.$cancelButton.attr("disabled","disabled")):(this.$okButton.removeAttr("disabled"),this.$cancelButton.removeAttr("disabled"))},n.prototype.updatePlansTimeSpan=function(){var e=this,t=this.datePicker.getWeekDays();CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.SetPlansTimeSpan,data:{courseId:this.settings.CourseId,planIds:this.planIdList,start:this.datePicker.getStartDate(),stop:this.datePicker.getStopDate(),weekNumber:this.datePicker.getWeekNumber(),weekDays:0===t.length?"":JSON.stringify(t),isDateColumnDisplayed:this.settings.IsDateColumnDisplayed}}).done(function(t){e.updateGridViewCallback&&e.updateGridViewCallback(t),e.clearSelectionCallback&&e.clearSelectionCallback(),e.closeDialog()}).fail(function(t,n,i){CCL.CommonFunctions.alertAjaxError(t,n,i),e.toggleInProcess(!1)})},n.prototype.updatePlansWeekAndDay=function(){var e=this,t=this.datePicker.getWeekDays();CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.SetPlansWeekAndDay,data:{courseId:this.settings.CourseId,planIds:this.planIdList,start:this.datePicker.getStartWeek(),stop:this.datePicker.getStopWeek(),weekNumber:this.datePicker.getWeekNumber(),weekDays:0===t.length?"":JSON.stringify(t),isDateColumnDisplayed:this.settings.IsDateColumnDisplayed}}).done(function(t){e.updateGridViewCallback&&e.updateGridViewCallback(t),e.clearSelectionCallback&&e.clearSelectionCallback(),e.closeDialog()}).fail(function(t,n,i){CCL.CommonFunctions.alertAjaxError(t,n,i),e.toggleInProcess(!1)})},n.prototype.updatePlansEvents=function(){var e=this,n=this.datePicker.getEvents();CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.SetPlansEvents,data:{courseId:this.settings.CourseId,planIds:this.planIdList,firstPlanEventIds:n,filterStartDate:this.settings.FilterStartDateTime,filterStopDate:this.settings.FilterStopDateTime,isDateColumnDisplayed:this.settings.IsDateColumnDisplayed}}).done(function(t){e.updateGridViewCallback&&e.updateGridViewCallback(t),e.clearSelectionCallback&&e.clearSelectionCallback(),e.closeDialog()}).fail(function(){e.datePicker.showErrorMsg(t.DatePickerMode.Event),e.toggleInProcess(!1)})},n.prototype.closeDialog=function(){window.location.href=this.settings.DefaultTarget},n}();n.SetPlanDatesDialog=i}(t.Dialogs||(t.Dialogs={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(){function t(t,n){var i=this;window[t]=this,this.settings=n,$(function(){i.topicColorPicker=window[i.settings.ColorPickerClientInstanceName],i.planner=e.Planner.getInstance()})}return t.prototype.setupAndOpenTopicColorPicker=function(t){var n=e.Cards.TopicCard.getInstance(t);this.topicColorPicker.getSelectedColorKey()!==n.getColorSchema()&&(this.topicColorPicker.setPickerLink(n.getColorPickerLink()),this.topicColorPicker.setColor(n.getColorSchema()),this.topicColorPicker.openPopup())},t.prototype.updateTopicColor=function(t,n){CCL.CommonFunctions.safeAjaxPost({url:this.planner.webMethods.Topic.SetTopicColorSchema,data:{courseId:this.planner.settings.CourseId,topicId:t,topicColorSchema:n}}).done(function(i){e.Cards.TopicCard.getInstance(t).setTopicColorSchema(n,i.topicColorSchemaCss)}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})},t}();t.TopicColorPicker=n}(e.Dialogs||(e.Dialogs={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function n(i,s){var o=this;this.addingPlanIsInProgress=!1,this.closeTooltip=function(e){setTimeout(function(){return o.toolTip.closeTooltip()},e)},this.openTooltip=function(e,t,n){setTimeout(function(){o.$toolTipContent.html(t),o.toolTip.openTooltip(e,o.tooltipPositionSettings)},n)},window[i]=this,n.clientInstanceName=i,this.settings=s,this.courseId=this.settings.CourseId,this.kpi=this.settings.Kpi,this.$container=$("#"+this.settings.Controls.Container),this.$addNewPlanLink=$("#"+this.settings.Controls.AddNewPlanLink),this.$addNewPlanLinkContainer=$("#"+this.settings.Controls.AddNewPlanLinkContainer),this.$newPlanToolTipContent=$("#"+this.settings.Controls.NewPlanToolTip),this.$toolTipContent=$("#"+this.settings.Controls.FieldsToolTip),this.initNewPlanToolTip(),this.initFieldsToolTip(),$(function(){o.datePeriodSelector=window[o.settings.Controls.DatePeriodSelector],$(o.datePeriodSelector).on(e.Controls.DatePeriodSelector.periodChangedEventName,function(e,t){return o.loadPlans(t.startDate,t.endDate)}),o.$container.on("click","."+o.settings.Css.SinglePlanEmptyOverlay,function(){return o.addPlan(!1)}),o.$addNewPlanLink.on("click",function(){return o.addPlan(!0)}),o.cbExpander=window[o.settings.Controls.Expander],CCL.CommonFunctions.attachPostMessageEventListener($(window),t.PlannerConstants.postMessages.SendElementIdToCourseFeature,function(e){t.Cells.Plan.ResourcesCell.PlanCbResourcesCell.getPlanActivityResourceCellInstance().refreshResourcesCell(e.relatedEntityId,e.customId,!0)})})}return n.getInstance=function(){return window[n.clientInstanceName]},n.prototype.getContainer=function(){return this.$container},n.prototype.getFilterStartDate=function(){return this.datePeriodSelector.getStartDate()},n.prototype.getFilterStopDate=function(){return this.datePeriodSelector.getEndDate()},n.prototype.reloadPlans=function(){this.loadPlans(this.datePeriodSelector.getStartDate(),this.datePeriodSelector.getEndDate())},n.prototype.getLibraryBrowserDialog=function(){return window[this.settings.Controls.LibraryBrowserDialog]},n.prototype.changeDatePeriod=function(e){this.datePeriodSelector.changeDatePeriod(e)},n.prototype.measureEditPlan=function(){CCL.CommonFunctions.measureKpi(this.kpi.Url,this.kpi.Section,this.kpi.EditPlanMeasurement,this.kpi.Context)},n.prototype.updatePlansFolder=function(e,n){$("."+this.settings.Css.SinglePlanContainer+CCL.CommonFunctions.getDataSelector(t.PlannerConstants.dataAttributes.PlanId,e)).attr("data-"+t.PlannerConstants.dataAttributes.FolderId,n)},n.prototype.loadPlans=function(e,t){var n=this;this.datePeriodSelector.toggleNavigationButtons(!1),this.togglePlanTitleToolTip(this.$container,!1),this.$container.append($("<div>").addClass(this.settings.Css.LoadingIndicator)),this.cbExpander.renderShowMoreLinkIfNeed(!1),CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.LoadPlans,data:{courseId:this.settings.CourseId,start:e,stop:t}}).done(function(e){n.$container.html(e.html),n.refreshCbExpander(!n.isSelectedWeekNotEmpty()),n.renderAddNewPlanLinkIfNeeds(),n.disableKeyboardNavigationIfWeekIsEmpty(),n.toggleFieldsToolTip(!0),CCL.CommonFunctions.applyIframely(),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(n.$container)}).fail(function(e,t,i){n.$container.empty(),CCL.CommonFunctions.alertAjaxError(e,t,i)}).always(function(){n.datePeriodSelector.toggleNavigationButtons(!0)})},n.prototype.refreshCbExpander=function(e){this.cbExpander&&this.cbExpander.renderShowMoreLinkIfNeed(e),this.$container.removeClass(this.settings.Css.PlansContainerMinHeight)},n.prototype.addPlan=function(e){var t=this;this.addingPlanIsInProgress||(this.addingPlanIsInProgress=!0,this.toggleFieldsToolTip(!1),CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.AddPlan,data:{courseId:this.settings.CourseId,start:this.datePeriodSelector.getStartDate(),stop:this.datePeriodSelector.getEndDate()}}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)}).done(function(n){if(e){t.$container.append(n.ControlHtml);var i=t.$container.find("."+t.settings.Css.SinglePlanContainer).last();$("html, body",window.document).stop().animate({scrollTop:i.offset().top})}else{t.$container.html(n.ControlHtml),t.$container.find("."+t.settings.Css.PlanTitleCell).find("."+t.settings.Css.HtmlTextCellViewer).click(),t.togglePlanTitleToolTip(t.$container,!0)}t.refreshCbExpander(!0),t.renderAddNewPlanLinkIfNeeds(),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(t.$container)}).always(function(){t.addingPlanIsInProgress=!1}))},n.prototype.renderAddNewPlanLinkIfNeeds=function(){this.$addNewPlanLinkContainer.toggle(this.isSelectedWeekNotEmpty())},n.prototype.isSelectedWeekNotEmpty=function(){return $("."+this.settings.Css.SinglePlanContainer).not("[data-"+t.PlannerConstants.dataAttributes.PlanId+"=0]").length>0},n.prototype.togglePlanTitleToolTip=function(e,n){var i=e.find("."+this.settings.Css.PlanTitleCell).find("div"+CCL.CommonFunctions.getDataSelector(t.PlannerConstants.dataAttributes.HybridEditorItem));i.length>0&&this.showNewPlanToolTip(i,n)},n.prototype.initNewPlanToolTip=function(){var e={contentContainer:this.$newPlanToolTipContent,zIndex:1};this.newPlanToolTip=new CCL.CustomTooltip("newPlanToolTip",e,this.settings.Css.CustomTooltipCssClasses),this.$newPlanToolTipContent.show()},n.prototype.initFieldsToolTip=function(){var e={contentContainer:this.$toolTipContent,zIndex:1};this.toolTip=new CCL.CustomTooltip("fieldsToolTip",e,this.settings.Css.CustomTooltipCssClasses),this.tooltipPositionSettings={My:"center bottom",At:"center top-10",Arrow:"top"},this.$toolTipContent.show()},n.prototype.disableKeyboardNavigationIfWeekIsEmpty=function(){var e=$("."+this.settings.Css.SinglePlanEmptyOverlay);e.length>0&&(this.$container.find("*").prop("tabindex","-1"),e.attr("tabindex","0"))},n.prototype.showNewPlanToolTip=function(e,n){var i,s,o,r=this,a=function(n){clearTimeout(s),clearTimeout(i),s=setTimeout(function(){r.newPlanToolTip.isTooltipOpened()&&(r.newPlanToolTip.closeTooltip(),e.off(t.PlannerConstants.events.HybridEditorItemInlineModeChanged),r.toggleFieldsToolTip(!0))},n)};n?(o=300,clearTimeout(s),clearTimeout(i),i=setTimeout(function(){r.newPlanToolTip.openTooltip(e,{My:"center top",At:"center bottom+10",Arrow:"bottom"}),e.on(t.PlannerConstants.events.HybridEditorItemInlineModeChanged,function(e,t){t.isEditMode||a(300)})},o)):a(0)},n.prototype.toggleTooltipForField=function(e,t,n){var i=this;void 0===n&&(n=""),CCL.CommonFunctions.isMobileDevice()||(t?e.on("mouseover",function(t){return i.openTooltip(e,n,0)}).on("mouseleave",function(){return i.closeTooltip(0)}):(this.closeTooltip(0),e.off("mouseover mouseleave")))},n.prototype.toggleFieldsToolTip=function(e){var t=this;if(!CCL.CommonFunctions.isMobileDevice()){var n=this.$container.find("."+this.settings.Css.PlanTitleCell);n.each(function(e){return t.toggleTooltipForField($(n[e]),!0,t.settings.Terms.PlanTitleCellTooltip)});var i=this.$container.find("."+this.settings.Css.PlanTopicCell);i.each(function(e){return t.toggleTooltipForField($(i[e]),!0,t.settings.Terms.PlanTopicCellTooltip)});var s=this.$container.find("."+this.settings.Css.PlanDateCell);s.each(function(e){return t.toggleTooltipForField($(s[e]),!0,t.settings.Terms.PlanDateCellTooltip)});var o=this.$container.find("."+this.settings.Css.PlanEmptyThumbnailCell).closest("."+this.settings.Css.PlanThumbnailCell);o.each(function(e){return t.toggleTooltipForField($(o[e]),!0,t.settings.Terms.PlanThumbnailCellTooltip)})}},n}();t.CbPlanner=n}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){var t=this;window[e.ClientInstanceName]=this,this.settings=e,this.folderSelector=window[e.FolderSelectorInstanceName],this.dialog=window[e.DialogInstanceName],this.grid=this.folderSelector.controls.grid,this.tree=this.folderSelector.controls.tree,this.tbody=$("#"+this.settings.LearningObjectiveTableClientId+" > tbody"),this.checkBoxClientId=e.LearningObjectiveGridClientId+"_select_new",$(document).keyup(function(e){return t.keyup(e)}),$(document).keydown(function(e){return t.keydown(e)}),this.dialog.setAfterOpenDialog(function(){t.dialog.setCloseConfirmation(function(){return!t.isEditorShown})})}return e.prototype.showEditor=function(){var e=this,t=function(){e.isEditorShown||(e.initEditor(),e.tbody.prepend(e.editor),$("#"+e.checkBoxClientId).prop("checked",!0).prop("disabled",!0),e.toggleInsertButtons(!1)),e.isEditorVisibleOnDisplay()||e.editor.animate({scrollTop:0},250),setTimeout(function(){e.editorInput.focus()},250)};this.folderSelector.selectedId===this.settings.NodeIdCreatedRoot?t():this.folderSelector.navigateToNode(this.settings.NodeIdCreatedRoot,!1,!0,function(){return t()})},e.prototype.initEditor=function(){var e=this,t=$(this.settings.EditorTemplate),n=t.find("td").first(),i=this.grid.createCheckbox(this.checkBoxClientId);n.append(i),CCL.ModernCheckbox.BuildCheckbox(i,this.grid.cclGridConstants.terms.selectOneRow,!0,!0),this.editorInput=t.find("#"+this.settings.EditorClientId),this.editor=t,this.editorInput.on("blur",function(){return e.createLearningObjective()})},e.prototype.createLearningObjective=function(){var e=this,t=this.editorInput.val().trim();if(""!==t){this.editor.remove();var n=(new Date).getTime();this.renderGridRow({Id:n.toString(),Title:t}),CCL.CommonFunctions.safeAjaxPost({data:{title:this.editorInput.val(),courseId:this.settings.CourseId},url:this.settings.CreateLearningObjectiveUrl}).done(function(t){var i=t.Items[0];if(e.addToCache(t),e.folderSelector.selectedId===e.settings.NodeIdCreatedRoot){var s=e.tbody.find("#"+n);s&&(s.data("id",i.Id),s.attr("data-id",i.Id)),s.find("."+e.folderSelector.settings.cssClasses.itemCell+" > span").text(i.Title),e.grid._addRemoveSelectedValue(i.Id,!0),e.refreshTreeRow()}else e.folderSelector.controls.tree.refresh(e.settings.NodeIdCreatedRoot);e.toggleInsertButtons(!0)}).fail(function(){e.tbody.find("#"+n).remove(),e.folderSelector.showErrorFeedback()})}else this.removeEditor()},e.prototype.renderGridRow=function(e){var t=$("<tr id='"+e.Id+"' data-id=''></tr>").addClass(this.grid.cclGridConstants.cssClasses.selectedRow),n=$("<td></td>").prop("class",this.grid.cclGridConstants.cssClasses.selectColumn),i=this.settings.LearningObjectiveGridClientId+"_select_"+e.Id,s=this.grid.createCheckbox(i);n.append(s),CCL.ModernCheckbox.BuildCheckbox(s,this.grid.cclGridConstants.terms.selectOneRow,!0,!0),t.append(n);var o=$("<td></td>").addClass(this.folderSelector.settings.cssClasses.itemCell),r=$("<span class='LearningObjective'></span>").text(e.Title);o.append(r),t.append(o),this.tbody.prepend(t),this.grid.allowSelecting&&(this.initCheckBox(i,!0),this.grid.addCheckBoxHandler(i))},e.prototype.refreshTreeRow=function(){this.folderSelector.controls.tree&&(this.folderSelector.selectedId=this.folderSelector.rootId,this.folderSelector.controls.tree.refresh(this.folderSelector.selectedId),this.folderSelector.navigateToNode(this.settings.NodeIdCreatedRoot,!1,!1),this.folderSelector.selectedId=this.settings.NodeIdCreatedRoot)},Object.defineProperty(e.prototype,"isEditorShown",{get:function(){return 1===this.tbody.find("#"+this.settings.EditorClientId).length},enumerable:!0,configurable:!0}),e.prototype.addToCache=function(e){var t=this.folderSelector.getCachedFolderData(this.settings.NodeIdCreatedRoot);if(null!=e.Folders)for(var n=t.folders,i=e.Folders.length,s=0;s<i;s++){var o=e.Folders[s];n.splice(0,0,{id:o.Id,title:o.Title,description:o.Description,cssClass:o.CssClass,isFolder:o.IsFolder,selectedByDefault:o.SelectedByDefault,setRootAsParent:o.SetRootAsParent})}var r=t.items.pages[1];if(null!=e.Items){var a=e.Items.length;for(s=0;s<a;s++){o=e.Items[s];r.splice(0,0,{id:o.Id,title:o.Title,description:o.Description,cssClass:o.CssClass,isFolder:o.IsFolder,selectable:o.Selectable,selectedByDefault:!1})}}t.virtualItemCount++,this.folderSelector.cache[this.settings.NodeIdCreatedRoot]=t},e.prototype.isEditorVisibleOnDisplay=function(){var e=$(window).scrollTop(),t=e+$(window).height(),n=this.editorInput.offset().top;return n+this.editorInput.height()<=t&&n>=e},e.prototype.keyup=function(e){if(this.isEditorShown)return e.which===CCL.CommonConstants.keyCodes.escape?(this.removeEditor(),void event.preventDefault()):void 0},e.prototype.keydown=function(e){if(this.isEditorShown)return e.which===CCL.CommonConstants.keyCodes.enter?(this.createLearningObjective(),void event.preventDefault()):void 0},e.prototype.toggleInsertButtons=function(e){this.folderSelector.toggleSelectButtons(e)},e.prototype.removeEditor=function(){this.editor.remove(),this.toggleInsertButtons(this.grid.getSelectedIds()&&0!==this.grid.getSelectedIds().length)},e.prototype.initCheckBox=function(e,t){$("#"+e).prop("checked",t)},e}();e.LearningObjectiveInlineEditor=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(t){window[e.clientInstanceName]=this,this.settings=t}return e.getInstance=function(){return window[e.clientInstanceName]},e.prototype.updateLearningObjectiveDataSource=function(e){var t=[e];return this.updateLearningObjectivesDataSource(t)},e.prototype.updateLearningObjectivesDataSource=function(e){var t=this;return CCL.CommonFunctions.safeAjaxPost({url:this.settings.GetLearningObjectivesTooltipDataWebMethod,data:{learningObjectiveIds:e}}).done(function(e){$.each(e,function(e,n){window[t.settings.TooltipDataSourceMethods.AddToDataSource](e,n.title,n.description,n.path)})}).fail(CCL.CommonFunctions.alertAjaxError)},e.clientInstanceName="PlannerLearningObjectiveToolTipManagerClientInstanceName",e}();e.PlannerLearningObjectiveToolTipManager=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function e(t,n){window[t]=this,e.dataAttributes=n.DataAttributes,e.events=n.Events,e.postMessages=n.PostMessages};e.PlannerConstants=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(n){window[n]=this,t.instanceName=n,this._planner=e.Planner.getInstance()}return t.getInstance=function(){return window[t.instanceName]},t.prototype.printTopics=function(){var t=this,n=e.Cards.TopicCard.getSelectedTopicIds(!0);null!=n&&(e.Cards.TopicCard.getAllTopicCardContainers().addClass(this._planner.css.NoPrint),n.forEach(function(e){t.prepareTopicForPrint(e)}),window.print())},t.prototype.printPlans=function(t){var n=t.getTopicId();if(!n)return this._planner.settings.UseTopics?(e.Cards.TopicCard.getAllTopicCardContainers().removeClass(this._planner.css.NoPrint),e.Cards.TopicCard.getPlansForAllTopics().removeClass(this._planner.css.NoPrint)):this.prepareAllPlansForPrint(),void window.print();e.Cards.TopicCard.getAllTopicCardContainers().addClass(this._planner.css.NoPrint),this.prepareTopicForPrint(n),window.print()},t.prototype.prepareAllPlansForPrint=function(){var t=this;e.Cards.TopicCard.getAllTopicCardContainers().each(function(n,i){var s=e.Cards.TopicCard.getInstanceByContainer($(i)).getPlanGrid(),o=s.getSelectedRows(),r=s.getRows();o.length>0?(r.addClass(t._planner.css.NoPrint),o.removeClass(t._planner.css.NoPrint)):r.removeClass(t._planner.css.NoPrint)})},t.prototype.prepareTopicForPrint=function(t){var n=e.Cards.TopicCard.getInstance(t),i=n.getTopicCardContainer(),s=n.getPlanGrid(),o=s.getRows(),r=s.getSelectedRows();i.removeClass(this._planner.css.NoPrint),r.length>0?(o.addClass(this._planner.css.NoPrint),r.removeClass(this._planner.css.NoPrint)):o.removeClass(this._planner.css.NoPrint)},t.prototype.printPlanner=function(t){if(null==t)return this._planner.settings.UseTopics?(e.Cards.TopicCard.getAllTopicCardContainers().removeClass(this._planner.css.NoPrint),e.Cards.TopicCard.getPlansForAllTopics().removeClass(this._planner.css.NoPrint)):this.prepareAllPlansForPrint(),void window.print();e.Cards.TopicCard.getAllTopicCardContainers().addClass(this._planner.css.NoPrint),this.prepareTopicForPrint(t),window.print()},t}();e.PlannerPrint=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t;!function(e){e[e.NotLoaded=0]="NotLoaded",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded"}(t||(t={}));var n=function(e,n,i){var s=t.NotLoaded,o=$("<div class='ccl-context-dialog-content-container'></div>").hide();e.parent().append(o);var r=new ContextDialog(o,{showHeader:!1,showCloseLink:!1,useMobileViewIfNeeded:!1,valign:"bottom",marginTop:12,marginBottom:0,marginLeft:0,marginRight:10,cssClass:i,toggleElement:e,noTitle:!0}),a=r.closeDialog;function l(e){var t=-e.width()/2,n=e.height();r.openDialogAt(t,n,!0),$(window.itslTop).trigger($.Event("QuickAddMenuShow"))}r.setCloseFunction(function(e){a(e),$(window.itslTop).trigger($.Event("QuickAddMenuHide"))}),window.addEventListener("orientationchange",function(e){return r.closeDialog(e)}),o.click(function(){return r.closeDialog()}),e.click(function(e){r.isOpened()?r.closeDialog():s===t.Loaded?l($(e.currentTarget)):s===t.NotLoaded&&(s=t.Loading,$.get(n,function(n){n&&(o.append(n),l($(e.currentTarget))),s=t.Loaded}).fail(function(){return s=t.NotLoaded}))})};e.QuickAddMenu=n}(e.Controls||(e.Controls={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(n){!function(n){var i=function(){function n(e,t){var n=this;this.settings=t,window[e]=this,this.courseId=t.CourseId,$(function(){$("body").on("keyup","."+n.settings.Css.ImageUploaderContainer,function(e){var t=$(e.target);e.which===CCL.CommonConstants.keyCodes.enter&&t.getIfHyperLinkEnabled()&&t.find("input").click(),e.preventDefault()}).on("change","."+n.settings.Css.ImageUploaderContainer,function(e){return n.uploadImage(e)}).on("click","."+n.settings.Css.DeleteButton,function(e){return n.deleteImage(e)})})}return n.prototype.uploadImage=function(n){var i=this,s=$(n.target),o=s.closest("."+this.settings.Css.CellContainer);this.hideImageLoadingError(o);var r=n.target,a=parseInt(s.closest("."+this.settings.Css.PlanContainer).data(t.PlannerConstants.dataAttributes.PlanId),10),l=e.UploadFileHelper.getFormDataWithAttachedFilesAndFileSizes(r),c=l.formData;if(c)if(l.fileSizes[0]>this.settings.MaxImageSizeInBytes)this.showImageLoadingError(o,this.settings.Terms.MaximumFileSizeForUpload);else{var d=this.showLoading(o);t.CbPlanner.getInstance()&&t.CbPlanner.getInstance().toggleTooltipForField(o,!1);var u=this.settings.WebMethods.UploadImage.replace("{courseId}",this.settings.CourseId.toString()).replace("{planId}",a.toString());$.ajax({type:"POST",url:u,contentType:!1,processData:!1,dataType:"json",data:c}).done(function(e){e.success?o.replaceWith(e.content):(i.toggleAddImage(o,!0),i.showImageLoadingError(o,e.errorMessage))}).fail(function(){CCL.CommonFunctions.jAlertAjaxError(i.settings.Terms.SomethingWentWrong,i.settings.Terms.ErrorMessage,i.settings.Terms.Ok,!1)}).always(function(){return i.hideLoading(o,d)})}},n.prototype.deleteImage=function(e){var n=this,i=$(e.target),s=i.closest("."+this.settings.Css.CellContainer),o=parseInt(i.closest("."+this.settings.Css.PlanContainer).data(t.PlannerConstants.dataAttributes.PlanId),10);CCL.CommonFunctions.safeAjax({type:"DELETE",url:this.settings.WebMethods.DeletePlanThumbnail,data:{courseId:this.settings.CourseId,planId:o}}).done(function(e){var i=s.parent();s.replaceWith(e.controlHtml),t.CbPlanner.getInstance()&&t.CbPlanner.getInstance().toggleTooltipForField(i.find("."+n.settings.Css.CellContainer),!0,n.settings.Terms.AddImageTooltip)})},n.prototype.showLoading=function(e){var t=e.css("position");return e.css("position","relative").append($('<div class="'+this.settings.Css.AjaxLoader+'"></div>')),this.toggleAddImage(e,!1),t},n.prototype.hideLoading=function(e,t){e.css("position",t),e.find("."+this.settings.Css.AjaxLoader).replaceWith("")},n.prototype.showImageLoadingError=function(e,t){var n=$('<div class="'+this.settings.Css.ImageErrorMessage+'">'+t+"</div>");e.append(n)},n.prototype.hideImageLoadingError=function(e){e.find("."+this.settings.Css.ImageErrorMessage).replaceWith("")},n.prototype.toggleAddImage=function(e,t){e.find("."+this.settings.Css.AddImage).toggle(t)},n}();n.PlanThumbnailCell=i}(n.Plan||(n.Plan={}))}(t.Cells||(t.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){function t(e){var t=itslTop;return window!=t?$("#item"+e,t.document):null}e.deleteTopicFolderNode=function(e){if(e){var n=t(e);n&&n.remove()}},e.updateTopicFolderNode=function(e,n){if(e){var i=t(e);if(i){var s=document.createTextNode(n);i.children("a:first").contents().filter(function(){return 3===this.nodeType}).replaceWith(s)}}}}(e.PlannerUtility||(e.PlannerUtility={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t,n){var i=this;this.topicsAutocomplete=function(e,t){i.topicsAutocompleteRequest&&i.topicsAutocompleteRequest.abort&&i.topicsAutocompleteRequest.abort();var n=i;i.topicsAutocompleteRequest=CCL.CommonFunctions.safeAjaxPost({url:n.settings.WebMethods.FindTopics,data:{courseId:n.courseId,searchText:e.term}}).done(function(e){if(e.length)t($.map(e,function(e){return{label:e.Name,value:e.TopicId,metadata:e}}));else{t([{label:"",value:""}])}}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)}).always(function(){n.topicsAutocompleteRequest=void 0})},this.onTopicSelect=function(e,t){return i.selectedTopic=t.item.metadata,i.$textInput.val(i.selectedTopic.Name),i.$textInput[0].blur(),!1},window[t]=this,this.courseId=n.CourseId,this.$textInput=$("#"+n.InputClientId),this.settings=n;var s=this;this.$textInput.autocomplete({focus:function(e){e.preventDefault()},position:{collision:"none flip",of:this.$textInput},source:this.topicsAutocomplete,select:this.onTopicSelect,delay:this.settings.Autocomplete.Delay,minLength:this.settings.Autocomplete.MinLength,create:function(){$(this).data("ui-autocomplete")._renderItem=function(e,t){return $("<li>").append(t.metadata?String.format("<span>{0}</span>",CCL.CommonFunctions.htmlEncode(t.metadata.Name)):String.format("<span class='{0}'>{1}</span>",s.settings.Css.NoMatches,s.settings.Terms.NoMatches)).appendTo(e)},$(this).data("ui-autocomplete")._renderMenu=function(e,t){var n=this;$.each(t,function(t,i){n._renderItemData(e,i)}),e.hasClass(s.settings.Css.AutocompleteMenu)||e.addClass(s.settings.Css.AutocompleteMenu)}}}),$(function(){n.CurrentTopic&&(i.currentTopic=n.CurrentTopic,i.$textInput.val(i.currentTopic.Name)),i.$textInput.blur(function(){return i.onTopicChangeHandler()}),i.$textInput.keydown(function(e){return i.keyDown(e)}),i.cbPlanner=e.CbPlanner.getInstance()})}return t.prototype.getPlanId=function(){var t=this.$textInput.closest("."+this.settings.Css.OnePlanContainer);return parseInt(t.data(e.PlannerConstants.dataAttributes.PlanId),10)},t.prototype.getCurrentTopicId=function(){return this.currentTopic?this.currentTopic.TopicId:0},t.prototype.getSelectedTopicId=function(){return this.selectedTopic?this.selectedTopic.TopicId:0},t.prototype.checkIfNeedsToUpdateTopic=function(){var e=!0,t=this.$textInput.val().trim();return this.currentTopic||this.selectedTopic||""!==t||(e=!1),(this.getCurrentTopicId()===this.getSelectedTopicId()&&this.getCurrentTopicId()>0||this.currentTopic.Name===t)&&(e=!1),e},t.prototype.onTopicChangeHandler=function(){var t=this;if(this.checkIfNeedsToUpdateTopic()){var n=this.getPlanId();CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.ConnectPlanToTopic,data:{courseId:this.courseId,topicId:this.getSelectedTopicId(),planId:n,topicName:this.$textInput.val()}}).done(function(i){if(i){var s=i.topicInfo;t.currentTopic&&t.currentTopic.TopicId===s.TopicId||t.$textInput.attr("data-"+t.settings.TopicIdDataAttribute,s.TopicId),t.currentTopic=s,t.selectedTopic=null,t.$textInput.val(t.currentTopic.Name),i.isCurrentTopicRenamed&&(t.updateTopicName(t.currentTopic.TopicId,t.currentTopic.Name),e.PlannerUtility.updateTopicFolderNode(i.topicConnectedFolderId,s.Name)),t.cbPlanner.updatePlansFolder(n,i.topicConnectedFolderId)}}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})}},t.prototype.keyDown=function(e){e.which===CCL.CommonConstants.keyCodes.enter&&(e.preventDefault(),this.$textInput[0].blur()),e.which===CCL.CommonConstants.keyCodes.escape&&(e.preventDefault(),this.selectedTopic=null,this.currentTopic&&this.$textInput.val(this.currentTopic.Name))},t.prototype.updateTopicName=function(e,t){var n=$("."+this.settings.Css.PlansContainer).find("."+this.settings.Css.TopicNameInput+CCL.CommonFunctions.getDataSelector(this.settings.TopicIdDataAttribute,e));$.each(n,function(e,n){$(n).val(t)})},t}();e.TopicSelector=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e,t,n){var i=this;this.sortDirection="DESC",this.refreshGrid=function(e,t){CCL.CommonFunctions.safeAjaxPost({url:i.context.WebMethods.LearnerLetters,data:{PersonId:i.context.PersonId,PageIndex:e-1,PageSize:t,SortDirection:i.sortDirection,SortColumn:i.sortColumn}}).done(function(e){null!=e&&(i.letters(e),i.updateScrollBarYHandler())})},this.pagerEventHandler=function(e){if(e===i.context.Pager.Name){var t=window[e];i.refreshGrid(t.pageNumber,t.pageSize)}},this.changeSortColumn=function(e){i.sortColumn===e?"DESC"===i.sortDirection?i.sortDirection="ASC":i.sortDirection="DESC":i.sortColumn=e;var t=window[i.context.Pager.Name];i.refreshGrid(t.pageNumber,t.pageSize)},this.getCourseTitle=function(e){return e||i.context.LanguageTerms.All},this.openLetterLink=function(e){window.open(e,"_blank")},this.openProfile=function(e,t){e===i.context.PersonId?$("li[data-tab='about']").find("a").trigger("click"):document.showProfileCard?document.showProfileCard(e):window.raw_popup(t,"","resizable,scrollbars,height=500,width=750")},this.updateScrollBarYHandler=function(){return i.lettersTabPage.perfectScrollbar("update"),!0},this.context=e,this.letters=ko.observableArray(t),this.sortColumn=e.Sort.CreatedDateColumnSortName,this.lettersTabPage=n,$(document).off(this.context.Pager.OnPageNumberChangedEventName+" "+this.context.Pager.OnPageSizeChangedEventName),$(document).on(this.context.Pager.OnPageNumberChangedEventName+" "+this.context.Pager.OnPageSizeChangedEventName,function(e,t){return i.pagerEventHandler(t)}),document.profileCardScope.isWindowLoading=!1,$(".c-modal__mask").on("click",document.profileCardScope.closeProfileCardWindow),n.perfectScrollbar({suppressScrollX:!0}),this.updateScrollBarYHandler(),$(window).on("resize",this.updateScrollBarYHandler);var s=$(".c-profileCard[data-personid='"+e.PersonId+"']");ko.utils.domNodeDisposal.addDisposeCallback(s[0],function(){$(window).off("resize",this.updateScrollBarYHandler)})};e.ProfileLetters=t}(e.ProfileCard||(e.ProfileCard={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(e){function t(t){var n=this;e.call(this,t.CommonAjaxClientSettings),this.settings=t,this.toggleLightBulletinSubscriptionForPerson=function(e,t){return $.ajax({type:"PUT",url:n.settings.Urls.ToggleLightBulletinSubscriptionForPerson,data:{lightBulletinId:e,subscribe:t},dataType:"json"})},this.getStreamList=function(e,t){return $.ajax({type:"GET",url:n.settings.Urls.GetStreamList,data:{boundaryNotificationActiveFromTicks:e,boundaryNotificationId:t}})}}return __extends(t,e),t}(e.CommonAjaxClient);t.StreamAjaxClient=n}(e.Stream||(e.Stream={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=e.LightBulletin.LightBulletinUtility,i=function(){function i(n,i){var s=this;this.controls=n,this.settings=i,this.numberOfRepeatsOfCheckingLastItemForIos=12,this.intervalBeforeCheckForLoading=250,this.minVisiblePartOfLastItemToLoadMore=.5,this.afterAddingComment=function(e){var t=e.userData.sourceId,n=s.getBulletinById(t);s.lightBulletinSingleItemDataManager.subscribeToCommentsIfNeeded(n,t)},this.lightBulletinMenuClicked=function(t){var n=t.detail,i=n.lightBulletinDropDownMenuActionType,o=n.lightBulletinId,r=s.getBulletinById(o);switch(i){case e.LightBulletin.LightBulletinDropDownMenuActionType.ToggleSubscription:var a=s.lightBulletinSingleItemDataManager.getSingleItemData(r).SubscriptionStatus!==e.LightBulletin.PersonSubscriptionStatus.Subscribed;s.ajaxClient.toggleLightBulletinSubscriptionForPerson(o,a).done(function(t){return e.LightBulletin.GenericResponseHandler.handle(t,function(){return s.lightBulletinSingleItemDataManager.updateSubscriptionStatus(r,o,a)})}).fail(s.ajaxClient.handleAjaxError),s.resetFocusOnCurrentItem(r);break;case e.LightBulletin.LightBulletinDropDownMenuActionType.ImmersiveReader:var l=o;window.fetch("/restapi/personal/immersivereader/v1?ResourceType=Bulletin&ResourceId="+l).then(function(e){if(!e.ok)throw Error(e.statusText);e.json().then(function(e){var t={accessToken:e.AccessToken,subDomain:e.SubDomain,content:{title:e.Title,chunks:[{content:e.Text}]},zindex:{uiZIndex:1e6}};window.ImmersiveReader.launchAsync(t.accessToken,t.subDomain,t.content,t.zindex)})})}},this.resetLastItem=function(){s.lastItem.removeAttr("data-"+s.settings.DataAttributes.BoundaryNotificationActiveFromTicks).removeAttr("data-"+s.settings.DataAttributes.BoundaryNotificationId),s.lastItem=$()},this.getCurrentLastItem=function(){return s.controls.ItemsContainer.find("[data-"+s.settings.DataAttributes.BoundaryNotificationActiveFromTicks+"]")},this.isAllItemsLoaded=function(){return 0===s.lastItem.length},this.lightBulletinContentNodeSelector="[data-"+this.settings.DataAttributes.LightBulletinId+"]",t.StreamContentBlockInstance=this,this.lastItem=this.getCurrentLastItem(),this.isFirstCallLazy=!0,this.oembedError=new e.LightBulletin.EmbedError(this.settings.OembedErrorCssClasses,this.settings.OembedErrorResources),this.isIosDevice=CCL.CommonFunctions.isIosDevice(),this.textExpander=new CCL.TextExpander(this.settings.TextExpanderSettings),this.lightBulletinShowMoreLinkRenderer=new e.LightBulletin.ShowMoreLinkRenderer(this.settings.ShowMoreLinkRendererSettings,this.textExpander,this.getBulletinId),this.lightBulletinEmbedAsynchronousLoader=new e.LightBulletin.EmbedAsynchronousLoader({isIosDevice:this.isIosDevice,cssClasses:{noBorder:this.settings.CssClasses.Border0,ajaxLoader:this.settings.CssClasses.AjaxLoader,oembedError:this.settings.OembedErrorCssClasses.OembedBoxError},selectors:{embedBox:"."+this.settings.CssClasses.OembedBox,bulletinItem:this.lightBulletinContentNodeSelector},dataAttributes:{embedIframeUrl:this.settings.DataAttributes.EmbedIframeUrl}}),this.lightBulletinSingleItemDataManager=new e.LightBulletin.LightBulletinSingleItemDataManager(this.settings.LightBulletinSingleDataDataAttributes,this.settings.LightBulletinSingleItemDataResources),this.ajaxClient=new t.StreamAjaxClient(this.settings),this.listenToEmbedPostmessages(),this.isAllItemsLoaded()||(this.isMobile()||this.loadIfReachedLastItem(!1,0),$(window).on(this.isIosDevice?"touchmove":"scroll",function(){s.isMobile()||s.loadIfReachedLastItem(!1,s.isIosDevice?s.numberOfRepeatsOfCheckingLastItemForIos:0)}),this.controls.ShowMoreLink.click(function(e){s.controls.ShowMoreLink.hide(),s.loadIfReachedLastItem(!0,0),e.preventDefault()})),e.LightBulletin.EmbedResizer.listenToEmbedSizePostmessages(this.controls.ItemsContainer,this.settings.CssClasses.OembedContent,this.lightBulletinEmbedAsynchronousLoader),this.renderShowMoreInLightBulletins(this.controls.ItemsContainer.find(this.lightBulletinContentNodeSelector)),this.lightBulletinSingleItemDataManager.setupSingleItemSvelte(this.controls.ItemsContainer.find(this.lightBulletinContentNodeSelector).get(),{isStream:!0}),this.lightBulletinEmbedAsynchronousLoader.appendIframeHolders(this.controls.ItemsContainer),this.lightBulletinEmbedAsynchronousLoader.loadEmbedContentAsync(),document.addEventListener("announcementDropDownMenuClick_b8079c41162443528e2a8153c4f924e8",function(e){return s.lightBulletinMenuClicked(e)})}return i.prototype.resetFocusOnCurrentItem=function(e){$(e).parent().find(".itsl-cb-stream-item-header > a").first().focus()},i.prototype.loadIfReachedLastItem=function(e,t){var n=this;if(this.isAllItemsLoaded()||!e&&!CCL.CommonFunctions.isOnScreen(this.lastItem,this.minVisiblePartOfLastItemToLoadMore,this.minVisiblePartOfLastItemToLoadMore,this.isIosDevice?window.parent:window))t>0&&setTimeout(function(){n.loadIfReachedLastItem(e,t-1)},this.intervalBeforeCheckForLoading);else{var i=this.lastItem.attr("data-"+this.settings.DataAttributes.BoundaryNotificationActiveFromTicks),s=this.lastItem.attr("data-"+this.settings.DataAttributes.BoundaryNotificationId);this.resetLastItem(),this.ajaxClient.getStreamList(i,s).done(function(e){if(e){var t=$(e);n.controls.ItemsContainer.append(t),n.renderShowMoreInLightBulletins(n.controls.ItemsContainer.find(n.lightBulletinContentNodeSelector)),n.lightBulletinSingleItemDataManager.setupSingleItemSvelte(t.find(n.lightBulletinContentNodeSelector).get(),{isStream:!0}),n.isFirstCallLazy&&($.ajax(n.settings.Urls.MeasureLazyLoading),n.isFirstCallLazy=!1),n.lightBulletinEmbedAsynchronousLoader.appendIframeHolders(t)}n.lastItem=n.getCurrentLastItem(),n.isAllItemsLoaded()||n.controls.ShowMoreLink.show()}).fail(CCL.CommonFunctions.alertAjaxError)}},i.prototype.renderShowMoreInLightBulletins=function(e){var t=this;e.each(function(e,i){var s=$(i);n.setTabindexToHiddenElements(s,t.lightBulletinShowMoreLinkRenderer.findClickablePlaceholder(s),"."+t.settings.CssClasses.ElementLink)}),this.lightBulletinShowMoreLinkRenderer.renderShowMoreLink(e,!1,function(e,i){return n.setTabindexToHiddenElements(e,i,"."+t.settings.CssClasses.ElementLink)})},i.prototype.isMobile=function(){return CCL.CommonFunctions.checkScreenSize(CCL.CommonConstants.mediaScreenSizes.mobile,!1)},i.prototype.getBulletinById=function(e){return this.controls.ItemsContainer.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.LightBulletinId,e))},i.prototype.getBulletinId=function(e){return e.data(this.settings.DataAttributes.LightBulletinId)||0},i.prototype.listenToEmbedPostmessages=function(){var e=this;CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.getEmbeddedContentData,function(t){var n=e.controls.ItemsContainer.find("#"+t.oembedPlaceHolderId);e.lightBulletinEmbedAsynchronousLoader.removeAjaxLoader(n),e.controls.ItemsContainer.removeClass(e.settings.CssClasses.AjaxLoader),t.isPlainLink&&!e.oembedError.hasOembedError(n)&&n.append(e.oembedError.generateOembedError({originalEmbedCode:t.originalEmbedCode,oembedPlaceHolder:n},e.lightBulletinEmbedAsynchronousLoader))})},i}();t.StreamContentBlock=i}(e.Stream||(e.Stream={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(t,n){var i=this;this._templates={},window[t]=this,e.instanceName=t,this._settings=n,this.css=n.Css,this.webMethods=n.WebMethods;var s=$("#"+this._settings.Controls.PlanTemplateId).html(),o=$("#"+this._settings.Controls.TopicTemplateId).html();this._templates[this._settings.Controls.PlanTemplateId]=Handlebars.compile(s),this._templates[this._settings.Controls.TopicTemplateId]=Handlebars.compile(o),this._container=$("."+n.Css.Container),setTimeout(function(){i.initTimeline()},100),this._planContextDialog=new ContextDialog("#"+this._settings.Controls.PlanContextDialogId,{valign:"bottom",width:500,zIndex:2,closeButtonTooltip:n.Terms.Close})}return e.getInstance=function(){return window[e.instanceName]},e.prototype.getContainer=function(){return this._container},e.prototype.isEmpty=function(){return this._settings.UseTopics?0===this._topics.length:0===this._plans.length},e.prototype.refresh=function(){return this._settings.UseTopics?this.loadTopics():this.loadTopicPlans()},e.prototype.toggleTimeline=function(e,t){var n=this;this.getContainer().hide(),e?($("#"+this._settings.Controls.LoadingLabelId).show(),this.refresh().done(function(){return n.showEmptyMessageIfNecessary()})):t&&this.toggleEmptyMessage(!1),$("#"+this._settings.Controls.LoadingLabelId).hide()},e.prototype.showEmptyMessageIfNecessary=function(){this.toggleEmptyMessage(this.isPlannerTimelineEmpty()),this.getContainer().toggle(!this.isPlannerTimelineEmpty())},e.prototype.toggleEmptyMessage=function(e){var t=this._container.parent().find("."+this._settings.Css.NoTopicsMessage);t&&t.toggle(e)},e.prototype.isPlannerTimelineEmpty=function(){return this._settings.UseTopics&&0===this._topics.length||!this._settings.UseTopics&&0===this._plans.length},e.prototype.initTimeline=function(){var e=this,t={margin:{item:{vertical:25,horizontal:5e3}},selectable:!1,locale:this._settings.Language,order:function(t,n){return e.orderTimelineItems(t,n)},template:function(t){return(0,e._templates[t.template])(t)},zoomMin:432e6,zoomMax:321408e5,maxHeight:500};this._timeline=new vis.Timeline(this._container[0],null,t),this._timeline.on("click",function(t){e._planContextDialog.isOpened()&&e._planContextDialog.closeDialog(),e.expandCollapseTimelineItem(t)}),$(document).trigger(this._settings.Events.TimelineControlInitialized)},e.prototype.expandCollapseTimelineItem=function(e){if(null!=e.item&&!$(e.event.target).hasClass(this.css.ItemTitle)){var t=e.item.split("#");if(1===t.length){var n=this.getTopicItem(e.item),i=this._timeline.itemSet.itemFromTarget(e.event).dom.box;if($(i).toggleClass(this.css.TopicArrowCollapsed,null!=n.Plans),$(i).toggleClass(this.css.TopicArrowExpanded,null==n.Plans),$(i).attr("title",this._settings.Terms.HidePlans),null!=n.Plans)return this.removeItemsFromTopicTimeline(n),void $(i).attr("title",this._settings.Terms.ShowPlans);this.loadTopicPlans(e.item)}else{var s=t[0],o=t[1],r=this.getPlanItem(e.item,s);r&&this.openDialogAndLoadPlanContents(o,r.Content,e)}}},e.prototype.openDialogAndLoadPlanContents=function(e,t,n){var i=this;this._planContextDialog.setTitle(t),this._planContextDialog.openDialog(n.event.srcEvent),this._planContextDialog.setContent(this._settings.Terms.Loading),CCL.CommonFunctions.safeAjaxPost({url:this._settings.WebMethods.GetSinglePlanForPlannerXhtml,data:{planId:e,courseId:this._settings.CourseId,childId:this._settings.ChildId,dashboardHierarchyId:this._settings.DashboardHierarchyId}}).done(function(e){i._planContextDialog.setContent(e.contentHtml),CCL.CustomTreeLinkNavigationManager.subscribeOnTreeLinkClick(i._planContextDialog.mainContainer)})},e.prototype.refreshTimeline=function(){var e=this,t=new Array,n=new Array;this._settings.UseTopics?$.each(this._topics,function(i,s){t.push(e.getTimelineItem(s,!1,s.Id,s.ColorSchemaClass)),n.push({id:s.Id,content:"",order:s.Order}),null!=s.Plans&&$.each(s.Plans,function(n,i){t.push(e.getTimelineItem(i,!0,s.Id,i.Active?s.ColorSchemaClass:e._settings.Css.InactivePlan))})}):$.each(this._plans,function(i,s){t.push(e.getTimelineItem(s,!0,s.Id,s.Active?e._settings.Css.DefaultColorSchemaClass:e._settings.Css.InactivePlan)),n.push({id:s.Id,content:"",order:s.Order})}),t.length>0&&this._timeline.setData({groups:n,items:t})},e.prototype.setViewOptions=function(e,t,n,i){this._timeline.setOptions({start:e,end:t,min:n,max:i})},e.prototype.addItemsToTopicTimeline=function(e){var t=this;$.each(e.Plans,function(n,i){t._timeline.itemsData.add(t.getTimelineItem(i,!0,e.Id,i.Active?e.ColorSchemaClass:t._settings.Css.InactivePlan))})},e.prototype.removeItemsFromTopicTimeline=function(e){if(null!=e.Plans){var t=[];$.each(e.Plans,function(e,n){t.push(n.Id)}),this._timeline.itemsData.remove(t),e.Plans=null}},e.prototype.loadTopics=function(){var e=this;return CCL.CommonFunctions.safeAjaxPost({url:this._settings.WebMethods.GetTopicsForPlannerTimeline,data:{courseId:this._settings.CourseId,start:this._settings.FilterStartDate,end:this._settings.FilterEndDate,childId:this._settings.ChildId,topicId:this._settings.FilteredTopicId,termId:this._settings.FilteredTermId}}).done(function(t){t&&t.topics&&(e.setViewOptions(t.initialStart,t.initialEnd,t.minStart,t.maxEnd),e._topics=t.topics,e.refreshTimeline())}).fail(function(){return CCL.CommonFunctions.alertAjaxError})},e.prototype.loadTopicPlans=function(e){var t=this;return void 0===e&&(e=""),CCL.CommonFunctions.safeAjaxPost({url:this._settings.WebMethods.GetPlansForPlannerTimeline,data:{courseId:this._settings.CourseId,topicIdString:e,start:this._settings.FilterStartDate,end:this._settings.FilterEndDate,childId:this._settings.ChildId}}).done(function(n){if(n&&n.plans)if(t._settings.UseTopics){var i=t.getTopicItem(e);i.Plans=n.plans,t.addItemsToTopicTimeline(i),n.topicStartDate&&n.topicStopDate&&(i.Start=n.topicStartDate,i.End=n.topicStopDate,t._timeline.itemsData.update(t.getTimelineItem(i,!1,i.Id,i.ColorSchemaClass)))}else t.setViewOptions(n.initialStart,n.initialEnd,n.minStart,n.maxEnd),t._plans=n.plans,t.refreshTimeline()}).fail(function(){return CCL.CommonFunctions.alertAjaxError})},e.prototype.getTopicItem=function(e){return this.getItem(this._topics,e)},e.prototype.getPlanItem=function(e,t){void 0===t&&(t=null);var n=null!=t&&this._settings.UseTopics?this.getTopicItem(t).Plans:this._plans;return this.getItem(n,e)},e.prototype.getItem=function(e,t){var n=null;return $.each(e,function(e,i){return i.Id!==t||(n=i,!1)}),n},e.prototype.getTimelineItem=function(e,t,n,i){var s=this.isTopicExpanded(e,t)?this._settings.Css.TopicArrowExpanded:this._settings.Css.TopicArrowCollapsed;return{id:e.Id,content:e.Content,start:e.Start,end:e.End,className:t?i+" "+this._settings.Css.Plan:i+" "+s,group:n,subgroup:t?e.Order:0,template:t?this._settings.Controls.PlanTemplateId:this._settings.Controls.TopicTemplateId,custom:t?e.ElementsCount:null,active:e.Active,title:t?this._settings.Terms.OpenPlanDetails:this.isTopicExpanded(e,t)?this._settings.Terms.HidePlans:this._settings.Terms.ShowPlans}},e.prototype.isTopicExpanded=function(e,t){return!t&&null!=e.Plans},e.prototype.orderTimelineItems=function(e,t){return t.subgroup-e.subgroup},e.prototype.parseDateFromString=function(e){return null!=e?$.datepicker.parseDate(this._settings.DateTimeFormat,e):null},e}();e.PlannerTimeline=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(e,t){this.dataAttributes=e,this.resources=t}return t.prototype.getSingleItemData=function(e){return e.data(this.dataAttributes.LightBulletinSingleItemData)},t.prototype.updateSingleItemData=function(e,t){e.data(this.dataAttributes.LightBulletinSingleItemData,t)},t.prototype.refreshSingleItemData=function(e,t){var n=this.getSingleItemData(e);return t(n),this.updateSingleItemData(e,n),n},t.prototype.updateSingleItemDataSvelte=function(e,t){document.dispatchEvent(new CustomEvent("updateLightBulletinItemData__932fac4c36a94d4bad696ffc1cff71f7",{detail:Object.assign({lightBulletinId:e},t)}))},t.prototype.updateSubscriptionStatus=function(t,n,i){this.refreshSingleItemData(t,function(t){return t.SubscriptionStatus=i?e.PersonSubscriptionStatus.Subscribed:e.PersonSubscriptionStatus.UnsubscribedManually}),this.updateSingleItemDataSvelte(n,{subscriptionStatus:i?e.PersonSubscriptionStatus.Subscribed:e.PersonSubscriptionStatus.UnsubscribedManually})},t.prototype.setupSingleItemSvelte=function(e,t){for(var n=this,i=t.isStream,s=function(e){var t=e.dataset,s=JSON.parse(i?t.lightBulletinSingleItemSharedDataSvelte:t.lightBulletinSingleItemDataSvelte),r=e.querySelector(i?"[data-"+o.dataAttributes.LightBulletinActionDropDown+"]":"[data-"+o.dataAttributes.LightBulletinSingleItemMountPoint+"]"),a=function(){return setTimeout(function(){r.dispatchEvent(new CustomEvent("renderAnnouncementManager_e109c648d1c6407f86bc83a62ef423ba",{bubbles:!0,detail:{isStream:i,lightBulletinItemData:s}}));var t=e.querySelector("[data-"+n.dataAttributes.LightBulletinSingleItemTextMountPoint+"]");t&&t.dispatchEvent(new CustomEvent("renderSingleAnnouncementText_321fdce554e046958f2a1810e14485a6",{bubbles:!0,detail:{lightBulletinId:s.lightBulletinId}}))},200)};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",a):a()},o=this,r=0,a=e;r<a.length;r++){s(a[r])}},t.prototype.subscribeToCommentsIfNeeded=function(t,n){this.getSingleItemData(t).SubscriptionStatus===e.PersonSubscriptionStatus.WasNotSubscribed&&this.updateSubscriptionStatus(t,n,!0)},t}();e.LightBulletinSingleItemDataManager=t}(e.LightBulletin||(e.LightBulletin={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e,t,n,i){var s=this;this.$itemSelector=e,this.idDataAttribute=t,this.selectAllItemId=n,this.languageTerms=i,this.hasItems=function(){return s.getAllItems().length>0},this.getItemId=function(e){var t=s.getItemIdByDataAttribute(s.getItem(e));return s.areAllItemsSelected(t)?null:t},this.setDefaultItemText=function(e){var t=s.getItem(e),n=s.getItemIdByDataAttribute(t),i=s.areAllItemsSelected(n)?s.languageTerms.All+" "+s.languageTerms.Items.toLowerCase():t.text();s.$itemSelector.text(i)},this.getAllItems=function(){return s.$itemSelector.parent().find("[data-"+s.idDataAttribute+"]")},this.isItem=function(e){return null!=e.closest("[data-"+s.idDataAttribute+"]")},this.getItem=function(e){return e.closest("[data-"+s.idDataAttribute+"]")},this.getItemIdByDataAttribute=function(e){return e.data(s.idDataAttribute)},this.areAllItemsSelected=function(e){return e===s.selectAllItemId}},n=function(){function e(n,i,s){var o=this;this.settings=i,this.controls=s,this.initPerfectScrollbar=function(){o.controls.MenuContainer.perfectScrollbar({suppressScrollX:!0}),$(window).on("resize",o.updateScrollBarYHandler)},this.updateScrollBarYHandler=function(){o.controls.MenuContainer.perfectScrollbar("update")},this.onItemClickHandler=function(t){var n=o.itemSelectorManagerManager.getItemId($(t.target));void 0!==n&&(o.selectedItemId=n,o.itemSelectorManagerManager.setDefaultItemText($(t.target)),o.controls.ItemSelector.trigger(e.itemSelectorOnChangeEventName,o))},window[n]=this,this.itemSelectorManagerManager=new t(this.controls.ItemSelector,this.settings.DataAttributes.ItemId,this.settings.SelectAllItemId,this.settings.LanguageTerms),this.initPerfectScrollbar(),this.controls.ItemSelector.parent().on("focusin",function(){o.controls.ItemSelector.addClass(o.settings.CssClasses.MenuIsActive)}),this.controls.ItemSelector.parent().on("focusout",function(){o.controls.ItemSelector.removeClass(o.settings.CssClasses.MenuIsActive)}),this.controls.ItemSelector.on("keyup",function(e){e.which===CCL.CommonConstants.keyCodes.enter&&o.controls.ItemSelector.trigger("click")}),this.controls.MenuContainer.on(CCL.CommonFunctions.isMobileDevice()?"touchstart":"click",this.onItemClickHandler),this.itemSelectorManagerManager.getAllItems().on("keyup",function(e){e.which===CCL.CommonConstants.keyCodes.enter&&(o.onItemClickHandler(e),o.controls.MenuContainer.trigger("click"))})}return Object.defineProperty(e.prototype,"hasItems",{get:function(){return this.itemSelectorManagerManager.hasItems()},enumerable:!0,configurable:!0}),e.itemSelectorOnChangeEventName="itemSelector:onchange",e}();e.ItemSelector=n}(e.ItemSelector||(e.ItemSelector={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e){this.settings=e,this.modalDialog=window[this.settings.ContainerId]}return e.prototype.openDialog=function(e,t){this.modalDialog.setAjaxUrl(this.settings.DialogContentUrl,t,!1),this.modalDialog.setTitle(e.header),$("#"+this.settings.HeaderId).text(e.assessmentName),this.modalDialog.openDialog(!1)},e}();e.TermAssessmentDialogManager=t}(e.Supervisor||(e.Supervisor={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function e(t,n){var i=this;this.serviceUrls=t,this.model=n,this.getAssessments=function(){var e={supervisorType:i.model.supervisorType,courseId:i.model.courseId,termId:i.model.termId(),categoryIds:i.model.categoryIds()},t=CCL.CommonFunctions.safeAjaxPost({url:i.serviceUrls.Assessments,data:e,dataType:"json"});return t.done(function(e){i.model.addAssessments(e)}),t},this.getAssessmentPersonResults=function(){var t={supervisorType:i.model.supervisorType,courseId:i.model.courseId,assessmentIds:i.model.assessments().map(function(e){return e.id}),paging:{pageIndex:i.model.assessmentPersonResultsCurrentPage,pageSize:e.pageSize},sortDescending:i.model.sortDescending},n=CCL.CommonFunctions.safeAjaxPost({url:i.serviceUrls.AssessmentPersonResults,data:t,dataType:"json"});return n.done(function(e){i.model.addAssessmentPersonResults(e)}),n}}return e.pageSize=50,e}(),i=function(){function t(t){var i=this;this.settings=t,this.isScrollingInProgress=!1,this.assessmentPersonResultsCurrentPage=0,this.sortDescending=!1,this.initialise=function(){i.areAssessmentsBeingLoaded(!0),i.dataFetcher.getAssessments()},this.addAssessments=function(e){if(e){var t=e.map(function(e){return{id:e.Id,title:e.Title}});[].push.apply(i.assessments(),t),i.assessments.valueHasMutated()}i.areAssessmentsBeingLoaded(!1),i.fetchAssessmentPersonResultsData(i.resetAssessmentRecordScroll)},this.addAssessmentPersonResults=function(e){if(e){var t=e.map(function(e){return{personId:e.PersonId,fullName:e.FullName,pictureUrl:e.PictureUrl,fallbackProfileUrl:e.FallbackProfileUrl,fallbackPictureUrl:e.FallbackPictureUrl,tooltipText:e.TooltipText,results:e.Results.map(function(e){return{gradebookItemId:e.GradebookItemId,score:e.Score?e.Score:"-",hasComment:e.HasComment}})}});[].push.apply(i.assessmentPersonResults(),t),i.assessmentPersonResults.valueHasMutated()}0===i.assessmentPersonResultsCurrentPage?i.areAssessmentsPersonResultsBeingLoaded(!1):i.isAssessmentsPersonResultsPageBeingLoaded(!1),(!e||0===e.length||e.length<n.pageSize)&&i.areAllAssessmentPersonResultsRetreived(!0),i.assessmentPersonResultsCurrentPage++,i.$assessmentColumnsContainer.perfectScrollbar("update")},this.openProfileCard=function(e){document.showProfileCard?document.showProfileCard(e.personId):window.raw_popup(e.fallbackProfileUrl,"","resizable,scrollbars,height=500,width=750")},this.sortByName=function(){i.sortDescending=!i.sortDescending,i.isScrolledToTheBottom(!1),i.fetchAssessmentPersonResultsData(i.resetAssessmentRecordScroll)},this.fetchAssessmentsData=function(){i.cancelDataFetching(),i.areAssessmentsBeingLoaded(!0),i.assessments([]),i.clearAssessmentPersonResultsData(),i.fetchAssessmentsCallbackDebouncer.invokeCallback({},200)},this.clearAssessmentPersonResultsData=function(){i.areAssessmentsPersonResultsBeingLoaded(!0),i.assessmentPersonResults([]),i.isAssessmentsPersonResultsPageBeingLoaded(!1),i.areAllAssessmentPersonResultsRetreived(!1),i.assessmentPersonResultsCurrentPage=0,i.isScrolledToTheBottom(!1),i.resultsScrollLeft=0,i.resultsScrollTop=0},this.fetchAssessmentPersonResultsData=function(e){void 0===e&&(e=null),i.cancelDataFetching(),i.clearAssessmentPersonResultsData(),i.fetchAssessmentPersonResultsCallbackDebouncer.invokeCallback(e,200)},this.fetchAssessmentPersonResultsPage=function(){i.isAssessmentsPersonResultsPageBeingLoaded(!0),i.fetchAssessmentPersonResultsCallbackDebouncer.invokeCallback(null,200)},this.cancelDataFetching=function(){null!=i.fetchAssessmentPersonResultsPromise&&i.fetchAssessmentPersonResultsPromise.readyState!==i.fetchAssessmentPersonResultsPromise.DONE&&i.fetchAssessmentPersonResultsPromise.abort(),null!=i.fetchAssessmentsPromise&&i.fetchAssessmentsPromise.readyState!==i.fetchAssessmentsPromise.DONE&&i.fetchAssessmentsPromise.abort()},this.onAssessmentResultsScrollHandler=function(){if(!i.isScrollingInProgress){i.isScrollingInProgress=!0;var e=i.$assessmentColumnsContainer.scrollLeft();e!==i.resultsScrollLeft&&(i.resultsScrollLeft=e,$("."+i.settings.CssClasses.AssessmentHeaders).scrollLeft(i.resultsScrollLeft));var t=i.$assessmentColumnsContainer.scrollTop();if(t!==i.resultsScrollTop)i.fetchAssessmentPersonResultsPageOnScrollHandler(t),i.resultsScrollTop=t,$("."+i.settings.CssClasses.StudentsColumn).scrollTop(i.resultsScrollTop),Math.ceil(i.$assessmentColumnsContainer[0].scrollHeight-i.$assessmentColumnsContainer[0].scrollTop)===i.$assessmentColumnsContainer[0].clientHeight&&i.isScrolledToTheBottom(!0);i.isScrollingInProgress=!1}},this.resetAssessmentRecordScroll=function(){i.$assessmentColumnsContainer.scrollTop(0),i.$studentsColumn.scrollTop(0)},this.fetchAssessmentPersonResultsPageOnScrollHandler=function(e){if(!i.areAssessmentsPersonResultsBeingLoaded()&&!i.areAllAssessmentPersonResultsRetreived()&&e>i.resultsScrollTop){var t=$("."+i.settings.CssClasses.AssessmentColumnsContainer+" > ."+i.settings.CssClasses.AssessmentColumn).first().children(),s=t.eq(t.length-n.pageSize/2);CCL.CommonFunctions.isOnScreen(s,.5,.5)&&i.fetchAssessmentPersonResultsPage()}},this.initialiseTermFilter=function(){i.$termFilter.on(e.ItemSelector.ItemSelector.itemSelectorOnChangeEventName,i.onTermFilterItemClickHandler)},this.onTermFilterItemClickHandler=function(e,t){i.termId(t.selectedItemId),i.fetchAssessmentsData()},this.initialiseCategoryFilter=function(){i.$categoryFilter.on(e.ItemMultiSelector.ItemMultiSelector.itemMultiSelectorOnChangeEventName,i.onCategoryFilterItemClickHandler)},this.onCategoryFilterItemClickHandler=function(e,t){i.categoryIds(t.selectedItemIds),i.fetchAssessmentsData()},this.dataFetcher=new n(this.settings.ServiceUrls,this),this.fetchAssessmentsCallbackDebouncer=new CCL.CallbackDebouncer(function(){i.fetchAssessmentsPromise=i.dataFetcher.getAssessments()}),this.fetchAssessmentPersonResultsCallbackDebouncer=new CCL.CallbackDebouncer(function(e){i.fetchAssessmentPersonResultsPromise=i.dataFetcher.getAssessmentPersonResults(),e&&i.fetchAssessmentPersonResultsPromise.done(function(){return e()})}),this.termId=ko.observable(null),this.categoryIds=ko.observableArray([]),this.areAssessmentsBeingLoaded=ko.observable(!0),this.assessments=ko.observableArray([]),this.areAssessmentsPersonResultsBeingLoaded=ko.observable(!0),this.isAssessmentsPersonResultsPageBeingLoaded=ko.observable(!1),this.areAllAssessmentPersonResultsRetreived=ko.observable(!1),this.assessmentPersonResults=ko.observableArray([]),this.persons=ko.computed(function(){return i.assessmentPersonResults().map(function(e){return e})}),this.resultsScrollLeft=this.$assessmentColumnsContainer.scrollLeft(),this.resultsScrollTop=this.$assessmentColumnsContainer.scrollTop(),this.initialiseTermFilter(),this.initialiseCategoryFilter(),this.isScrolledToTheBottom=ko.observable(!1)}return Object.defineProperty(t.prototype,"$assessmentColumnsContainer",{get:function(){return $("."+this.settings.CssClasses.AssessmentColumnsContainer)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$studentsColumn",{get:function(){return $("."+this.settings.CssClasses.StudentsColumn)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$termFilter",{get:function(){return $("#"+this.settings.ClientIds.TermFilter)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"$categoryFilter",{get:function(){return $("#"+this.settings.ClientIds.CategoryFilter)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"supervisorType",{get:function(){return this.settings.SupervisorType},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"courseId",{get:function(){return this.settings.CourseId},enumerable:!0,configurable:!0}),t}();t.AssessmentRecordViewModel=i;var s=function(){function t(t){var n=this;this.settings=t,this.preventFromDropDownMenuFromClosing=function(e){$(e.target).is(n.$container.children().first())&&e.stopPropagation()};var s=new e.KnockoutCustomBindingsManager;s.registerSafeImgBinding(),s.registerPerfectScrollBarBinding(),this.model=new i(t),ko.applyBindings(this.model,this.$container[0]),this.model.initialise(),this.$container.on("click",this.preventFromDropDownMenuFromClosing),ko.utils.domNodeDisposal.addDisposeCallback(this.$container[0],function(){n.$container.off("click",n.preventFromDropDownMenuFromClosing)})}return Object.defineProperty(t.prototype,"$container",{get:function(){return $("."+this.settings.CssClasses.Container)},enumerable:!0,configurable:!0}),t}();t.AssessmentRecord=s}(e.Supervisor||(e.Supervisor={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function e(t,n){var i=this;this.serviceUrls=t,this.model=n,this.getDataForOrganisation=function(){var e={supervisorType:i.model.supervisorType,organisationId:i.model.organisationId()},t=CCL.CommonFunctions.safeAjaxPost({url:i.serviceUrls.Filters,data:e,dataType:"html"});return t.done(function(e){i.model.updateOrganisation(e)}),t},this.getCourses=function(){var t={supervisorType:i.model.supervisorType,organisationId:i.model.organisationId(),termId:i.model.termId(),paging:{pageIndex:i.model.coursesCurrentPage,pageSize:e.coursesPageSize}},n=CCL.CommonFunctions.safeAjaxPost({url:i.serviceUrls.Courses,data:t,dataType:"json"});return n.done(function(e){i.model.addCourses(e),i.model.areCoursesBeingLoaded(!1)}),n},this.getTermAssessments=function(){if(!i.model.currentCourse())return null;var e={supervisorType:i.model.supervisorType,organisationId:i.model.organisationId(),termId:i.model.termId(),courseId:i.model.currentCourse().id,hierarchyIds:i.model.hierarchyIds()},t=CCL.CommonFunctions.safeAjaxPost({url:i.serviceUrls.TermAssessments,data:e,dataType:"json"});return t.done(function(e){e&&i.model.addTermAssessments(e),i.model.areCourseTermAssessmentsBeingLoaded(!1)}),t},this.getTermAssessmentPersonResults=function(){if(!i.model.currentCourse())return null;var t={supervisorType:i.model.supervisorType,organisationId:i.model.organisationId(),termId:i.model.termId(),courseId:i.model.currentCourse().id,hierarchyIds:i.model.hierarchyIds(),finalAssessmentIds:i.model.termAssessments().map(function(e){return e.id}),paging:{pageIndex:i.model.termAssessmentPersonResultsCurrentPage,pageSize:e.termAssessmentPersonResultsPageSize},sortDescending:i.model.sortDescending},n=CCL.CommonFunctions.safeAjaxPost({url:i.serviceUrls.TermAssessmentPersonResults,data:t,dataType:"json"});return n.done(function(e){i.model.addTermAssessmentPersonResults(e),i.model.areCourseTermAssessmentsResultsBeingLoaded(!1)}),n}}return e.coursesPageSize=10,e.termAssessmentPersonResultsPageSize=50,e}(),i=function(){function i(i){var s=this;this.settings=i,this.isResultsHorisontalScrollInProgress=!1,this.coursesCurrentPage=0,this.termAssessmentPersonResultsCurrentPage=0,this.sortDescending=!1,this.updateOrganisation=function(e){$("."+s.settings.CssClasses.FiltersContainer).replaceWith($(e)),s.initialiseFilters(),s.fetchCoursesData()},this.addCourses=function(e){var t=0===s.coursesCurrentPage,i=e.map(function(e,n){return{id:e.Id,title:e.Title,isSelected:!!t&&0===n,assessmentRecordTooltip:s.getAssessmentRecordTooltip(e.Title)}});[].push.apply(s.courses(),i),s.courses.valueHasMutated(),s.coursesCount(s.courses().length),t?(s.areCoursesBeingLoaded(!1),s.enableHierarchyFilter(),s.coursesCount()>0&&s.selectCourse(s.courses()[0])):s.isCoursesPageBeingLoaded(!1),(0===e.length||e.length<n.coursesPageSize)&&s.areAllCoursesRetreived(!0),s.coursesCurrentPage++},this.selectCourse=function(e){s.currentCourse(e),s.fetchTermAssessmentsData(),$(window).scrollTop(0)},this.openAssessmentRecord=function(e){window.location.href=s.settings.ServiceUrls.AssessmentRecord+"?courseId="+e.id+"&supervisorType="+s.settings.SupervisorType},this.selectStudent=function(e){s.currentStudent(e)},this.clearStudent=function(){s.currentStudent(null)},this.addTermAssessments=function(e){var t=e.map(function(e){return{id:e.Id,title:e.Title}});[].push.apply(s.termAssessments(),t),s.termAssessments.valueHasMutated(),s.termAssessmentsCount(s.termAssessments().length),s.fetchTermAssessmentPersonResultsData()},this.addTermAssessmentPersonResults=function(e){if(e){var t=e.map(function(e){return{personId:e.PersonId,fullName:e.FullName,pictureUrl:e.PictureUrl,fallbackProfileUrl:e.FallbackProfileUrl,fallbackPictureUrl:e.FallbackPictureUrl,tooltipText:e.TooltipText,results:e.Results.map(function(e){return{gradebookItemId:e.GradebookItemId,score:e.Score,hasComment:e.HasComment}})}});[].push.apply(s.termAssessmentPersonResults(),t),s.termAssessmentPersonResults.valueHasMutated(),s.termAssessmentPersonResultsCount(s.termAssessmentPersonResults().length)}0===s.termAssessmentPersonResultsCurrentPage?s.areCourseTermAssessmentsResultsBeingLoaded(!1):s.isTermAssessmentPersonResultsPageBeingLoaded(!1),(!e||0===e.length||e.length<n.termAssessmentPersonResultsPageSize)&&s.areAllTermAssessmentPersonResultsRetreived(!0),s.termAssessmentPersonResultsCurrentPage++},this.openProfileCard=function(e){document.showProfileCard?document.showProfileCard(e.personId):window.raw_popup(e.fallbackProfileUrl,"","resizable,scrollbars,height=500,width=750")},this.sortByName=function(){s.sortDescending=!s.sortDescending,s.fetchTermAssessmentPersonResultsData(),$(window).scrollTop(0)},this.showMoreCourses=function(){s.fetchCoursesPage()},this.showMoreResults=function(){s.fetchTermAssessmentPersonResultsPage()},this.scrollResultsContainer=function(){s.scrollHorisontaly($("."+s.settings.CssClasses.ResultsFixedHeadersWrapper),$("."+s.settings.CssClasses.ResultsContainer))},this.scrollResultsFixedHeader=function(){s.scrollHorisontaly($("."+s.settings.CssClasses.ResultsContainer),$("."+s.settings.CssClasses.ResultsFixedHeadersWrapper))},this.ajustResultsFixedHeaderPosition=function(){s.onResultsFixedHeaderPositionChangeHandler()},this.scrollHorisontaly=function(e,t){s.isResultsHorisontalScrollInProgress||(s.isResultsHorisontalScrollInProgress=!0,t.scrollLeft(e.scrollLeft()),s.isResultsHorisontalScrollInProgress=!1)},this.isScrolledIntoView=function(e){return e.offset().top>=$(window).scrollTop()},this.onResultsFixedHeaderPositionChangeHandler=function(){var e=$("."+s.settings.CssClasses.StudentHeader);if(e.length>0){var t=CCL.CommonFunctions.isElementFullyShownInWindow(e),n=$("."+s.settings.CssClasses.ResultsContainer),i=CCL.CommonFunctions.isElementFullyShownInWindow(n),o=$("."+s.settings.CssClasses.StudentFixedHeader),r=$("."+s.settings.CssClasses.ResultsFixedHeadersWrapper);if(t&&i)o.css({display:"none"}),r.css({display:"none"});else{var a=t||s.isScrolledIntoView(n)?e.offset().top-$(window).scrollTop():0;o.css({display:"block",position:"fixed",top:a,height:e.outerHeight(!0),width:e.outerWidth(!0)}),r.css({display:"block",position:"fixed",top:a,left:e.offset().left+e.outerWidth(!0),height:e.outerHeight(!0),width:n.outerWidth(!0)}),r.perfectScrollbar("update"),$("."+s.settings.CssClasses.ResultsFixedHeadersContainer).css({display:"flex",width:n[0].scrollWidth});var l=$("."+s.settings.CssClasses.ResultsFixedHeader),c=$("."+s.settings.CssClasses.ResultsHeader);l.each(function(e,t){$(t).css({width:c.eq(e).outerWidth(!0)})})}}},this.openAssessmentDialog=function(e,n){var i=t.termAssessmentDialogManagerInstance;if(i){var o=ko.utils.arrayFirst(s.termAssessments(),function(e){return e.id===n}),r=ko.utils.arrayFirst(s.termAssessmentPersonResults(),function(t){return t.personId===e});i.openDialog({header:r.fullName,assessmentName:o.title},{personId:e,gradebookItemId:n,supervisorType:s.settings.SupervisorType})}},this.openAssessmentDialogForCurrentStudent=function(e,t){s.openAssessmentDialog(e().personId,t)},this.getPersonGradebookItemResult=function(e,t){var n=ko.utils.arrayFirst(s.termAssessmentPersonResults(),function(t){return t.personId===e().personId});return ko.utils.arrayFirst(n.results,function(e){return e.gradebookItemId===t})},this.initialiseFilters=function(){s.initialiseOrganisationFilter(),s.initialiseTermFilter(),s.initialiseHierarchyFilter()},this.disableFilters=function(){s.$organisationFilter.addClass(s.settings.CssClasses.FilterDisabled),s.$organisationFilter.prop("disabled",!0),s.$termFilter.addClass(s.settings.CssClasses.FilterDisabled),s.$termFilter.prop("disabled",!0),s.disableHierarchyFilter()},this.disableHierarchyFilter=function(){s.$hierarchyFilter.addClass(s.settings.CssClasses.FilterDisabled),s.$hierarchyFilter.prop("disabled",!0)},this.enableHierarchyFilter=function(){window[s.settings.ClientIds.HierarchyFilter].hasItems&&(s.$hierarchyFilter.removeClass(s.settings.CssClasses.FilterDisabled),s.$hierarchyFilter.removeProp("disabled"))},this.initialiseOrganisationFilter=function(){s.$organisationFilter.on(e.ItemSelector.ItemSelector.itemSelectorOnChangeEventName,s.onOrganisationFilterClickHandler)},this.onOrganisationFilterClickHandler=function(e,t){s.organisationId(t.selectedItemId),s.fetchOrganisationData()},this.initialiseTermFilter=function(){s.$termFilter.on(e.ItemSelector.ItemSelector.itemSelectorOnChangeEventName,s.onTermFilterItemClickHandler)},this.onTermFilterItemClickHandler=function(e,t){s.termId(t.selectedItemId),s.fetchCoursesData()},this.initialiseHierarchyFilter=function(){s.$hierarchyFilter.on(e.ItemMultiSelector.ItemMultiSelector.itemMultiSelectorOnChangeEventName,s.onHierarchyFilterItemClickHandler)},this.onHierarchyFilterItemClickHandler=function(e,t){s.hierarchyIds(t.selectedItemIds),s.fetchTermAssessmentPersonResultsData()},this.fetchOrganisationData=function(){s.clearFilters(),s.clearCoursesData(),s.cancelDataFetching(),s.disableFilters(),s.fetchFiltersCallbackDebouncer.invokeCallback({},200)},this.fetchCoursesData=function(){s.clearCoursesData(),s.clearTermAssessmentsData(),s.cancelDataFetching(),s.disableHierarchyFilter(),s.fetchCoursesCallbackDebouncer.invokeCallback({},200)},this.fetchCoursesPage=function(){s.isCoursesPageBeingLoaded(!0),s.fetchCoursesCallbackDebouncer.invokeCallback({},200)},this.fetchTermAssessmentsData=function(){s.clearTermAssessmentsData(),s.clearTermAssessmentPersonResultsData(),s.cancelDataFetching(),s.fetchTermAssessmentsCallbackDebouncer.invokeCallback({},200)},this.fetchTermAssessmentPersonResultsData=function(){s.clearTermAssessmentPersonResultsData(),s.cancelDataFetching(),s.fetchTermAssessmentPersonResultsCallbackDebouncer.invokeCallback({},200)},this.onFetchTermAssessmentPersonResultsPageHandler=function(e){if(!s.areCourseTermAssessmentsResultsBeingLoaded()&&!s.areAllTermAssessmentPersonResultsRetreived()&&!s.isStudentSelectedInMobile()){var t=$(e.target).scrollTop();if(t>s.termAssessmentPersonResultsListScrollTop){var i=void 0,o=(i=$("."+s.settings.CssClasses.MobileStudentContainer).is(":visible")?$("."+s.settings.CssClasses.MobileStudentContainer).children():$("."+s.settings.CssClasses.StudentsContainer).children()).eq(i.length-n.termAssessmentPersonResultsPageSize/2);CCL.CommonFunctions.isOnScreen(o,.5,.5)&&s.fetchTermAssessmentPersonResultsPage()}s.termAssessmentPersonResultsListScrollTop=t}},this.fetchTermAssessmentPersonResultsPage=function(){s.isTermAssessmentPersonResultsPageBeingLoaded(!0),s.fetchTermAssessmentPersonResultsCallbackDebouncer.invokeCallback({},200)},this.cancelDataFetching=function(){null!=s.fetchFiltersPromise&&s.fetchFiltersPromise.readyState!==s.fetchFiltersPromise.DONE&&s.fetchFiltersPromise.abort(),null!=s.fetchCoursesPromise&&s.fetchCoursesPromise.readyState!==s.fetchCoursesPromise.DONE&&s.fetchCoursesPromise.abort(),null!=s.fetchTermAssessmentsPromise&&s.fetchTermAssessmentsPromise.readyState!==s.fetchTermAssessmentsPromise.DONE&&s.fetchTermAssessmentsPromise.abort(),null!=s.fetchTermAssessmentPersonResultsPromise&&s.fetchTermAssessmentPersonResultsPromise.readyState!==s.fetchTermAssessmentPersonResultsPromise.DONE&&s.fetchTermAssessmentPersonResultsPromise.abort()},this.clearFilters=function(){s.termId(null),s.hierarchyIds([])},this.clearCoursesData=function(){s.courses([]),s.coursesCount(s.courses().length),s.areCoursesBeingLoaded(!0),s.isCoursesPageBeingLoaded(!1),s.currentCourse(null),s.areAllCoursesRetreived(!1),s.coursesCurrentPage=0,s.clearTermAssessmentsData(),s.clearTermAssessmentPersonResultsData()},this.clearTermAssessmentsData=function(){s.termAssessments([]),s.termAssessmentsCount(s.termAssessments().length),s.areCourseTermAssessmentsBeingLoaded(!0)},this.clearTermAssessmentPersonResultsData=function(){s.termAssessmentPersonResults([]),s.termAssessmentPersonResultsCount(s.termAssessmentPersonResults().length),s.areCourseTermAssessmentsResultsBeingLoaded(!0),s.isTermAssessmentPersonResultsPageBeingLoaded(!1),s.currentStudent(null),s.areAllTermAssessmentPersonResultsRetreived(!1),s.termAssessmentPersonResultsCurrentPage=0,s.ajustResultsFixedHeaderPosition()},this.getAssessmentRecordTooltip=function(e){var t=CCL.CommonFunctions.htmlEncode(e);return CCL.CommonFunctions.formatString(s.settings.LanguageTerms.AssessmentRecordTooltip,t)},this.dataFetcher=new n(this.settings.ServiceUrls,this),this.fetchCoursesCallbackDebouncer=new CCL.CallbackDebouncer(function(){s.fetchCoursesPromise=s.dataFetcher.getCourses()}),this.fetchFiltersCallbackDebouncer=new CCL.CallbackDebouncer(function(){s.fetchFiltersPromise=s.dataFetcher.getDataForOrganisation()}),this.fetchTermAssessmentsCallbackDebouncer=new CCL.CallbackDebouncer(function(){s.fetchTermAssessmentsPromise=s.dataFetcher.getTermAssessments()}),this.fetchTermAssessmentPersonResultsCallbackDebouncer=new CCL.CallbackDebouncer(function(){s.fetchTermAssessmentPersonResultsPromise=s.dataFetcher.getTermAssessmentPersonResults()}),this.organisationId=ko.observable(this.settings.OrganisationId),this.termId=ko.observable(0===this.settings.TermId?null:this.settings.TermId),this.currentCourse=ko.observable(null),this.hierarchyIds=ko.observableArray(this.settings.HierarchyIds),this.currentCourseTitle=ko.pureComputed(function(){var e="";return null!=s.currentCourse()&&(e=s.currentCourse().title),e}),this.areCoursesInitiated=ko.observable(!1),this.areCoursesBeingLoaded=ko.observable(!0),this.isCoursesPageBeingLoaded=ko.observable(!1),this.areCourseTermAssessmentsBeingLoaded=ko.observable(!0),this.areCourseTermAssessmentsResultsBeingLoaded=ko.observable(!0),this.isTermAssessmentPersonResultsPageBeingLoaded=ko.observable(!1),this.courses=ko.observableArray([]),this.coursesCount=ko.observable(0),this.areAllCoursesRetreived=ko.observable(!1),this.termAssessments=ko.observableArray([]),this.termAssessmentsCount=ko.observable(0),this.termAssessmentPersonResults=ko.observableArray([]),this.termAssessmentPersonResultsCount=ko.observable(0),this.areAllTermAssessmentPersonResultsRetreived=ko.observable(!1),this.persons=ko.computed(function(){return s.termAssessmentPersonResults().map(function(e){return e})}),this.currentStudent=ko.observable(null),this.isStudentSelectedInMobile=ko.computed(function(){return s.currentStudent()&&CCL.CommonFunctions.isMobileDevice()}),this.initialiseFilters(),this.termAssessmentPersonResultsListScrollTop=$(window).scrollTop(),$(window).on("resize scroll touchmove",this.onResultsFixedHeaderPositionChangeHandler),$(window).on("scroll touchmove",this.onFetchTermAssessmentPersonResultsPageHandler)}return Object.defineProperty(i.prototype,"$organisationFilter",{get:function(){return $("#"+this.settings.ClientIds.OrganisationFilter)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"$termFilter",{get:function(){return $("#"+this.settings.ClientIds.TermFilter)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"$hierarchyFilter",{get:function(){return $("#"+this.settings.ClientIds.HierarchyFilter)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"supervisorType",{get:function(){return this.settings.SupervisorType},enumerable:!0,configurable:!0}),i}();t.TermAssessmentsViewModel=i;var s=function(){function t(t){var n=this;this.settings=t,this.preventFromDropDownMenuFromClosing=function(e){$(e.target).is(n.$container.children().first())&&e.stopPropagation()};var s=new e.KnockoutCustomBindingsManager;s.registerSafeImgBinding(),s.registerPerfectScrollBarBinding(),this.model=new i(this.settings),ko.applyBindings(this.model,this.$container[0]),this.model.dataFetcher.getCourses().done(function(){n.model.areCoursesInitiated(!0)}),this.$container.on("click",this.preventFromDropDownMenuFromClosing),ko.utils.domNodeDisposal.addDisposeCallback(this.$container[0],function(){n.$container.off("click",n.preventFromDropDownMenuFromClosing)})}return Object.defineProperty(t.prototype,"$container",{get:function(){return $("."+this.settings.CssClasses.Container)},enumerable:!0,configurable:!0}),t}();t.TermAssessments=s}(e.Supervisor||(e.Supervisor={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e){var t=this;this.context=e,$("#"+this.context.Controls.DeleteButtonId).on(CCL.CommonFunctions.isMobileDevice()?"touchstart":"click",function(){return t.deleteSelectedTerms()})}return e.prototype.deleteSelectedTerms=function(){var e=this,t=window[this.context.Controls.DataGridName],n=t.GetSelectedValues(),i=[];if(n&&n.length>0&&(i=n.substr(0,n.length-1).split(",")),!t.GetNumberOfSelectedRows())return jAlert(this.context.Settings.PleaseMakeSelectionMessage),!1;var s=this.context.Settings.DeleteWarningMessage.replace(/#NumberOfSelectedRows/g,t.GetNumberOfSelectedRows());for(var o in i)if(i.hasOwnProperty(o)&&-1!==this.context.TermIdsUsedInGradebook.indexOf(i[o])){s=this.context.Settings.DeleteWarningMessageWithExistTermInGradebook;break}return $.alerts.okButton=this.context.Settings.YesButtonText,$.alerts.cancelButton=this.context.Settings.NotButtonText,jConfirm(s,this.context.Settings.WarningDialogTitle,function(t){t&&__doPostBack("__Page",e.context.Settings.PostBackArgumentDelete)}),!1},e}();e.TermManagement=t}(e.TermManagement||(e.TermManagement={}))}(e.Terms||(e.Terms={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(e,t){var n=[],i=new DivToggler({divId:t.ClientIds.TopMenuArea,isCollapsed:!t.TopmenuExpanded,afterToggle:function(){},changeDivVisibility:!0}),s=$(window);if(i.initialize(),n.push(i),t.ClientIds.TopNavigationContainer&&n.push(new DivToggler({divId:t.ClientIds.TopNavigationContainer,isCollapsed:!1,changeDivVisibility:!0})),t.UseLeftmenuToggler){var o=function(n,i,s){!function(t,n,i){e.LeftArea.toggleClass(n,!t).toggleClass(i,t)}(n,t.CssClasses.DesktopLeftmenuVisible,t.CssClasses.DesktopLeftmenuHidden)},r={divId:t.ClientIds.LeftArea,isCollapsed:!t.LeftMenuExpanded,changeDivVisibility:!1,afterToggle:function(){o(a.settings.isCollapsed,t.CssClasses.DesktopLefttoggleExpand,t.CssClasses.DesktopLefttoggleCollapse)}},a=new DivToggler(r);a.initialize(),n.push(a)}window.divTogglers=n,CCL.CommonFunctions.attachPostMessageEventListener(s,[CCL.CommonWindowMessages.MessageNames.disableFullScreen,CCL.CommonWindowMessages.MessageNames.collapseContentAreaFrame,CCL.CommonWindowMessages.MessageNames.enableFullScreen,CCL.CommonWindowMessages.MessageNames.expandContentAreaFrame],function(n,i){if(!window.itslTop[CCL.CommonWindowMessages.MessageNames.suspendExpandCollaplseContentAreaFrame])if(t.IsEmbedded){var s=document.getElementById(t.ClientIds.CourseOverviewBackLinkContainer);n.messageName===CCL.CommonWindowMessages.MessageNames.collapseContentAreaFrame||n.messageName===CCL.CommonWindowMessages.MessageNames.disableFullScreen?s.classList.remove("l-hidden","l-forcibly-hidden"):n.messageName!==CCL.CommonWindowMessages.MessageNames.expandContentAreaFrame&&!CCL.CommonWindowMessages.MessageNames.enableFullScreen||window.itslTop.isProfileCardOpened||s.classList.add("l-hidden","l-forcibly-hidden")}else{var o,r,a;n.messageName===CCL.CommonWindowMessages.MessageNames.collapseContentAreaFrame||n.messageName===CCL.CommonWindowMessages.MessageNames.disableFullScreen?($(window.itslTop.divTogglers).each(function(){this.settings.isCollapsed||this.expandDiv()}),o=new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.contentAreaFrameHasCollapsed),r=new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.collapseExtensionIframe)):n.messageName!==CCL.CommonWindowMessages.MessageNames.expandContentAreaFrame&&!CCL.CommonWindowMessages.MessageNames.enableFullScreen||window.itslTop.isProfileCardOpened||($(window.itslTop.divTogglers).each(function(){var e=this.settings.isCollapsed;this.collapseDiv(),this.settings.isCollapsed=e}),o=new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.contentAreaFrameHasExpanded),r=new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.expandExtensionIframe)),(a=1===e.MenuIframe.length?e.MenuIframe.get(0).contentWindow:void 0)&&CCL.CommonFunctions.makePostMessageCall(a,r),CCL.CommonFunctions.makePostMessageCall(i,o)}})};e.NavigationControlScript=t}(e.TopMenu||(e.TopMenu={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t,n){e.GradeExportInstance=this,this.controls=t,this.context=n,this.init()}return t.prototype.dismissSyncItemNotifications=function(){$.post(this.context.WebMethods.CancelSyncItemNotification,{courseId:this.context.Settings.CourseId}).fail(function(t){e.Utils.handleAjaxError(t)})},t.prototype.init=function(){var e=this;jQuery.alerts.okButton=this.context.LanguageTerms.Ok,jQuery.alerts.cancelButton=this.context.LanguageTerms.Cancel,$(document).on(t.showFeedbackEventTitle,function(t,n,i){return e.showFeedback(n,i)})},t.prototype.showFeedback=function(e,t){var n=this;this.changeFeedbackContainer(t),null!=e&&CCL.InformationFeedback.showFeedbackWithextraButton(this.controls.Container,e,this.context.LanguageTerms.GotIt,function(){n.closeFeedback()})},t.prototype.changeFeedbackContainer=function(e){null!=e&&$(document).find("."+CCL.CommonCssClasses.InformationFeedback.Container).css("top",e.top+20)},t.prototype.closeFeedback=function(){CCL.InformationFeedback.hideFeedback(this.controls.Container)},t.showFeedbackEventTitle="LineItemsTransfer:showFeedback",t}();e.GradeExport=t}(e.OneRoster||(e.OneRoster={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t){var n=this;this.toggleValidator=ValidatorEnable,this.self=this,e.AddAssessmentInstance=this,this.context=t,this.window=$(window);var i=this;jQuery.alerts.okButton=this.context.LanguageTerms.Ok,jQuery.alerts.cancelButton=this.context.LanguageTerms.Cancel,this.initialDefaultScore=1===this.context.Controls.DefaultScore.length?this.context.Controls.DefaultScore.val():"",this.initialDefaultAssessmentItemId=1===this.context.Controls.DefaultAssessmentItemId.length?this.context.Controls.DefaultAssessmentItemId.val():"",this.context.Controls.OkButton.click(function(){return n.approveChanges(n)}),this.secondSectionSeparator=this.context.Controls.WhereCountSection.parent().find("div."+this.context.CssClasses.FormSectionSeparator).last(),this.toggleCustomExistingSections(this),this.context.Controls.CustomRadioButton.click(function(){n.toggleCustomExistingSections(n)}),this.context.Controls.ExistingAssessment.click(function(){n.toggleCustomExistingSections(n)}),this.toggleFinalAssessmentCheckbox(),this.context.Controls.AddDefaultAssessmentCheckBox.click(function(){n.toggleDefaultAssessmentControls(n)}),this.context.Controls.DefaultAssessmentItemList.change(function(){n.saveDefaultAssessmentItemListSelection(n)}),this.context.Controls.RetrieveLearningObjectivesFromPlannerButton.click(function(){n.retrieveLearningObjectivesFromPlanner(n)}),$(document).on(i.context.Settings.LearningObjectiveItemsChangedClientEventName,function(e,t){i.refreshAssessmentTypeList(i,e,t)}),1===this.context.Controls.AssessmentScaleList.length&&(this.context.Controls.AssessmentScaleList.change(function(){i.toggleWeightPanelAccordingToAssessmentScale(this.value),i.toggleMaxScorePanelAccordingToAssessmentScale(),i.toggleAddDefaultAssessmentCheckBoxAccordingToAssessmentScale()}),this.toggleWeightPanelAccordingToAssessmentScale(this.context.Controls.AssessmentScaleList.val()))}return t.prototype.toggleCustomExistingSections=function(e){var t=e.context.Controls.CustomRadioButton.prop("checked");e.toggle(e.context.Controls.ExistingSection,!t),e.toggle(e.context.Controls.CustomSection,t),e.toggle(e.context.Controls.AssessmentScaleListHolder,t),e.context.Controls.AssessmentScaleName.toggle(!t||0===e.context.Controls.AssessmentScaleList.length),e.toggle(e.context.Controls.EditableMaxScoreHolder,t),e.context.Controls.MaxScoreLabel.toggle(!t||0===e.context.Controls.MaxScore.length),e.context.Settings.UseTerms&&(e.context.Settings.SelectedTermId>0&&e.toggle(e.context.Controls.FinalAssessmentPanel,t),e.context.Controls.FinalAssessmentCheckbox.prop("checked")&&e.toggleFinalAssessmentSettings(t),e.context.Settings.SelectedTermId>0&&e.toggleWhereOrHowSection(e.context.Controls.WhereCountSection,t||e.context.Controls.CategoryListPanel.is(":visible"))),e.context.Settings.UseTerms&&0!==e.context.Settings.SelectedTermId||e.context.Controls.CustomRadioButton.prop("disabled")&&t||e.toggleBottomWarningMessageForElement(e),e.toggleWeightPanelAccordingToAssessmentScale(null),e.toggleMaxScorePanelAccordingToAssessmentScale(),e.toggleAddDefaultAssessmentCheckBoxAccordingToAssessmentScale(),e.toggleIsManualAssessmentVisible()},t.prototype.toggleIsManualAssessmentVisible=function(){var e=this.context.Controls.FinalAssessmentCheckbox.is(":visible")&&this.context.Controls.FinalAssessmentCheckbox.prop("checked")||!this.context.Controls.CustomRadioButton.prop("checked");this.toggle(this.context.Controls.IsManualAssessmentVisibleTogglePanel,!e)},t.prototype.toggleFinalAssessmentCheckbox=function(){this.toggleFinalAssessmentSettings(this.context.Controls.FinalAssessmentCheckbox.is(":visible")&&this.context.Controls.FinalAssessmentCheckbox.prop("checked"))},t.prototype.toggleFinalAssessmentSettings=function(e){this.toggleIsManualAssessmentVisible(),this.toggle(this.context.Controls.CategoryListPanel,!e),this.context.Settings.UseTerms&&this.context.Settings.SelectedTermId>0&&this.toggleWhereOrHowSection(this.context.Controls.HowAssessSection,!e),this.toggleWeightPanelAccordingToAssessmentScale(null),this.toggleMaxScorePanelAccordingToAssessmentScale()},t.prototype.toggleWhereOrHowSection=function(e,t){e.is(":visible")&&t||(this.toggle(e,t),this.secondSectionSeparator.toggle(this.context.Controls.HowAssessSection.is(":visible")&&t))},t.prototype.toggleWeightPanelAccordingToAssessmentScale=function(e){1===this.context.Controls.WeightPanel.length&&this.toggle(this.context.Controls.WeightPanel,(!this.context.Controls.FinalAssessmentCheckbox.is(":visible")||!this.context.Controls.FinalAssessmentCheckbox.prop("checked"))&&(1===this.context.Controls.AssessmentScaleList.length&&this.context.Controls.AssessmentScaleList.is(":visible")?this.isAssessmentScaleSupportWeighting(e||this.context.Controls.AssessmentScaleList.val()):this.context.Settings.IsAssessmentScaleOfTheColumnSupportWeighting))},t.prototype.toggleMaxScorePanelAccordingToAssessmentScale=function(){1===this.context.Controls.MaxScorePanel.length&&this.toggle(this.context.Controls.MaxScorePanel,1===this.context.Controls.AssessmentScaleList.length&&this.context.Controls.AssessmentScaleList.is(":visible")?this.isAssessmentScaleSupportScore():this.context.Settings.IsAssessmentScaleOfTheColumnSupportScore)},t.prototype.saveDefaultAssessmentItemListSelection=function(e){e.context.Controls.DefaultAssessmentItemId.val(e.context.Controls.DefaultAssessmentItemList.val())},t.prototype.toggleAddDefaultAssessmentCheckBoxAccordingToAssessmentScale=function(){1===this.context.Controls.AddDefaultAssessmentPanel.length&&(this.isAssessmentScaleSelected()||this.isAssessmentScaleSupportScore()?this.context.Controls.AddDefaultAssessmentCheckBox.removeAttr("disabled"):(this.context.Controls.AddDefaultAssessmentCheckBox.removeAttr("checked"),this.context.Controls.AddDefaultAssessmentCheckBox.prop("disabled","disabled")),this.toggleDefaultAssessmentControls(this))},t.prototype.toggleDefaultAssessmentControls=function(e){var t=e.context.Controls.CustomRadioButton.prop("checked")&&!e.usedFinalAssessmentOption(),n=!1,i=!1;t?(n=e.context.Controls.AddDefaultAssessmentCheckBox.prop("checked"),i=e.isAssessmentScaleSupportScore(),n&&!i&&$.getJSON(e.context.WebMethods.GetAssessmentItems,{assessmentId:this.getAssessmentId(),courseId:this.context.Settings.CourseId}).done(function(t){e.context.Controls.DefaultAssessmentItemList.empty();for(var n=0,i=t.length;n<i;n+=1){var s=t[n];e.context.Controls.DefaultAssessmentItemList.append('<option value="'+s.AssessmentItemId+'">'+s.Title+"</option>")}""!==e.context.Controls.DefaultAssessmentItemId.val()&&e.context.Controls.DefaultAssessmentItemList.val(e.context.Controls.DefaultAssessmentItemId.val())}).fail(function(e){return CCL.CommonFunctions.alertAjaxError(e,null,null)})):(e.context.Controls.DefaultAssessmentItemList.empty(),e.context.Controls.DefaultAssessmentItemId.val(""),e.context.Controls.DefaultScore.val(""),e.context.Controls.AddDefaultAssessmentCheckBox.removeAttr("checked")),e.toggle(e.context.Controls.AddDefaultAssessmentPanel,t),e.toggle(e.context.Controls.DefaultAssessmentItemListPanel,t&&n&&!i),e.toggle(e.context.Controls.DefaultScorePanel,t&&n&&i)},t.prototype.isAssessmentScaleSupportWeighting=function(e){return parseInt(e.split(":")[1])===this.context.Settings.AssessmentTotalsAverage},t.prototype.isAssessmentScaleSupportScore=function(){return 1===this.context.Controls.AssessmentScaleList.length&&parseInt(this.context.Controls.AssessmentScaleList.val().split(":")[0])===this.context.Settings.ScoreItemValue||0===this.context.Controls.AssessmentScaleList.length&&this.context.Settings.IsAssessmentScaleOfTheColumnSupportScore},t.prototype.toggleBottomWarningMessageForElement=function(e){if(window[e.context.Settings.BottomMessageClientInstanceName]){var t=!e.context.Controls.CustomRadioButton.prop("checked")&&e.context.Settings.IsAssessmentScaleOfTheColumnSupportScore;window[e.context.Settings.BottomMessageClientInstanceName].self.context.Controls.container.toggle(t),t&&(e.context.Controls.FinalAssessmentCheckbox.prop("checked",!1),e.toggleFinalAssessmentCheckbox()),e.context.Controls.FinalAssessmentCheckbox.prop("disabled",t)}},t.prototype.usedFinalAssessmentOption=function(){return 1===this.context.Controls.FinalAssessmentCheckbox.length&&this.context.Controls.FinalAssessmentCheckbox.is(":visible")&&this.context.Controls.FinalAssessmentCheckbox.prop("checked")},t.prototype.isAssessmentScaleSelected=function(){return null!=this.getAssessmentId()},t.prototype.getAssessmentId=function(){return 1===this.context.Controls.AssessmentScaleList.length&&this.context.Controls.AssessmentScaleList.val()!==this.context.Settings.NotSelectedAssessmentScaleValue?parseInt(this.context.Controls.AssessmentScaleList.val().split(":")[0]):0===this.context.Controls.AssessmentScaleList.length&&this.context.Settings.SelectedAssessmentId>0?this.context.Settings.SelectedAssessmentId:null},t.prototype.toggle=function(e,t){var n=this;if(1===e.length){var i=function(e,t){for(var i=0,s=e.length;i<s;i++)n.toggleValidator(e[i],t)};if(e.toggle(t),e.hasClass(this.context.CssClasses.FormContainer))return void e.find('input:not([type="hidden"]), select, textarea').each(function(e,t){i($(t).nextAll("span[id$=Validator]").toArray(),$(t).is(":visible"))});i(e.nextAll("span[id$=Validator]").toArray(),t)}},t.prototype.approveChanges=function(e){return!e.confirmationDefaultAssessmentEditRequired()||(jConfirm(e.context.Controls.AddDefaultAssessmentCheckBox.prop("checked")?e.context.LanguageTerms.DefaultAssessmentChaingingConfirmMessage:e.context.LanguageTerms.DefaultAssessmentTurningOffConfirmMessage,e.context.LanguageTerms.PleaseConfirm,function(t){if(t){if(!e.pageIsValid())return!1;e.context.Functions.SuccessSubmit()}return!0}),!1)},t.prototype.confirmationDefaultAssessmentEditRequired=function(){if(!this.context.Settings.IsEditModeAndCustomAssessment)return!1;var e=1===this.context.Controls.AddDefaultAssessmentCheckBox.length&&this.context.Controls.AddDefaultAssessmentCheckBox.prop("checked");return this.context.Settings.UseDefaultAssessment&&!e||this.context.Settings.UseDefaultAssessment&&e&&(1===this.context.Controls.DefaultScore.length&&this.context.Controls.DefaultScore.val()!==this.initialDefaultScore||1===this.context.Controls.DefaultAssessmentItemId.length&&this.context.Controls.DefaultAssessmentItemId.val()!==this.initialDefaultAssessmentItemId)},t.prototype.pageIsValid=function(){return!Page_ClientValidate||"function"!=typeof Page_ClientValidate||(Page_ClientValidate(),Page_IsValid)},t.prototype.retrieveLearningObjectivesFromPlanner=function(e){e.context.Controls.OkButton.attr("disabled","disabled"),e.context.Controls.RetrieveLearningObjectivesFromPlannerButton.addClass(e.context.CssClasses.ButtonInProgerssClass).attr("disabled","disabled"),CCL.CommonFunctions.safeAjaxPost({data:{termId:e.context.Settings.TermId,courseId:e.context.Settings.CourseId},dataType:"json",url:e.context.WebMethods.GetLearningObjectivesFromPlanner}).done(function(t){t.Success||alert(t.Message);var n=t.LearningObjectiveIds?t.LearningObjectiveIds:[],i=$.unique(n.concat(window[e.context.Controls.LearningObjectivesEditorKey].getObjectiveIdsArray()));window[e.context.Controls.LearningObjectivesEditorKey].addLearningObjectives(i)}).fail(function(e){CCL.CommonFunctions.alertAjaxError(e,null,null)}).always(function(){e.context.Controls.OkButton.removeAttr("disabled"),e.context.Controls.RetrieveLearningObjectivesFromPlannerButton.removeClass(e.context.CssClasses.ButtonInProgerssClass).removeAttr("disabled")})},t.prototype.refreshAssessmentTypeList=function(e,t,n){e.context.Controls.AssessmentTypeListPanel.find("["+e.context.Settings.IncludeLearningObjectivesAttribute+"='False']").toggle(!(n.length>0))},t}();e.AddAssessment=t}(e.AssessmentRecord||(e.AssessmentRecord={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t){var n=this;this.settings=e,this.controls=t,this.document=$(document),window[this.settings.ClientInstanceName]=this,this.formCheckBeforeUnload=new CCL.FormCheckBeforeUnload(this.controls.form,this.settings.Terms.BeforeUnloadWarningMessage,{cancelButtonId:this.settings.ClientIds.CancelButton}),this.controls.usePlagiarismCheckBox.click(function(e){n.controls.plagiarismInfoMessage.toggle()}),this.controls.useAnonymousSubmissionCheckBox.click(function(e){n.controls.anonymousSubmissionInfoMessage.toggle()}),this.settings.ConnectAssessmentCriteriaToScale&&this.controls.assessmentDropDown.change(function(){n.toggleCriteriaWeights(!1)})}return e.prototype.toggleCriteriaWeights=function(e){var t=this.controls.assessmentDropDown.find("option:selected").val();this.document.trigger(this.settings.LearningObjectivesEditorToggleCriteriaWeightsVisibilityMethodName,{show:!e&&t!==this.settings.AssessmentScaleControlDoNotUseAssessmentValue})},e}();e.AddEditLearningToolElement=t}(e.LearningToolElement||(e.LearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(e){this.settings=e,this.document=$(document),window[this.settings.ClientInstanceName]=this}return e.prototype.checkIfTransitionAllowed=function(e,t){var n=[];return this.settings.AllowedTypeTransitions.forEach(function(t){t.Type==e&&(n=t.AllowedChildrenTypes)}),n.length>0&&$.inArray(t,n)>-1},e.prototype.extractType=function(e){var t=this.settings.NodeNamePrefix,n=e.indexOf(t);if(n<0)return"";var i=e.indexOf(" ",n);return i<0&&(i=e.length-1),e.substring(n+t.length,i)},e.prototype.findParentWithType=function(e,t,n){var i=this.settings.NodeNamePrefix+t;if(n&&$(e).hasClass(i))return e;var s=$(e).parents("."+i);return s.length>0?s.get(0):null},e.prototype.moveNode=function(e,t,n,i,s){var o=this,r=$("#"+e),a=$("#"+n),l=$("#"+i),c={};c[this.settings.RequestItems.RepositoryTreeEntityClientIdToMove]=e,c[this.settings.RequestItems.RepositoryTreeEntityToMoveType]=this.extractType(r.attr("class")),c[this.settings.RequestItems.NewParentRepositoryTreeEntityClientId]=n,c[this.settings.RequestItems.NewParentRepositoryTreeEntityType]=this.extractType(a.attr("class")),c[this.settings.RequestItems.RelativeRepositoryTreeEntityClientId]=i,c[this.settings.RequestItems.RelativeRepositoryTreeEntityType]=this.extractType(l.attr("class")),c[this.settings.RequestItems.RelativeMovePosition]=s,c[this.settings.RequestItems.HierarchyId]=this.settings.HierarchyId,c[this.settings.RequestItems.CountryCode]=this.settings.CountryCode,CCL.CommonFunctions.safeAjax({type:"PUT",url:this.settings.MoveUrl,data:c}).done(function(){r.children("a").first().effect("highlight",{},2500)}).fail(function(){jAlert(o.settings.Terms.TreeMenuErrorWhileMoving,o.settings.Terms.Error,function(){location.reload()})})},e.prototype.beforeMove=function(e){var t=e.o[0];if(this.extractType(t.className)===this.settings.TreeTypeDescriptor){var n=e.np[0],i=this.extractType(n.className)===this.settings.TreeTypeCriterion;if(i)if($(n).find("li."+this.settings.NodeNamePrefix+this.settings.TreeTypeDescriptor).length>=this.settings.MaxNumberOfAchievementLevels)return jAlert(this.settings.Terms.YouCannotAddMoreThanXDescriptors),!1;return i}return!0},e.prototype.checkOnMove=function(e){if(e.np[0]!=e.op[0]){var t=this.extractType(e.np[0].className),n=this.extractType(e.o[0].className);if(!t||!n)return!1;if(!this.checkIfTransitionAllowed(t,n))return!1;if(this.findParentWithType(e.np[0],this.settings.TreeTypeSubject,!0)!=this.findParentWithType(e.o[0],this.settings.TreeTypeSubject,!1))return!1}return!0},e}();e.LearningObjectiveRepository=t}(e.LearningObjectiveRepository||(e.LearningObjectiveRepository={}))}(e.Administration||(e.Administration={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t,n){var i=this;this.checkAsyncTaskStatusTimeoutMilliseconds=5e3,this.selectedPersonIds=[],e.AssessmentLettersInstance=this,this.settings=t,this.controls=n,this.letterGroupGridRowsContainer=this.controls.letterGroupGridInstance.getRowsContainer(),this.letterGroupGridRows=this.controls.letterGroupGridInstance.getRows(),this.letterGroupGridRowsContainer.on("click",CCL.CommonFunctions.formatString(".{0}",this.settings.CssClasses.LetterGroupDownloadLink),function(){CCL.CommonFunctions.safeAjaxPost({url:i.settings.ServiceUrlsModel.AddKpiOnDownloadLetterGroupPdf,data:{isViewerRoleHeadteacher:i.settings.IsViewerRoleHeadteacher}}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})}),this.controls.createLetterGroupButton.click(this.openCreateLetterGroupPopup),this.scheduleCheckExportToPdfAsyncTaskStatus(),this.scheduleCheckLettersGeneratedAsyncTaskStatus(),this.settings.IsScrollToGroupLettersFeedbackControlNeeded&&this.scrollToGroupLettersFeedback()}return t.prototype.openViewRecipientsDialog=function(t,n,i){var s=window[e.AssessmentLettersInstance.settings.ClientInstanceNames.ViewRecipientsDialogInstance],o=CCL.CommonFunctions.formatString(e.AssessmentLettersInstance.settings.LanguageTerms.RecipientsFor,i);s.setTitle(o);var r={letterGroupId:n,isViewerRoleHeadteacher:e.AssessmentLettersInstance.settings.IsViewerRoleHeadteacher};s.setAjaxUrl(e.AssessmentLettersInstance.settings.ServiceUrlsModel.GetLetterGroupRecipients,r,!1),s.openDialog(!1)},t.prototype.publishLetterGroupAction=function(e,t,n){var i=this,s={letterGroupId:t,isViewerRoleHeadteacher:this.settings.IsViewerRoleHeadteacher};$.alerts.okButton=this.settings.LanguageTerms.Yes,$.alerts.cancelButton=this.settings.LanguageTerms.No,jConfirm(this.settings.LanguageTerms.PublishLetterGroupConfirmationMessage,this.settings.LanguageTerms.PleaseConfirm,function(e){e&&i.postJsonToService(i.settings.ServiceUrlsModel.PublishLetterGroup,s).done(function(e){window.location=window.location})})},t.prototype.deleteLetterGroupAction=function(e){$.alerts.okButton=this.settings.LanguageTerms.Yes,$.alerts.cancelButton=this.settings.LanguageTerms.No,jConfirm(this.settings.LanguageTerms.DeleteLetterGroupConfirmationMessage,this.settings.LanguageTerms.PleaseConfirm,function(t){t&&e()})},t.prototype.exportToPdfLetterGroupAction=function(e,t){$(e).attr("disabled")||t()},t.prototype.openCreateLetterGroupPopup=function(){var t=window[e.AssessmentLettersInstance.settings.ClientInstanceNames.CreateLetterPopupInstance],n=[],i=e.AssessmentLettersInstance.controls.learnersGridInstance.GetSelectedValues();i&&i.length>0&&(n=i.substr(0,i.length-1).split(",")),0!==n.length?0===$(n).not(e.AssessmentLettersInstance.selectedPersonIds).length&&0===$(e.AssessmentLettersInstance.selectedPersonIds).not(n).length?t.openDialog():CCL.CommonFunctions.safeAjaxPost({url:e.AssessmentLettersInstance.settings.ServiceUrlsModel.GetCreateLetterGroupPopupTitle,data:{personIds:n,termName:e.AssessmentLettersInstance.settings.TermName,isViewerRoleHeadteacher:e.AssessmentLettersInstance.settings.IsViewerRoleHeadteacher}}).done(function(i){e.AssessmentLettersInstance.selectedPersonIds=n,t.setAboutHtml(i),t.openDialog()}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)}):jAlert(e.AssessmentLettersInstance.settings.LanguageTerms.SelectAtLeastOneLearner,e.AssessmentLettersInstance.settings.LanguageTerms.AlertTitle,null)},t.prototype.scheduleCheckExportToPdfAsyncTaskStatus=function(){var e=this;setTimeout(function(){e.checkExportToPdfAsyncTaskStatus()},this.checkAsyncTaskStatusTimeoutMilliseconds)},t.prototype.checkExportToPdfAsyncTaskStatus=function(){var e=this,t=[];this.controls.letterGroupGridInstance.getRows().each(function(e,n){t.push($(n).data("id"))}),t.length>0&&CCL.CommonFunctions.safeAjaxPost({url:this.settings.ServiceUrlsModel.GetLetterGroupsFeedback,data:{letterGroupIds:t,isViewerRoleHeadteacher:this.settings.IsViewerRoleHeadteacher}}).done(function(n){var i=window[e.settings.ClientInstanceNames.GroupLettersTasksStatusFeedbackInstance],s=$(n),o=s.attr(e.settings.DataAttributes.FeedbackProgress);o!==e.settings.DataAttributes.FeedbackProgressValueWait&&o!==e.settings.DataAttributes.FeedbackProgressValueOk&&o!==e.settings.DataAttributes.FeedbackProgressValueError||i.showMessage(o===e.settings.DataAttributes.FeedbackProgressValueError?CCL.FeedbackType.Error:CCL.FeedbackType.Information,s.html()),o!==e.settings.DataAttributes.FeedbackProgressValueOk&&o!==e.settings.DataAttributes.FeedbackProgressValueError||e.deleteLetterGroupAsyncTaskExportAsPdf(),o===e.settings.DataAttributes.FeedbackProgressValueOk&&e.injectLetterGroupDownloadLinks(t),e.scheduleCheckExportToPdfAsyncTaskStatus()}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})},t.prototype.scheduleCheckLettersGeneratedAsyncTaskStatus=function(){var e=this;this.letterGroupGridRowsContainer.find(CCL.CommonFunctions.formatString(".{0}",this.settings.CssClasses.LetterGroupGeneratingInProgress)).length>0&&setInterval(function(){e.checkLettersGeneratedAsyncTaskStatus()},this.checkAsyncTaskStatusTimeoutMilliseconds)},t.prototype.checkLettersGeneratedAsyncTaskStatus=function(){var e=this,t=[];this.controls.letterGroupGridInstance.getRows().each(function(n,i){$(i).find(CCL.CommonFunctions.formatString(".{0}",e.settings.CssClasses.LetterGroupGeneratingInProgress)).length>0&&t.push($(i).data("id"))}),t.length>0&&this.postJsonToService(this.settings.ServiceUrlsModel.GetGenerateLettersJobStatus,{letterGroupIds:t,isViewerRoleHeadteacher:this.settings.IsViewerRoleHeadteacher}).done(function(e){var t=!1;e.forEach(function(e){e.IsLetterGroupBusy||(t=!0)}),t&&(window.location=window.location)})},t.prototype.publishLetterGroups=function(e,t){this.postJsonToService(this.settings.ServiceUrlsModel.PublishLetterGroup,{letterGroupIds:e,isViewerRoleHeadteacher:this.settings.IsViewerRoleHeadteacher}).done(function(){t()})},t.prototype.deleteLetterGroupAsyncTaskExportAsPdf=function(){this.postJsonToService(this.settings.ServiceUrlsModel.DeleteLetterGroupAsyncTaskExportAsPdf,{isViewerRoleHeadteacher:this.settings.IsViewerRoleHeadteacher})},t.prototype.injectLetterGroupDownloadLinks=function(e){var t=this;CCL.CommonFunctions.safeAjaxPost({url:this.settings.ServiceUrlsModel.GetLetterGroupDownloadLinks,data:{letterGroupIds:e,isViewerRoleHeadteacher:this.settings.IsViewerRoleHeadteacher}}).done(function(e){$(e).children().each(function(e,n){var i=$(n),s=t.letterGroupGridRowsContainer.find(CCL.CommonFunctions.formatString("[{0}='{1}'] ",t.settings.DataAttributes.LetterGroupDownloadLink,i.attr(t.settings.DataAttributes.LetterGroupDownloadLink)));s.length>0&&s.replaceWith(i)})}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})},t.prototype.postJsonToService=function(e,t){return CCL.CommonFunctions.safeAjaxPost({dataType:"JSON",url:e,data:t}).fail(function(e,t,n){CCL.CommonFunctions.alertAjaxError(e,t,n)})},t.prototype.scrollToGroupLettersFeedback=function(){$("html, body").animate({scrollTop:this.controls.groupLettersGridLabel.offset().top},1e3)},t}();e.AssessmentLetters=t}(e.Supervisor||(e.Supervisor={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){!function(n){var i=function(){function e(e,t){this.PlanId=e,this.ColumnId=t}return e.distinctArray=function(e){return e.reduce(function(e,t){return 0===e.filter(function(e){var n=e;return t.PlanId===n.PlanId&&t.ColumnId===n.ColumnId}).length&&e.push(t),e},[])},e}();n.PlannerCell=i;var s=function(n){function s(i,o,r){n.call(this,o,e.Planner.getInstance().settings.CourseId,r),this._planElementMovingDisabled=!1,window[i]=this,s.instanceName=i,this._css=o.Css,this._terms=o.Terms,this._elementColumnIds=o.ElementColumnIds,this._planner=e.Planner.getInstance(),this._activateElementsByPlan=this._planner.settings.ActivateElementsByPlan,this._planExpandableContentCellCommonLogic=t.PlanExpandableContentCellCommonLogic.getInstance();var a=itslTop;this._activateElementsByPlan&&a.reloadFolder&&a.reloadFolder("item0","planner",!0),this.attachEvents()}return __extends(s,n),s.prototype.refreshResourcesCell=function(e,t,n){this.refreshActivityResourceCell(e,t,!0,!0,!1),n&&this.measureKpiEditPlan()},s.prototype.refreshResourcesCellWithElement=function(e){var t=this,n=this.findCellsToRefresh(e);i.distinctArray(n).forEach(function(e){return t.refreshActivityResourceCell(e.PlanId,e.ColumnId,!1,!1)})},s.getPlanActivityResourceCellInstance=function(){return window[s.instanceName]},s.onFileUploadSuccess=function(e){s.getPlanActivityResourceCellInstance().onFileUploadSuccess(e)},s.onFileUploadFailed=function(e,t){s.getPlanActivityResourceCellInstance().onFileUploadFailed(e,t)},s.onFileSelected=function(e){s.getPlanActivityResourceCellInstance().onFileSelected(e)},s.getActivityResourceListItemSelector=function(){return"."+s.getPlanActivityResourceCellInstance()._css.ActivityResourceListItem},s.prototype.refreshActivityResourceCell=function(e,t,n,i,s){void 0===i&&(i=!0),this.reloadPlanElements(e,t,i,n,s)},s.prototype.updateContent=function(t,n,i,s,o){var r=this,a=this.getActivityResourceCell(n,i);a.html(t);var l=itslTop;if(s&&l.reloadFolder&&l.reloadFolder("item0","planner",o,!0),this._activateElementsByPlan){var c=a.find("."+this._css.ActivityResourceListItem),d=this._planner.getContainer();c.length>0&&c.each(function(e,t){var n=$(t),i=n.find("."+r._css.ActivityResourceListItemLink).first(),s=n.data(r._planner.data.ElementId);if(!(null==s||i.length<=0)){var o=d.find("."+r._css.ActivityResourceListItem+CCL.CommonFunctions.getDataSelector(r._planner.data.ElementId,s));o.length>0&&o.each(function(){var e=$(this),t=n.clone();e.replaceWith(t)})}})}this.initDragAndDrop(e.Cards.TopicCard.getParentTopicCardContainer(a))},s.prototype.initDragAndDrop=function(t){var n=this;null==t&&(t=e.Cards.TopicCard.getAllTopicCardContainers()),t.each(function(e,t){var i=$(t);n._elementColumnIds.forEach(function(e){var t=i.find("."+n._css.ActivityResourceCell+CCL.CommonFunctions.getDataSelector(n._planner.data.ColumnId,e)+" > ul");n.setDragAndDrop(t)})})},s.prototype.reloadPlanElements=function(e,t,n,i,s){var o=this;(this._planElementMovingDisabled=!0,null==s)&&(s=!this.getActivityResourceCell(e,t).find("."+this._planExpandableContentCellCommonLogic.css.ExpanderLink).hasClass(this._planExpandableContentCellCommonLogic.css.ExpanderLinkExpanded));CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.ReloadPlanElements,data:{courseId:this.courseId,planId:e,columnId:t,showCollapsedList:s}}).done(function(s){o.updateContent(s.ControlHtml,e,t,n,i),o._planElementMovingDisabled=!1}).fail(function(){return o._planElementMovingDisabled=!1})},s.prototype.removeElementFromPlan=function(t){var i=this,s=this.getDataAttributeValueAsNumber(t,e.PlannerConstants.dataAttributes.ElementId),o=this.getDataAttributeValueAsNumber(t,e.PlannerConstants.dataAttributes.PlanId),r=this.getDataAttributeValueAsNumber(t,e.PlannerConstants.dataAttributes.ColumnId);n.prototype.deletePlanElement.call(this,o,s,!1).done(function(){i.refreshActivityResourceCell(o,r,!1,!1),i.measureKpiEditPlan()})},s.prototype.deleteElementFromCourse=function(t){var s=this,o=this.getDataAttributeValueAsNumber(t,e.PlannerConstants.dataAttributes.ElementId),r=this.getDataAttributeValueAsNumber(t,e.PlannerConstants.dataAttributes.PlanId);n.prototype.deletePlanElement.call(this,r,o,!0).done(function(){var e=itslTop;e.reloadFolder&&e.reloadFolder("item0","planner");var t=s.findCellsToRefresh(o);i.distinctArray(t).forEach(function(e){s.refreshActivityResourceCell(e.PlanId,e.ColumnId,!1,!1)}),s.measureKpiEditPlan()})},s.prototype.getActivityResourceCell=function(e,t){return $("."+this._css.ActivityResourceCell+CCL.CommonFunctions.getDataSelector(this._planner.data.PlanId,e)+CCL.CommonFunctions.getDataSelector(this._planner.data.ColumnId,t)).closest("."+this._planner.getPlannerCellCssClass())},s.prototype.getActivityResourceList=function(e,t){return this.getActivityResourceCell(e,t).find("ul")},s.prototype.findCellsToRefresh=function(e){var t=this,n=this._planner.getContainer().find("."+this._css.ActivityResourceListItem+CCL.CommonFunctions.getDataSelector(this._planner.data.ElementId,e)),s=new Array;return n.each(function(e,n){var o=$(n),r=o.data(t._planner.data.PlanId),a=o.data(t._planner.data.ColumnId);s.push(new i(r,a))}),this.getChildElementIds(e).forEach(function(e){s=$.merge(s,t.findCellsToRefresh(e))}),s},s.prototype.getChildElementIds=function(e){var t=this,n=[];return this._planner.getContainer().find("."+this._css.ActivityResourceListItem+CCL.CommonFunctions.getDataSelector(this._planner.data.ParentFolderId,e)).each(function(e,i){var s=$(i).data(t._planner.data.ElementId);-1===n.indexOf(s)&&n.push(s)}),n},s.prototype.swapPlanElements=function(e,t,n,i){var s=this;CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.SwapPlanElements,data:{courseId:this.courseId,firstElementId:t,secondElementId:n,planId:e,columnId:i}}).done(function(){s.reloadPlanElements(e,i,!1,!1)})},s.prototype.movePlanElement=function(e,t,n,i,s){var o=this;this._planElementMovingDisabled=!0,CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.MovePlanElement,data:{courseId:this.courseId,sourcePlanId:e,targetPlanId:t,elementId:n,columnId:i,elementIds:s}}).done(function(){e!==t&&(o.refreshActivityResourceCell(e,i,!1),o.refreshActivityResourceCell(t,i,o._planner.settings.ActivateElementsByPlan)),o._planElementMovingDisabled=!1}).fail(function(){o.refreshActivityResourceCell(e,i,!1),e!==t&&o.refreshActivityResourceCell(t,i,!1),o._planElementMovingDisabled=!1})},s.prototype.moveElementToPlan=function(e,t,n,i){var s=this;CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.MoveElementToPlan,data:{courseId:this.courseId,elementId:n,sourcePlanId:e,targetPlanId:t,columnId:i}}).done(function(n){n.Success&&(s.refreshActivityResourceCell(e,i,!1),s.refreshActivityResourceCell(t,i,s._planner.settings.ActivateElementsByPlan))})},s.prototype.getPrevElementId=function(e,t,n){var i=this,s=null,o=this.getActivityResourceCell(e,n).find("."+this._css.ActivityResourceListItem);return $.each(o,function(e,n){var r=$(n),a=o.eq(e-1);r.data(i._planner.data.ElementId)==t&&e>0&&(s=a.data(i._planner.data.ElementId))}),s},s.prototype.getNextElementId=function(e,t,n){var i=this,s=null,o=this.getActivityResourceCell(e,n).find("."+this._css.ActivityResourceListItem);return $.each(o,function(e,n){var r=$(n),a=o.eq(e+1);r.data(i._planner.data.ElementId)==t&&e<o.length-1&&(s=a.data(i._planner.data.ElementId))}),s},s.prototype.getNextPlanId=function(t,n){var i=null,s=e.Cards.TopicCard.getParentTopicCard(this.getActivityResourceCell(t,n)).getPlanIds();return $.each(s,function(e,n){if(n===t)return e<s.length-1&&(i=s[e+1]),!1}),i},s.prototype.getPrevPlanId=function(t,n){var i=null,s=e.Cards.TopicCard.getParentTopicCard(this.getActivityResourceCell(t,n)).getPlanIds();return $.each(s,function(e,n){if(n===t)return e>0&&(i=s[e-1]),!1}),i},s.prototype.updateMoveOptions=function(e,t){if(e.length){var n=e.data(this._planner.data.ElementId),i=e.data(this._planner.data.ColumnId),s=e.data(this._planner.data.PlanId),o="data-"+this._planner.data.PlanId,r=this.getActionLink(this._css.MoveUpResourceLink,n,i,t),a=this.getActionLink(this._css.MoveDownResourceLink,n,i,t),l=this.getActionLink(this._css.MoveResourceToPrevPlanLink,n,i,t),c=this.getActionLink(this._css.MoveResourceToNextPlanLink,n,i,t),d=this.getActionLink(this._css.RemoveFromPlanLink,n,i,t),u=this.getActionLink(this._css.DeleteFromCourseLink,n,i,t);r.attr(o,s),a.attr(o,s),l.attr(o,s),c.attr(o,s),d.attr(o,s),u.attr(o,s)}},s.prototype.hideMoveOptionsIfNecessary=function(e){if(e.length){var t=e.siblings("."+this._css.ActivityResourceListItem),n=t.data(this._planner.data.ElementId),i=t.data(this._planner.data.ColumnId),s=t.data(this._planner.data.PlanId),o=this.getActionLink(this._css.MoveUpResourceLink,n,i,s).closest("li"),r=this.getActionLink(this._css.MoveDownResourceLink,n,i,s).closest("li"),a=this.getActionLink(this._css.MoveResourceToPrevPlanLink,n,i,s).closest("li"),l=this.getActionLink(this._css.MoveResourceToNextPlanLink,n,i,s).closest("li"),c=this.getPrevElementId(s,n,i);o.toggle(null!=c);var d=this.getNextElementId(s,n,i);r.toggle(null!=d);var u=this.getPrevPlanId(s,i);a.toggle(null!=u);var h=this.getNextPlanId(s,i);l.toggle(null!=h)}},s.prototype.getActionLink=function(e,t,n,i){return $("."+e+CCL.CommonFunctions.getDataSelector(this._planner.data.ElementId,t)+CCL.CommonFunctions.getDataSelector(this._planner.data.ColumnId,n)+CCL.CommonFunctions.getDataSelector(this._planner.data.PlanId,i))},s.prototype.setDragAndDrop=function(t){var n=this;t.each(function(i,s){var o=$(s);if(null!=o.sortable("instance"))return o.sortable("option","connectWith",t),!0;o.sortable({connectWith:t,axis:"y",scroll:!0,scrollSensitivity:50,scrollSpeed:10,handle:"."+n._planner.css.ReorderDragHandler,cursor:"move",dropOnEmpty:!0,items:"."+n.settings.Css.ElementListItem,containment:e.Cards.TopicCard.getParentTopicCard(o).getPlanGrid().getRowsContainer()}),o.on("sortstart",function(e,t){t.item.data("oldIndexValue",t.item.index())}),o.on("sortreceive",function(e,t){var i=$(t.item).find("."+n._css.ActivityResourceListItem),s=i.data(n._planner.data.ElementId);n._planElementMovingDisabled?t.sender.sortable("cancel"):$(e.target).find("."+n._css.ActivityResourceListItem).each(function(e,o){return o==i[0]||($(o).data(n._planner.data.ElementId)==s?(t.sender.sortable("cancel"),!1):void 0)})}),o.on("sortstop",function(t,i){var s=parseInt(i.item.index(),10),o=parseInt(i.item.data("oldIndexValue"),10),r=$(i.item),a=r.find("."+n._css.ActivityResourceListItem),l=a.data(n._planner.data.PlanId),c=a.data(n._planner.data.ColumnId),d=a.data(n._planner.data.ElementId),u=e.Cards.TopicCard.getParentPlanContainer(a).data(n._planner.data.GridRowId);if(l!==u||o!==s){var h=new Array;if(r.parent().find("."+n._css.ActivityResourceListItem).each(function(e,t){var i=$(t);if(c===i.data(n._planner.data.ColumnId)){var s=i.data(n._planner.data.ElementId);h.push(s)}}),n._planElementMovingDisabled){var g=null!=i.sender?i.sender:$(t.currentTarget);null!=g&&g.sortable("cancel")}else n.movePlanElement(l,u,d,c,h),a.attr("data-"+n._planner.data.PlanId,u),a.data(n._planner.data.PlanId,u),n.updateMoveOptions(a,l)}})})},s.prototype.getLearningObjectiveIds=function(e,n){var i=t.LearningObjectivesCell.PlanLearningObjectivesCell.getPlanLearningObjectivesCellInstance();return i?i.getLearningObjectiveIds(e,n):[]},s.prototype.measureKpiEditPlan=function(){this._planner.measureEditPlan()},s.prototype.attachSpecificEvents=function(){var e=this;$(document).on("click","."+this._css.DeleteFromCourseLink,function(t){var n=$(t.currentTarget);CCL.CommonFunctions.jAjaxConfirm(e._terms.DeleteFromCourseConfirmation,e._planner.terms.ConfirmTitle,e._planner.terms.Yes,e._planner.terms.No,function(t){t&&e.deleteElementFromCourse(n)})}).on("click","."+this._css.MoveUpResourceLink,function(t){var n=$(t.currentTarget),i=e.getDataAttributeValueAsNumber(n,e._planner.data.PlanId),s=e.getDataAttributeValueAsNumber(n,e._planner.data.ColumnId),o=e.getDataAttributeValueAsNumber(n,e._planner.data.ElementId),r=e.getPrevElementId(i,o,s);r&&e.swapPlanElements(i,o,r,s)}).on("click","."+this._css.MoveDownResourceLink,function(t){var n=$(t.currentTarget),i=e.getDataAttributeValueAsNumber(n,e._planner.data.PlanId),s=e.getDataAttributeValueAsNumber(n,e._planner.data.ColumnId),o=e.getDataAttributeValueAsNumber(n,e._planner.data.ElementId),r=e.getNextElementId(i,o,s);r&&e.swapPlanElements(i,o,r,s)}).on("click","."+this._css.MoveResourceToNextPlanLink,function(t){var n=$(t.currentTarget),i=e.getDataAttributeValueAsNumber(n,e._planner.data.ElementId),s=e.getDataAttributeValueAsNumber(n,e._planner.data.ColumnId),o=e.getDataAttributeValueAsNumber(n,e._planner.data.PlanId),r=e.getNextPlanId(o,s);r&&e.moveElementToPlan(o,r,i,s)}).on("click","."+this._css.MoveResourceToPrevPlanLink,function(t){var n=$(t.currentTarget),i=e.getDataAttributeValueAsNumber(n,e._planner.data.ElementId),s=e.getDataAttributeValueAsNumber(n,e._planner.data.ColumnId),o=e.getDataAttributeValueAsNumber(n,e._planner.data.PlanId),r=e.getPrevPlanId(o,s);r&&e.moveElementToPlan(o,r,i,s)}).on("click","."+this._css.ActionLink,function(t){e.hideMoveOptionsIfNecessary($(t.currentTarget))}).on(this._planner.events.PlanActivityResourceCellOutdated,function(t,n){null!=n&&e._elementColumnIds.forEach(function(t){e.refreshActivityResourceCell(n.planId,t,!1,e._activateElementsByPlan)})})},s.prototype.getLibraryBrowserDialog=function(){return this._planner.getLibraryBrowserDialog()},s.prototype.getPlanId=function(t){var n=this.getPlanContainer(t);return this.getDataAttributeValueAsNumber(n,e.PlannerConstants.dataAttributes.GridRowId)},s.prototype.getColumnId=function(t){var n=t.closest("."+this._planner.getPlannerCellCssClass()).find("."+this.settings.Css.ActivityResourceCell);return this.getDataAttributeValueAsNumber(n,e.PlannerConstants.dataAttributes.ColumnId)},s.prototype.getElementDialogOffset=function(){return-15},s.prototype.getFolderId=function(t){return this.getDataAttributeValueAsNumber(t,e.PlannerConstants.dataAttributes.FolderId)},s}(n.PlanResourcesCellBase);n.PlanActivityResourceCell=s}(t.ResourcesCell||(t.ResourcesCell={}))}(t.Plan||(t.Plan={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){!function(t){var n=function(t){function n(i,s){var o=this;t.call(this,s),window[i]=this,n.instanceName=i,this.planner=e.Planner.getInstance(),this.courseId=this.planner.settings.CourseId,this.showDates=this.planner.settings.ShowDates,this.startDate=this.planner.settings.FilterStartDate,this.endDate=this.planner.settings.FilterEndDate,$(function(){o.attachEvents()})}return __extends(n,t),n.getPlanDateCellInstance=function(){return window[n.instanceName]},n.prototype.updateContent=function(t,n,i){this.getDateCell(n).replaceWith(t);var s=[{planId:n,planActive:i}];$(document).trigger(e.PlannerConstants.events.PlanActivationChanged,{planActivations:s})},n.prototype.updatePlanTimeSpan=function(t){var n=this,i=this.getDatePicker();return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.UpdatePlanTimeSpan,data:{courseId:this.courseId,planId:t,start:i.getStartDate(),stop:i.getStopDate(),showPlanDates:this.showDates}}).done(function(t){if(t){n.closeDatePicker(),n.refreshDatesCell(t);var s=e.Cards.TopicCard.getInstance(t.topicId);s&&s.updateTopicExpanderLink(t.expanderText)}else i.showErrorMsg(e.DatePickerMode.TimeSpan)}).fail(function(){i.showErrorMsg(e.DatePickerMode.TimeSpan)})},n.prototype.updatePlanWeekAndDay=function(t){var n=this,i=this.getDatePicker();return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.UpdatePlanWeekAndDay,data:{courseId:this.courseId,planId:t,start:i.getStartWeek(),stop:i.getStopWeek(),showPlanDates:this.showDates}}).done(function(t){if(t){n.closeDatePicker(),n.refreshDatesCell(t);var s=e.Cards.TopicCard.getInstance(t.topicId);s&&s.updateTopicExpanderLink(t.expanderText)}else i.showErrorMsg(e.DatePickerMode.WeekAndDay)}).fail(function(){i.showErrorMsg(e.DatePickerMode.WeekAndDay)})},n.prototype.updatePlanEvents=function(t){var n=this,i=this.getDatePicker(),s=i.getEvents();return CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.UpdatePlanEvents,data:{courseId:this.courseId,planId:t,activityIds:s,filterStartDate:this.startDate,filterStopDate:this.endDate,showPlanDates:this.showDates}}).done(function(t){if(t){n.closeDatePicker(),n.refreshDatesCell(t);var s=e.Cards.TopicCard.getInstance(t.topicId);s&&s.updateTopicExpanderLink(t.expanderText)}else i.showErrorMsg(e.DatePickerMode.Event)}).fail(function(){i.showErrorMsg(e.DatePickerMode.Event)})},n.prototype.setDefaultDate=function(){var t=this.getTimeSpanHidden(this.currentPlanId).data(e.PlannerConstants.dataAttributes.TopicId);e.Cards.TopicCard.setDefaultDate(this.getDatePicker(),t)},n.prototype.getCurrentPlanId=function(t){var n=t.parent().find("input:hidden");return parseInt(n.data(e.PlannerConstants.dataAttributes.PlanId).toString(),10)},n.prototype.openContextDialog=function(e){this.contextDialog.openDialog(e)},n.prototype.focusOnDateEditAction=function(t){this.getDateCell(t).find(CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.PlanCellAction)).focus()},n.prototype.refreshDatesCell=function(t){this.updateContent(t.dateCell,t.planId,t.planActive),this.planner.settings.ActivateElementsByPlan&&$(document).trigger(e.PlannerConstants.events.PlanActivityResourceCellOutdated,{planId:t.planId})},n.prototype.getDateCell=function(t){return $("."+this.css.CellContent+" input:hidden"+CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.PlanId,t)).closest("."+this.css.CellContent)},n.prototype.attachEvents=function(){var t=this;$(document).on(e.PlannerConstants.events.PlanDateCellChange,function(e,n){null!=n.dateCellObject&&t.refreshDatesCell(n.dateCellObject)}),$(document).on(e.PlannerConstants.events.PlanDateCellsChanged,function(e,n){null!=n.dateCellObjects&&$.each(n.dateCellObjects,function(e,n){t.getDateCell(n.PlanId).replaceWith(n.Content)})})},n}(t.PlanDateCellBase);t.PlanDateCell=n}(t.DateCell||(t.DateCell={}))}(t.Plan||(t.Plan={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){!function(t){var n=function(t){function n(n,i){t.call(this,n,i,e.Planner.getInstance().getContainer())}return __extends(n,t),n.prototype.removeLearningObjective=function(n){var i=this,s=n.data(e.PlannerConstants.dataAttributes.PlanId),o=n.data(e.PlannerConstants.dataAttributes.LearningObjectiveId),r=!this.getLearningObjectivesListCell(s).find("."+this.settings.Css.ExpanderLink).hasClass(this.settings.Css.ExpanderLinkExpanded);t.prototype.removeLOFromPlan.call(this,s,o,r).done(function(e){i.updateContent(e.ControlHtml,s)})},n.prototype.getCurrentPlanId=function(t){return t.data(e.PlannerConstants.dataAttributes.PlanId)},n.prototype.getLearningObjectivesListCell=function(t){return $("."+this.settings.Css.LearningObjectivesList+CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.PlanId,t)).closest("."+e.Planner.getInstance().getPlannerCellCssClass())},n.prototype.getLearningObjectiveIds=function(t,n){void 0===n&&(n=!1);var i=this.getLearningObjectivesListCell(t),s=this.getLearningObjectiveDataAttribute(n),o=i.find(CCL.CommonFunctions.getDataSelector(e.PlannerConstants.dataAttributes.PlanId,t)+CCL.CommonFunctions.getDataSelector(s)),r=new Array;return o.length>0&&$.each(o,function(e,t){var n=$(t);if($.isNumeric(n.data(s))){var i=parseInt(n.data(s).toString(),10);-1===$.inArray(i,r)&&r.push(i)}}),r},n}(t.PlanLearningObjectivesCellBase);t.PlanLearningObjectivesCell=n}(t.LearningObjectivesCell||(t.LearningObjectivesCell={}))}(t.Plan||(t.Plan={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){e[e.RichText=0]="RichText",e[e.Theme=1]="Theme",e[e.Lesson=3]="Lesson",e[e.LessonDescription=4]="LessonDescription",e[e.Date=5]="Date",e[e.ClassHours=6]="ClassHours",e[e.LearningObjectives=7]="LearningObjectives",e[e.Resources=8]="Resources",e[e.Activities=9]="Activities",e[e.Term=10]="Term",e[e.Rubric=11]="Rubric",e[e.Elements=12]="Elements"}(e.ColumnType||(e.ColumnType={}));e.ColumnType;!function(e){e[e.Resource=0]="Resource",e[e.Activity=1]="Activity",e[e.LearningObjectiveAssessmentSupported=2]="LearningObjectiveAssessmentSupported"}(e.ElementCategory||(e.ElementCategory={}));e.ElementCategory;!function(e){e[e.TimeSpan=0]="TimeSpan",e[e.WeekAndDay=1]="WeekAndDay",e[e.Event=2]="Event"}(e.DatePickerMode||(e.DatePickerMode={}));e.DatePickerMode}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(n,i){window[n]=this,t.instanceName=n,this.terms=i,this.planner=e.Planner.getInstance(),this.courseId=this.planner.settings.CourseId,this.startDate=this.planner.settings.FilterStartDate,this.endDate=this.planner.settings.FilterEndDate,this.showPlanDates=this.planner.settings.ShowDates,this.useTopics=this.planner.settings.UseTopics,this.addingPlanInProgress=!1}return t.getInstance=function(){return window[t.instanceName]},t.prototype.addPlan=function(t){var n=this;if(!this.addingPlanInProgress){this.addingPlanInProgress=!0,this.planner.toggleEnableDisplayModeSwitcher(!1);var i=e.Cards.TopicCard.getInstance(t),s=i.getLastPlanId();s||(s=0),CCL.CommonFunctions.safeAjaxPost({url:this.planner.webMethods.Plan.AddPlan,data:{courseId:this.courseId,topicId:t,start:this.startDate,end:this.endDate,insertAfterPlanId:s,showPlanDates:this.showPlanDates,currentDisplayMode:this.planner.currentDisplayMode,isSearching:i.isSearching},success:function(e){n.useTopics&&(i.getTopicExpanderLink().html(e.topicExpanderText),i.hasPlans=e.hasPlans),i.appendNewPlan(e.planRow,e.planId),i.showPlanActionMenu(),i.hidePlanMoveOptionsIfNecessary(),n.planner.toggleEnableDisplayModeSwitcher(!0),n.addingPlanInProgress=!1},error:function(e,t,i){CCL.CommonFunctions.alertAjaxError(e,t,i),n.planner.toggleEnableDisplayModeSwitcher(!0),n.addingPlanInProgress=!1}})}},t.prototype.removePlan=function(e,t){this.removePlans(e,[t],!1)},t.prototype.removePlans=function(t,n,i){var s=this;void 0===n&&(n=null),void 0===i&&(i=!0);var o=e.Cards.TopicCard.getInstance(t);i&&null==n&&(n=o.getSelectedPlanIds(!0)),null!=n&&this.planner.showConfirmDialog(i?this.terms.DeletePlansConfirmation:this.terms.DeletePlanConfirmation,function(e){e&&CCL.CommonFunctions.safeAjaxPost({url:s.planner.webMethods.Plan.RemovePlans,traditional:!0,data:{courseId:s.courseId,topicId:t,planIds:n,updatePlanCount:s.useTopics,start:s.startDate,end:s.endDate,showPlanDates:s.showPlanDates,isBulkAction:i},success:function(e){s.useTopics&&(o.getTopicExpanderLink().html(e.topicExpanderText),o.hasPlans=e.hasPlans),o.showPlanFeedbackMessage(CCL.FeedbackType.Information,e.restoreText),o.clearPlanSelection(),o.removePlansFromGrid(n,e.emptyGridText),o.hidePlanMoveOptionsIfNecessary()},error:CCL.CommonFunctions.alertAjaxError})},this.planner.terms.Delete,this.planner.terms.Cancel)},t.prototype.restorePlans=function(t,n){var i=this,s=e.Cards.TopicCard.getInstance(t);CCL.CommonFunctions.safeAjaxPost({url:this.planner.webMethods.Plan.RestorePlans,traditional:!0,data:{courseId:this.courseId,topicId:t,planIds:n,start:this.startDate,end:this.endDate,updatePlanCount:this.useTopics,showPlanDates:this.showPlanDates},success:function(e){i.useTopics&&(s.getTopicExpanderLink().html(e.topicExpanderText),s.hasPlans=e.hasPlans),s.refreshPlanGrid(function(){e.restoreText&&s.showPlanFeedbackMessage(CCL.FeedbackType.Information,e.restoreText)},n)},error:CCL.CommonFunctions.alertAjaxError})},t.prototype.togglePlanStatus=function(e,t,n){this.togglePlansStatus(e,n,[t],!1)},t.prototype.togglePlansStatus=function(t,n,i,s){var o=this;void 0===i&&(i=null),void 0===s&&(s=!0);var r=e.Cards.TopicCard.getInstance(t);if(s&&null==i&&(i=r.getSelectedPlanIds(!0)),null!=i){var a=function(e){CCL.CommonFunctions.safeAjaxPost({url:o.planner.webMethods.Plan.TogglePlansStatus,traditional:!0,data:{courseId:o.courseId,planIds:i,activate:n,showPlanDates:o.showPlanDates,toggleElementsActivation:e,isBulkAction:s},success:function(e){1===i.length?r.showPlanFeedbackMessage(CCL.FeedbackType.Information,n?o.terms.PlanActivated:o.terms.PlanDeactivated):r.showPlanFeedbackMessage(CCL.FeedbackType.Information,n?o.terms.PlansActivated:o.terms.PlansDeactivated),s&&r.clearPlanSelection(),$.each(e,function(e,t){$(document).trigger(o.planner.events.PlanDateCellChange,{dateCellObject:t,planContainer:r.getPlanContainerById(t.planId)})})},error:CCL.CommonFunctions.alertAjaxError})};!n&&this.planner.settings.ActivateElementsByPlan&&r.containsPlanElements(i)?this.planner.showConfirmDialog(s?this.terms.PlansDeactivatedWithElementsWarning:this.terms.PlanDeactivatedWithElementsWarning,function(e){a(e)}):a(!0)}},t.prototype.notifyAboutChanges=function(e){null!=e&&CCL.CommonFunctions.safeAjaxPost({url:this.planner.webMethods.Plan.NotifyAboutChanges,data:{courseId:this.courseId,planId:e},success:function(){},error:CCL.CommonFunctions.alertAjaxError})},t.prototype.movePlan=function(e,t,n){this.movePlans(e,n,[t])},t.prototype.movePlans=function(t,n,i){void 0===i&&(i=null);var s=e.Cards.TopicCard.getInstance(t);null==i&&(i=s.getSelectedPlanIds(!0)),null!=i&&(i.length>=s.getPlanGrid().getRowsCount()||CCL.CommonFunctions.safeAjaxPost({url:this.planner.webMethods.Plan.MovePlans,traditional:!0,data:{courseId:this.courseId,topicId:t,planIds:i,moveUp:n,start:this.startDate,end:this.endDate},success:function(e){s.sortPlans(e.sortedPlanIds),s.hidePlanMoveOptionsIfNecessary()},error:CCL.CommonFunctions.alertAjaxError}))},t.prototype.setPlanDates=function(t){var n=e.Cards.TopicCard.getInstance(t),i=n.getSelectedPlanIds(!0);null!=i&&this.planner.getSetDateDialog().open(i,function(e){n.updatePlanCellsCallback(e)},function(){n.clearPlanSelection()},t)},t.prototype.sharePlans=function(t){var n=this,i=e.Cards.TopicCard.getInstance(t),s=i.getSelectedPlanIds(!0);null!=s&&CCL.CommonFunctions.safeAjaxPost({url:this.planner.webMethods.ShareablePlanner.CheckPlanDataForSharing,data:{courseId:this.courseId,planIds:s}}).done(function(e){e&&e.conflictMessage?CCL.CommonFunctions.jAjaxAlert(e.conflictMessage,n.planner.terms.Alert,n.planner.terms.Ok):e&&e.warningMessage?n.planner.showConfirmDialog(e.warningMessage,function(e){e&&i.redirectToSharePlans(s)}):i.redirectToSharePlans(s)}).fail(CCL.CommonFunctions.alertAjaxError)},t.prototype.stopSharingPlan=function(t,n,i){var s=this,o=e.Cards.TopicCard.getInstance(n),r=[i];CCL.CommonFunctions.safeAjaxPost({url:this.planner.webMethods.ShareablePlanner.StopSharingPlans,data:{courseId:this.courseId,planIds:r}}).done(function(){s.planner.settings.UseTopics&&o&&o.clearPlanSelection(),$(t).parent().hide()}).fail(CCL.CommonFunctions.alertAjaxError)},t}();e.PlanCommonLogic=t}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(n){function i(e,t,i){var s=this;n.call(this,e,t),$(function(){s.columnsData=new Array,s.addColumnsToEdit(i)})}return __extends(i,n),i.getInstance=function(){return window[t.PlannerInlineCellBase.clientInstanceName]},i.prototype.addColumnsToEdit=function(t){var n=this;$.each(t,function(t,s){n.columnsData[s.HybridEditorItemId]=s;var o=$("div["+e.PlannerConstants.dataAttributes.HybridEditorItem+"][id *= "+s.HybridEditorItemId+"]");o&&o.data(i.hybridEditorItemIdDataAttr,s.HybridEditorItemId)})},i.prototype.getEditorItemSettings=function(e){var t=this.columnsData[e];return t?n.prototype.getSettings.call(this,t):{}},i.prototype.measureKpiEditPlan=function(){e.Planner.getInstance().measureEditPlan()},i.prototype.getColumnData=function(e){return this.columnsData[e.data(i.hybridEditorItemIdDataAttr).toString()]},i.prototype.replaceMediaContentWithPlaceholders=function(){return e.Planner.getInstance().isTableCurrentMode()},i}(t.PlannerInlineCellBase);t.PlannerInlineCell=n}(t.InlineCell||(t.InlineCell={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){var n=function(){function t(t,n){var i=this;this.focusTitle=function(){i.$topicTitle.select()},window[t]=this,this.settings=n,this.planner=e.Planner.getInstance(),this.$topicTitle=$("#"+this.settings.Controls.TopicTitleId),this.$errorMessage=$("#"+this.settings.Controls.ErrorMessageId),this.$saveButton=$("#"+this.settings.Controls.SaveButtonId),this.attachEventHandlers()}return t.prototype.open=function(){var e=this,t=this.getDialog(),n=this.getColorPicker();this.clearForm(),CCL.CommonFunctions.safeAjaxPost({url:this.settings.WebMethods.GetRandomColorSchemeForNewTopic+"/"+this.planner.settings.CourseId}).done(function(e){n.setColor(e.topicColorSchema)}).fail(function(){n.setColor(e.settings.TopicDefaultColorSchema)}),t.openDialog()},t.prototype.getColorPicker=function(){return window[this.settings.Controls.ColorPickerId]},t.prototype.attachEventHandlers=function(){var e=this;this.$saveButton.click(function(){return e.validateAndSave()}),this.$topicTitle.keypress(function(t){return 13!==t.keyCode||(e.validateAndSave(),!1)})},t.prototype.clearForm=function(){this.$errorMessage.hide(),this.$saveButton.toggleHyperlink(!0)},t.prototype.validateAndSave=function(){if(this.$saveButton.getIfHyperLinkEnabled()){var e=$.trim(this.$topicTitle.val());if(e.length>0){var t=this.getColorPicker().getSelectedColorKey();this.addTopic(e,t)}else this.$errorMessage.show()}},t.prototype.addTopic=function(t,n){var i=this;this.$saveButton.toggleHyperlink(!1),e.TopicCommonLogic.getInstance().addTopic(t,n,CssModal.closeDialog,function(){i.$saveButton.toggleHyperlink(!0)})},t.prototype.getDialog=function(){return window[this.settings.TopicAddDialogInstance]},t}();t.TopicAddDialog=n}(e.Dialogs||(e.Dialogs={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(){function t(n,i){window[n]=this,t.instanceName=n,this._settings=i,this._css=i.Css,this._planner=e.Planner.getInstance(),this._courseId=this._planner.settings.CourseId,this._currentTopicId=0,this._currentColumnId=0,this.attachEvents()}return t.getTopicLearningObjectivesCellInstance=function(){return window[t.instanceName]},t.prototype.updateLearningObjectives=function(e){var t=this,n=this._currentTopicId,i=this._currentColumnId;CCL.CommonFunctions.safeAjaxPost({url:this._planner.webMethods.LearningObjective.AddTopicLearningObjectives,data:{courseId:this._courseId,learningObjectiveIds:e,topicId:n,columnId:i}}).done(function(e){t.getLearningObjectivesListCell(n,i).html(e.contentHtml)}).fail(CCL.CommonFunctions.alertAjaxError)},t.prototype.getLearningObjectivesListCell=function(e,t){return $("."+this._css.CardCell+CCL.CommonFunctions.getDataSelector(this._planner.data.TopicId,e)+CCL.CommonFunctions.getDataSelector(this._planner.data.ColumnId,t)).parent()},t.prototype.getLearningObjectiveIds=function(e,t,n){var i=this,s=e.find(""+CCL.CommonFunctions.getDataSelector(this._planner.data.TopicId,t)+CCL.CommonFunctions.getDataSelector(this._planner.data.ColumnId,n)+CCL.CommonFunctions.getDataSelector(this._planner.data.LearningObjectiveId)),o=[];return s.size()>0&&$.each(s,function(e,t){var n=$(t);$.isNumeric(n.data(i._planner.data.LearningObjectiveId))&&o.push(parseInt(n.data(i._planner.data.LearningObjectiveId)))}),o},t.prototype.removeLearningObjective=function(e,t,n){var i=this;CCL.CommonFunctions.safeAjax({type:"DELETE",url:this._planner.webMethods.LearningObjective.RemoveTopicLearningObjective,data:{courseId:this._courseId,topicId:e,learningObjectiveId:n,columnId:t}}).done(function(n){i.getLearningObjectivesListCell(e,t).html(n.contentHtml)}).fail(CCL.CommonFunctions.alertAjaxError)},t.prototype.attachEvents=function(){var e=this;this._planner.getContainer().on("click","."+this._css.AddLearningObjectives,function(t){e._currentTopicId=$(t.currentTarget).data(e._planner.data.TopicId),e._currentColumnId=$(t.currentTarget).data(e._planner.data.ColumnId);var n=window[e._settings.LearningObjectiveSelector];n.setSelectedIds(e.getLearningObjectiveIds(e.getLearningObjectivesListCell(e._currentTopicId,e._currentColumnId),e._currentTopicId,e._currentColumnId),!0),n.openDialog()}),$(document).on("click","."+this._css.RemoveLearningObjective,function(t){var n=$(t.currentTarget);e.removeLearningObjective(n.data(e._planner.data.TopicId),n.data(e._planner.data.ColumnId),n.data(e._planner.data.LearningObjectiveId))})},t}();t.TopicLearningObjectivesCell=n}(t.Topic||(t.Topic={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(t){!function(t){var n=function(){function t(n,i){window[n]=this,t.instanceName=n,this._settings=i,this._css=i.Css,this._terms=i.Terms,this._planner=e.Planner.getInstance(),this._courseId=this._planner.settings.CourseId,this._contextDialog=new ContextDialog($("#"+i.TermEditorId),{title:this._terms.TermContextDialogTitle,footerContent:i.TermEditorFooterId,setFocus:!1,width:"auto",zIndex:1}),$.each($("."+this._css.TermRadioButton),function(e,t){$(t).find(":radio").attr("name","TermGroup")}),this.attachEvents()}return t.getTopicTermCellInstance=function(){return window[t.instanceName]},t.prototype.editTerm=function(e,t,n,i){this._currentTopicId=n,this._activeContainer=t.parent(),this._contextDialog.openDialog(e),null!=i?$("."+this._css.TermRadioButton+CCL.CommonFunctions.getDataSelector(this._planner.data.CourseTermId,i)).find(":radio").attr("checked","checked").focus():($("."+this._css.TermRadioButton).find(":radio:checked").removeAttr("checked").blur(),$("."+this._css.TermRadioButton+":first").find(":radio").focus())},t.prototype.attachEvents=function(){var e=this;this._contextDialog.setBeforeCloseDialog(function(){e.beforeCloseClontextDialog()}),this._planner.getContainer().on("click","."+this._css.EditTermLink,function(t){var n=$(t.currentTarget),i=n.data(e._planner.data.TopicId),s=n.data(e._planner.data.CourseTermId);!e._contextDialog.mainContainer.is(":visible")&&i>0&&e.editTerm(t,n,i,s)}),$("#"+this._settings.SaveTermButtonId).on("click",function(){e._contextDialog.closeDialog()}),$("#"+this._settings.ClearTermLinkId).on("click",function(){$("."+e._css.TermRadioButton).find(":radio:checked").removeAttr("checked")})},t.prototype.beforeCloseClontextDialog=function(){var t=this,n=$("."+this._css.EditTermLink+CCL.CommonFunctions.getDataSelector(this._planner.data.TopicId,this._currentTopicId)).data(this._planner.data.CourseTermId),i=$("."+this._css.TermRadioButton).has(":radio:checked").data(this._planner.data.CourseTermId);n!==i&&CCL.CommonFunctions.safeAjaxPost({url:this._planner.webMethods.TopicTerm.UpdateTopicTerm,data:{courseId:this._courseId,topicId:this._currentTopicId,courseTermId:void 0!==i?i:0,start:this._planner.settings.FilterStartDate,stop:this._planner.settings.FilterEndDate}}).done(function(n){if(n){t._activeContainer.replaceWith(n.termCell),$(document).trigger(t._planner.events.PlanDateCellsChanged,{dateCellObjects:n.dateCells});var i=e.Cards.TopicCard.getInstance(t._currentTopicId);i&&i.setTermDates(t._planner.parseDateFromString(n.termStartDate),t._planner.parseDateFromString(n.termStopDate))}})},t}();t.TopicTermCell=n}(t.Topic||(t.Topic={}))}(e.Cells||(e.Cells={}))}(e.Planner||(e.Planner={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t){e.mentorFeedbackOverviewInstance=this,this.context=t,this.$window=$(window),this.setMentorFeedbackSelectorAction(),this.setCompleteButtonAction(),this.setUndoButtonAction(),this.context.Settings.IsToolbarButtonsAvailable?(this.setfeedbackSetupAction(),this.setMultipleAssessAction()):(window[this.context.Controls.PersonGrid].disableToolbarItem($("#"+this.context.Controls.FeedbackSetupButtonId)),window[this.context.Controls.PersonGrid].disableToolbarItem($("#"+this.context.Controls.AssessMultipleButtonId)));var n=$("."+this.context.CssClasses.HybridEditorItemCss);this.bindToEditorItemEvents(n),window[this.context.Controls.PersonGrid].toggleSelectAll(!1)}return t.prototype.onSetFeedbackColumnValueError=function(e,t){var n=t.xhrObject.status,i=409===n?this.context.LanguageTerms.AlertMessage:this.context.LanguageTerms.AlertStoringProblem;CCL.CommonFunctions.jAlertAjaxError(i,this.context.LanguageTerms.AlertTitle,this.context.LanguageTerms.Ok,409===n),e.stopPropagation()},t.prototype.bindToEditorItemEvents=function(e){var t=this;e.on(this.context.Events.HybridEditorItemAjaxError,function(e,n){t.onSetFeedbackColumnValueError(e,n)}).on(this.context.Events.HybridEditorItemSaveError,function(e,n){t.onSetFeedbackColumnValueError(e,n)})},t.prototype.checkLogAvailability=function(t){var n=window[e.mentorFeedbackOverviewInstance.context.Controls.PersonGrid].getRowById(t),i=$("."+e.mentorFeedbackOverviewInstance.context.CssClasses.MentorFeedbackSelectorCss,n).attr(e.mentorFeedbackOverviewInstance.context.Settings.MentorFeedbackIdAttribute);e.mentorFeedbackOverviewInstance.safeAjaxPostHandler(e.mentorFeedbackOverviewInstance.context.WebMethods.LogAvailability,{mentorFeedbackId:i},function(n){e.mentorFeedbackOverviewInstance.toggleLogLink(n.available,t)})},t.prototype.setfeedbackSetupAction=function(){var e=this;$("#"+this.context.Controls.FeedbackSetupButtonId).click(function(){return e.isAnyStudentSelected(function(t){for(var n,i="",s=0;s<t.length;s++){var o=e.getLearnerMentorFeedbackId(t[s]);if(0===s)n=o;else if(n!==o){i=e.context.LanguageTerms.DifferentMfConfirmation;break}}var r=e.context.Urls.FeedbackSetupDialogUrl+"&"+e.context.Settings.PersonIdAttribute+"="+t.join(",");""!==i?jConfirm(i,e.context.LanguageTerms.PleaseConfirm,function(t){t&&e.openDialog(r,e.context.Controls.FeedbackSetupDialog)}):e.openDialog(r,e.context.Controls.FeedbackSetupDialog)})})},t.prototype.setMultipleAssessAction=function(){var e=this;$("#"+this.context.Controls.AssessMultipleButtonId).click(function(){return e.isAnyStudentSelected(function(t){for(var n=0,i=e.context.LanguageTerms.WarningNoMfSelected,s=0;s<t.length;s++){var o=e.getLearnerMentorFeedbackId(t[s]);if(0!==o){if(0!==n&&n!==o){i=e.context.LanguageTerms.WarningDifferentMfSelected;break}n=o,i=""}}if(""!==i)jAlert(i,e.context.LanguageTerms.AlertTitle,null);else{var r=e.context.Urls.AssessMultipleDialogUrl+"&"+e.context.Settings.TermAssessmentAttributeId+"="+n+"&"+e.context.Settings.PersonIdAttribute+"="+t.join(",");e.openDialog(r,e.context.Controls.AssesMultipleDialog)}})})},t.prototype.openDialog=function(e,t){window[t].setIframeUrl(e),window[t].openDialog()},t.prototype.isAnyStudentSelected=function(e){var t=window[this.context.Controls.PersonGrid].getSelectedValues();0===t.length?jAlert(this.context.LanguageTerms.AlertNoPersonSelected,this.context.LanguageTerms.AlertTitle,null):e(t)},t.prototype.getLearnerMentorFeedbackId=function(e){return+$("select["+this.context.Settings.LearnerIdAttribute+"='"+e+"']").val()},t.prototype.setCompleteButtonAction=function(){var e=this;$("#"+this.context.Controls.CompleteTermButtonId).click(function(){jConfirm(e.context.LanguageTerms.CompleteTermWarning,e.context.LanguageTerms.PleaseConfirm,function(t){t&&e.safeAjaxPostHandler(e.context.WebMethods.CompleteTerm,{organizationId:e.context.Settings.OrganizationId,termId:e.context.Settings.TermId},function(){$("#"+e.context.Controls.CompleteContainer).hide(),$("#"+e.context.Controls.UndoContainer).show()})})})},t.prototype.setUndoButtonAction=function(){var e=this;$("#"+this.context.Controls.UndoCompleteTermButtonId).click(function(){e.safeAjaxPostHandler(e.context.WebMethods.UndoCompleteTerm,{organizationId:e.context.Settings.OrganizationId,termId:e.context.Settings.TermId},function(){$("#"+e.context.Controls.UndoContainer).hide(),$("#"+e.context.Controls.CompleteContainer).show()})})},t.prototype.ajaxHandler=function(e,t,n){var i=this;this.errorRised=!1,$.ajax({type:"POST",url:e,dataType:"json",data:t,success:n,error:function(e){return i.ajaxErrorHandler(e)}})},t.prototype.safeAjaxPostHandler=function(e,t,n){var i=this;this.errorRised=!1,CCL.CommonFunctions.safeAjaxPost({url:e,dataType:"json",data:t,success:n,error:function(e){return i.ajaxErrorHandler(e)}})},t.prototype.ajaxErrorHandler=function(e){this.errorRised||(this.errorRised=!0,409===e.status?CCL.CommonFunctions.jAlertAjaxError(this.context.LanguageTerms.AlertMessage,this.context.LanguageTerms.AlertTitle,this.context.LanguageTerms.Ok,!0):0===e.status?CCL.CommonFunctions.jAlertAjaxError(this.context.LanguageTerms.AlertStoringProblem,this.context.LanguageTerms.AlertTitle,this.context.LanguageTerms.Ok,!1):CCL.CommonFunctions.alertAjaxError(e,null,null))},t.prototype.setMentorFeedbackSelectorAction=function(){var e=this;$("."+this.context.CssClasses.MentorFeedbackSelectorCss).focus(function(t){return e.feedbackSetupPreviousValue=$(t.target).val()}).change(function(t){var n=$(t.target).attr(e.context.Settings.LearnerIdAttribute);$.getJSON(e.context.WebMethods.IsMentorFeedbackValuesExist,{learnerId:n,organisationId:e.context.Settings.OrganizationId,hierarchyId:e.context.Settings.HierarchyId,termId:e.context.Settings.TermId},function(n){!!n.result?jConfirm(e.context.LanguageTerms.ChangeFeedbackSetupWarning,e.context.LanguageTerms.PleaseConfirm,function(n){n?e.changeMentorSetup(t):$(t.target).val(e.feedbackSetupPreviousValue)}):e.changeMentorSetup(t)})})},t.prototype.changeMentorSetup=function(e){var t=this,n=$(e.target),i=n.attr(this.context.Settings.LearnerIdAttribute),s=$("."+i),o=n.val();if(this.toggleLogLink(!1,i),o===this.context.Settings.DefaultMentorFeedbackSelectorValue){var r=n.attr(this.context.Settings.MentorFeedbackIdAttribute);this.safeAjaxPostHandler(this.context.WebMethods.RemoveFeedbackSetup,{mentorFeedbackId:r,learnerId:i,organisationId:this.context.Settings.OrganizationId,hierarchyId:this.context.Settings.HierarchyId},function(){s.addClass(t.context.CssClasses.HiddenCss),$("."+t.context.CssClasses.CommentLabelCss,s).text("");for(var e=$("."+t.context.CssClasses.HybridEditorItemCss,s),i=0;i<e.length;i++){var o=$(e[i]);o.hybridEditorItem().hybridEditorItem("resetValue"),o.hybridEditorItem().hybridEditorItem("setToolTip","");var r=o.hybridEditorItem().hybridEditorItem("option","webMethodParams");r.mentorFeedbackId="",r.columnId="",o.hybridEditorItem().hybridEditorItem("option","webMethodParams",r)}$("."+t.context.CssClasses.CommentPanelCss,s).addClass(t.context.CssClasses.HiddenCss),n.attr(t.context.Settings.MentorFeedbackIdAttribute,"")})}else{var a=n.attr(this.context.Settings.LearnerNameAttribute);this.safeAjaxPostHandler(this.context.WebMethods.SetFeedbackSetup,{organisationId:this.context.Settings.OrganizationId,hierarchyId:this.context.Settings.HierarchyId,learnerId:i,termAssessmentId:o},function(e){n.attr(t.context.Settings.MentorFeedbackIdAttribute,e.mentorFeedbackId),s.removeClass(t.context.CssClasses.HiddenCss);var r,l,c=t.context.TermAssessmentCustomColumns[o],d=$("."+t.context.CssClasses.CommentLabelCss,s),u=$("."+t.context.CssClasses.HybridEditorItemCss,s),h=$("."+t.context.CssClasses.CommentPanelCss,s);t.setUrlToLogLink(e.mentorFeedbackId,i);for(var g=0;g<c.length;g++)$(d[g]).text(c[g].Name),(l=$(u[g])).hybridEditorItem().hybridEditorItem("resetValue"),l.hybridEditorItem().hybridEditorItem("setToolTip",c[g].ToolTip+" "+a),(r=l.hybridEditorItem().hybridEditorItem("option","webMethodParams")).mentorFeedbackId=e.mentorFeedbackId,r.columnId=String(c[g].CustomColumnId),l.hybridEditorItem().hybridEditorItem("option","webMethodParams",r),$(h[g]).removeClass(t.context.CssClasses.HiddenCss);if(c.length<d.length)for(var p=d.length,m=c.length;m<p;m++)$(d[m]).text(""),(l=$(u[m])).hybridEditorItem().hybridEditorItem("resetValue"),l.hybridEditorItem().hybridEditorItem("setToolTip",""),(r=l.hybridEditorItem().hybridEditorItem("option","webMethodParams")).mentorFeedbackId="",r.columnId="",l.hybridEditorItem().hybridEditorItem("option","webMethodParams",r),$(h[m]).addClass(t.context.CssClasses.HiddenCss)})}},t.prototype.setUrlToLogLink=function(e,t){var n=window[this.context.Controls.PersonGrid].getRowById(t),i=$("."+this.context.CssClasses.LogLinkCss,n),s=this.context.Urls.LogLink+"?"+this.context.Settings.PersonIdAttribute+"="+t+"&"+this.context.Settings.SupervisorTypeRequestItem+"="+this.context.Settings.SupervisorType+"&"+this.context.Settings.MentorFeedbackIdRequestItem+"="+e;i.attr("href",s)},t.prototype.toggleLogLink=function(e,t){var n=window[this.context.Controls.PersonGrid].getRowById(t),i=$("."+this.context.CssClasses.LogLinkCss,n),s=$("."+this.context.CssClasses.NoLogLabelCss,n);e?(i.removeClass(this.context.CssClasses.HiddenCss),s.addClass(this.context.CssClasses.HiddenCss)):(i.addClass(this.context.CssClasses.HiddenCss),s.removeClass(this.context.CssClasses.HiddenCss))},t}();e.MentorFeedbackOverview=t}(e.Mentor||(e.Mentor={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function t(t){e.mentorFeedbackAssessMultipleInstance=this,this.context=t,this.window=$(window),this.setOkClickEvent()}return t.prototype.setOkClickEvent=function(){var e=this;$("#"+this.context.Settings.OkClientId).click(function(){for(var t="",n=$('[id*="CustomColumnValue"]'),i=0;i<n.length;i++){var s=$(n[i]);if(s.val().trim()){var o=s.attr("data-cc-id");e.context.Settings.FilledCustomColumns.indexOf(o)>-1&&(t=e.context.Settings.TermCommentWarning)}}""!==t?jConfirm(t,e.context.Settings.TermPleaseConfirm,function(t){t&&e.context.Functions.OkPostbackScript()}):e.context.Functions.OkPostbackScript()})},t}();e.MentorFeedbackAssessMultiple=t}(e.Mentor||(e.Mentor={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){!function(e){e[e.Expanded=1]="Expanded",e[e.Collapsed=2]="Collapsed",e[e.Loading=3]="Loading"}(t.FolderExpandState||(t.FolderExpandState={}));var n=t.FolderExpandState,i=function(){function t(t,n,i){var s=this;this.settings=n,this.controls=i,this.inputTypeCheckboxSelector="input:checkbox",this.stateChangedHandler=function(e){var t=$(e.target),n=s.closestItem(t),i=s.updateItemState(n,t.is(":checked"));n.find(s.inputTypeCheckboxSelector).first().focus(),s.controls.Container.trigger(s.settings.StateChangedEventName,i)},window[t]=this,this.checkboxStateMachine=new e.CheckboxStateMachine.Machine,this.setupListItemFocusedAreaClickHandler()}return Object.defineProperty(t.prototype,"itemSelector",{get:function(){return CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.ItemId)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"listItemFocusedAreaSelector",{get:function(){return"."+this.settings.CssClasses.ListItemFocusedArea},enumerable:!0,configurable:!0}),t.prototype.init=function(e){this.initParameters=e},t.prototype.expandFolder=function(e){var t=this,i=e.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.FolderActionExpand)).first(),s=i.data(this.settings.DataAttributes.FolderActionExpand),o=e.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.FolderAppendTarget)).first();if(s)this.setFolderState(o,i,n.Expanded);else{this.setFolderState(o,i,n.Loading);var r={folderId:this.getItemId(e)};this.getFolderContent(r).done(function(e){o.append(e),t.setFolderState(o,i,n.Expanded),t.onFolderContentLoaded()})}},t.prototype.onFolderContentLoaded=function(){var e=this;this.initParameters.itemStates.forEach(function(t,n){if(e.checkboxStateMachine.isElementChecked(t)){var i=e.getCheckbox(n);i&&i.length>0&&i.prop("checked",!0)}}),this.initParameters.disabledItemIds&&this.initParameters.disabledItemIds.forEach(function(t){var n=e.getCheckbox(t);n&&n.prop("disabled",!0)})},t.prototype.countItemsChanged=function(){return e.MapUtils.reduce(this.initParameters.itemStates,function(t,n,i){return i===e.CheckboxStateMachine.State.AttachedByUser||i===e.CheckboxStateMachine.State.DetachedByUser?t+1:t},0)},t.prototype.countCheckedItems=function(){var t=this;return e.MapUtils.reduce(this.initParameters.itemStates,function(e,n,i){return t.checkboxStateMachine.isElementChecked(i)?e+1:e},0)},t.prototype.setupListItemFocusedAreaClickHandler=function(){var e,t=this;this.controls.Container.on(((e={}).change=this.stateChangedHandler,e),this.inputTypeCheckboxSelector),this.controls.Container.on("click",this.listItemFocusedAreaSelector,function(e){var n=$(e.target),i=t.closestItem(n);if(t.isClickTargetEnabled(n,i))if(t.targetIsFolderActionExpand(n))t.expandOrCollapseFolder(i);else if(t.isListItemFocusedArea(n)){var s=t.getCheckbox(t.getItemId(i));s.prop("checked",!s.is(":checked")).change()}}),this.controls.Container.on("keyup",this.listItemFocusedAreaSelector,function(e){if(e.which===CCL.CommonConstants.keyCodes.space){var n=$(e.target);t.targetIsFolderActionExpand(n)&&t.expandOrCollapseFolder(t.closestItem(n))}})},t.prototype.isClickTargetEnabled=function(e,t){return e.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.FolderActionExpand)).length<=0||this.initParameters.allowFolderSelection&&this.isCheckboxExistAndEnabled(t)},t.prototype.targetIsFolderActionExpand=function(e){return e.is(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.FolderActionExpand))||e.closest(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.FolderActionExpand)).length>0},t.prototype.updateItemState=function(t,n){var i=this.getItemId(t),s=this.initParameters.itemStates.get(i)||e.CheckboxStateMachine.State.Empty,o=this.checkboxStateMachine.validateAndTransferElementStateAfterClick(n,s);return this.initParameters.itemStates.set(i,o),this.countCheckedItems()},t.prototype.expandOrCollapseFolder=function(e){var t=this,i=e.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.FolderActionExpand)).first(),s=i.data(this.settings.DataAttributes.FolderActionExpand),o=e.find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.FolderAppendTarget)).first();if(s)s===n.Expanded?this.setFolderState(o,i,n.Collapsed):s===n.Collapsed&&this.setFolderState(o,i,n.Expanded);else{this.setFolderState(o,i,n.Loading);var r={folderId:this.getItemId(e)};this.getFolderContent(r).done(function(e){o.append(e),t.setFolderState(o,i,n.Expanded),t.onFolderContentLoaded()})}},t.prototype.isCheckboxExistAndEnabled=function(e){var t=this.getCheckbox(this.getItemId(e));return t&&t.length>0&&t.is(":enabled")},t.prototype.setFolderState=function(e,t,i){e.toggle(i===n.Expanded),this.closestListItemFocusedArea(t).find(CCL.CommonFunctions.getDataSelector(this.settings.DataAttributes.FolderTitle)).toggleClass(this.settings.CssClasses.FontBold,i===n.Expanded),t.data(this.settings.DataAttributes.FolderActionExpand,i);var s=t.find("."+this.settings.CssClasses.FolderStateExpanded+",."+this.settings.CssClasses.FolderStateCollapsed);s.toggleClass(this.settings.CssClasses.FolderStateCollapsed,i!==n.Expanded),s.toggleClass(this.settings.CssClasses.FolderStateExpanded,i===n.Expanded)},t.prototype.isClosestLabel=function(e){return e.closest("label").length>0},t.prototype.getFolderContent=function(e){return $.ajax({type:"GET",url:this.settings.Urls.FolderContent,data:e,dataType:"html"})},t.prototype.isListItemFocusedArea=function(e){return e.is(this.listItemFocusedAreaSelector)},t.prototype.closestListItemFocusedArea=function(e){return e.closest(this.listItemFocusedAreaSelector)},t.prototype.closestItem=function(e){return e.closest(this.itemSelector)},t.prototype.getItemId=function(e){return e.data(this.settings.DataAttributes.ItemId)},t.prototype.getCheckbox=function(e){return $("#"+this.controls.CheckboxItemPrefix+e)},t}();t.TreeViewSelector=i}(e.TreeViewSelector||(e.TreeViewSelector={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){e.getFormDataWithAttachedFilesAndFileSizes=function(e){var t=e.files,n=new Array;if(t.length>0&&FormData){for(var i=new FormData,s=0;s<t.length;s++)t[s].size>0&&(i.append("file"+s,t[s]),n.push(t[s].size));return{formData:i,fileSizes:n}}}}(e.UploadFileHelper||(e.UploadFileHelper={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){this.timeout=500};e.IframeLoadingIndicatorSettings=t;var n=function(){function e(e){var t=this;this.settings=e,this.showAfterDelay=!0,this.loadingIndicator=$("#"+this.settings.loadingIndicatorClientId),$(window).load(function(){$("#"+t.settings.iframeClientId).ready(function(){t.hideIndicator()})}),$(document).on("cssmodal:show",function(){t.hideIndicator()}),setTimeout(function(){t.showAfterDelay&&t.loadingIndicator.show()},this.settings.timeout)}return e.prototype.hideIndicator=function(){null!=this.settings.onHideCallback&&this.settings.onHideCallback(),this.showAfterDelay=!1,this.loadingIndicator.hide()},e}();e.IframeLoadingIndicator=n}(e.ViewLearningToolElement||(e.ViewLearningToolElement={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){!function(e){var t=function(){function e(){var e=this;this.featureDialogMap={},this.antiForgerySettings={},this.dispatch=function(t){switch(t.type){case CCL.Onboarding.Extensions.MessageType.CompleteFeature:e.completeFeatures(t.features);break;case CCL.Onboarding.Extensions.MessageType.TriggerOnboardingFeature:e.triggerFeature(t.featureId);break;case CCL.Onboarding.Extensions.MessageType.HideOverlay:e.hideOverlay();break;case CCL.Onboarding.Extensions.MessageType.ShowOverlay:e.showOverlay();break;case CCL.Onboarding.Extensions.MessageType.RequestFeatureState:e.requestFeatureState(t.featureId).done(function(n,i,s){var o=e.extensionIframe.get(0).contentWindow,r=new CCL.CommonWindowMessages.GenericMessage(CCL.CommonWindowMessages.MessageNames.extensionOnboarding),a={featureId:t.featureId,type:CCL.Onboarding.Extensions.MessageType.ReceiveFeatureState};$.extend(a,n),CCL.CommonFunctions.makePostMessageCallWithData(o,r,a)})}},this.triggerFeature=function(t){t&&e.requestFeatureState(t).done(function(n,i,s){if(n.IsCompleted)e.triggerFeature(e.featureDialogMap[t].nextFeatureId);else{var o=window[e.featureDialogMap[t].dialogClientId];o.blockHighlightZone=!0,o.openDialog(function(n){if(n){var i=[e.featureDialogMap[t].featuresForComplete];e.completeFeatures(i)}else e.triggerFeature(e.featureDialogMap[t].nextFeatureId)})}})},this.completeFeatures=function(t){for(var n=0;n<t.length;n++){var i=t[n];if(i){var s=e.onboardingServiceUrl;CCL.CommonFunctions.safeAjax({url:s.replace("{featureId}",i),type:"PUT",headers:(o={},o[e.antiForgerySettings.headerName]=e.antiForgerySettings.headerValue,o)})}}var o}}return e.prototype.init=function(e,t,n){this.pageOptions=n,this.onboardingServiceUrl=e,this.extensionIframe=t,this.antiForgerySettings=this.pageOptions.antiForgerySettings,this.featureDialogMap[CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentLearningToolOptions]={dialogClientId:n.optionsOnboradingClientId,nextFeatureId:CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentReminders,featuresForComplete:[CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentReminders]},this.featureDialogMap[CCL.Onboarding.Extensions.OnboardingFeatures.AssignmentReminders]={dialogClientId:n.pageFunctionsClientId},CCL.CommonFunctions.attachPostMessageEventListener($(window),CCL.CommonWindowMessages.MessageNames.extensionOnboarding,this.dispatch)},e.prototype.showOverlay=function(){this.extensionIframe.css("position","relative"),this.extensionIframe.css("z-index","1000"),$("<div></div>").appendTo(document.body).addClass(this.pageOptions.cssClasses.onboardingDialogMask).css({opacity:"0",filter:"alpha(opacity=0)","z-index":997}).fadeTo(0,1)},e.prototype.hideOverlay=function(){this.extensionIframe.css("position",""),this.extensionIframe.css("z-index",""),$("."+this.pageOptions.cssClasses.onboardingDialogMask).remove()},e.prototype.requestFeatureState=function(e){return $.ajax({url:this.onboardingServiceUrl.replace("{featureId}",e),type:"GET"})},e}();e.PostMessageDispatcher=t}(e.ViewLearningToolElement||(e.ViewLearningToolElement={}))}(e.Onboarding||(e.Onboarding={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(t){var n=function(){function t(e,t){var n=this;window[e]=this,this.settings=t,$(function(){CCL.CommonFunctions.attachPostMessageEventListener($(window),n.settings.SendElementIdToCourseFeature,function(e){n.elementList.addElement(e.elementId).done(function(){return n.refreshLeftMenu(e.folderId,e.elementId,e.notFocusingOnElement)})}),n.elementList=window[n.settings.ClientInstanceNames.ElementListClient],n.feedback=window[n.settings.ClientInstanceNames.Feedback],n.$titleTextBox=$("#"+n.settings.Controls.TitleTextBox),n.$saveButton=$("#"+n.settings.Controls.SaveButton),n.$learningObjectiveSelector=$("#"+n.settings.Controls.LearningObjectiveSelector),n.$saveButton.click(function(){var e=""!==n.$titleTextBox.val();return e||(n.feedback.showMessage(CCL.FeedbackType.Error,n.settings.Terms.ValidationError),$("html, body").animate({scrollTop:0})),e}),$("."+n.settings.Css.AddLinkCss).click(function(e){return n.onAddLinkClick($(e.currentTarget))})})}return t.prototype.addElement=function(e,t,n,i){this.elementList.addElementItem(e,t,n,i)},t.prototype.removeElement=function(e){this.elementList.deleteElement(e)},t.prototype.refreshLeftMenu=function(e,t,n){var i=top;i&&i.reloadFolder&&(i.reloadFolder(),i.reloadFolder("item"+e,"item"+t),i.notFocusingOnElement=n)},t.prototype.onAddLinkClick=function(t){var n=this,i=parseInt(t.data(this.settings.DataAttributes.ElementType),10);if(parseInt(t.data(this.settings.DataAttributes.ElementExternalSource),10)===e.AddResourceMenu.ElementExternalSourceType.Course){var s={locationId:this.settings.CourseId,locationType:e.AddResourceMenu.ElementExternalSourceType.Course},o=this.elementList.getElementIds(),r=new Map;$.each(o,function(t,n){r.set(n,e.CheckboxStateMachine.State.Saved)});var a=i===e.ElementLinkDialog.ContentElementType.Resources?this.settings.Terms.AddResource:this.settings.Terms.AddActivity,l={elementStates:e.MapUtils.makeCopy(r),elementType:i,showAll:!1,header:a,learningObjectiveId:this.$learningObjectiveSelector.val(),allowFolderSelection:!1,openerPage:e.ElementLinkDialog.ElementsPopupOpener.WorkingPortfolioTask,afterOkClickCallback:function(t){var i=[],s=[];t&&t.forEach(function(t,n){t===e.CheckboxStateMachine.State.AttachedByUser||t===e.CheckboxStateMachine.State.Saved?i.push(n):t===e.CheckboxStateMachine.State.DetachedByUser&&s.push(n)}),n.elementList.deleteElements(s),n.elementList.addElements(i)}};e.ElementLinkDialog.elementLinkDialogManagerInstance.openDialog(l,s)}},t}();t.AddEditTask=n}(e.WorkingPortfolio||(e.WorkingPortfolio={}))}(ItslearningWeb||(ItslearningWeb={})),function(e){!function(e){var t=function(){function e(e,t,n){this.settings=t,this.getSelectedIds=n,window[e]=this}return e.prototype.transferToPortfolio=function(e){if(null!=this.getSelectedIds){var t=this.getSelectedIds();if(0===t.length)CCL.CommonFunctions.jAlertAjaxError(this.settings.Terms.NoElementsSelected,this.settings.Terms.Alert,this.settings.Terms.Ok,!1);else{var n=this.settings.TransferPageUrlConstantPart+("&"+this.getTransferLocationRequestItem(e))+"&"+this.settings.RequestItems.ElementIds+"="+t.join();window.location.href=n}}},e.prototype.getTransferLocationRequestItem=function(e){var t=e.startsWith(this.settings.Prefixes.CourseIdPrefix),n=t?this.settings.RequestItems.CourseId:this.settings.RequestItems.PortfolioId,i=t?this.settings.Prefixes.CourseIdPrefix:this.settings.Prefixes.PortfolioIdPrefix;return n+"="+parseInt(e.substring(i.length),10)},e}();e.WorkingPortfolio=t}(e.WorkingPortfolio||(e.WorkingPortfolio={}))}(ItslearningWeb||(ItslearningWeb={}));